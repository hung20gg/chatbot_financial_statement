[
    {
        "id": "05531948-0c7c-4c04-b5b6-ed8dc6ba4d19",
        "question": "What were the Debt-to-Equity ratios of Vietcombank and Techcombank in 2022?",
        "answer": "Table 1\n| stock_code   |     dter |\n|:-------------|---------:|\n| TCB          |  5.16295 |\n| VCB          | 12.3717  |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT stock_code, data AS dter\nFROM financial_ratio\nWHERE ratio_code = 'DTER'\nAND stock_code IN ('VCB', 'TCB')\nAND year = 2022\nAND quarter = 0;\n"
            }
        ],
        "score": 1,
        "difficulty": 1,
        "response": "Table 1\n| stock_code   |\n|:-------------|\n| VCB          |\n| TCB          |\n\nTable 2\n| stock_code   |   year |   debt_to_equity_ratio |\n|:-------------|-------:|-----------------------:|\n| VCB          |   2022 |               12.3717  |\n| TCB          |   2022 |                5.16295 |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT stock_code \nFROM company_info \nWHERE (stock_code = 'VCB' OR stock_code = 'TCB') AND is_bank = TRUE;\n"
            },
            {
                "language": "sql",
                "code": "SELECT fr.stock_code, fr.year, fr.data AS Debt_To_Equity_Ratio\nFROM financial_ratio fr\nINNER JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\nINNER JOIN company_info ci ON fr.stock_code = ci.stock_code\nWHERE fr.stock_code IN ('VCB', 'TCB') \n  AND fr.year = 2022 \n  AND fr.quarter = 0 \n  AND mcr.ratio_name = 'Debt To Equity Ratio'\nLIMIT 100;\n"
            }
        ],
        "time": 58.818387031555176,
        "evaluate": 0.5,
        "input_token": 9787,
        "output_token": 2687
    },
    {
        "id": "6ee96cd0-65dc-4dca-b7d0-0320dc63353c",
        "question": "What is the Return on Equity (ROE) for Vinamilk, Masan Group, and Hoa Phat Group for the fiscal year 2023?",
        "answer": "Table 1\n| stock_code   |       roe |\n|:-------------|----------:|\n| HPG          | 0.0661282 |\n| MSN          | 0.0489033 |\n| VNM          | 0.257506  |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT stock_code, data AS ROE\nFROM financial_ratio\nWHERE ratio_code = 'ROE'\n  AND stock_code IN ('VNM', 'MSN', 'HPG')\n  AND year = 2023\n  AND quarter = 0;\n"
            }
        ],
        "score": 1,
        "difficulty": 1,
        "response": "Table 1\n| stock_code   |   year |   quarter | ratio_name       |   roe_value |\n|:-------------|-------:|----------:|:-----------------|------------:|\n| HPG          |   2023 |         0 | Return On Equity |   0.0661282 |\n| MSN          |   2023 |         0 | Return On Equity |   0.0489033 |\n| VNM          |   2023 |         0 | Return On Equity |   0.257506  |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT \n  fr.stock_code,\n  fr.year,\n  fr.quarter,\n  mcr.ratio_name,\n  fr.data AS ROE_Value\nFROM \n  financial_ratio fr\n  INNER JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\nWHERE \n  fr.stock_code IN ('VNM', 'MSN', 'HPG')  -- Identified stock codes\n  AND fr.year = 2023  -- Fiscal year 2023\n  AND fr.quarter = 0  -- Annual report (quarter = 0)\n  AND mcr.ratio_name = 'Return On Equity'  -- ROE ratio\nLIMIT 100;  -- Add limit as per the database schema requirement\n"
            }
        ],
        "time": 59.78657293319702,
        "evaluate": 0.5,
        "input_token": 0,
        "output_token": 0
    },
    {
        "id": "9421f908-f430-45de-b536-6b9e1ebdfb1c",
        "question": "What were the total assets and total liabilities of Vietcombank, Techcombank, and ACB at the end of 2022?",
        "answer": "Table 1\n| stock_code   | category_code   |        data |\n|:-------------|:----------------|------------:|\n| VCB          | BS_300          | 1.81382e+09 |\n| VCB          | BS_400          | 1.67817e+09 |\n| ACB          | BS_300          | 6.07875e+08 |\n| ACB          | BS_400          | 5.49437e+08 |\n| TCB          | BS_300          | 6.99033e+08 |\n| TCB          | BS_400          | 5.85608e+08 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    stock_code,\n    category_code,\n    data\nFROM \n    bank_financial_report\nWHERE \n    year = 2022\n    AND quarter = 0\n    AND stock_code IN ('VCB', 'TCB', 'ACB')\n    AND category_code IN ('BS_300', 'BS_400');\n"
            }
        ],
        "score": 1,
        "difficulty": 2,
        "response": "Table 1\n| stock_code   |   year | category          |        data |\n|:-------------|-------:|:------------------|------------:|\n| ACB          |   2022 | Total assets      | 6.07875e+08 |\n| ACB          |   2022 | Total liabilities | 5.49437e+08 |\n| TCB          |   2022 | Total assets      | 6.99033e+08 |\n| TCB          |   2022 | Total liabilities | 5.85608e+08 |\n| VCB          |   2022 | Total assets      | 1.81382e+09 |\n| VCB          |   2022 | Total liabilities | 1.67817e+09 |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT \n  bfr.stock_code,\n  bfr.year,\n  mccb.en_caption AS category,\n  bfr.data\nFROM \n  bank_financial_report bfr\n  INNER JOIN map_category_code_bank mccb ON bfr.category_code = mccb.category_code\nWHERE \n  bfr.stock_code IN ('VCB', 'TCB', 'ACB')\n  AND bfr.year = 2022\n  AND bfr.quarter = 0  -- Annual report\n  AND mccb.en_caption IN ('Total assets', 'Total liabilities')\nORDER BY \n  bfr.stock_code, \n  mccb.en_caption\nLIMIT 100;\n"
            }
        ],
        "time": 59.8363835811615,
        "evaluate": 1,
        "input_token": 0,
        "output_token": 0
    },
    {
        "id": "52880a2b-08dd-4e7e-b453-7bfa90617938",
        "question": "Compare the Return on Assets (ROA) and Return on Equity (ROE) of Vinamilk and Masan Group for the fiscal year 2023.  Additionally, provide the total assets and total equity for both companies for the same period.",
        "answer": "Table 1\n| stock_code   | ratio_code   |   ratio_value |\n|:-------------|:-------------|--------------:|\n| MSN          | ROA          |     0.0126875 |\n| MSN          | ROE          |     0.0489033 |\n| VNM          | ROA          |     0.171232  |\n| VNM          | ROE          |     0.257506  |\n\nTable 2\n| stock_code   | en_caption     |       value |\n|:-------------|:---------------|------------:|\n| VNM          | TOTAL ASSETS   | 5.26734e+07 |\n| VNM          | Owner's equity | 3.50257e+07 |\n| MSN          | TOTAL ASSETS   | 1.47383e+08 |\n| MSN          | Owner's equity | 3.82372e+07 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "-- Step 1: Retrieve ROA and ROE for Vinamilk (VNM) and Masan Group (MSN) for fiscal year 2023\nSELECT \n    fr.stock_code,\n    fr.ratio_code,\n    fr.data AS ratio_value\nFROM \n    financial_ratio fr\nWHERE \n    fr.stock_code IN ('VNM', 'MSN') AND\n    fr.year = 2023 AND\n    fr.quarter = 0 AND\n    fr.ratio_code IN ('ROA', 'ROE');\n\n-- Step 2: Retrieve total assets and total equity for Vinamilk (VNM) and Masan Group (MSN) for fiscal year 2023\nSELECT \n    nfr.stock_code,\n    mcc.en_caption,\n    nfr.data AS value\nFROM \n    non_bank_financial_report nfr\nJOIN \n    map_category_code_non_bank mcc ON nfr.category_code = mcc.category_code\nWHERE \n    nfr.stock_code IN ('VNM', 'MSN') AND\n    nfr.year = 2023 AND\n    nfr.quarter = 0 AND\n    mcc.category_code IN ('BS_270', 'BS_410'); -- BS_270: TOTAL ASSETS, BS_410: Owner's equity\n"
            }
        ],
        "score": 1,
        "difficulty": 3,
        "response": "Table 1\n| stock_code   | is_bank   | is_securities   |\n|:-------------|:----------|:----------------|\n| VNM          | False     | False           |\n| MSN          | False     | False           |\n\nTable 2\n| metric_type   | company   | metric_name      |       value |\n|:--------------|:----------|:-----------------|------------:|\n| Assets/Equity | MSN       | Total Assets     | 1.09146e+08 |\n| Assets/Equity | MSN       | Total Equity     | 3.82372e+07 |\n| ROA/ROE       | MSN       | Return on Assets | 0.0126875   |\n| ROA/ROE       | MSN       | Return on Equity | 0.0489033   |\n| Assets/Equity | VNM       | Total Assets     | 1.76476e+07 |\n| Assets/Equity | VNM       | Total Equity     | 3.50257e+07 |\n| ROA/ROE       | VNM       | Return on Assets | 0.171232    |\n| ROA/ROE       | VNM       | Return on Equity | 0.257506    |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT stock_code, is_bank, is_securities \nFROM company_info \nWHERE stock_code IN ('VNM', 'MSN');\n"
            },
            {
                "language": "sql",
                "code": "-- Combine results for ROA, ROE, Total Assets, and Total Equity for both companies\n\nWITH \n  -- Extract ROA and ROE for VNM and MSN (FY2023, quarter=0)\n  ratios AS (\n    SELECT \n      stock_code, \n      ratio_code, \n      data\n    FROM \n      financial_ratio\n    WHERE \n      stock_code IN ('VNM', 'MSN') \n      AND year = 2023 \n      AND quarter = 0 \n      AND ratio_code IN ('ROA', 'ROE')\n  ),\n\n  -- Extract Total Assets and Total Equity for VNM and MSN (FY2023, quarter=0)\n  -- Assuming category codes for Total Assets and Total Equity based on common VAS/IFRS practices\n  -- Please verify the actual category codes used in your database\n  assets_equity AS (\n    SELECT \n      stock_code, \n      category_code, \n      data\n    FROM \n      non_bank_financial_report\n    WHERE \n      stock_code IN ('VNM', 'MSN') \n      AND year = 2023 \n      AND quarter = 0 \n      AND category_code IN ('BS_300', 'BS_400')  -- Replace with actual category codes for Total Assets and Total Equity\n  )\n\n-- Combine and format the results\nSELECT \n  'ROA/ROE' AS metric_type,\n  stock_code AS company,\n  CASE ratio_code \n    WHEN 'ROA' THEN 'Return on Assets'\n    WHEN 'ROE' THEN 'Return on Equity'\n  END AS metric_name,\n  data AS value\nFROM \n  ratios\n\nUNION ALL\n\nSELECT \n  'Assets/Equity' AS metric_type,\n  stock_code AS company,\n  CASE category_code \n    -- Replace with actual category codes and descriptions for Total Assets and Total Equity\n    WHEN 'BS_300' THEN 'Total Assets'\n    WHEN 'BS_400' THEN 'Total Equity'\n  END AS metric_name,\n  data AS value\nFROM \n  assets_equity\n\nORDER BY \n  company, \n  metric_type, \n  metric_name\n\nLIMIT 100;  -- Adjust the LIMIT as necessary\n"
            }
        ],
        "time": 77.01070523262024,
        "evaluate": 0,
        "input_token": 4333,
        "output_token": 1328
    },
    {
        "id": "481ebd36-c43a-4af2-901b-99a8e6964217",
        "question": "Compare the Return on Equity (ROE) of Vinamilk and Masan Group for the fiscal year 2023.",
        "answer": "Table 1\n| stock_code   |       roe |\n|:-------------|----------:|\n| MSN          | 0.0489033 |\n| VNM          | 0.257506  |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT stock_code, data AS ROE\nFROM financial_ratio\nWHERE ratio_code = 'ROE'\n  AND stock_code IN ('VNM', 'MSN')\n  AND year = 2023\n  AND quarter = 0;\n"
            }
        ],
        "score": 1,
        "difficulty": 1,
        "response": "Table 1\n| stock_code   |\n|:-------------|\n| VNM          |\n| MSN          |\n\nTable 2\n| stock_code   |   year |   quarter |   roe_value |\n|:-------------|-------:|----------:|------------:|\n| MSN          |   2023 |         0 |   0.0489033 |\n| VNM          |   2023 |         0 |   0.257506  |\n\nTable 3\n| stock_code   |   year |   quarter |   roe_value |\n|:-------------|-------:|----------:|------------:|\n| MSN          |   2023 |         0 |   0.0489033 |\n| VNM          |   2023 |         0 |   0.257506  |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT stock_code\nFROM company_info\nWHERE (stock_code = 'VNM' OR stock_code = 'MSN');  -- Assuming stock codes based on provided company details\n\n-- Output:\n-- | stock_code |\n-- |------------|\n-- | VNM        |\n-- | MSN        |\n"
            },
            {
                "language": "sql",
                "code": "SELECT \n  fr.stock_code,\n  fr.year,\n  fr.quarter,\n  fr.data AS ROE_Value\nFROM \n  financial_ratio fr\n  INNER JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\nWHERE \n  fr.stock_code IN ('VNM', 'MSN')  -- Using stock codes from Step 1\n  AND fr.year = 2023\n  AND fr.quarter = 0  -- Fiscal year 2023, annual report\n  AND mcr.ratio_name = 'Return On Equity';  -- Ensure correct ratio code for ROE\n\n-- Output:\n-- | stock_code | year | quarter | ROE_Value |\n-- |------------|------|---------|-----------|\n-- | VNM        | 2023 | 0       |  xxx.xxx  |\n-- | MSN        | 2023 | 0       |  xxx.xxx  |\n"
            },
            {
                "language": "sql",
                "code": "SELECT \n  fr.stock_code,\n  fr.year,\n  fr.quarter,\n  fr.data AS ROE_Value\nFROM \n  financial_ratio fr\n  INNER JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\nWHERE \n  fr.stock_code IN ('VNM', 'MSN')\n  AND fr.year = 2023\n  AND fr.quarter = 0\n  AND mcr.ratio_name = 'Return On Equity'\nLIMIT 100;  -- Added LIMIT, as per the notes\n"
            }
        ],
        "time": 35.83058166503906,
        "evaluate": 0.5,
        "input_token": 3138,
        "output_token": 1220
    },
    {
        "id": "61803c95-30e1-4a6f-8f02-ebde74c1120c",
        "question": "What were the operating cash flows and capital expenditures for Vietcombank, Techcombank, and VPBank in Q2 2024?  Calculate the free cash flow for each bank.",
        "answer": "Table 1\n| stock_code   |   year |   quarter |   operating_cash_flow |   capital_expenditures |   free_cash_flow |\n|:-------------|-------:|----------:|----------------------:|-----------------------:|-----------------:|\n| TCB          |   2024 |         2 |                     0 |                -280254 |           280254 |\n| VPB          |   2024 |         2 |                     0 |                  -1490 |             1490 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    bfr.stock_code,\n    bfr.year,\n    bfr.quarter,\n    SUM(CASE WHEN bfr.category_code = 'CF_009' THEN bfr.data ELSE 0 END) AS operating_cash_flow,\n    SUM(CASE WHEN bfr.category_code = 'CF_025' THEN bfr.data ELSE 0 END) AS capital_expenditures,\n    SUM(CASE WHEN bfr.category_code = 'CF_009' THEN bfr.data ELSE 0 END) - \n    SUM(CASE WHEN bfr.category_code = 'CF_025' THEN bfr.data ELSE 0 END) AS free_cash_flow\nFROM \n    bank_financial_report bfr\nWHERE \n    bfr.stock_code IN ('VCB', 'TCB', 'VPB') AND\n    bfr.year = 2024 AND\n    bfr.quarter = 2 AND\n    bfr.category_code IN ('CF_009', 'CF_025')\nGROUP BY \n    bfr.stock_code, bfr.year, bfr.quarter;\n"
            }
        ],
        "score": 1,
        "difficulty": 2,
        "response": "Table 1\n| stock_code   |   year |   quarter | operating_cash_flow   |   capital_expenditures |\n|:-------------|-------:|----------:|:----------------------|-----------------------:|\n| TCB          |   2024 |         2 |                       |            0           |\n| VPB          |   2024 |         2 |                       |            1.02289e+06 |\n\nTable 2\n| stock_code   |   year |   quarter | operating_cash_flow   |   capital_expenditures | free_cash_flow   |\n|:-------------|-------:|----------:|:----------------------|-----------------------:|:-----------------|\n| TCB          |   2024 |         2 |                       |            0           |                  |\n| VPB          |   2024 |         2 |                       |            1.02289e+06 |                  |\n\nTable 3\n| stock_code   |   year |   quarter | operating_cash_flow   |   capital_expenditures | free_cash_flow   |\n|:-------------|-------:|----------:|:----------------------|-----------------------:|:-----------------|\n| TCB          |   2024 |         2 |                       |            0           |                  |\n| VPB          |   2024 |         2 |                       |            1.02289e+06 |                  |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "WITH target_companies AS (\n  SELECT stock_code\n  FROM company_info\n  WHERE stock_code IN ('VCB', 'TCB', 'VPB')\n)\nSELECT \n  bfr.stock_code,\n  bfr.year,\n  bfr.quarter,\n  -- Assuming CF_009 is the correct category code for operating cash flows (based on map_category_code_bank)\n  MAX(CASE WHEN bfr.category_code = 'CF_009' THEN bfr.data END) AS operating_cash_flow,\n  -- Assuming CF_021 is the correct category code for capital expenditures (based on map_category_code_bank)\n  MAX(CASE WHEN bfr.category_code = 'CF_021' THEN bfr.data END) AS capital_expenditures\nFROM \n  bank_financial_report bfr\n  JOIN target_companies tc ON bfr.stock_code = tc.stock_code\nWHERE \n  bfr.year = 2024\n  AND bfr.quarter = 2  -- Q2\nGROUP BY \n  bfr.stock_code, bfr.year, bfr.quarter\nLIMIT 100;\n"
            },
            {
                "language": "sql",
                "code": "WITH financial_data AS (\n  -- Reuse the query from Step 1\n  WITH target_companies AS (\n    SELECT stock_code\n    FROM company_info\n    WHERE stock_code IN ('VCB', 'TCB', 'VPB')\n  )\n  SELECT \n    bfr.stock_code,\n    bfr.year,\n    bfr.quarter,\n    MAX(CASE WHEN bfr.category_code = 'CF_009' THEN bfr.data END) AS operating_cash_flow,\n    MAX(CASE WHEN bfr.category_code = 'CF_021' THEN bfr.data END) AS capital_expenditures\n  FROM \n    bank_financial_report bfr\n    JOIN target_companies tc ON bfr.stock_code = tc.stock_code\n  WHERE \n    bfr.year = 2024\n    AND bfr.quarter = 2  -- Q2\n  GROUP BY \n    bfr.stock_code, bfr.year, bfr.quarter\n)\nSELECT \n  stock_code,\n  year,\n  quarter,\n  operating_cash_flow,\n  capital_expenditures,\n  -- Calculate free cash flow\n  (operating_cash_flow - capital_expenditures) AS free_cash_flow\nFROM \n  financial_data\nLIMIT 100;\n"
            },
            {
                "language": "sql",
                "code": "WITH target_companies AS (\n  SELECT stock_code\n  FROM company_info\n  WHERE stock_code IN ('VCB', 'TCB', 'VPB')\n),\nfinancial_data AS (\n  SELECT \n    bfr.stock_code,\n    bfr.year,\n    bfr.quarter,\n    MAX(CASE WHEN bfr.category_code = 'CF_009' THEN bfr.data END) AS operating_cash_flow,\n    MAX(CASE WHEN bfr.category_code = 'CF_021' THEN bfr.data END) AS capital_expenditures\n  FROM \n    bank_financial_report bfr\n    JOIN target_companies tc ON bfr.stock_code = tc.stock_code\n  WHERE \n    bfr.year = 2024\n    AND bfr.quarter = 2  -- Q2\n  GROUP BY \n    bfr.stock_code, bfr.year, bfr.quarter\n)\nSELECT \n  stock_code,\n  year,\n  quarter,\n  operating_cash_flow,\n  capital_expenditures,\n  (operating_cash_flow - capital_expenditures) AS free_cash_flow\nFROM \n  financial_data\nLIMIT 100;\n"
            }
        ],
        "time": 49.50947284698486,
        "evaluate": 0,
        "input_token": 2211,
        "output_token": 872
    },
    {
        "id": "b8a00999-b6af-4a1f-9e41-60a2aa7e4d01",
        "question": "Compare the Return on Equity (ROE) of Vinamilk, Masan Group, and Sabeco for the fiscal year 2023.",
        "answer": "Table 1\n| stock_code   |   return_on_equity |\n|:-------------|-------------------:|\n| MSN          |          0.0489033 |\n| SAB          |          0.166962  |\n| VNM          |          0.257506  |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    stock_code, \n    data AS return_on_equity\nFROM \n    financial_ratio\nWHERE \n    ratio_code = 'ROE' AND\n    year = 2023 AND\n    quarter = 0 AND\n    stock_code IN ('VNM', 'MSN', 'SAB');\n"
            }
        ],
        "score": 1,
        "difficulty": 1,
        "response": "Table 1\n| stock_code   |\n|:-------------|\n| VNM          |\n| MSN          |\n| SAB          |\n\nTable 2\n| stock_code   |   year |   quarter |       roe |\n|:-------------|-------:|----------:|----------:|\n| MSN          |   2023 |         0 | 0.0489033 |\n| SAB          |   2023 |         0 | 0.166962  |\n| VNM          |   2023 |         0 | 0.257506  |\n\nTable 3\n| stock_code   |   year |   quarter |       roe |\n|:-------------|-------:|----------:|----------:|\n| MSN          |   2023 |         0 | 0.0489033 |\n| SAB          |   2023 |         0 | 0.166962  |\n| VNM          |   2023 |         0 | 0.257506  |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT stock_code \nFROM company_info \nWHERE stock_code IN ('VNM', 'MSN', 'SAB');\n"
            },
            {
                "language": "sql",
                "code": "SELECT fr.stock_code, fr.year, fr.quarter, fr.data AS ROE\nFROM financial_ratio fr\nINNER JOIN map_category_code_ratio mcr \n  ON fr.ratio_code = mcr.ratio_code\nWHERE mcr.ratio_name = 'Return On Equity'\n  AND fr.stock_code IN ('VNM', 'MSN', 'SAB')\n  AND fr.year = 2023\n  AND fr.quarter = 0\nLIMIT 100;\n"
            },
            {
                "language": "sql",
                "code": "WITH identified_stock_codes AS (\n  SELECT stock_code \n  FROM company_info \n  WHERE stock_code IN ('VNM', 'MSN', 'SAB')\n)\nSELECT fr.stock_code, fr.year, fr.quarter, fr.data AS ROE\nFROM financial_ratio fr\nINNER JOIN map_category_code_ratio mcr \n  ON fr.ratio_code = mcr.ratio_code\nINNER JOIN identified_stock_codes isc \n  ON fr.stock_code = isc.stock_code\nWHERE mcr.ratio_name = 'Return On Equity'\n  AND fr.year = 2023\n  AND fr.quarter = 0\nLIMIT 100;\n"
            }
        ],
        "time": 47.172149658203125,
        "evaluate": 0.5,
        "input_token": 3731,
        "output_token": 1123
    },
    {
        "id": "74f9babe-9421-4bb7-a88f-a5c664b5a6da",
        "question": "What is the trend of the Current Ratio for Vietcombank, Techcombank, and ACB from 2020 to Q2 2024?",
        "answer": "Table 1\n|   year |   quarter | stock_code   |   current_ratio |\n|-------:|----------:|:-------------|----------------:|\n|   2020 |         0 | ACB          |         3.69815 |\n|   2021 |         0 | ACB          |         3.97544 |\n|   2022 |         0 | ACB          |         3.81624 |\n|   2023 |         0 | ACB          |         3.04283 |\n|   2024 |         1 | ACB          |         3.29123 |\n|   2020 |         0 | TCB          |         2.83619 |\n|   2021 |         0 | TCB          |         4.35343 |\n|   2022 |         0 | TCB          |         3.29776 |\n|   2023 |         0 | TCB          |         2.66367 |\n|   2024 |         1 | TCB          |         2.40445 |\n|   2024 |         2 | TCB          |         2.88946 |\n|   2020 |         0 | VCB          |         7.25011 |\n|   2021 |         0 | VCB          |         6.29498 |\n|   2022 |         0 | VCB          |         3.56816 |\n|   2023 |         0 | VCB          |         4.7828  |\n|   2024 |         1 | VCB          |         3.48899 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    fr.year, \n    fr.quarter, \n    fr.stock_code, \n    fr.data AS current_ratio\nFROM \n    financial_ratio fr\nJOIN \n    map_category_code_ratio mccr ON fr.ratio_code = mccr.ratio_code\nWHERE \n    mccr.ratio_name = 'Current Ratio'\n    AND fr.stock_code IN ('VCB', 'TCB', 'ACB')\n    AND ((fr.year BETWEEN 2020 AND 2023 AND fr.quarter = 0) OR \n         (fr.year = 2024 AND fr.quarter BETWEEN 1 AND 2))\nORDER BY \n    fr.stock_code, fr.year, fr.quarter;\n"
            }
        ],
        "score": 1,
        "difficulty": 2,
        "response": "Table 1\n| stock_code   |   year |   quarter |   currentratio |\n|:-------------|-------:|----------:|---------------:|\n| ACB          |   2020 |         0 |        3.69815 |\n| ACB          |   2021 |         0 |        3.97544 |\n| ACB          |   2022 |         0 |        3.81624 |\n| ACB          |   2023 |         0 |        3.04283 |\n| TCB          |   2020 |         0 |        2.83619 |\n| TCB          |   2021 |         0 |        4.35343 |\n| TCB          |   2022 |         0 |        3.29776 |\n| TCB          |   2023 |         0 |        2.66367 |\n| TCB          |   2024 |         2 |        2.88946 |\n| VCB          |   2020 |         0 |        7.25011 |\n| VCB          |   2021 |         0 |        6.29498 |\n| VCB          |   2022 |         0 |        3.56816 |\n| VCB          |   2023 |         0 |        4.7828  |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT \n  fr.stock_code,\n  fr.year,\n  fr.quarter,\n  fr.data AS CurrentRatio\nFROM \n  financial_ratio fr\n  INNER JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\nWHERE \n  fr.stock_code IN ('VCB', 'TCB', 'ACB')\n  AND mcr.ratio_name = 'Current Ratio'\n  AND (\n    (fr.year BETWEEN 2020 AND 2023 AND fr.quarter = 0)  -- Annual data for 2020-2023\n    OR (fr.year = 2024 AND fr.quarter = 2)  -- Q2 2024\n  )\nORDER BY \n  fr.stock_code,\n  fr.year,\n  fr.quarter\nLIMIT 100;  -- Add limit as per the database schema guidelines\n"
            }
        ],
        "time": 73.26215529441833,
        "evaluate": 0,
        "input_token": 1988,
        "output_token": 516
    },
    {
        "id": "3bdd12bf-a669-4f11-bd82-b368cc2c608f",
        "question": "What is the trend of the current ratio and quick ratio for BIDV, Eximbank, and OCB Bank from 2020 to Q2 2024,  considering their respective subsidiaries and investments?",
        "answer": "Table 1\n| stock_code   |   year |   quarter | ratio_name    |     data |\n|:-------------|-------:|----------:|:--------------|---------:|\n| BID          |   2020 |         0 | Current Ratio | 2.57276  |\n| BID          |   2021 |         0 | Current Ratio | 3.94763  |\n| BID          |   2022 |         0 | Current Ratio | 5.04924  |\n| BID          |   2023 |         0 | Current Ratio | 2.5701   |\n| BID          |   2024 |         1 | Current Ratio | 2.94967  |\n| BID          |   2024 |         2 | Current Ratio | 3.65939  |\n| EIB          |   2020 |         0 | Current Ratio | 6.67582  |\n| EIB          |   2021 |         0 | Current Ratio | 5.72966  |\n| EIB          |   2022 |         0 | Current Ratio | 5.16642  |\n| EIB          |   2023 |         0 | Current Ratio | 6.12482  |\n| EIB          |   2024 |         1 | Current Ratio | 6.11042  |\n| HDB          |   2020 |         0 | Current Ratio | 4.83941  |\n| HDB          |   2021 |         0 | Current Ratio | 5.9133   |\n| HDB          |   2022 |         0 | Current Ratio | 4.00626  |\n| HDB          |   2023 |         0 | Current Ratio | 3.6528   |\n| HDB          |   2024 |         1 | Current Ratio | 3.1524   |\n| OCB          |   2020 |         0 | Current Ratio | 1.11545  |\n| OCB          |   2021 |         0 | Current Ratio | 4.2912   |\n| OCB          |   2022 |         0 | Current Ratio | 2.74653  |\n| OCB          |   2023 |         0 | Current Ratio | 1.68853  |\n| OCB          |   2024 |         1 | Current Ratio | 2.58278  |\n| STB          |   2020 |         0 | Current Ratio | 1.56301  |\n| STB          |   2021 |         0 | Current Ratio | 1.02262  |\n| STB          |   2022 |         0 | Current Ratio | 1.09035  |\n| STB          |   2023 |         0 | Current Ratio | 0.700152 |\n| STB          |   2024 |         1 | Current Ratio | 1.0368   |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "WITH relevant_companies AS (\n    SELECT stock_code\n    FROM company_info\n    WHERE stock_code IN ('BID', 'EIB', 'OCB')\n    UNION\n    SELECT invest_on AS stock_code\n    FROM sub_and_shareholder\n    WHERE stock_code IN ('BID', 'EIB', 'OCB')\n),\nratios AS (\n    SELECT ratio_code\n    FROM map_category_code_ratio\n    WHERE ratio_name IN ('Current Ratio', 'Quick Ratio')\n)\nSELECT fr.stock_code, fr.year, fr.quarter, mcr.ratio_name, fr.data\nFROM financial_ratio fr\nJOIN ratios r ON fr.ratio_code = r.ratio_code\nJOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\nWHERE fr.stock_code IN (SELECT stock_code FROM relevant_companies)\nAND ((fr.year BETWEEN 2020 AND 2024 AND fr.quarter = 0) OR (fr.year = 2024 AND fr.quarter <= 2))\nORDER BY fr.stock_code, fr.year, fr.quarter, mcr.ratio_name;\n"
            }
        ],
        "score": 1,
        "difficulty": 4,
        "response": "Table 1\n| target_bank   | subsidiary   | investor   |\n|:--------------|:-------------|:-----------|\n| BID           | BSI          | BID        |\n| BID           | BIC          | BID        |\n| BID           | ND2          | BID        |\n| BID           | PVY          | BID        |\n| BID           | DPM          | BID        |\n| BID           | ASP          | BID        |\n| BID           | IJC          | BID        |\n| BID           | NT2          | BID        |\n| BID           | VCG          | BID        |\n| BID           | CII          | BID        |\n| BID           | PTL          | BID        |\n| BID           | PGC          | BID        |\n| EIB           | BLI          | EIB        |\n| EIB           | BLI          | EIB        |\n| EIB           | BLI          | EIB        |\n| EIB           | BLI          | EIB        |\n| EIB           | VDS          | EIB        |\n| EIB           | VDS          | EIB        |\n| EIB           | VDS          | EIB        |\n| EIB           | VDS          | EIB        |\n| EIB           | VAB          | EIB        |\n| EIB           | VAB          | EIB        |\n| EIB           | VAB          | EIB        |\n| EIB           | VAB          | EIB        |\n| EIB           | TDH          | EIB        |\n| EIB           | TDH          | EIB        |\n| EIB           | TDH          | EIB        |\n| EIB           | TDH          | EIB        |\n| EIB           | FDC          | EIB        |\n| EIB           | FDC          | EIB        |\n| EIB           | FDC          | EIB        |\n| EIB           | FDC          | EIB        |\n| EIB           | VCR          | EIB        |\n| EIB           | VCR          | EIB        |\n| EIB           | VCR          | EIB        |\n| EIB           | VCR          | EIB        |\n| EIB           | SJ1          | EIB        |\n| EIB           | SJ1          | EIB        |\n| EIB           | SJ1          | EIB        |\n| EIB           | SJ1          | EIB        |\n| OCB           | RBC          | OCB        |\n| OCB           | RBC          | OCB        |\n| BID           | HDB          | BID        |\n| EIB           | STB          | EIB        |\n| EIB           | STB          | EIB        |\n| EIB           | STB          | EIB        |\n| EIB           | STB          | EIB        |\n| OCB           | ORS          | OCB        |\n| OCB           | ORS          | OCB        |\n\nTable 2\n| relevant_stock_code   |   year |   quarter | ratio_name    |     data |\n|:----------------------|-------:|----------:|:--------------|---------:|\n| HDB                   |   2020 |         0 | Current Ratio | 4.83941  |\n| HDB                   |   2021 |         0 | Current Ratio | 5.9133   |\n| HDB                   |   2022 |         0 | Current Ratio | 4.00626  |\n| HDB                   |   2023 |         0 | Current Ratio | 3.6528   |\n| STB                   |   2020 |         0 | Current Ratio | 1.56301  |\n| STB                   |   2020 |         0 | Current Ratio | 1.56301  |\n| STB                   |   2020 |         0 | Current Ratio | 1.56301  |\n| STB                   |   2020 |         0 | Current Ratio | 1.56301  |\n| STB                   |   2021 |         0 | Current Ratio | 1.02262  |\n| STB                   |   2021 |         0 | Current Ratio | 1.02262  |\n| STB                   |   2021 |         0 | Current Ratio | 1.02262  |\n| STB                   |   2021 |         0 | Current Ratio | 1.02262  |\n| STB                   |   2022 |         0 | Current Ratio | 1.09035  |\n| STB                   |   2022 |         0 | Current Ratio | 1.09035  |\n| STB                   |   2022 |         0 | Current Ratio | 1.09035  |\n| STB                   |   2022 |         0 | Current Ratio | 1.09035  |\n| STB                   |   2023 |         0 | Current Ratio | 0.700152 |\n| STB                   |   2023 |         0 | Current Ratio | 0.700152 |\n| STB                   |   2023 |         0 | Current Ratio | 0.700152 |\n| STB                   |   2023 |         0 | Current Ratio | 0.700152 |\n\nTable 3\n| relevant_stock_code   |   year |   quarter | ratio_name    |     data |\n|:----------------------|-------:|----------:|:--------------|---------:|\n| HDB                   |   2020 |         0 | Current Ratio | 4.83941  |\n| HDB                   |   2021 |         0 | Current Ratio | 5.9133   |\n| HDB                   |   2022 |         0 | Current Ratio | 4.00626  |\n| HDB                   |   2023 |         0 | Current Ratio | 3.6528   |\n| STB                   |   2020 |         0 | Current Ratio | 1.56301  |\n| STB                   |   2020 |         0 | Current Ratio | 1.56301  |\n| STB                   |   2020 |         0 | Current Ratio | 1.56301  |\n| STB                   |   2020 |         0 | Current Ratio | 1.56301  |\n| STB                   |   2021 |         0 | Current Ratio | 1.02262  |\n| STB                   |   2021 |         0 | Current Ratio | 1.02262  |\n| STB                   |   2021 |         0 | Current Ratio | 1.02262  |\n| STB                   |   2021 |         0 | Current Ratio | 1.02262  |\n| STB                   |   2022 |         0 | Current Ratio | 1.09035  |\n| STB                   |   2022 |         0 | Current Ratio | 1.09035  |\n| STB                   |   2022 |         0 | Current Ratio | 1.09035  |\n| STB                   |   2022 |         0 | Current Ratio | 1.09035  |\n| STB                   |   2023 |         0 | Current Ratio | 0.700152 |\n| STB                   |   2023 |         0 | Current Ratio | 0.700152 |\n| STB                   |   2023 |         0 | Current Ratio | 0.700152 |\n| STB                   |   2023 |         0 | Current Ratio | 0.700152 |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "WITH target_banks AS (\n  SELECT stock_code\n  FROM company_info\n  WHERE stock_code IN ('BID', 'EIB', 'OCB')  -- Assuming these are the correct stock codes\n)\nSELECT \n  tb.stock_code AS target_bank,\n  ssh.invest_on AS subsidiary,\n  ssh.stock_code AS investor\nFROM \n  target_banks tb\n  LEFT JOIN sub_and_shareholder ssh ON tb.stock_code = ssh.stock_code\n  LEFT JOIN sub_and_shareholder ssh_inv ON tb.stock_code = ssh_inv.invest_on\n"
            },
            {
                "language": "sql",
                "code": "WITH target_banks AS (\n  SELECT stock_code\n  FROM company_info\n  WHERE stock_code IN ('BID', 'EIB', 'OCB')  -- Assuming these are the correct stock codes\n),\nrelevant_stock_codes AS (\n  SELECT \n    tb.stock_code AS target_bank,\n    COALESCE(ssh.invest_on, tb.stock_code) AS relevant_stock_code\n  FROM \n    target_banks tb\n    LEFT JOIN sub_and_shareholder ssh ON tb.stock_code = ssh.stock_code\n    LEFT JOIN sub_and_shareholder ssh_inv ON tb.stock_code = ssh_inv.invest_on\n)\nSELECT \n  rsc.relevant_stock_code,\n  fr.year,\n  fr.quarter,\n  mcr.ratio_name,\n  fr.data\nFROM \n  relevant_stock_codes rsc\n  JOIN financial_ratio fr ON rsc.relevant_stock_code = fr.stock_code\n  JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\nWHERE \n  fr.year BETWEEN 2020 AND 2024\n  AND (fr.quarter = 0 OR (fr.year = 2024 AND fr.quarter = 2))  -- Annual reports or Q2 2024\n  AND mcr.ratio_name IN ('Current Ratio', 'Quick Ratio')\nORDER BY \n  rsc.relevant_stock_code, fr.year, fr.quarter, mcr.ratio_name\nLIMIT 100;  -- Add a reasonable limit\n"
            },
            {
                "language": "sql",
                "code": "WITH target_banks AS (\n  SELECT stock_code\n  FROM company_info\n  WHERE stock_code IN ('BID', 'EIB', 'OCB')\n),\nrelevant_stock_codes AS (\n  SELECT \n    tb.stock_code AS target_bank,\n    COALESCE(ssh.invest_on, tb.stock_code) AS relevant_stock_code\n  FROM \n    target_banks tb\n    LEFT JOIN sub_and_shareholder ssh ON tb.stock_code = ssh.stock_code\n    LEFT JOIN sub_and_shareholder ssh_inv ON tb.stock_code = ssh_inv.invest_on\n)\nSELECT \n  rsc.relevant_stock_code,\n  fr.year,\n  fr.quarter,\n  mcr.ratio_name,\n  fr.data\nFROM \n  relevant_stock_codes rsc\n  JOIN financial_ratio fr ON rsc.relevant_stock_code = fr.stock_code\n  JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\nWHERE \n  fr.year BETWEEN 2020 AND 2024\n  AND (fr.quarter = 0 OR (fr.year = 2024 AND fr.quarter = 2))\n  AND mcr.ratio_name IN ('Current Ratio', 'Quick Ratio')\nORDER BY \n  rsc.relevant_stock_code, fr.year, fr.quarter, mcr.ratio_name\nLIMIT 100;\n"
            }
        ],
        "time": 52.19522476196289,
        "evaluate": 0,
        "input_token": 3445,
        "output_token": 1371
    },
    {
        "id": "5972ee68-a39a-4051-b3d5-59aa6a533359",
        "question": "For the year 2023, what was the total revenue, net income, and total assets of  Masan Group, Vinamilk, and  PetroVietnam Gas?  Additionally, provide the percentage of total assets attributable to subsidiaries or investments for each company.",
        "answer": "Table 1\n| stock_code   |   total_revenue |   net_income |   total_assets |   percentage_investment_assets |\n|:-------------|----------------:|-------------:|---------------:|-------------------------------:|\n| GAS          |     8.99539e+07 |  1.46395e+07 |    8.77545e+07 |                        2.05086 |\n| MSN          |     7.82516e+07 |  2.56297e+06 |    1.47383e+08 |                        0       |\n| VNM          |     6.03689e+07 |  1.09679e+07 |    5.26734e+07 |                        0       |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "WITH financial_data AS (\n    SELECT\n        nfr.stock_code,\n        SUM(CASE WHEN mcc.category_code = 'IS_010' THEN nfr.data ELSE 0 END) AS total_revenue,\n        SUM(CASE WHEN mcc.category_code = 'IS_050' THEN nfr.data ELSE 0 END) AS net_income,\n        SUM(CASE WHEN mcc.category_code = 'BS_270' THEN nfr.data ELSE 0 END) AS total_assets\n    FROM\n        non_bank_financial_report nfr\n    JOIN\n        map_category_code_non_bank mcc ON nfr.category_code = mcc.category_code\n    WHERE\n        nfr.year = 2023 AND nfr.quarter = 0 AND nfr.stock_code IN ('MSN', 'VNM', 'GAS')\n    GROUP BY\n        nfr.stock_code\n),\ninvestment_data AS (\n    SELECT\n        s.stock_code,\n        SUM(nfr.data) AS investment_assets\n    FROM\n        sub_and_shareholder s\n    JOIN\n        non_bank_financial_report nfr ON s.invest_on = nfr.stock_code\n    JOIN\n        map_category_code_non_bank mcc ON nfr.category_code = mcc.category_code\n    WHERE\n        nfr.year = 2023 AND nfr.quarter = 0 AND mcc.category_code = 'BS_270'\n    GROUP BY\n        s.stock_code\n)\nSELECT\n    fd.stock_code,\n    fd.total_revenue,\n    fd.net_income,\n    fd.total_assets,\n    COALESCE(id.investment_assets / NULLIF(fd.total_assets, 0) * 100, 0) AS percentage_investment_assets\nFROM\n    financial_data fd\nLEFT JOIN\n    investment_data id ON fd.stock_code = id.stock_code;\n"
            }
        ],
        "score": 1,
        "difficulty": 4,
        "response": "Table 1\n| stock_code   | industry                             |   total_revenue | net_income   | total_assets   |\n|:-------------|:-------------------------------------|----------------:|:-------------|:---------------|\n| VNM          | Food and Beverages                   |     6.04789e+07 |              |                |\n| MSN          | Food and Beverages                   |     7.8517e+07  |              |                |\n| GAS          | Utilities (Electricity, Water & Gas) |     9.00141e+07 |              |                |\n\nTable 2\n| stock_code   | industry                             | total_assets   | subsidiary_assets   | percentage_subsidary_assets   |\n|:-------------|:-------------------------------------|:---------------|:--------------------|:------------------------------|\n| VNM          | Food and Beverages                   |                |                     |                               |\n| MSN          | Food and Beverages                   |                |                     |                               |\n| GAS          | Utilities (Electricity, Water & Gas) |                |                     |                               |\n\nTable 3\n| stock_code   | industry                             |   total_revenue | net_income   | total_assets   | subsidiary_assets   | percentage_subsidary_assets   |\n|:-------------|:-------------------------------------|----------------:|:-------------|:---------------|:--------------------|:------------------------------|\n| VNM          | Food and Beverages                   |     6.04789e+07 |              |                |                     |                               |\n| MSN          | Food and Beverages                   |     7.8517e+07  |              |                |                     |                               |\n| GAS          | Utilities (Electricity, Water & Gas) |     9.00141e+07 |              |                |                     |                               |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT \n  ci.stock_code,\n  ci.industry,\n  -- Total Revenue\n  (SELECT data FROM non_bank_financial_report \n   WHERE stock_code = ci.stock_code AND year = 2023 AND quarter = 0 AND category_code = 'IS_001') AS total_revenue,\n  -- Net Income\n  (SELECT data FROM non_bank_financial_report \n   WHERE stock_code = ci.stock_code AND year = 2023 AND quarter = 0 AND category_code = 'IS_099') AS net_income,\n  -- Total Assets\n  (SELECT data FROM non_bank_financial_report \n   WHERE stock_code = ci.stock_code AND year = 2023 AND quarter = 0 AND category_code = 'BS_001') AS total_assets\nFROM \n  company_info ci\nWHERE \n  ci.stock_code IN ('MSN', 'VNM', 'GAS')\nLIMIT 100;\n"
            },
            {
                "language": "sql",
                "code": "SELECT \n  ci.stock_code,\n  ci.industry,\n  -- Total Assets (from previous query)\n  (SELECT data FROM non_bank_financial_report \n   WHERE stock_code = ci.stock_code AND year = 2023 AND quarter = 0 AND category_code = 'BS_001') AS total_assets,\n  -- Total Assets attributable to Subsidiaries or Investments\n  (SELECT SUM(CASE WHEN ssh.invest_on = ci.stock_code THEN nbfr.data ELSE 0 END) \n   FROM sub_and_shareholder ssh\n   JOIN non_bank_financial_report nbfr ON ssh.invest_on = nbfr.stock_code\n   WHERE nbfr.year = 2023 AND nbfr.quarter = 0 AND nbfr.category_code = 'BS_001' AND ssh.stock_code = ci.stock_code) AS subsidiary_assets,\n  -- Percentage Calculation\n  (SELECT \n     (SUM(CASE WHEN ssh.invest_on = ci.stock_code THEN nbfr.data ELSE 0 END) / \n      (SELECT data FROM non_bank_financial_report \n       WHERE stock_code = ci.stock_code AND year = 2023 AND quarter = 0 AND category_code = 'BS_001')) * 100\n   FROM sub_and_shareholder ssh\n   JOIN non_bank_financial_report nbfr ON ssh.invest_on = nbfr.stock_code\n   WHERE nbfr.year = 2023 AND nbfr.quarter = 0 AND nbfr.category_code = 'BS_001' AND ssh.stock_code = ci.stock_code) AS percentage_subsidary_assets\nFROM \n  company_info ci\nWHERE \n  ci.stock_code IN ('MSN', 'VNM', 'GAS')\nLIMIT 100;\n"
            },
            {
                "language": "sql",
                "code": "SELECT \n  ci.stock_code,\n  ci.industry,\n  -- Total Revenue\n  (SELECT data FROM non_bank_financial_report \n   WHERE stock_code = ci.stock_code AND year = 2023 AND quarter = 0 AND category_code = 'IS_001') AS total_revenue,\n  -- Net Income\n  (SELECT data FROM non_bank_financial_report \n   WHERE stock_code = ci.stock_code AND year = 2023 AND quarter = 0 AND category_code = 'IS_099') AS net_income,\n  -- Total Assets\n  (SELECT data FROM non_bank_financial_report \n   WHERE stock_code = ci.stock_code AND year = 2023 AND quarter = 0 AND category_code = 'BS_001') AS total_assets,\n  -- Total Assets attributable to Subsidiaries or Investments\n  (SELECT SUM(CASE WHEN ssh.invest_on = ci.stock_code THEN nbfr.data ELSE 0 END) \n   FROM sub_and_shareholder ssh\n   JOIN non_bank_financial_report nbfr ON ssh.invest_on = nbfr.stock_code\n   WHERE nbfr.year = 2023 AND nbfr.quarter = 0 AND nbfr.category_code = 'BS_001' AND ssh.stock_code = ci.stock_code) AS subsidiary_assets,\n  -- Percentage Calculation\n  (SELECT \n     (SUM(CASE WHEN ssh.invest_on = ci.stock_code THEN nbfr.data ELSE 0 END) / \n      (SELECT data FROM non_bank_financial_report \n       WHERE stock_code = ci.stock_code AND year = 2023 AND quarter = 0 AND category_code = 'BS_001')) * 100\n   FROM sub_and_shareholder ssh\n   JOIN non_bank_financial_report nbfr ON ssh.invest_on = nbfr.stock_code\n   WHERE nbfr.year = 2023 AND nbfr.quarter = 0 AND nbfr.category_code = 'BS_001' AND ssh.stock_code = ci.stock_code) AS percentage_subsidary_assets\nFROM \n  company_info ci\nWHERE \n  ci.stock_code IN ('MSN', 'VNM', 'GAS')\nLIMIT 100;\n"
            }
        ],
        "time": 115.85394501686096,
        "evaluate": 0,
        "input_token": 2383,
        "output_token": 1670
    },
    {
        "id": "e0c17ae2-f308-486c-b62b-97f32e813cff",
        "question": "How has the Debt-to-Equity ratio of Vinamilk, Masan Group, and SABECO changed from 2020 to Q2 2024?  Compare their respective Quick Ratios over the same period.",
        "answer": "Table 1\n| stock_code   |   year |   quarter | ratio_code   |     data |\n|:-------------|-------:|----------:|:-------------|---------:|\n| MSN          |   2020 |         0 | DTER         | 3.62386  |\n| MSN          |   2020 |         0 | QR           | 0.451862 |\n| MSN          |   2020 |         2 | DTER         | 2.36354  |\n| MSN          |   2020 |         2 | QR           | 0.356423 |\n| MSN          |   2021 |         0 | DTER         | 1.97835  |\n| MSN          |   2021 |         0 | QR           | 0.899436 |\n| MSN          |   2021 |         2 | DTER         | 2.83936  |\n| MSN          |   2021 |         2 | QR           | 0.572475 |\n| MSN          |   2022 |         0 | DTER         | 2.85795  |\n| MSN          |   2022 |         0 | QR           | 0.514436 |\n| MSN          |   2022 |         2 | DTER         | 2.22866  |\n| MSN          |   2022 |         2 | QR           | 0.44704  |\n| MSN          |   2023 |         0 | DTER         | 2.85445  |\n| MSN          |   2023 |         0 | QR           | 0.61315  |\n| MSN          |   2023 |         2 | DTER         | 2.75379  |\n| MSN          |   2023 |         2 | QR           | 0.563175 |\n| SAB          |   2020 |         0 | DTER         | 0.290342 |\n| SAB          |   2020 |         0 | QR           | 3.52024  |\n| SAB          |   2020 |         2 | DTER         | 0.32508  |\n| SAB          |   2020 |         2 | QR           | 3.0425   |\n| SAB          |   2021 |         0 | DTER         | 0.349295 |\n| SAB          |   2021 |         0 | QR           | 2.93441  |\n| SAB          |   2021 |         2 | DTER         | 0.288778 |\n| SAB          |   2021 |         2 | QR           | 3.55591  |\n| SAB          |   2022 |         0 | DTER         | 0.401541 |\n| SAB          |   2022 |         0 | QR           | 2.69688  |\n| SAB          |   2022 |         2 | DTER         | 0.280909 |\n| SAB          |   2022 |         2 | QR           | 3.53308  |\n| SAB          |   2023 |         0 | DTER         | 0.336332 |\n| SAB          |   2023 |         0 | QR           | 2.9677   |\n| SAB          |   2023 |         2 | DTER         | 0.318275 |\n| SAB          |   2023 |         2 | QR           | 3.13189  |\n| SAB          |   2024 |         2 | DTER         | 0.359095 |\n| SAB          |   2024 |         2 | QR           | 2.9152   |\n| VNM          |   2020 |         0 | DTER         | 0.439424 |\n| VNM          |   2020 |         0 | QR           | 1.7462   |\n| VNM          |   2020 |         2 | DTER         | 0.532862 |\n| VNM          |   2020 |         2 | QR           | 1.46628  |\n| VNM          |   2021 |         0 | DTER         | 0.487649 |\n| VNM          |   2021 |         0 | QR           | 1.72213  |\n| VNM          |   2021 |         2 | DTER         | 0.543159 |\n| VNM          |   2021 |         2 | QR           | 1.56154  |\n| VNM          |   2022 |         0 | DTER         | 0.477386 |\n| VNM          |   2022 |         0 | QR           | 1.70628  |\n| VNM          |   2022 |         2 | DTER         | 0.462287 |\n| VNM          |   2022 |         2 | QR           | 1.79426  |\n| VNM          |   2023 |         0 | DTER         | 0.503847 |\n| VNM          |   2023 |         0 | QR           | 1.74405  |\n| VNM          |   2023 |         2 | DTER         | 0.390309 |\n| VNM          |   2023 |         2 | QR           | 1.97817  |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    fr.stock_code,\n    fr.year,\n    fr.quarter,\n    fr.ratio_code,\n    fr.data\nFROM \n    financial_ratio fr\nJOIN \n    map_category_code_ratio mccr ON fr.ratio_code = mccr.ratio_code\nWHERE \n    fr.stock_code IN ('VNM', 'MSN', 'SAB')\n    AND fr.year BETWEEN 2020 AND 2024\n    AND (fr.quarter = 0 OR fr.quarter = 2) -- Include annual reports and Q2 reports\n    AND mccr.ratio_code IN ('DTER', 'QR') -- Debt-to-Equity Ratio and Quick Ratio\nORDER BY \n    fr.stock_code, fr.year, fr.quarter, fr.ratio_code;\n"
            }
        ],
        "score": 1,
        "difficulty": 2,
        "response": "Table 1\n| stock_code   | company_name                                             |   year |   quarter | ratio_name           |     data |\n|:-------------|:---------------------------------------------------------|-------:|----------:|:---------------------|---------:|\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan                           |   2020 |         0 | Debt To Equity Ratio | 3.62386  |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan                           |   2020 |         0 | Quick Ratio          | 0.451862 |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan                           |   2021 |         0 | Debt To Equity Ratio | 1.97835  |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan                           |   2021 |         0 | Quick Ratio          | 0.899436 |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan                           |   2022 |         0 | Debt To Equity Ratio | 2.85795  |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan                           |   2022 |         0 | Quick Ratio          | 0.514436 |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan                           |   2023 |         0 | Debt To Equity Ratio | 2.85445  |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan                           |   2023 |         0 | Quick Ratio          | 0.61315  |\n| SAB          | T\u1ed5ng C\u00f4ng ty C\u1ed5 ph\u1ea7n Bia - R\u01b0\u1ee3u - N\u01b0\u1edbc Gi\u1ea3i kh\u00e1t S\u00e0i G\u00f2n |   2020 |         0 | Debt To Equity Ratio | 0.290342 |\n| SAB          | T\u1ed5ng C\u00f4ng ty C\u1ed5 ph\u1ea7n Bia - R\u01b0\u1ee3u - N\u01b0\u1edbc Gi\u1ea3i kh\u00e1t S\u00e0i G\u00f2n |   2020 |         0 | Quick Ratio          | 3.52024  |\n| SAB          | T\u1ed5ng C\u00f4ng ty C\u1ed5 ph\u1ea7n Bia - R\u01b0\u1ee3u - N\u01b0\u1edbc Gi\u1ea3i kh\u00e1t S\u00e0i G\u00f2n |   2021 |         0 | Debt To Equity Ratio | 0.349295 |\n| SAB          | T\u1ed5ng C\u00f4ng ty C\u1ed5 ph\u1ea7n Bia - R\u01b0\u1ee3u - N\u01b0\u1edbc Gi\u1ea3i kh\u00e1t S\u00e0i G\u00f2n |   2021 |         0 | Quick Ratio          | 2.93441  |\n| SAB          | T\u1ed5ng C\u00f4ng ty C\u1ed5 ph\u1ea7n Bia - R\u01b0\u1ee3u - N\u01b0\u1edbc Gi\u1ea3i kh\u00e1t S\u00e0i G\u00f2n |   2022 |         0 | Debt To Equity Ratio | 0.401541 |\n| SAB          | T\u1ed5ng C\u00f4ng ty C\u1ed5 ph\u1ea7n Bia - R\u01b0\u1ee3u - N\u01b0\u1edbc Gi\u1ea3i kh\u00e1t S\u00e0i G\u00f2n |   2022 |         0 | Quick Ratio          | 2.69688  |\n| SAB          | T\u1ed5ng C\u00f4ng ty C\u1ed5 ph\u1ea7n Bia - R\u01b0\u1ee3u - N\u01b0\u1edbc Gi\u1ea3i kh\u00e1t S\u00e0i G\u00f2n |   2023 |         0 | Debt To Equity Ratio | 0.336332 |\n| SAB          | T\u1ed5ng C\u00f4ng ty C\u1ed5 ph\u1ea7n Bia - R\u01b0\u1ee3u - N\u01b0\u1edbc Gi\u1ea3i kh\u00e1t S\u00e0i G\u00f2n |   2023 |         0 | Quick Ratio          | 2.9677   |\n| SAB          | T\u1ed5ng C\u00f4ng ty C\u1ed5 ph\u1ea7n Bia - R\u01b0\u1ee3u - N\u01b0\u1edbc Gi\u1ea3i kh\u00e1t S\u00e0i G\u00f2n |   2024 |         2 | Debt To Equity Ratio | 0.359095 |\n| SAB          | T\u1ed5ng C\u00f4ng ty C\u1ed5 ph\u1ea7n Bia - R\u01b0\u1ee3u - N\u01b0\u1edbc Gi\u1ea3i kh\u00e1t S\u00e0i G\u00f2n |   2024 |         2 | Quick Ratio          | 2.9152   |\n| VNM          | C\u00f4ng ty C\u1ed5 ph\u1ea7n S\u1eefa Vi\u1ec7t Nam                             |   2020 |         0 | Debt To Equity Ratio | 0.439424 |\n| VNM          | C\u00f4ng ty C\u1ed5 ph\u1ea7n S\u1eefa Vi\u1ec7t Nam                             |   2020 |         0 | Quick Ratio          | 1.7462   |\n| VNM          | C\u00f4ng ty C\u1ed5 ph\u1ea7n S\u1eefa Vi\u1ec7t Nam                             |   2021 |         0 | Debt To Equity Ratio | 0.487649 |\n| VNM          | C\u00f4ng ty C\u1ed5 ph\u1ea7n S\u1eefa Vi\u1ec7t Nam                             |   2021 |         0 | Quick Ratio          | 1.72213  |\n| VNM          | C\u00f4ng ty C\u1ed5 ph\u1ea7n S\u1eefa Vi\u1ec7t Nam                             |   2022 |         0 | Debt To Equity Ratio | 0.477386 |\n| VNM          | C\u00f4ng ty C\u1ed5 ph\u1ea7n S\u1eefa Vi\u1ec7t Nam                             |   2022 |         0 | Quick Ratio          | 1.70628  |\n| VNM          | C\u00f4ng ty C\u1ed5 ph\u1ea7n S\u1eefa Vi\u1ec7t Nam                             |   2023 |         0 | Debt To Equity Ratio | 0.503847 |\n| VNM          | C\u00f4ng ty C\u1ed5 ph\u1ea7n S\u1eefa Vi\u1ec7t Nam                             |   2023 |         0 | Quick Ratio          | 1.74405  |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT \n  fr.stock_code,\n  ci.company_name,\n  fr.year,\n  fr.quarter,\n  mcr.ratio_name,\n  fr.data\nFROM \n  financial_ratio fr\n  INNER JOIN company_info ci ON fr.stock_code = ci.stock_code\n  INNER JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\nWHERE \n  fr.stock_code IN ('VNM', 'MSN', 'SAB')\n  AND mcr.ratio_name IN ('Debt To Equity Ratio', 'Quick Ratio')\n  AND (\n    (fr.year BETWEEN 2020 AND 2023 AND fr.quarter = 0)  -- Yearly data (2020-2023)\n    OR (fr.year = 2024 AND fr.quarter = 2)  -- Q2 2024\n  )\nORDER BY \n  fr.stock_code, fr.year, fr.quarter, mcr.ratio_name\nLIMIT 100;\n"
            }
        ],
        "time": 36.955007553100586,
        "evaluate": 0,
        "input_token": 2074,
        "output_token": 487
    },
    {
        "id": "e4a9ec26-1d13-431d-854f-90f02a2024dd",
        "question": "What was the total equity of  Vietcombank's subsidiaries and associated companies as a percentage of Vietcombank's total equity at the end of Q2 2024?",
        "answer": "Table 1\n| equity_percentage   |\n|---------------------|\n\n",
        "code": [
            {
                "language": "sql",
                "code": "-- Step 1: Identify Vietcombank's subsidiaries and associated companies\nWITH vcb_subsidiaries AS (\n    SELECT invest_on\n    FROM sub_and_shareholder\n    WHERE stock_code = 'VCB'\n),\n\n-- Step 2: Retrieve the total equity of these subsidiaries and associated companies\nsubsidiaries_equity AS (\n    SELECT SUM(data) AS total_subsidiaries_equity\n    FROM (\n        SELECT data\n        FROM bank_financial_report\n        WHERE stock_code IN (SELECT invest_on FROM vcb_subsidiaries)\n          AND year = 2024\n          AND quarter = 2\n          AND category_code = 'BS_500' -- Shareholders\u2019 equity for banks\n        UNION ALL\n        SELECT data\n        FROM non_bank_financial_report\n        WHERE stock_code IN (SELECT invest_on FROM vcb_subsidiaries)\n          AND year = 2024\n          AND quarter = 2\n          AND category_code = 'BS_400' -- Owner's equity for non-banks\n        UNION ALL\n        SELECT data\n        FROM securities_financial_report\n        WHERE stock_code IN (SELECT invest_on FROM vcb_subsidiaries)\n          AND year = 2024\n          AND quarter = 2\n          AND category_code = 'BS_400' -- Owner's equity for securities\n    ) AS equity_data\n),\n\n-- Step 3: Retrieve Vietcombank's total equity\nvcb_equity AS (\n    SELECT data AS total_vcb_equity\n    FROM bank_financial_report\n    WHERE stock_code = 'VCB'\n      AND year = 2024\n      AND quarter = 2\n      AND category_code = 'BS_500' -- Shareholders\u2019 equity for banks\n)\n\n-- Step 4: Calculate the percentage\nSELECT (subsidiaries_equity.total_subsidiaries_equity / vcb_equity.total_vcb_equity) * 100 AS equity_percentage\nFROM subsidiaries_equity, vcb_equity;\n"
            }
        ],
        "score": 1,
        "difficulty": 4,
        "response": "Table 1\n| vietcombank_equity   |\n|----------------------|\n\nTable 2\n| subsidiaries_equity   |\n|:----------------------|\n|                       |\n\nTable 3\n| percentage   |\n|--------------|\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT stock_code \nFROM company_info \nWHERE en_company_name = 'Joint Stock Commercial Bank For Foreign Trade Of Vietnam'\n"
            },
            {
                "language": "sql",
                "code": "SELECT invest_on \nFROM sub_and_shareholder \nWHERE stock_code = 'VCB'\n"
            },
            {
                "language": "sql",
                "code": "WITH vietcombank_stock_code AS (\n  SELECT stock_code \n  FROM company_info \n  WHERE en_company_name = 'Joint Stock Commercial Bank For Foreign Trade Of Vietnam'\n)\nSELECT invest_on \nFROM sub_and_shareholder \nWHERE stock_code = (SELECT stock_code FROM vietcombank_stock_code)\n"
            },
            {
                "language": "sql",
                "code": "SELECT data AS vietcombank_equity\nFROM bank_financial_report\nWHERE stock_code = 'VCB'\n  AND year = 2024\n  AND quarter = 2\n  AND category_code = 'BS_500'  -- Shareholders\u2019 equity (from map_category_code_bank)\n"
            },
            {
                "language": "sql",
                "code": "WITH vietcombank_stock_code AS (\n  SELECT stock_code \n  FROM company_info \n  WHERE en_company_name = 'Joint Stock Commercial Bank For Foreign Trade Of Vietnam'\n),\nsubsidiaries AS (\n  SELECT invest_on \n  FROM sub_and_shareholder \n  WHERE stock_code = (SELECT stock_code FROM vietcombank_stock_code)\n)\nSELECT \n  SUM(CASE \n        WHEN ci.is_bank THEN bfr.data \n        WHEN ci.is_securities THEN sfr.data \n        ELSE nfr.data \n      END) AS subsidiaries_equity\nFROM subsidiaries s\nJOIN company_info ci ON s.invest_on = ci.stock_code\nLEFT JOIN bank_financial_report bfr ON ci.stock_code = bfr.stock_code AND bfr.year = 2024 AND bfr.quarter = 2 AND bfr.category_code = 'BS_500'\nLEFT JOIN non_bank_financial_report nfr ON ci.stock_code = nfr.stock_code AND nfr.year = 2024 AND nfr.quarter = 2 AND nfr.category_code = 'BS_400'\nLEFT JOIN securities_financial_report sfr ON ci.stock_code = sfr.stock_code AND sfr.year = 2024 AND sfr.quarter = 2 AND sfr.category_code = 'BS_400'  -- Assuming same category code for securities\n"
            },
            {
                "language": "sql",
                "code": "WITH vietcombank_stock_code AS (\n  SELECT stock_code \n  FROM company_info \n  WHERE en_company_name = 'Joint Stock Commercial Bank For Foreign Trade Of Vietnam'\n),\nsubsidiaries AS (\n  SELECT invest_on \n  FROM sub_and_shareholder \n  WHERE stock_code = (SELECT stock_code FROM vietcombank_stock_code)\n),\nvietcombank_equity AS (\n  SELECT data AS vietcombank_equity\n  FROM bank_financial_report\n  WHERE stock_code = (SELECT stock_code FROM vietcombank_stock_code)\n    AND year = 2024\n    AND quarter = 2\n    AND category_code = 'BS_500'\n),\nsubsidiaries_equity AS (\n  SELECT \n    SUM(CASE \n          WHEN ci.is_bank THEN bfr.data \n          WHEN ci.is_securities THEN sfr.data \n          ELSE nfr.data \n        END) AS subsidiaries_equity\n  FROM subsidiaries s\n  JOIN company_info ci ON s.invest_on = ci.stock_code\n  LEFT JOIN bank_financial_report bfr ON ci.stock_code = bfr.stock_code AND bfr.year = 2024 AND bfr.quarter = 2 AND bfr.category_code = 'BS_500'\n  LEFT JOIN non_bank_financial_report nfr ON ci.stock_code = nfr.stock_code AND nfr.year = 2024 AND nfr.quarter = 2 AND nfr.category_code = 'BS_400'\n  LEFT JOIN securities_financial_report sfr ON ci.stock_code = sfr.stock_code AND sfr.year = 2024 AND sfr.quarter = 2 AND sfr.category_code = 'BS_400'\n)\nSELECT \n  (se.subsidiaries_equity / ve.vietcombank_equity) * 100 AS percentage\nFROM vietcombank_equity ve\nCROSS JOIN subsidiaries_equity se\nLIMIT 1\n"
            }
        ],
        "time": 61.261329889297485,
        "evaluate": 0,
        "input_token": 2037,
        "output_token": 1203
    },
    {
        "id": "23ea7012-1827-4ab6-b0cd-b24116d380df",
        "question": "What is the trend of the Return on Equity (ROE) for Vietcombank, Techcombank, and Sacombank from 2020 to Q2 2024?",
        "answer": "Table 1\n| stock_code   |   year |   quarter |       roe |\n|:-------------|-------:|----------:|----------:|\n| STB          |   2020 |         0 | 0.0926219 |\n| STB          |   2021 |         0 | 0.0995728 |\n| STB          |   2022 |         0 | 0.130497  |\n| STB          |   2023 |         0 | 0.168772  |\n| TCB          |   2020 |         0 | 0.168632  |\n| TCB          |   2021 |         0 | 0.197927  |\n| TCB          |   2022 |         0 | 0.180176  |\n| TCB          |   2023 |         0 | 0.139608  |\n| TCB          |   2024 |         2 | 0.0457096 |\n| VCB          |   2020 |         0 | 0.196318  |\n| VCB          |   2021 |         0 | 0.201059  |\n| VCB          |   2022 |         0 | 0.220567  |\n| VCB          |   2023 |         0 | 0.200315  |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    stock_code, \n    year, \n    quarter, \n    data AS ROE\nFROM \n    financial_ratio\nWHERE \n    ratio_code = 'ROE'\n    AND stock_code IN ('VCB', 'TCB', 'STB')\n    AND (\n        (year BETWEEN 2020 AND 2023 AND quarter = 0) -- Annual data from 2020 to 2023\n        OR (year = 2024 AND quarter = 2) -- Q2 data for 2024\n    )\nORDER BY \n    stock_code, \n    year, \n    quarter;\n"
            }
        ],
        "score": 1,
        "difficulty": 2,
        "response": "Table 1\n| stock_code   | company_name                                       |   year |   quarter |   roe_value |\n|:-------------|:---------------------------------------------------|-------:|----------:|------------:|\n| STB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n S\u00e0i G\u00f2n Th\u01b0\u01a1ng T\u00edn    |   2020 |         0 |   0.0926219 |\n| STB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n S\u00e0i G\u00f2n Th\u01b0\u01a1ng T\u00edn    |   2021 |         0 |   0.0995728 |\n| STB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n S\u00e0i G\u00f2n Th\u01b0\u01a1ng T\u00edn    |   2022 |         0 |   0.130497  |\n| STB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n S\u00e0i G\u00f2n Th\u01b0\u01a1ng T\u00edn    |   2023 |         0 |   0.168772  |\n| TCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam    |   2020 |         0 |   0.168632  |\n| TCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam    |   2021 |         0 |   0.197927  |\n| TCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam    |   2022 |         0 |   0.180176  |\n| TCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam    |   2023 |         0 |   0.139608  |\n| TCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam    |   2024 |         2 |   0.0457096 |\n| VCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ngo\u1ea1i th\u01b0\u01a1ng Vi\u1ec7t Nam |   2020 |         0 |   0.196318  |\n| VCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ngo\u1ea1i th\u01b0\u01a1ng Vi\u1ec7t Nam |   2021 |         0 |   0.201059  |\n| VCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ngo\u1ea1i th\u01b0\u01a1ng Vi\u1ec7t Nam |   2022 |         0 |   0.220567  |\n| VCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ngo\u1ea1i th\u01b0\u01a1ng Vi\u1ec7t Nam |   2023 |         0 |   0.200315  |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT \n  fr.stock_code,\n  ci.company_name,\n  fr.year,\n  fr.quarter,\n  fr.data AS ROE_Value\nFROM \n  financial_ratio fr\n  INNER JOIN company_info ci ON fr.stock_code = ci.stock_code\n  INNER JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\nWHERE \n  fr.stock_code IN ('VCB', 'TCB', 'STB')  -- Identified stock codes\n  AND fr.year BETWEEN 2020 AND 2024  -- Time range for years\n  AND (fr.quarter = 0 OR (fr.year = 2024 AND fr.quarter = 2))  -- Quarterly filter for Q2 2024\n  AND mcr.ratio_name = 'Return On Equity'  -- Specific ratio\nORDER BY \n  fr.stock_code, \n  fr.year, \n  fr.quarter\nLIMIT 100;  -- Added limit as per database access note\n"
            }
        ],
        "time": 33.21788549423218,
        "evaluate": 0.5,
        "input_token": 5654,
        "output_token": 1357
    },
    {
        "id": "1ef436da-be56-41ad-a474-7be82fff814b",
        "question": "Rank the top 5 companies with the highest Debt-to-Equity ratio as of December 31, 2023.",
        "answer": "Table 1\n| stock_code   | industry   |   debt_to_equity_ratio |\n|:-------------|:-----------|-----------------------:|\n| BID          | Banking    |                17.7184 |\n| CTG          | Banking    |                15.1483 |\n| STB          | Banking    |                13.746  |\n| HDB          | Banking    |                12.5012 |\n| SHB          | Banking    |                11.5853 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    fr.stock_code,\n    ci.industry,\n    fr.data AS debt_to_equity_ratio\nFROM \n    financial_ratio fr\nJOIN \n    company_info ci ON fr.stock_code = ci.stock_code\nWHERE \n    fr.ratio_code = 'DTER'\n    AND fr.year = 2023\n    AND fr.quarter = 0\nORDER BY \n    fr.data DESC\nLIMIT 5;\n"
            }
        ],
        "score": 1,
        "difficulty": 2,
        "response": "Table 1\n| stock_code   |   debt_to_equity_ratio |\n|:-------------|-----------------------:|\n| BCM          |               1.7435   |\n| CAP          |               0.102494 |\n| CEO          |               0.508928 |\n| CMG          |               1.04948  |\n| DBC          |               1.78848  |\n| DCM          |               0.529397 |\n| DGC          |               0.291759 |\n| DHT          |               0.722593 |\n| DTD          |               0.772254 |\n| DVM          |               1.22591  |\n| DXG          |               1.02916  |\n| FPT          |               1.01392  |\n| FRT          |               6.61905  |\n| GAS          |               0.343894 |\n| GVR          |               0.419899 |\n| HDC          |               1.46271  |\n| HLD          |               0.394739 |\n| HPG          |               0.826032 |\n| HUT          |               1.36439  |\n| KDH          |               0.705913 |\n| L14          |               0.554623 |\n| L18          |               8.16639  |\n| LAS          |               0.660318 |\n| LHC          |               0.593005 |\n| MSN          |               2.85445  |\n| MWG          |               1.5733   |\n| NHA          |               0.581221 |\n| NKG          |               1.25617  |\n| NTP          |               0.750505 |\n| NVL          |               4.33049  |\n| PLC          |               2.22761  |\n| PNJ          |               0.471272 |\n| POW          |               1.06223  |\n| PSD          |               4.69525  |\n| PVC          |               1.35495  |\n| PVG          |               2.72341  |\n| PVS          |               0.950352 |\n| PVT          |               0.936787 |\n| SAB          |               0.336332 |\n| SAF          |               0.457793 |\n| SLS          |               0.136624 |\n| TCH          |               0.176222 |\n| TIG          |               0.603542 |\n| TMB          |               4.66769  |\n| TNG          |               1.81978  |\n| TVD          |               2.00446  |\n| VC3          |               1.51354  |\n| VCS          |               0.297329 |\n| VGI          |               0.719185 |\n| VHM          |               1.43451  |\n| VIC          |               3.50444  |\n| VJC          |               4.69885  |\n| VNM          |               0.503847 |\n| VPI          |               2.15907  |\n| VRE          |               0.259786 |\n| VTP          |               3.0692   |\n| YEG          |               0.344899 |\n| ABB          |              11.0259   |\n| ACB          |               9.13015  |\n| BID          |              17.7184   |\n| CTG          |              15.1483   |\n| EIB          |               7.9738   |\n| HDB          |              12.5012   |\n| LPB          |              10.2219   |\n| MBB          |               8.77089  |\n| OCB          |               7.41452  |\n| SHB          |              11.5853   |\n| STB          |              13.746    |\n| TCB          |               5.50936  |\n| TPB          |               9.89194  |\n| VCB          |              10.1483   |\n| VIB          |               9.80353  |\n| VPB          |               4.84831  |\n\nTable 2\n| stock_code   | industry   |   debt_to_equity_ratio |   rank |\n|:-------------|:-----------|-----------------------:|-------:|\n| BID          | Banking    |                17.7184 |      1 |\n| CTG          | Banking    |                15.1483 |      2 |\n| STB          | Banking    |                13.746  |      3 |\n| HDB          | Banking    |                12.5012 |      4 |\n| SHB          | Banking    |                11.5853 |      5 |\n\nTable 3\n| stock_code   | industry   |   debt_to_equity_ratio |   rank |\n|:-------------|:-----------|-----------------------:|-------:|\n| BID          | Banking    |                17.7184 |      1 |\n| CTG          | Banking    |                15.1483 |      2 |\n| STB          | Banking    |                13.746  |      3 |\n| HDB          | Banking    |                12.5012 |      4 |\n| SHB          | Banking    |                11.5853 |      5 |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "-- Step 1: Extract Debt-to-Equity ratio for all companies as of December 31, 2023\nSELECT \n  fr.stock_code,\n  fr.data AS debt_to_equity_ratio\nFROM \n  financial_ratio fr\n  INNER JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\nWHERE \n  mcr.ratio_name = 'Debt To Equity Ratio'\n  AND fr.year = 2023\n  AND fr.quarter = 0\n"
            },
            {
                "language": "sql",
                "code": "-- Step 2: Rank the extracted Debt-to-Equity ratios in descending order and match with company names\nSELECT \n  ci.stock_code,\n  ci.industry,  -- Optional: include industry for additional context\n  fr.debt_to_equity_ratio,\n  DENSE_RANK() OVER (ORDER BY fr.debt_to_equity_ratio DESC) AS rank\nFROM \n  (\n    -- Step 1 query here\n    SELECT \n      fr.stock_code,\n      fr.data AS debt_to_equity_ratio\n    FROM \n      financial_ratio fr\n      INNER JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\n    WHERE \n      mcr.ratio_name = 'Debt To Equity Ratio'\n      AND fr.year = 2023\n      AND fr.quarter = 0\n  ) fr\n  INNER JOIN company_info ci ON fr.stock_code = ci.stock_code\nORDER BY \n  fr.debt_to_equity_ratio DESC\nLIMIT 5;  -- Get the top 5 companies with the highest Debt-to-Equity ratio\n"
            },
            {
                "language": "sql",
                "code": "SELECT \n  ci.stock_code,\n  ci.industry,  \n  fr.debt_to_equity_ratio,\n  DENSE_RANK() OVER (ORDER BY fr.debt_to_equity_ratio DESC) AS rank\nFROM \n  (\n    SELECT \n      fr.stock_code,\n      fr.data AS debt_to_equity_ratio\n    FROM \n      financial_ratio fr\n      INNER JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\n    WHERE \n      mcr.ratio_name = 'Debt To Equity Ratio'\n      AND fr.year = 2023\n      AND fr.quarter = 0\n  ) fr\n  INNER JOIN company_info ci ON fr.stock_code = ci.stock_code\nORDER BY \n  fr.debt_to_equity_ratio DESC\nLIMIT 5;\n"
            }
        ],
        "time": 39.68736147880554,
        "evaluate": 1,
        "input_token": 2116,
        "output_token": 719
    },
    {
        "id": "ba73d2eb-be40-43aa-aae0-07913d6003b2",
        "question": "What are the top 10 companies with the lowest Return on Equity (ROE) for the fiscal year 2022?",
        "answer": "Table 1\n| stock_code   | industry                             |    roe_value |\n|:-------------|:-------------------------------------|-------------:|\n| VJC          | Travel and Leisure                   | -0.151828    |\n| NKG          | Basic Resources                      | -0.0234384   |\n| NVB          | Banking                              |  1.38787e-06 |\n| DBC          | Food and Beverages                   |  0.0011191   |\n| NHA          | Construction and Materials           |  0.00438288  |\n| HLD          | Real Estate                          |  0.0115416   |\n| VIC          | Real Estate                          |  0.0150701   |\n| YEG          | Media                                |  0.0274488   |\n| PVG          | Utilities (Electricity, Water & Gas) |  0.032697    |\n| PVC          | Oil and Gas                          |  0.0327001   |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    fr.stock_code,\n    ci.industry,\n    fr.data AS roe_value\nFROM \n    financial_ratio fr\nJOIN \n    company_info ci ON fr.stock_code = ci.stock_code\nWHERE \n    fr.ratio_code = 'ROE'\n    AND fr.year = 2022\n    AND fr.quarter = 0\nORDER BY \n    fr.data ASC\nLIMIT 10;\n"
            }
        ],
        "score": 1,
        "difficulty": 2,
        "response": "Error in getting the answer",
        "code_response": "Error in getting the code",
        "evaluate": 0,
        "input_token": 1481,
        "output_token": 341
    },
    {
        "id": "48a8fa57-c0d7-4ba7-879f-5dbe2a9228cc",
        "question": "Compare the Net Profit Margin and the Debt-to-Equity ratio of Vinamilk and Masan Group from 2020 to Q2 2024.  Analyze the changes in their total assets and total liabilities during this period.",
        "answer": "Table 1\n| stock_code   |   year |   quarter | ratio_code   |   ratio_value |\n|:-------------|-------:|----------:|:-------------|--------------:|\n| MSN          |   2020 |         0 | DTER         |      3.62386  |\n| MSN          |   2021 |         0 | DTER         |      1.97835  |\n| MSN          |   2022 |         0 | DTER         |      2.85795  |\n| MSN          |   2023 |         0 | DTER         |      2.85445  |\n| VNM          |   2020 |         0 | DTER         |      0.439424 |\n| VNM          |   2021 |         0 | DTER         |      0.487649 |\n| VNM          |   2022 |         0 | DTER         |      0.477386 |\n| VNM          |   2023 |         0 | DTER         |      0.503847 |\n\nTable 2\n| stock_code   |   year |   quarter | category_code   |       value |\n|:-------------|-------:|----------:|:----------------|------------:|\n| MSN          |   2020 |         0 | BS_270          | 1.15737e+08 |\n| MSN          |   2020 |         0 | BS_300          | 9.07063e+07 |\n| MSN          |   2021 |         0 | BS_270          | 1.26093e+08 |\n| MSN          |   2021 |         0 | BS_300          | 8.37568e+07 |\n| MSN          |   2022 |         0 | BS_270          | 1.41343e+08 |\n| MSN          |   2022 |         0 | BS_300          | 1.04706e+08 |\n| MSN          |   2023 |         0 | BS_270          | 1.47383e+08 |\n| MSN          |   2023 |         0 | BS_300          | 1.09146e+08 |\n| VNM          |   2020 |         0 | BS_270          | 4.84325e+07 |\n| VNM          |   2020 |         0 | BS_300          | 1.47854e+07 |\n| VNM          |   2021 |         0 | BS_270          | 5.33324e+07 |\n| VNM          |   2021 |         0 | BS_300          | 1.74823e+07 |\n| VNM          |   2022 |         0 | BS_270          | 4.84827e+07 |\n| VNM          |   2022 |         0 | BS_300          | 1.56661e+07 |\n| VNM          |   2023 |         0 | BS_270          | 5.26734e+07 |\n| VNM          |   2023 |         0 | BS_300          | 1.76476e+07 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    stock_code,\n    year,\n    quarter,\n    ratio_code,\n    data AS ratio_value\nFROM \n    financial_ratio\nWHERE \n    stock_code IN ('VNM', 'MSN')\n    AND ratio_code IN ('NPM', 'DTER')\n    AND ((year = 2020 AND quarter = 0) OR (year = 2021 AND quarter = 0) OR (year = 2022 AND quarter = 0) OR (year = 2023 AND quarter = 0) OR (year = 2024 AND quarter = 2))\nORDER BY \n    stock_code, year, quarter, ratio_code;\n"
            },
            {
                "language": "sql",
                "code": "SELECT \n    stock_code,\n    year,\n    quarter,\n    category_code,\n    data AS value\nFROM \n    non_bank_financial_report\nWHERE \n    stock_code IN ('VNM', 'MSN')\n    AND category_code IN ('BS_270', 'BS_300') -- BS_270 for Total Assets, BS_300 for Total Liabilities\n    AND ((year = 2020 AND quarter = 0) OR (year = 2021 AND quarter = 0) OR (year = 2022 AND quarter = 0) OR (year = 2023 AND quarter = 0) OR (year = 2024 AND quarter = 2))\nORDER BY \n    stock_code, year, quarter, category_code;\n"
            }
        ],
        "score": 1,
        "difficulty": 3,
        "response": "Table 1\n| stock_code   |   year |   quarter | ratio_name           |     data |\n|:-------------|-------:|----------:|:---------------------|---------:|\n| MSN          |   2020 |         0 | Debt To Equity Ratio | 3.62386  |\n| MSN          |   2020 |         2 | Debt To Equity Ratio | 2.36354  |\n| MSN          |   2021 |         0 | Debt To Equity Ratio | 1.97835  |\n| MSN          |   2021 |         2 | Debt To Equity Ratio | 2.83936  |\n| MSN          |   2022 |         0 | Debt To Equity Ratio | 2.85795  |\n| MSN          |   2022 |         2 | Debt To Equity Ratio | 2.22866  |\n| MSN          |   2023 |         0 | Debt To Equity Ratio | 2.85445  |\n| MSN          |   2023 |         2 | Debt To Equity Ratio | 2.75379  |\n| VNM          |   2020 |         0 | Debt To Equity Ratio | 0.439424 |\n| VNM          |   2020 |         2 | Debt To Equity Ratio | 0.532862 |\n| VNM          |   2021 |         0 | Debt To Equity Ratio | 0.487649 |\n| VNM          |   2021 |         2 | Debt To Equity Ratio | 0.543159 |\n| VNM          |   2022 |         0 | Debt To Equity Ratio | 0.477386 |\n| VNM          |   2022 |         2 | Debt To Equity Ratio | 0.462287 |\n| VNM          |   2023 |         0 | Debt To Equity Ratio | 0.503847 |\n| VNM          |   2023 |         2 | Debt To Equity Ratio | 0.390309 |\n\nTable 2\n| stock_code   | year   | quarter   | en_caption   | data   |\n|--------------|--------|-----------|--------------|--------|\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "WITH \n  -- Retrieve stock codes for Vinamilk and Masan Group\n  company_codes AS (\n    SELECT stock_code\n    FROM company_info\n    WHERE stock_code IN ('VNM', 'MSN')\n  ),\n\n  -- Define the periods for filtering\n  periods AS (\n    SELECT year, quarter\n    FROM (VALUES \n      (2020, 0), (2021, 0), (2022, 0), (2023, 0), (2024, 0),  -- Annual\n      (2020, 2), (2021, 2), (2022, 2), (2023, 2), (2024, 2)   -- Q2\n    ) AS period(year, quarter)\n  )\n\n-- Retrieve financial ratios for the specified companies and periods\nSELECT \n  cr.stock_code,\n  p.year,\n  p.quarter,\n  mr.ratio_name,\n  fr.data\nFROM \n  company_codes cr\n  CROSS JOIN periods p\n  JOIN financial_ratio fr ON cr.stock_code = fr.stock_code AND p.year = fr.year AND p.quarter = fr.quarter\n  JOIN map_category_code_ratio mr ON fr.ratio_code = mr.ratio_code\nWHERE \n  mr.ratio_name IN ('Net profit margin', 'Debt To Equity Ratio')\nLIMIT 100;\n"
            },
            {
                "language": "sql",
                "code": "WITH \n  -- Retrieve stock codes for Vinamilk and Masan Group\n  company_codes AS (\n    SELECT stock_code\n    FROM company_info\n    WHERE stock_code IN ('VNM', 'MSN')\n  ),\n\n  -- Define the periods for filtering\n  periods AS (\n    SELECT year, quarter\n    FROM (VALUES \n      (2020, 0), (2021, 0), (2022, 0), (2023, 0), (2024, 0),  -- Annual\n      (2020, 2), (2021, 2), (2022, 2), (2023, 2), (2024, 2)   -- Q2\n    ) AS period(year, quarter)\n  )\n\n-- Extract total assets and total liabilities for the specified companies and periods\nSELECT \n  cr.stock_code,\n  p.year,\n  p.quarter,\n  mb.en_caption,\n  nbr.data\nFROM \n  company_codes cr\n  CROSS JOIN periods p\n  JOIN non_bank_financial_report nbr ON cr.stock_code = nbr.stock_code AND p.year = nbr.year AND p.quarter = nbr.quarter\n  JOIN map_category_code_non_bank mb ON nbr.category_code = mb.category_code\nWHERE \n  mb.en_caption IN ('Total Assets', 'Total Liabilities')  -- Assuming these captions match the category codes\nLIMIT 100;\n"
            }
        ],
        "time": 83.8685872554779,
        "evaluate": 0,
        "input_token": 8188,
        "output_token": 3270
    },
    {
        "id": "94513aff-57b5-4d36-8a98-bdf527d9190f",
        "question": "What is the trend of the Net Profit Margin ratio for Vietcombank, Techcombank, and ACB from 2020 to Q2 2024?",
        "answer": "Table 1\n| stock_code   | year   | quarter   | net_profit_margin   |\n|--------------|--------|-----------|---------------------|\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    stock_code, \n    year, \n    quarter, \n    data AS net_profit_margin\nFROM \n    financial_ratio\nWHERE \n    ratio_code = 'NPM'\n    AND stock_code IN ('VCB', 'TCB', 'ACB')\n    AND (\n        (year BETWEEN 2020 AND 2023 AND quarter = 0) OR\n        (year = 2024 AND quarter IN (1, 2))\n    )\nORDER BY \n    stock_code, \n    year, \n    quarter;\n"
            }
        ],
        "score": 1,
        "difficulty": 2,
        "response": "Table 1\n| stock_code   | company_name                         |   year |   quarter |   net_profit_margin |\n|:-------------|:-------------------------------------|-------:|----------:|--------------------:|\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         1 |         9.90228     |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         1 |         1.10514     |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         1 |         0.0509733   |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         1 |         0.0117174   |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         1 |         0.00487661  |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         1 |         0.0951341   |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         1 |         0.904866    |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         1 |         7.95758     |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         1 |       -14.761       |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         1 |         0.0106027   |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         1 |        -0.0108483   |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         1 |         9.9645      |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         1 |        -0.00750452  |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         1 |         0.507923    |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         1 |         0.00754927  |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         1 |        -1.54565     |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         1 |         0.699768    |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         1 |         0.00487661  |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         1 |         0.405624    |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         1 |        -0.134452    |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         1 |         0.557316    |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         1 |         9.51148     |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         1 |         0.00484929  |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         1 |         0.748664    |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         1 |         0.904866    |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         1 |         0.350103    |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         1 |         3.8191      |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         1 |         0.904866    |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         1 |         1.10514     |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         1 |         0.179583    |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         1 |        -1.44091e+07 |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         1 |       -16.8994      |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         1 |        -0.146952    |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         1 |       -15.2388      |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         1 |         1.19485     |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         1 |         0.588035    |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         1 |         0.522703    |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         1 |         0.699768    |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         1 |       -30.3228      |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         1 |        -0.0179747   |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         1 |         0.530941    |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         1 |         0.522703    |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         1 |         0.00484929  |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         2 |         0.00630621  |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         2 |         0.00994336  |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         2 |         0.00422206  |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         2 |         0.598808    |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         2 |         1.09192     |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         2 |        -8.77092     |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         2 |         1.80002     |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         2 |         0.00695836  |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         2 |         0.466085    |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         2 |         0.0501528   |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         2 |         0.00630621  |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         2 |        10.2229      |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         2 |        -4.24064     |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         2 |         8.15946     |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         2 |         0.483488    |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         2 |        -0.138264    |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         2 |         0.915816    |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         2 |         0.61174     |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         2 |         0.915816    |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         2 |         0.0841838   |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         2 |         0.0108574   |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         2 |        -0.0128905   |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         2 |        -0.00763468  |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         2 |        -0.039699    |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         2 |        -3.92324     |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         2 |         1.09192     |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         2 |         0.51271     |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         2 |        -4.17206e+06 |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         2 |        -0.0365101   |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         2 |        -4.43958     |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         2 |         0.240581    |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         2 |         0.50942     |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         2 |         0.423276    |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         2 |         0.838398    |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |         2 |         0.838398    |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh |   2021 |        ",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT \n  fr.stock_code,\n  ci.company_name,  -- added to provide company names in the output\n  fr.year,\n  fr.quarter,\n  fr.data AS net_profit_margin\nFROM \n  financial_ratio fr\n  INNER JOIN company_info ci ON fr.stock_code = ci.stock_code\nWHERE \n  fr.ratio_code = 'NPM'  -- Net Profit Margin\n  AND fr.stock_code IN ('VCB', 'TCB', 'ACB')\n  AND (fr.year = 2020 AND fr.quarter IN (1, 2, 3, 4)) \n  OR (fr.year = 2021 AND fr.quarter IN (1, 2, 3, 4)) \n  OR (fr.year = 2022 AND fr.quarter IN (1, 2, 3, 4)) \n  OR (fr.year = 2023 AND fr.quarter IN (1, 2, 3, 4)) \n  OR (fr.year = 2024 AND fr.quarter IN (1, 2))  -- only up to Q2 2024\nORDER BY \n  fr.stock_code, \n  fr.year, \n  fr.quarter\nLIMIT 100;  -- added to comply with the database access note\n"
            }
        ],
        "time": 41.964712142944336,
        "evaluate": 0,
        "input_token": 4018,
        "output_token": 1813
    },
    {
        "id": "4705a2ab-1bb2-400f-895d-b1eea6557de9",
        "question": "What was the average Return on Equity (ROE) for  Vietcombank,  Techcombank, and  Sacombank in 2022, and how did this compare to their respective subsidiaries' average ROE for the same year?",
        "answer": "Table 1\n| bank_code   |   bank_avg_roe |   subsidiary_avg_roe |\n|:------------|---------------:|---------------------:|\n| STB         |       0.130497 |           nan        |\n| TCB         |       0.180176 |           nan        |\n| VCB         |       0.220567 |             0.170252 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "WITH bank_roe AS (\n    SELECT stock_code, AVG(data) AS avg_roe\n    FROM financial_ratio\n    WHERE ratio_code = 'ROE'\n      AND stock_code IN ('VCB', 'TCB', 'STB')\n      AND year = 2022\n      AND quarter = 0\n    GROUP BY stock_code\n),\nsubsidiary_roe AS (\n    SELECT s.stock_code, AVG(fr.data) AS avg_roe\n    FROM sub_and_shareholder s\n    JOIN financial_ratio fr ON s.invest_on = fr.stock_code\n    WHERE s.stock_code IN ('VCB', 'TCB', 'STB')\n      AND fr.ratio_code = 'ROE'\n      AND fr.year = 2022\n      AND fr.quarter = 0\n    GROUP BY s.stock_code\n)\nSELECT b.stock_code AS bank_code, b.avg_roe AS bank_avg_roe, s.avg_roe AS subsidiary_avg_roe\nFROM bank_roe b\nLEFT JOIN subsidiary_roe s ON b.stock_code = s.stock_code;\n"
            }
        ],
        "score": 1,
        "difficulty": 3,
        "response": "Table 1\n| parent_stock_code   | subsidiary_stock_code   |\n|:--------------------|:------------------------|\n| VCB                 | PGI                     |\n| VCB                 | EIB                     |\n| VCB                 | MBB                     |\n| VCB                 | HVN                     |\n| VCB                 | PVD                     |\n| VCB                 | OCB                     |\n| STB                 | SBS                     |\n| STB                 | NAS                     |\n| STB                 | SPM                     |\n| STB                 | COM                     |\n| STB                 | GEG                     |\n| STB                 | HMC                     |\n| STB                 | VTO                     |\n| STB                 | HLA                     |\n| STB                 | SWC                     |\n| STB                 | LSS                     |\n| STB                 | SCR                     |\n| STB                 | CMX                     |\n| STB                 | NBW                     |\n| STB                 | LAI                     |\n| STB                 | DLR                     |\n| STB                 | DNT                     |\n| STB                 | SSC                     |\n| STB                 | SAV                     |\n| STB                 | STG                     |\n| STB                 | MRF                     |\n| STB                 | SFC                     |\n| TCB                 | VCG                     |\n| TCB                 | HVN                     |\n| VCB                 | EIB                     |\n| VCB                 | MBB                     |\n| VCB                 | OCB                     |\n\nTable 2\n| group_type   | stock_code   |   avg_roe |\n|:-------------|:-------------|----------:|\n| Parent       | STB          |  0.130497 |\n| Parent       | TCB          |  0.180176 |\n| Parent       | VCB          |  0.220567 |\n| Subsidiary   | EIB          |  0.143836 |\n| Subsidiary   | MBB          |  0.228042 |\n| Subsidiary   | OCB          |  0.138876 |\n\nTable 3\n| group_type   | stock_code   |   avg_roe |\n|:-------------|:-------------|----------:|\n| Parent       | STB          |  0.130497 |\n| Parent       | TCB          |  0.180176 |\n| Parent       | VCB          |  0.220567 |\n| Subsidiary   | EIB          |  0.143836 |\n| Subsidiary   | MBB          |  0.228042 |\n| Subsidiary   | OCB          |  0.138876 |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "-- Identify parent banks\nWITH parent_banks AS (\n  SELECT stock_code\n  FROM company_info\n  WHERE (stock_code = 'VCB' OR stock_code = 'TCB' OR stock_code = 'STB')  -- Assuming STB is Sacombank\n    AND is_bank = TRUE\n)\n-- Get subsidiaries (if any) for each parent bank\nSELECT \n  pb.stock_code AS parent_stock_code,\n  ssh.invest_on AS subsidiary_stock_code\nFROM parent_banks pb\nLEFT JOIN sub_and_shareholder ssh ON pb.stock_code = ssh.stock_code\nLIMIT 100;  -- Add limit as per the instruction\n"
            },
            {
                "language": "sql",
                "code": "-- Extract ROE for parent banks and subsidiaries (if any) in 2022\nWITH roe_data AS (\n  SELECT \n    'Parent' AS group_type,\n    fr.stock_code,\n    fr.data AS roe\n  FROM financial_ratio fr\n  JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\n  JOIN company_info ci ON fr.stock_code = ci.stock_code\n  WHERE mcr.ratio_name = 'Return On Equity'\n    AND fr.year = 2022\n    AND fr.quarter = 0\n    AND ci.stock_code IN ('VCB', 'TCB', 'STB')  -- Parent banks\n  UNION ALL\n  SELECT \n    'Subsidiary' AS group_type,\n    fr.stock_code,\n    fr.data AS roe\n  FROM financial_ratio fr\n  JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\n  JOIN company_info ci ON fr.stock_code = ci.stock_code\n  JOIN sub_and_shareholder ssh ON ci.stock_code = ssh.invest_on\n  WHERE mcr.ratio_name = 'Return On Equity'\n    AND fr.year = 2022\n    AND fr.quarter = 0\n    AND ssh.stock_code IN ('VCB', 'TCB', 'STB')  -- Parent banks (to get their subsidiaries)\n)\n-- Compute average ROE for each group\nSELECT \n  group_type,\n  stock_code,\n  AVG(roe) AS avg_roe\nFROM roe_data\nGROUP BY group_type, stock_code\nLIMIT 100;  -- Add limit as per the instruction\n"
            },
            {
                "language": "sql",
                "code": "WITH parent_banks AS (\n  SELECT stock_code\n  FROM company_info\n  WHERE (stock_code = 'VCB' OR stock_code = 'TCB' OR stock_code = 'STB')  \n    AND is_bank = TRUE\n),\nroe_data AS (\n  SELECT \n    'Parent' AS group_type,\n    fr.stock_code,\n    fr.data AS roe\n  FROM financial_ratio fr\n  JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\n  JOIN company_info ci ON fr.stock_code = ci.stock_code\n  WHERE mcr.ratio_name = 'Return On Equity'\n    AND fr.year = 2022\n    AND fr.quarter = 0\n    AND ci.stock_code IN ('VCB', 'TCB', 'STB')  \n  UNION ALL\n  SELECT \n    'Subsidiary' AS group_type,\n    fr.stock_code,\n    fr.data AS roe\n  FROM financial_ratio fr\n  JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\n  JOIN company_info ci ON fr.stock_code = ci.stock_code\n  JOIN sub_and_shareholder ssh ON ci.stock_code = ssh.invest_on\n  WHERE mcr.ratio_name = 'Return On Equity'\n    AND fr.year = 2022\n    AND fr.quarter = 0\n    AND ssh.stock_code IN ('VCB', 'TCB', 'STB')  \n)\nSELECT \n  group_type,\n  stock_code,\n  AVG(roe) AS avg_roe\nFROM roe_data\nGROUP BY group_type, stock_code\nLIMIT 100;\n"
            }
        ],
        "time": 50.73782682418823,
        "evaluate": 0,
        "input_token": 587,
        "output_token": 142
    },
    {
        "id": "090710f9-3867-4922-9703-fd2af16e09e9",
        "question": "Calculate the Debt-to-Equity ratio for  Vinamilk,  Masan Group, and their significant subsidiaries in 2023 Q2.  Analyze the differences in leverage between the parent companies and their subsidiaries.",
        "answer": "Table 1\n| stock_code   |   year |   quarter |   debt_to_equity_ratio |\n|:-------------|-------:|----------:|-----------------------:|\n| MSN          |   2023 |         2 |               2.75379  |\n| VNM          |   2023 |         2 |               0.390309 |\n| TCB          |   2023 |         2 |               4.98106  |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "WITH parent_companies AS (\n    SELECT 'VNM' AS stock_code\n    UNION\n    SELECT 'MSN'\n),\nsubsidiaries AS (\n    SELECT invest_on AS stock_code\n    FROM sub_and_shareholder\n    WHERE stock_code IN (SELECT stock_code FROM parent_companies)\n),\nall_relevant_companies AS (\n    SELECT stock_code FROM parent_companies\n    UNION\n    SELECT stock_code FROM subsidiaries\n)\nSELECT fr.stock_code, fr.year, fr.quarter, fr.data AS debt_to_equity_ratio\nFROM financial_ratio fr\nJOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\nWHERE mcr.ratio_name = 'Debt To Equity Ratio'\nAND fr.stock_code IN (SELECT stock_code FROM all_relevant_companies)\nAND fr.year = 2023\nAND fr.quarter = 2;\n"
            }
        ],
        "score": 1,
        "difficulty": 3,
        "response": "Error in getting the answer",
        "code_response": "Error in getting the code",
        "evaluate": 0,
        "input_token": 4551,
        "output_token": 1582
    },
    {
        "id": "113431fd-d8a9-4fcc-b8e4-44bb3cc73663",
        "question": "Rank the top 5 companies with the highest Return on Equity (ROE) in 2023, based on their financial statements.",
        "answer": "Table 1\n| stock_code   | industry           |      roe |\n|:-------------|:-------------------|---------:|\n| TMB          | Basic Resources    | 0.476625 |\n| SLS          | Food and Beverages | 0.443074 |\n| CAP          | Basic Resources    | 0.43171  |\n| SAF          | Food and Beverages | 0.2894   |\n| DGC          | Chemicals          | 0.269533 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    fr.stock_code,\n    ci.industry,\n    fr.data AS roe\nFROM \n    financial_ratio fr\nJOIN \n    company_info ci ON fr.stock_code = ci.stock_code\nWHERE \n    fr.ratio_code = 'ROE'\n    AND fr.year = 2023\n    AND fr.quarter = 0\nORDER BY \n    fr.data DESC\nLIMIT 5;\n"
            }
        ],
        "score": 1,
        "difficulty": 2,
        "response": "Table 1\n| stock_code   | industry           |   roe_value |\n|:-------------|:-------------------|------------:|\n| TMB          | Basic Resources    |    0.476625 |\n| SLS          | Food and Beverages |    0.443074 |\n| CAP          | Basic Resources    |    0.43171  |\n| SAF          | Food and Beverages |    0.2894   |\n| DGC          | Chemicals          |    0.269533 |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT \n  ci.stock_code, \n  ci.industry, \n  fr.data AS ROE_value\nFROM \n  financial_ratio fr\n  INNER JOIN company_info ci ON fr.stock_code = ci.stock_code\nWHERE \n  fr.year = 2023 \n  AND fr.quarter = 0 \n  AND fr.ratio_code = 'ROE'  -- Map category code for Return on Equity\nORDER BY \n  fr.data DESC  -- Rank by ROE value in descending order\nLIMIT \n  5;  -- Select top 5 companies\n"
            }
        ],
        "time": 29.369869470596313,
        "evaluate": 1,
        "input_token": 5689,
        "output_token": 1663
    },
    {
        "id": "bb6f60b5-01dc-41a5-a518-ba2edf9f457b",
        "question": "Compare the evolution of the Debt-to-Equity ratio and the Current Ratio for Vinamilk, Masan Group, and Hoa Phat Group from 2020 to Q2 2024.  Analyze the implications of these ratios on the financial risk profile of each company.",
        "answer": "Table 1\n| stock_code   |   year |   quarter | ratio_name           |   ratio_value |\n|:-------------|-------:|----------:|:---------------------|--------------:|\n| HPG          |   2020 |         0 | Current Ratio        |      1.09453  |\n| HPG          |   2020 |         0 | Debt To Equity Ratio |      1.22073  |\n| HPG          |   2021 |         0 | Current Ratio        |      1.28577  |\n| HPG          |   2021 |         0 | Debt To Equity Ratio |      0.963375 |\n| HPG          |   2022 |         0 | Current Ratio        |      1.29573  |\n| HPG          |   2022 |         0 | Debt To Equity Ratio |      0.772243 |\n| HPG          |   2023 |         0 | Current Ratio        |      1.16128  |\n| HPG          |   2023 |         0 | Debt To Equity Ratio |      0.826032 |\n| HPG          |   2024 |         2 | Current Ratio        |      1.15441  |\n| HPG          |   2024 |         2 | Debt To Equity Ratio |      0.901137 |\n| MSN          |   2020 |         0 | Current Ratio        |      0.773354 |\n| MSN          |   2020 |         0 | Debt To Equity Ratio |      3.62386  |\n| MSN          |   2021 |         0 | Current Ratio        |      1.27032  |\n| MSN          |   2021 |         0 | Debt To Equity Ratio |      1.97835  |\n| MSN          |   2022 |         0 | Current Ratio        |      0.73558  |\n| MSN          |   2022 |         0 | Debt To Equity Ratio |      2.85795  |\n| MSN          |   2023 |         0 | Current Ratio        |      0.874439 |\n| MSN          |   2023 |         0 | Debt To Equity Ratio |      2.85445  |\n| VNM          |   2020 |         0 | Current Ratio        |      2.09132  |\n| VNM          |   2020 |         0 | Debt To Equity Ratio |      0.439424 |\n| VNM          |   2021 |         0 | Current Ratio        |      2.11895  |\n| VNM          |   2021 |         0 | Debt To Equity Ratio |      0.487649 |\n| VNM          |   2022 |         0 | Current Ratio        |      2.06801  |\n| VNM          |   2022 |         0 | Debt To Equity Ratio |      0.477386 |\n| VNM          |   2023 |         0 | Current Ratio        |      2.1016   |\n| VNM          |   2023 |         0 | Debt To Equity Ratio |      0.503847 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    fr.stock_code,\n    fr.year,\n    fr.quarter,\n    mccr.ratio_name,\n    fr.data AS ratio_value\nFROM \n    financial_ratio fr\nJOIN \n    map_category_code_ratio mccr ON fr.ratio_code = mccr.ratio_code\nWHERE \n    fr.stock_code IN ('VNM', 'MSN', 'HPG')\n    AND mccr.ratio_name IN ('Debt To Equity Ratio', 'Current Ratio')\n    AND (\n        (fr.year BETWEEN 2020 AND 2024 AND fr.quarter = 0) OR\n        (fr.year = 2024 AND fr.quarter = 2)\n    )\nORDER BY \n    fr.stock_code, fr.year, fr.quarter, mccr.ratio_name;\n"
            }
        ],
        "score": 1,
        "difficulty": 3,
        "response": "Table 1\n| stock_code   |   year |   quarter | ratio_name           |   ratio_value |\n|:-------------|-------:|----------:|:---------------------|--------------:|\n| HPG          |   2020 |         0 |                      |  -0.00995978  |\n| HPG          |   2020 |         0 |                      |  -0.000299107 |\n| HPG          |   2020 |         0 |                      |   1.81918     |\n| HPG          |   2020 |         0 |                      |   0.133438    |\n| HPG          |   2020 |         0 |                      |   0.133438    |\n| HPG          |   2020 |         0 |                      |   0.263512    |\n| HPG          |   2020 |         0 |                      |   0.183515    |\n| HPG          |   2020 |         0 |                      |   0.128578    |\n| HPG          |   2020 |         0 |                      |   0.12716     |\n| HPG          |   2020 |         0 |                      |   0.216571    |\n| HPG          |   2020 |         0 |                      |   6.28693     |\n| HPG          |   2020 |         0 |                      |   0.0993388   |\n| HPG          |   2020 |         0 |                      |   0.239378    |\n| HPG          |   2020 |         0 | Current Ratio        |   1.09453     |\n| HPG          |   2020 |         0 |                      |   0.549699    |\n| HPG          |   2020 |         0 | Debt-to-Equity Ratio |   1.22073     |\n| HPG          |   2020 |         0 |                      |   0.549699    |\n| HPG          |   2020 |         0 |                      |   1.22599     |\n| HPG          |   2020 |         0 |                      |   2.01508e+07 |\n| HPG          |   2020 |         0 |                      |   0.857923    |\n| HPG          |   2020 |         0 |                      |   0.450301    |\n| HPG          |   2020 |         0 |                      |   1.10761     |\n| HPG          |   2020 |         0 |                      |   3.68935e+07 |\n| HPG          |   2020 |         0 |                      |   0.0111496   |\n| HPG          |   2020 |         0 |                      |   0.549699    |\n| HPG          |   2020 |         0 |                      |   0.209769    |\n| HPG          |   2020 |         0 |                      |   1.81918     |\n| HPG          |   2020 |         0 |                      |   8.00694     |\n| HPG          |   2020 |         0 |                      |   1.06383     |\n| HPG          |   2020 |         0 |                      |   3.67999     |\n| HPG          |   2020 |         0 |                      |   0.343068    |\n| HPG          |   2020 |         0 |                      |   0.343068    |\n| HPG          |   2020 |         0 |                      |   0.169691    |\n| HPG          |   2020 |         0 |                      |   0.604786    |\n| HPG          |   2020 |         0 |                      |   0.214736    |\n| HPG          |   2020 |         0 |                      |   0.209496    |\n| HPG          |   2020 |         0 |                      |   0.265452    |\n| HPG          |   2020 |         0 |                      |   0.588777    |\n| HPG          |   2020 |         0 |                      |   0.1027      |\n| HPG          |   2020 |         0 |                      |   0.228068    |\n| HPG          |   2020 |         0 |                      |   0.206007    |\n| HPG          |   2020 |         0 |                      |   0.1027      |\n| HPG          |   2020 |         0 |                      |   2.16195     |\n| HPG          |   2020 |         0 |                      |   0.149871    |\n| HPG          |   2020 |         0 |                      |   0.0889446   |\n| HPG          |   2020 |         0 |                      |   0.0438255   |\n| HPG          |   2020 |         0 |                      |   0.0488927   |\n| HPG          |   2020 |         0 |                      |   0.395214    |\n| HPG          |   2020 |         0 |                      |   0.877666    |\n| HPG          |   2020 |         0 |                      |   8.00694     |\n| HPG          |   2021 |         0 |                      |  -0.0078975   |\n| HPG          |   2021 |         0 |                      |  -0.000220353 |\n| HPG          |   2021 |         0 |                      |   2.03802     |\n| HPG          |   2021 |         0 |                      |   0.222079    |\n| HPG          |   2021 |         0 |                      |   0.222079    |\n| HPG          |   2021 |         0 |                      |   0.305902    |\n| HPG          |   2021 |         0 |                      |   0.334539    |\n| HPG          |   2021 |         0 |                      |   0.178521    |\n| HPG          |   2021 |         0 |                      |   0.174931    |\n| HPG          |   2021 |         0 |                      |   0.356278    |\n| HPG          |   2021 |         0 |                      |  11.5791      |\n| HPG          |   2021 |         0 |                      |   0.172533    |\n| HPG          |   2021 |         0 |                      |   0.396328    |\n| HPG          |   2021 |         0 | Current Ratio        |   1.28577     |\n| HPG          |   2021 |         0 |                      |   0.490673    |\n| HPG          |   2021 |         0 | Debt-to-Equity Ratio |   0.963375    |\n| HPG          |   2021 |         0 |                      |   0.490673    |\n| HPG          |   2021 |         0 |                      |   0.969105    |\n| HPG          |   2021 |         0 |                      |   3.70628e+07 |\n| HPG          |   2021 |         0 |                      |   0.774049    |\n| HPG          |   2021 |         0 |                      |   0.509327    |\n| HPG          |   2021 |         0 |                      |   1.32664     |\n| HPG          |   2021 |         0 |                      |   8.1097e+07  |\n| HPG          |   2021 |         0 |                      |   0.0205201   |\n| HPG          |   2021 |         0 |                      |   0.490673    |\n| HPG          |   2021 |         0 |                      |   0.274642    |\n| HPG          |   2021 |         0 |                      |   2.03802     |\n| HPG          |   2021 |         0 |                      |  15.6712      |\n| HPG          |   2021 |         0 |                      |   1.24614     |\n| HPG          |   2021 |         0 |                      |   6.00734     |\n| HPG          |   2021 |         0 |                      |   0.154179    |\n| HPG          |   2021 |         0 |                      |   0.154179    |\n| HPG          |   2021 |         0 |                      |   0.247251    |\n| HPG          |   2021 |         0 |                      |   0.587855    |\n| HPG          |   2021 |         0 |                      |   0.340867    |\n| HPG          |   2021 |         0 |                      |   0.330386    |\n| HPG          |   2021 |         0 |                      |   0.37863     |\n| HPG          |   2021 |         0 |                      |   0.712191    |\n| HPG          |   2021 |         0 |                      |   0.193681    |\n| HPG          |   2021 |         0 |                      |   0.380268    |\n| HPG          |   2021 |         0 |                      |   0.498276    |\n| HPG          |   2021 |         0 |                      |   0.193681    |\n| HPG          |   2021 |         0 |                      |   3.55934     |\n| HPG          |   2021 |         0 |                      |   0.230632    |\n| HPG          |   2021 |         0 |                      |   0.0968708   |\n| HPG          |   2021 |         0 |                      |   0.0332249   |\n| HPG          |   2021 |         0 |                      |   0.0475319   |\n| HPG          |   2021 |         0 |                      |   0.412145    |\n| HPG          |   2021 |         0 |                      |   0.809196    |\n| HPG          |   2021 |         0 |                      |  15.6712      |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "WITH target_companies AS (\n  SELECT 'VNM' AS stock_code UNION\n  SELECT 'MSN' UNION\n  SELECT 'HPG'\n)\nSELECT \n  tc.stock_code,\n  fr.year,\n  fr.quarter,\n  CASE \n    WHEN mcr.ratio_code = 'DTER' THEN 'Debt-to-Equity Ratio'\n    WHEN mcr.ratio_code = 'CurrentR' THEN 'Current Ratio'\n  END AS ratio_name,\n  fr.data AS ratio_value\nFROM \n  target_companies tc\n  JOIN financial_ratio fr ON tc.stock_code = fr.stock_code\n  JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\nWHERE \n  fr.year BETWEEN 2020 AND 2023 AND fr.quarter = 0  -- Annual reports from 2020 to 2023\n  OR (fr.year = 2024 AND fr.quarter = 2)  -- Q2 2024\n  AND mcr.ratio_code IN ('DTER', 'CurrentR')  -- Filter for Debt-to-Equity and Current Ratios\nORDER BY \n  tc.stock_code, fr.year, fr.quarter, mcr.ratio_code\nLIMIT 100;  -- Add limit as per database schema requirement\n"
            }
        ],
        "time": 40.89966869354248,
        "evaluate": 0,
        "input_token": 0,
        "output_token": 0
    },
    {
        "id": "1f330071-6ed3-48d3-912a-2bad5446636b",
        "question": "For Q4 2023, what was the Debt-to-Equity ratio for Mobile World Investment and Vinamilk, and how do these ratios change when considering the debt and equity of their subsidiaries and associated companies?",
        "answer": "Table 1\n| entity_type   | stock_code   | invest_on   |     dter |\n|:--------------|:-------------|:------------|---------:|\n| Parent        | MWG          |             | 1.57316  |\n| Parent        | VNM          |             | 0.503847 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "-- Step 1: Identify subsidiaries and associated companies for MWG and VNM\nWITH subsidiaries AS (\n    SELECT stock_code, invest_on\n    FROM sub_and_shareholder\n    WHERE stock_code IN ('MWG', 'VNM')\n),\n\n-- Step 2: Retrieve Debt-to-Equity Ratio for MWG and VNM for Q4 2023\nparent_dter AS (\n    SELECT stock_code, data AS dter\n    FROM financial_ratio\n    WHERE ratio_code = 'DTER'\n      AND stock_code IN ('MWG', 'VNM')\n      AND year = 2023\n      AND quarter = 4\n),\n\n-- Step 3: Retrieve Debt-to-Equity Ratio for subsidiaries and associated companies for Q4 2023\nsubsidiary_dter AS (\n    SELECT s.stock_code, s.invest_on, fr.data AS dter\n    FROM subsidiaries s\n    JOIN financial_ratio fr ON s.invest_on = fr.stock_code\n    WHERE fr.ratio_code = 'DTER'\n      AND fr.year = 2023\n      AND fr.quarter = 4\n)\n\n-- Step 4: Combine the results\nSELECT 'Parent' AS entity_type, stock_code, NULL AS invest_on, dter\nFROM parent_dter\nUNION ALL\nSELECT 'Subsidiary', stock_code, invest_on, dter\nFROM subsidiary_dter;\n"
            }
        ],
        "score": 1,
        "difficulty": 4,
        "response": "Table 1\n| stock_code   | associated_company   |\n|:-------------|:---------------------|\n| VNM          | VLC                  |\n| VNM          | MCM                  |\n| VNM          | SBT                  |\n| VNM          | SRF                  |\n| VNM          | TDW                  |\n| MWG          |                      |\n| VNM          | SCIC                 |\n| MWG          |                      |\n\nTable 2\n| stock_code   | associated_company   |   individual_dter |   consolidated_dter |\n|:-------------|:---------------------|------------------:|--------------------:|\n| MWG          |                      |          1.57316  |             3.14632 |\n| MWG          |                      |          1.57316  |             3.14632 |\n| VNM          | VLC                  |          0.503847 |             3.02308 |\n| VNM          | MCM                  |          0.503847 |             3.02308 |\n| VNM          | SBT                  |          0.503847 |             3.02308 |\n| VNM          | SRF                  |          0.503847 |             3.02308 |\n| VNM          | TDW                  |          0.503847 |             3.02308 |\n| VNM          | SCIC                 |          0.503847 |             3.02308 |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "-- Step 1: Identify stock codes and retrieve subsidiaries/associated companies\nWITH target_companies AS (\n  SELECT 'MWG' AS stock_code UNION ALL\n  SELECT 'VNM' AS stock_code\n)\nSELECT \n  tc.stock_code,\n  sah.invest_on AS associated_company\nFROM \n  target_companies tc\n  LEFT JOIN sub_and_shareholder sah ON tc.stock_code = sah.stock_code\nUNION ALL\nSELECT \n  tc.stock_code,\n  sah.stock_code AS associated_company\nFROM \n  target_companies tc\n  LEFT JOIN sub_and_shareholder sah ON tc.stock_code = sah.invest_on\nLIMIT 100;\n"
            },
            {
                "language": "sql",
                "code": "-- Step 2: Extract Debt-to-Equity ratios for Q4 2023 and analyze changes\nWITH \n  -- Step 1 result as a CTE (Common Table Expression)\n  target_companies AS (\n    SELECT 'MWG' AS stock_code UNION ALL\n    SELECT 'VNM' AS stock_code\n  ),\n  companies_with_associates AS (\n    SELECT \n      tc.stock_code,\n      sah.invest_on AS associated_company\n    FROM \n      target_companies tc\n      LEFT JOIN sub_and_shareholder sah ON tc.stock_code = sah.stock_code\n    UNION ALL\n    SELECT \n      tc.stock_code,\n      sah.stock_code AS associated_company\n    FROM \n      target_companies tc\n      LEFT JOIN sub_and_shareholder sah ON tc.stock_code = sah.invest_on\n  ),\n  -- Filter companies with DTER for Q4 2023\n  dter_ratios AS (\n    SELECT \n      cwa.stock_code,\n      cwa.associated_company,\n      fr.data AS dter_ratio\n    FROM \n      companies_with_associates cwa\n      JOIN financial_ratio fr ON cwa.stock_code = fr.stock_code OR cwa.associated_company = fr.stock_code\n      JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\n    WHERE \n      mcr.ratio_name = 'Debt To Equity Ratio'\n      AND fr.year = 2023\n      AND fr.quarter = 4\n  )\n-- Analyze changes in DTER ratios (consolidated debt and equity)\nSELECT \n  dr.stock_code,\n  dr.associated_company,\n  dr.dter_ratio AS individual_dter,\n  SUM(dr.dter_ratio) OVER (PARTITION BY dr.stock_code) AS consolidated_dter\nFROM \n  dter_ratios dr\nLIMIT 100;\n"
            }
        ],
        "time": 51.89986515045166,
        "evaluate": 0.5,
        "input_token": 6811,
        "output_token": 2271
    },
    {
        "id": "650a1eb0-378d-4d82-b07a-acedf00aa716",
        "question": "For the year 2023, what was the combined net income of  VinGroup's subsidiaries and the net income of VinGroup itself, and what percentage of VinGroup's total net income came from its subsidiaries?",
        "answer": "Table 1\n|   total_net_income |   subsidiaries_net_income |   percentage_from_subsidiaries |\n|-------------------:|--------------------------:|-------------------------------:|\n|        4.45219e+07 |               4.94273e+07 |                        111.018 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "WITH vin_subsidiaries AS (\n    SELECT invest_on AS subsidiary_code\n    FROM sub_and_shareholder\n    WHERE stock_code = 'VIC'\n),\nvin_and_subsidiaries_net_income AS (\n    SELECT stock_code, SUM(data) AS net_income\n    FROM non_bank_financial_report\n    WHERE (stock_code = 'VIC' OR stock_code IN (SELECT subsidiary_code FROM vin_subsidiaries))\n      AND year = 2023\n      AND quarter = 0\n      AND category_code = 'IS_030'\n    GROUP BY stock_code\n),\ntotal_net_income AS (\n    SELECT SUM(net_income) AS total_net_income\n    FROM vin_and_subsidiaries_net_income\n),\nsubsidiaries_net_income AS (\n    SELECT SUM(net_income) AS subsidiaries_net_income\n    FROM vin_and_subsidiaries_net_income\n    WHERE stock_code IN (SELECT subsidiary_code FROM vin_subsidiaries)\n)\nSELECT \n    tni.total_net_income,\n    sni.subsidiaries_net_income,\n    (sni.subsidiaries_net_income / tni.total_net_income) * 100 AS percentage_from_subsidiaries\nFROM total_net_income tni, subsidiaries_net_income sni;\n"
            }
        ],
        "score": 1,
        "difficulty": 4,
        "response": "Table 1\n| subsidiary_stock_code   |\n|:------------------------|\n| VRE                     |\n| VEF                     |\n| VNB                     |\n| VHM                     |\n\nTable 2\n| subsidiary_stock_code   |\n|:------------------------|\n| VRE                     |\n| VEF                     |\n| VNB                     |\n| VHM                     |\n\nTable 3\n| subsidiary_stock_code   |\n|:------------------------|\n| VRE                     |\n| VEF                     |\n| VNB                     |\n| VHM                     |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "-- Step 1: Find VinGroup's subsidiaries\nSELECT invest_on AS subsidiary_stock_code\nFROM sub_and_shareholder\nWHERE stock_code = 'VIC'\nLIMIT 100;\n"
            },
            {
                "language": "sql",
                "code": "-- Step 2: Extract net income for VinGroup and its subsidiaries\nWITH \n  -- VinGroup's net income\n  vingroup_net_income AS (\n    SELECT data AS vingroup_net_income\n    FROM non_bank_financial_report\n    WHERE stock_code = 'VIC'\n    AND year = 2023\n    AND quarter = 0\n    AND category_code = 'IS_XXX'  -- Replace 'IS_XXX' with actual category_code for net income\n  ),\n  \n  -- Subsidiaries' stock codes from Step 1\n  subsidiaries_stock_codes AS (\n    SELECT invest_on AS stock_code\n    FROM sub_and_shareholder\n    WHERE stock_code = 'VIC'\n  ),\n  \n  -- Subsidiaries' net income\n  subsidiaries_net_income AS (\n    SELECT SUM(data) AS subsidiaries_total_net_income\n    FROM non_bank_financial_report\n    WHERE stock_code IN (SELECT stock_code FROM subsidiaries_stock_codes)\n    AND year = 2023\n    AND quarter = 0\n    AND category_code = 'IS_XXX'  -- Replace 'IS_XXX' with actual category_code for net income\n  )\n\n-- Calculate total net income and percentage from subsidiaries\nSELECT \n  (SELECT vingroup_net_income FROM vingroup_net_income) AS vingroup_net_income,\n  (SELECT subsidiaries_total_net_income FROM subsidiaries_net_income) AS subsidiaries_total_net_income,\n  ROUND(\n    ((SELECT subsidiaries_total_net_income FROM subsidiaries_net_income) * 100.0) \n    / (\n      (SELECT vingroup_net_income FROM vingroup_net_income) \n      + (SELECT subsidiaries_total_net_income FROM subsidiaries_net_income)\n    )::numeric, 2\n  ) AS percentage_from_subsidaries\nLIMIT 1;\n"
            },
            {
                "language": "sql",
                "code": "WITH \n  vingroup_net_income AS (\n    SELECT data AS vingroup_net_income\n    FROM non_bank_financial_report\n    WHERE stock_code = 'VIC'\n    AND year = 2023\n    AND quarter = 0\n    AND category_code = '**ACTUAL_NET_INCOME_CATEGORY_CODE**'\n  ),\n  \n  subsidiaries_stock_codes AS (\n    SELECT invest_on AS stock_code\n    FROM sub_and_shareholder\n    WHERE stock_code = 'VIC'\n  ),\n  \n  subsidiaries_net_income AS (\n    SELECT SUM(data) AS subsidiaries_total_net_income\n    FROM non_bank_financial_report\n    WHERE stock_code IN (SELECT stock_code FROM subsidiaries_stock_codes)\n    AND year = 2023\n    AND quarter = 0\n    AND category_code = '**ACTUAL_NET_INCOME_CATEGORY_CODE**'\n  )\n\nSELECT \n  (SELECT vingroup_net_income FROM vingroup_net_income) AS vingroup_net_income,\n  (SELECT subsidiaries_total_net_income FROM subsidiaries_net_income) AS subsidiaries_total_net_income,\n  ROUND(\n    ((SELECT subsidiaries_total_net_income FROM subsidiaries_net_income) * 100.0) \n    / (\n      (SELECT vingroup_net_income FROM vingroup_net_income) \n      + (SELECT subsidiaries_total_net_income FROM subsidiaries_net_income)\n    )::numeric, 2\n  ) AS percentage_from_subsidaries\nLIMIT 1;\n"
            }
        ],
        "time": 145.91643977165222,
        "evaluate": 0,
        "input_token": 386,
        "output_token": 46
    },
    {
        "id": "12a7a240-a91a-45cd-b870-50f2826a2e66",
        "question": "What are the top 10 companies with the lowest Debt-to-Equity ratio from 2020 to Q2 2024, calculated as Total Debt divided by Total Equity, and how did this ratio change for each company over this period?",
        "answer": "Table 1\n| stock_code   | company_name                                                  |   year |   quarter |   debt_to_equity_ratio |\n|:-------------|:--------------------------------------------------------------|-------:|----------:|-----------------------:|\n| CAP          | C\u00f4ng ty C\u1ed5 ph\u1ea7n L\u00e2m N\u00f4ng s\u1ea3n Th\u1ef1c ph\u1ea9m Y\u00ean B\u00e1i                |   2023 |         0 |               0.102494 |\n| NHA          | T\u1ed5ng C\u00f4ng ty \u0110\u1ea7u t\u01b0 Ph\u00e1t tri\u1ec3n Nh\u00e0 v\u00e0 \u0110\u00f4 th\u1ecb Nam H\u00e0 N\u1ed9i       |   2020 |         0 |               0.125015 |\n| SLS          | C\u00f4ng ty C\u1ed5 ph\u1ea7n M\u00eda \u0111\u01b0\u1eddng S\u01a1n La                              |   2023 |         0 |               0.136624 |\n| TCH          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 D\u1ecbch v\u1ee5 T\u00e0i ch\u00ednh Ho\u00e0ng Huy            |   2020 |         0 |               0.17039  |\n| TCH          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 D\u1ecbch v\u1ee5 T\u00e0i ch\u00ednh Ho\u00e0ng Huy            |   2023 |         0 |               0.176222 |\n| SLS          | C\u00f4ng ty C\u1ed5 ph\u1ea7n M\u00eda \u0111\u01b0\u1eddng S\u01a1n La                              |   2024 |         2 |               0.179365 |\n| TCH          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 D\u1ecbch v\u1ee5 T\u00e0i ch\u00ednh Ho\u00e0ng Huy            |   2021 |         0 |               0.188442 |\n| CAP          | C\u00f4ng ty C\u1ed5 ph\u1ea7n L\u00e2m N\u00f4ng s\u1ea3n Th\u1ef1c ph\u1ea9m Y\u00ean B\u00e1i                |   2022 |         0 |               0.200008 |\n| VCS          | C\u00f4ng ty C\u1ed5 ph\u1ea7n VICOSTONE                                     |   2024 |         2 |               0.206202 |\n| PNJ          | C\u00f4ng ty C\u1ed5 ph\u1ea7n V\u00e0ng b\u1ea1c \u0110\u00e1 qu\u00fd Ph\u00fa Nhu\u1eadn                     |   2024 |         2 |               0.209858 |\n| TCH          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 D\u1ecbch v\u1ee5 T\u00e0i ch\u00ednh Ho\u00e0ng Huy            |   2022 |         0 |               0.216221 |\n| VRE          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Vincom Retail                                 |   2021 |         0 |               0.235643 |\n| DGC          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n H\u00f3a ch\u1ea5t \u0110\u1ee9c Giang                   |   2022 |         0 |               0.237365 |\n| VRE          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Vincom Retail                                 |   2023 |         0 |               0.259786 |\n| GAS          | T\u1ed5ng C\u00f4ng ty Kh\u00ed Vi\u1ec7t Nam - C\u00f4ng ty C\u1ed5 ph\u1ea7n                   |   2020 |         0 |               0.276946 |\n| VRE          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Vincom Retail                                 |   2022 |         0 |               0.277531 |\n| CAP          | C\u00f4ng ty C\u1ed5 ph\u1ea7n L\u00e2m N\u00f4ng s\u1ea3n Th\u1ef1c ph\u1ea9m Y\u00ean B\u00e1i                |   2021 |         0 |               0.277955 |\n| HLD          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 v\u00e0 Ph\u00e1t tri\u1ec3n B\u1ea5t \u0111\u1ed9ng s\u1ea3n HUDLAND     |   2021 |         0 |               0.287564 |\n| SAB          | T\u1ed5ng C\u00f4ng ty C\u1ed5 ph\u1ea7n Bia - R\u01b0\u1ee3u - N\u01b0\u1edbc Gi\u1ea3i kh\u00e1t S\u00e0i G\u00f2n      |   2020 |         0 |               0.290342 |\n| DGC          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n H\u00f3a ch\u1ea5t \u0110\u1ee9c Giang                   |   2023 |         0 |               0.291759 |\n| VCS          | C\u00f4ng ty C\u1ed5 ph\u1ea7n VICOSTONE                                     |   2023 |         0 |               0.297329 |\n| VRE          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Vincom Retail                                 |   2024 |         2 |               0.310486 |\n| DCM          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Ph\u00e2n b\u00f3n D\u1ea7u Kh\u00ed C\u00e0 Mau                       |   2022 |         0 |               0.33581  |\n| SAB          | T\u1ed5ng C\u00f4ng ty C\u1ed5 ph\u1ea7n Bia - R\u01b0\u1ee3u - N\u01b0\u1edbc Gi\u1ea3i kh\u00e1t S\u00e0i G\u00f2n      |   2023 |         0 |               0.336332 |\n| GAS          | T\u1ed5ng C\u00f4ng ty Kh\u00ed Vi\u1ec7t Nam - C\u00f4ng ty C\u1ed5 ph\u1ea7n                   |   2023 |         0 |               0.343894 |\n| YEG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Yeah1                                |   2023 |         0 |               0.344899 |\n| DGC          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n H\u00f3a ch\u1ea5t \u0110\u1ee9c Giang                   |   2021 |         0 |               0.345608 |\n| SAB          | T\u1ed5ng C\u00f4ng ty C\u1ed5 ph\u1ea7n Bia - R\u01b0\u1ee3u - N\u01b0\u1edbc Gi\u1ea3i kh\u00e1t S\u00e0i G\u00f2n      |   2021 |         0 |               0.349295 |\n| GAS          | T\u1ed5ng C\u00f4ng ty Kh\u00ed Vi\u1ec7t Nam - C\u00f4ng ty C\u1ed5 ph\u1ea7n                   |   2022 |         0 |               0.351281 |\n| VCS          | C\u00f4ng ty C\u1ed5 ph\u1ea7n VICOSTONE                                     |   2022 |         0 |               0.353514 |\n| VRE          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Vincom Retail                                 |   2020 |         0 |               0.357263 |\n| SAB          | T\u1ed5ng C\u00f4ng ty C\u1ed5 ph\u1ea7n Bia - R\u01b0\u1ee3u - N\u01b0\u1edbc Gi\u1ea3i kh\u00e1t S\u00e0i G\u00f2n      |   2024 |         2 |               0.359095 |\n| YEG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Yeah1                                |   2022 |         0 |               0.368554 |\n| GVR          | T\u1eadp \u0111o\u00e0n C\u00f4ng nghi\u1ec7p Cao su Vi\u1ec7t Nam - C\u00f4ng ty C\u1ed5 ph\u1ea7n        |   2024 |         2 |               0.369029 |\n| DCM          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Ph\u00e2n b\u00f3n D\u1ea7u Kh\u00ed C\u00e0 Mau                       |   2020 |         0 |               0.377942 |\n| HLD          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 v\u00e0 Ph\u00e1t tri\u1ec3n B\u1ea5t \u0111\u1ed9ng s\u1ea3n HUDLAND     |   2023 |         0 |               0.394739 |\n| SAB          | T\u1ed5ng C\u00f4ng ty C\u1ed5 ph\u1ea7n Bia - R\u01b0\u1ee3u - N\u01b0\u1edbc Gi\u1ea3i kh\u00e1t S\u00e0i G\u00f2n      |   2022 |         0 |               0.401541 |\n| L14          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Licogi 14                                     |   2022 |         0 |               0.402429 |\n| KDH          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 v\u00e0 Kinh doanh nh\u00e0 Khang \u0110i\u1ec1n           |   2021 |         0 |               0.406165 |\n| LAS          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Supe Ph\u1ed1t ph\u00e1t v\u00e0 H\u00f3a ch\u1ea5t L\u00e2m Thao           |   2020 |         0 |               0.408761 |\n| VCS          | C\u00f4ng ty C\u1ed5 ph\u1ea7n VICOSTONE                                     |   2021 |         0 |               0.414164 |\n| GVR          | T\u1eadp \u0111o\u00e0n C\u00f4ng nghi\u1ec7p Cao su Vi\u1ec7t Nam - C\u00f4ng ty C\u1ed5 ph\u1ea7n        |   2023 |         0 |               0.419899 |\n| TIG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n \u0110\u1ea7u t\u01b0 Th\u0103ng Long                    |   2020 |         0 |               0.423653 |\n| CEO          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n C.E.O                                |   2024 |         2 |               0.435372 |\n| HLD          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 v\u00e0 Ph\u00e1t tri\u1ec3n B\u1ea5t \u0111\u1ed9ng s\u1ea3n HUDLAND     |   2022 |         0 |               0.43865  |\n| VNM          | C\u00f4ng ty C\u1ed5 ph\u1ea7n S\u1eefa Vi\u1ec7t Nam                                  |   2020 |         0 |               0.439424 |\n| DGC          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n H\u00f3a ch\u1ea5t \u0110\u1ee9c Giang                   |   2020 |         0 |               0.444683 |\n| SAF          | C\u00f4ng ty C\u1ed5 ph\u1ea7n L\u01b0\u01a1ng th\u1ef1c Th\u1ef1c ph\u1ea9m SAFOCO                   |   2023 |         0 |               0.457793 |\n| SAF          | C\u00f4ng ty C\u1ed5 ph\u1ea7n L\u01b0\u01a1ng th\u1ef1c Th\u1ef1c ph\u1ea9m SAFOCO                   |   2020 |         0 |               0.463731 |\n| GVR          | T\u1eadp \u0111o\u00e0n C\u00f4ng nghi\u1ec7p Cao su Vi\u1ec7t Nam - C\u00f4ng ty C\u1ed5 ph\u1ea7n        |   2022 |         0 |               0.46592  |\n| PNJ          | C\u00f4ng ty C\u1ed5 ph\u1ea7n V\u00e0ng b\u1ea1c \u0110\u00e1 qu\u00fd Ph\u00fa Nhu\u1eadn                     |   2023 |         0 |               0.471272 |\n| L14          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Licogi 14                                     |   2020 |         0 |               0.474374 |\n| VNM          | C\u00f4ng ty C\u1ed5 ph\u1ea7n S\u1eefa Vi\u1ec7t Nam                                  |   2022 |         0 |               0.477386 |\n| DCM          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Ph\u00e2n b\u00f3n D\u1ea7u Kh\u00ed C\u00e0 Mau                       |   2021 |         0 |               0.480607 |\n| LHC          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 v\u00e0 X\u00e2y d\u1ef1ng Th\u1ee7y l\u1ee3i L\u00e2m \u0110\u1ed3ng          |   2024 |         2 |               0.483638 |\n| VNM          | C\u00f4ng ty C\u1ed5 ph\u1ea7n S\u1eefa Vi\u1ec7t Nam                                  |   2021 |         0 |               0.487649 |\n| VNM          | C\u00f4ng ty C\u1ed5 ph\u1ea7n S\u1eefa Vi\u1ec7t Nam                                  |   2023 |         0 |               0.503847 |\n| NTP          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Nh\u1ef1a Thi\u1ebfu ni\u00ean Ti\u1ec1n Phong                    |   2020 |         0 |               0.504436 |\n| CEO          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n C.E.O                                |   2023 |         0 |               0.508928 |\n| GAS          | T\u1ed5ng C\u00f4ng ty Kh\u00ed Vi\u1ec7t Nam - C\u00f4ng ty C\u1ed5 ph\u1ea7n                   |   2021 |         0 |               0.509177 |\n| GVR          | T\u1eadp \u0111o\u00e0n C\u00f4ng nghi\u1ec7p Cao su Vi\u1ec7t Nam - C\u00f4ng ty C\u1ed5 ph\u1ea7n        |   2021 |         0 |               0.521258 |\n| DCM          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Ph\u00e2n b\u00f3n D\u1ea7u Kh\u00ed C\u00e0 Mau                       |   2023 |         0 |               0.529397 |\n| L14          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Licogi 14                                     |   2021 |         0 |               0.543834 |\n| LHC          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 v\u00e0 X\u00e2y d\u1ef1ng Th\u1ee7y l\u1ee3i L\u00e2m \u0110\u1ed3ng          |   2020 |         0 |               0.545038 |\n| L14          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Licogi 14                                     |   2023 |         0 |               0.554623 |\n| GVR          | T\u1eadp \u0111o\u00e0n C\u00f4ng nghi\u1ec7p Cao su Vi\u1ec7t Nam - C\u00f4ng ty C\u1ed5 ph\u1ea7n        |   2020 |         0 |               0.560901 |\n| SAF          | C\u00f4ng ty C\u1ed5 ph\u1ea7n L\u01b0\u01a1ng th\u1ef1c Th\u1ef1c ph\u1ea9m SAFOCO                   |   2022 |         0 |               0.561239 |\n| YEG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Yeah1                                |   2021 |         0 |               0.563492 |\n| VCS          | C\u00f4ng ty C\u1ed5 ph\u1ea7n VICOSTONE                                     |   2020 |         0 |               0.569625 |\n| SAF          | C\u00f4ng ty C\u1ed5 ph\u1ea7n L\u01b0\u01a1ng th\u1ef1c Th\u1ef1c ph\u1ea9m SAFOCO                   |   2021 |         0 |               0.571747 |\n| TIG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n \u0110\u1ea7u t\u01b0 Th\u0103ng Long                    |   2024 |         2 |               0.576112 |\n| PNJ          | C\u00f4ng ty C\u1ed5 ph\u1ea7n V\u00e0ng b\u1ea1c \u0110\u00e1 qu\u00fd Ph\u00fa Nhu\u1eadn                     |   2022 |         0 |               0.579462 |\n| NHA          | T\u1ed5ng C\u00f4ng ty \u0110\u1ea7u t\u01b0 Ph\u00e1t tri\u1ec3n Nh\u00e0 v\u00e0 \u0110\u00f4 th\u1ecb Nam H\u00e0 N\u1ed9i       |   2023 |         0 |               0.581221 |\n| LHC          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 v\u00e0 X\u00e2y d\u1ef1ng Th\u1ee7y l\u1ee3i L\u00e2m \u0110\u1ed3ng          |   2023 |         0 |               0.593005 |\n| TIG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n \u0110\u1ea7u t\u01b0 Th\u0103ng Long                    |   2023 |         0 |               0.603542 |\n| PNJ          | C\u00f4ng ty C\u1ed5 ph\u1ea7n V\u00e0ng b\u1ea1c \u0110\u00e1 qu\u00fd Ph\u00fa Nhu\u1eadn                     |   2020 |         0 |               0.618346 |\n| NHA          | T\u1ed5ng C\u00f4ng ty \u0110\u1ea7u t\u01b0 Ph\u00e1t tri\u1ec3n Nh\u00e0 v\u00e0 \u0110\u00f4 th\u1ecb Nam H\u00e0 N\u1ed9i       |   2022 |         0 |               0.632072 |\n| DHT          | C\u00f4ng ty C\u1ed5 ph\u1ea7n D\u01b0\u1ee3c ph\u1ea9m H\u00e0 T\u00e2y                              |   2021 |         0 |               0.642793 |\n| LAS          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Supe Ph\u1ed1t ph\u00e1t v\u00e0 H\u00f3a ch\u1ea5t L\u00e2m Thao           |   2023 |         0 |               0.660318 |\n| LHC          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 v\u00e0 X\u00e2y d\u1ef1ng Th\u1ee7y l\u1ee3i L\u00e2m \u0110\u1ed3ng          |   2022 |         0 |               0.682692 |\n| CAP          | C\u00f4ng ty C\u1ed5 ph\u1ea7n L\u00e2m N\u00f4ng s\u1ea3n Th\u1ef1c ph\u1ea9m Y\u00ean B\u00e1i                |   2024 |         2 |               0.687472 |\n| LAS          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Supe Ph\u1ed1t ph\u00e1t v\u00e0 H\u00f3a ch\u1ea5t L\u00e2m Thao           |   2022 |         0 |               0.694971 |\n| POW          | T\u1ed5ng C\u00f4ng ty \u0110i\u1ec7n l\u1ef1c D\u1ea7u kh\u00ed Vi\u1ec7t Nam - CTCP                 |   2021 |         0 |               0.702049 |\n| VGI          | T\u1ed5ng C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 Qu\u1ed1c t\u1ebf Viettel                   |   2024 |         2 |               0.705204 |\n| KDH          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 v\u00e0 Kinh doanh nh\u00e0 Khang \u0110i\u1ec1n           |   2023 |         0 |               0.705913 |\n| POW          | T\u1ed5ng C\u00f4ng ty \u0110i\u1ec7n l\u1ef1c D\u1ea7u kh\u00ed Vi\u1ec7t Nam - CTCP                 |   2022 |         0 |               0.707956 |\n| KDH          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 v\u00e0 Kinh doanh nh\u00e0 Khang \u0110i\u1ec1n           |   2020 |         0 |               0.708054 |\n| VGI          | T\u1ed5ng C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 Qu\u1ed1c t\u1ebf Viettel                   |   2023 |         0 |               0.719185 |\n| LAS          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Supe Ph\u1ed1t ph\u00e1t v\u00e0 H\u00f3a ch\u1ea5t L\u00e2m Thao           |   2021 |         0 |               0.722437 |\n| DHT          | C\u00f4ng ty C\u1ed5 ph\u1ea7n D\u01b0\u1ee3c ph\u1ea9m H\u00e0 T\u00e2y                              |   2023 |         0 |               0.722593 |\n| TIG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n \u0110\u1ea7u t\u01b0 Th\u0103ng Long                    |   2022 |         0 |               0.725978 |\n| VGI          | T\u1ed5ng C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 Qu\u1ed1c t\u1ebf Viettel                   |   2022 |         0 |               0.728122 |\n| POW          | T\u1ed5ng C\u00f4ng ty \u0110i\u1ec7n l\u1ef1c D\u1ea7u kh\u00ed Vi\u1ec7t Nam - CTCP                 |   2020 |         0 |               0.728687 |\n| NTP          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Nh\u1ef1a Thi\u1ebfu ni\u00ean Ti\u1ec1n Phong                    |   2023 |         0 |               0.750505 |\n| TIG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n \u0110\u1ea7u t\u01b0 Th\u0103ng Long                    |   2021 |         0 |               0.751401 |\n| VHM          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Vinhomes                                      |   2021 |         0 |               0.754212 |\n| LHC          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 v\u00e0 X\u00e2y d\u1ef1ng Th\u1ee7y l\u1ee3i L\u00e2m \u0110\u1ed3ng          |   2021 |         0 |               0.755797 |\n| PNJ          | C\u00f4ng ty C\u1ed5 ph\u1ea7n V\u00e0ng b\u1ea1c \u0110\u00e1 qu\u00fd Ph\u00fa Nhu\u1eadn                     |   2021 |         0 |               0.766117 |\n| PVT          | T\u1ed5ng C\u00f4ng ty C\u1ed5 ph\u1ea7n V\u1eadn t\u1ea3i D\u1ea7u kh\u00ed                          |   2020 |         0 |               0.766169 |\n| HPG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n H\u00f2a Ph\u00e1t                             |   2022 |         0 |               0.772243 |\n| DTD          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 Ph\u00e1t tri\u1ec3n Th\u00e0nh \u0110\u1ea1t                   |   2023 |         0 |               0.772254 |\n| PVT          | T\u1ed5ng C\u00f4ng ty C\u1ed5 ph\u1ea7n V\u1eadn t\u1ea3i D\u1ea7u kh\u00ed                          |   2022 |         0 |               0.778332 |\n| NHA          | T\u1ed5ng C\u00f4ng ty \u0110\u1ea7u t\u01b0 Ph\u00e1t tri\u1ec3n Nh\u00e0 v\u00e0 \u0110\u00f4 th\u1ecb Nam H\u00e0 N\u1ed9i       |   2021 |         0 |               0.779472 |\n| DTD          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 Ph\u00e1t tri\u1ec3n Th\u00e0nh \u0110\u1ea1t                   |   2024 |         2 |               0.78104  |\n| NTP          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Nh\u1ef1a Thi\u1ebfu ni\u00ean Ti\u1ec1n Phong                    |   2022 |         0 |               0.788825 |\n| PVT          | T\u1ed5ng C\u00f4ng ty C\u1ed5 ph\u1ea7n V\u1eadn t\u1ea3i D\u1ea7u kh\u00ed                          |   2021 |         0 |               0.794179 |\n| NTP          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Nh\u1ef1a Thi\u1ebfu ni\u00ean Ti\u1ec1n Phong                    |   2021 |         0 |               0.808803 |\n| SLS          | C\u00f4ng ty C\u1ed5 ph\u1ea7n M\u00eda \u0111\u01b0\u1eddng S\u01a1n La                              |   2022 |         0 |               0.815038 |\n| SLS          | C\u00f4ng ty C\u1ed5 ph\u1ea7n M\u00eda \u0111\u01b0\u1eddng S\u01a1n La                              |   2021 |         0 |               0.816257 |\n| HPG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n H\u00f2a Ph\u00e1t                             |   2023 |         0 |               0.826032 |\n| KDH          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 v\u00e0 Kinh doanh nh\u00e0 Khang \u0110i\u1ec1n           |   2022 |         0 |               0.826206 |\n| DHT          | C\u00f4ng ty C\u1ed5 ph\u1ea7n D\u01b0\u1ee3c ph\u1ea9m H\u00e0 T\u00e2y                              |   2022 |         0 |               0.839544 |\n| VGI          | T\u1ed5ng C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 Qu\u1ed1c t\u1ebf Viettel                   |   2021 |         0 |               0.845713 |\n| PVT          | T\u1ed5ng C\u00f4ng ty C\u1ed5 ph\u1ea7n V\u1eadn t\u1ea3i D\u1ea7u kh\u00ed                          |   2024 |         2 |               0.874097 |\n| CEO          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n C.E.O                                |   2022 |         0 |               0.898412 |\n| HPG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n H\u00f2a Ph\u00e1t                             |   2024 |         2 |               0.901137 |\n| PVS          | T\u1ed5ng C\u00f4ng ty C\u1ed5 ph\u1ea7n D\u1ecbch v\u1ee5 K\u1ef9 thu\u1eadt D\u1ea7u kh\u00ed Vi\u1ec7t Nam        |   2024 |         2 |               0.93525  |\n| PVT          | T\u1ed5ng C\u00f4ng ty C\u1ed5 ph\u1ea7n V\u1eadn t\u1ea3i D\u1ea7u kh\u00ed                          |   2023 |         0 |               0.936787 |\n| VC3          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Nam M\u00ea K\u00f4ng                          |   2021 |         0 |               0.941665 |\n| PVC          | T\u1ed5ng C\u00f4ng ty H\u00f3a ch\u1ea5t v\u00e0 D\u1ecbch v\u1ee5 D\u1ea7u kh\u00ed - C\u00f4ng ty C\u1ed5 ph\u1ea7n    |   2024 |         2 |               0.949132 |\n| PVS          | T\u1ed5ng C\u00f4ng ty C\u1ed5 ph\u1ea7n D\u1ecbch v\u1ee5 K\u1ef9 thu\u1eadt D\u1ea7u kh\u00ed Vi\u1ec7t Nam        |   2023 |         0 |               0.950352 |\n| HPG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n H\u00f2a Ph\u00e1t                             |   2021 |         0 |               0.963375 |\n| SLS          | C\u00f4ng ty C\u1ed5 ph\u1ea7n M\u00eda \u0111\u01b0\u1eddng S\u01a1n La                              |   2020 |         0 |               0.974251 |\n| VGI          | T\u1ed5ng C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 Qu\u1ed1c t\u1ebf Viettel                   |   2020 |         0 |               0.975521 |\n| PVS          | T\u1ed5ng C\u00f4ng ty C\u1ed5 ph\u1ea7n D\u1ecbch v\u1ee5 K\u1ef9 thu\u1eadt D\u1ea7u kh\u00ed Vi\u1ec7t Nam        |   2021 |         0 |               0.982156 |\n| CEO          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n C.E.O                                |   2021 |         0 |               0.991947 |\n| PVS          | T\u1ed5ng C\u00f4ng ty C\u1ed5 ph\u1ea7n D\u1ecbch v\u1ee5 K\u1ef9 thu\u1eadt D\u1ea7u kh\u00ed Vi\u1ec7t Nam        |   2022 |         0 |               0.994639 |\n| FPT          | C\u00f4ng ty C\u1ed5 ph\u1ea7n FPT                                           |   2023 |         0 |               1.01392  |\n| DXG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n \u0110\u1ea5t Xanh                             |   2023 |         0 |               1.02916  |\n| PVC          | T\u1ed5ng C\u00f4ng ty H\u00f3a ch\u1ea5t v\u00e0 D\u1ecbch v\u1ee5 D\u1ea7u kh\u00ed - C\u00f4ng ty C\u1ed5 ph\u1ea7n    |   2020 |         0 |               1.03173  |\n| FPT          | C\u00f4ng ty C\u1ed5 ph\u1ea7n FPT                                           |   2022 |         0 |               1.037    |\n| PVS          | T\u1ed5ng C\u00f4ng ty C\u1ed5 ph\u1ea7n D\u1ecbch v\u1ee5 K\u1ef9 thu\u1eadt D\u1ea7u kh\u00ed Vi\u1ec7t Nam        |   2020 |         0 |               1.03966  |\n| CMG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n C\u00f4ng ngh\u1ec7 CMC                        |   2023 |         0 |               1.04948  |\n| POW          | T\u1ed5ng C\u00f4ng ty \u0110i\u1ec7n l\u1ef1c D\u1ea7u kh\u00ed Vi\u1ec7t Nam - CTCP                 |   2023 |         0 |               1.06223  |\n| DVM          | C\u00f4ng ty C\u1ed5 ph\u1ea7n D\u01b0\u1ee3c li\u1ec7u Vi\u1ec7t Nam                            |   2022 |         0 |               1.09689  |\n| CMG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n C\u00f4ng ngh\u1ec7 CMC                        |   2022 |         0 |               1.10132  |\n| DXG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n \u0110\u1ea5t Xanh                             |   2021 |         0 |               1.11143  |\n| CMG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n C\u00f4ng ngh\u1ec7 CMC                        |   2024 |         2 |               1.12275  |\n| DTD          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 Ph\u00e1t tri\u1ec3n Th\u00e0nh \u0110\u1ea1t                   |   2022 |         0 |               1.13455  |\n| CMG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n C\u00f4ng ngh\u1ec7 CMC                        |   2020 |         0 |               1.14525  |\n| DXG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n \u0110\u1ea5t Xanh                             |   2022 |         0 |               1.1527   |\n| HPG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n H\u00f2a Ph\u00e1t                             |   2020 |         0 |               1.22073  |\n| DVM          | C\u00f4ng ty C\u1ed5 ph\u1ea7n D\u01b0\u1ee3c li\u1ec7u Vi\u1ec7t Nam                            |   2023 |         0 |               1.22591  |\n| FPT          | C\u00f4ng ty C\u1ed5 ph\u1ea7n FPT                                           |   2020 |         0 |               1.2431   |\n| NKG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Th\u00e9p Nam Kim                                  |   2023 |         0 |               1.25617  |\n| PVC          | T\u1ed5ng C\u00f4ng ty H\u00f3a ch\u1ea5t v\u00e0 D\u1ecbch v\u1ee5 D\u1ea7u kh\u00ed - C\u00f4ng ty C\u1ed5 ph\u1ea7n    |   2021 |         0 |               1.25925  |\n| HDC          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Ph\u00e1t tri\u1ec3n Nh\u00e0 B\u00e0 R\u1ecba V\u0169ng T\u00e0u                |   2024 |         2 |               1.26119  |\n| PLX          | T\u1eadp \u0111o\u00e0n X\u0103ng d\u1ea7u Vi\u1ec7t Nam                                    |   2021 |         0 |               1.29267  |\n| DBC          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Dabaco Vi\u1ec7t Nam                      |   2021 |         0 |               1.31812  |\n| CMG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n C\u00f4ng ngh\u1ec7 CMC                        |   2021 |         0 |               1.32573  |\n| MWG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 Th\u1ebf Gi\u1edbi Di \u0110\u1ed9ng                       |   2022 |         0 |               1.33297  |\n| DVM          | C\u00f4ng ty C\u1ed5 ph\u1ea7n D\u01b0\u1ee3c li\u1ec7u Vi\u1ec7t Nam                            |   2021 |         0 |               1.34428  |\n| HUT          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Tasco                                         |   2024 |         2 |               1.35003  |\n| PVC          | T\u1ed5ng C\u00f4ng ty H\u00f3a ch\u1ea5t v\u00e0 D\u1ecbch v\u1ee5 D\u1ea7u kh\u00ed - C\u00f4ng ty C\u1ed5 ph\u1ea7n    |   2023 |         0 |               1.35495  |\n| HUT          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Tasco                                         |   2023 |         0 |               1.36439  |\n| POW          | T\u1ed5ng C\u00f4ng ty \u0110i\u1ec7n l\u1ef1c D\u1ea7u kh\u00ed Vi\u1ec7t Nam - CTCP                 |   2024 |         2 |               1.36986  |\n| HDC          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Ph\u00e1t tri\u1ec3n Nh\u00e0 B\u00e0 R\u1ecba V\u0169ng T\u00e0u                |   2022 |         0 |               1.37252  |\n| VHM          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Vinhomes                                      |   2024 |         2 |               1.39121  |\n| DBC          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Dabaco Vi\u1ec7t Nam                      |   2020 |         0 |               1.40109  |\n| VHM          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Vinhomes                                      |   2020 |         0 |               1.41587  |\n| VHM          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Vinhomes                                      |   2023 |         0 |               1.43451  |\n| VHM          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Vinhomes                                      |   2022 |         0 |               1.43609  |\n| NKG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Th\u00e9p Nam Kim                                  |   2020 |         0 |               1.44044  |\n| HDC          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Ph\u00e1t tri\u1ec3n Nh\u00e0 B\u00e0 R\u1ecba V\u0169ng T\u00e0u                |   2023 |         0 |               1.46271  |\n| DTD          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 Ph\u00e1t tri\u1ec3n Th\u00e0nh \u0110\u1ea1t                   |   2021 |         0 |               1.47419  |\n| MWG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 Th\u1ebf Gi\u1edbi Di \u0110\u1ed9ng                       |   2024 |         2 |               1.48784  |\n| FPT          | C\u00f4ng ty C\u1ed5 ph\u1ea7n FPT                                           |   2021 |         0 |               1.50714  |\n| VC3          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Nam M\u00ea K\u00f4ng                          |   2023 |         0 |               1.51354  |\n| NKG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Th\u00e9p Nam Kim                                  |   2022 |         0 |               1.53038  |\n| PLX          | T\u1eadp \u0111o\u00e0n X\u0103ng d\u1ea7u Vi\u1ec7t Nam                                    |   2020 |         0 |               1.53275  |\n| HDC          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Ph\u00e1t tri\u1ec3n Nh\u00e0 B\u00e0 R\u1ecba V\u0169ng T\u00e0u                |   2021 |         0 |               1.54511  |\n| DXG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n \u0110\u1ea5t Xanh                             |   2020 |         0 |               1.5662   |\n| MWG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 Th\u1ebf Gi\u1edbi Di \u0110\u1ed9ng                       |   2023 |         0 |               1.5733   |\n| PLX          | T\u1eadp \u0111o\u00e0n X\u0103ng d\u1ea7u Vi\u1ec7t Nam                                    |   2024 |         2 |               1.60012  |\n| PLX          | T\u1eadp \u0111o\u00e0n X\u0103ng d\u1ea7u Vi\u1ec7t Nam                                    |   2022 |         0 |               1.68066  |\n| VIC          | T\u1eadp \u0111o\u00e0n Vingroup - C\u00f4ng ty CP                                |   2021 |         0 |               1.68459  |\n| NKG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Th\u00e9p Nam Kim                                  |   2021 |         0 |               1.69044  |\n| BCM          | T\u1ed5ng C\u00f4ng ty \u0110\u1ea7u t\u01b0 v\u00e0 Ph\u00e1t tri\u1ec3n C\u00f4ng nghi\u1ec7p - CTCP          |   2022 |         0 |               1.69096  |\n| PVC          | T\u1ed5ng C\u00f4ng ty H\u00f3a ch\u1ea5t v\u00e0 D\u1ecbch v\u1ee5 D\u1ea7u kh\u00ed - C\u00f4ng ty C\u1ed5 ph\u1ea7n    |   2022 |         0 |               1.69426  |\n| DBC          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Dabaco Vi\u1ec7t Nam                      |   2024 |         2 |               1.72785  |\n| BCM          | T\u1ed5ng C\u00f4ng ty \u0110\u1ea7u t\u01b0 v\u00e0 Ph\u00e1t tri\u1ec3n C\u00f4ng nghi\u1ec7p - CTCP          |   2023 |         0 |               1.7435   |\n| BCM          | T\u1ed5ng C\u00f4ng ty \u0110\u1ea7u t\u01b0 v\u00e0 Ph\u00e1t tri\u1ec3n C\u00f4ng nghi\u1ec7p - CTCP          |   2024 |         2 |               1.77546  |\n| DBC          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Dabaco Vi\u1ec7t Nam                      |   2023 |         0 |               1.78848  |\n| DBC          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Dabaco Vi\u1ec7t Nam                      |   2022 |         0 |               1.7954   |\n| TNG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 v\u00e0 Th\u01b0\u01a1ng m\u1ea1i TNG                      |   2023 |         0 |               1.81978  |\n| HUT          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Tasco                                         |   2021 |         0 |               1.84053  |\n| BCM          | T\u1ed5ng C\u00f4ng ty \u0110\u1ea7u t\u01b0 v\u00e0 Ph\u00e1t tri\u1ec3n C\u00f4ng nghi\u1ec7p - CTCP          |   2021 |         0 |               1.85522  |\n| VPI          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 V\u0103n Ph\u00fa - Invest                       |   2021 |         0 |               1.89752  |\n| VPI          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 V\u0103n Ph\u00fa - Invest                       |   2024 |         2 |               1.90154  |\n| HDC          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Ph\u00e1t tri\u1ec3n Nh\u00e0 B\u00e0 R\u1ecba V\u0169ng T\u00e0u                |   2020 |         0 |               1.91758  |\n| PVG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Kinh doanh LPG Vi\u1ec7t Nam                       |   2022 |         0 |               1.92198  |\n| VPI          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 V\u0103n Ph\u00fa - Invest                       |   2022 |         0 |               1.95208  |\n| MWG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 Th\u1ebf Gi\u1edbi Di \u0110\u1ed9ng                       |   2020 |         0 |               1.97325  |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan                                |   2021 |         0 |               1.97835  |\n| TNG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 v\u00e0 Th\u01b0\u01a1ng m\u1ea1i TNG                      |   2021 |         0 |               1.98675  |\n| HUT          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Tasco                                         |   2022 |         0 |               2.00309  |\n| TVD          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Than V\u00e0ng Danh - Vinacomin                    |   2023 |         0 |               2.00446  |\n| VJC          | C\u00f4ng ty C\u1ed5 ph\u1ea7n H\u00e0ng kh\u00f4ng Vietjet                            |   2020 |         0 |               2.01747  |\n| VJC          | C\u00f4ng ty C\u1ed5 ph\u1ea7n H\u00e0ng kh\u00f4ng Vietjet                            |   2021 |         0 |               2.06474  |\n| MWG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 Th\u1ebf Gi\u1edbi Di \u0110\u1ed9ng                       |   2021 |         0 |               2.09013  |\n| TNG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 v\u00e0 Th\u01b0\u01a1ng m\u1ea1i TNG                      |   2020 |         0 |               2.09671  |\n| VIC          | T\u1eadp \u0111o\u00e0n Vingroup - C\u00f4ng ty CP                                |   2020 |         0 |               2.11001  |\n| VPI          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 V\u0103n Ph\u00fa - Invest                       |   2023 |         0 |               2.15907  |\n| TNG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 v\u00e0 Th\u01b0\u01a1ng m\u1ea1i TNG                      |   2022 |         0 |               2.20557  |\n| PLC          | T\u1ed5ng C\u00f4ng ty H\u00f3a d\u1ea7u Petrolimex - C\u00f4ng ty C\u1ed5 ph\u1ea7n             |   2024 |         2 |               2.21151  |\n| PVG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Kinh doanh LPG Vi\u1ec7t Nam                       |   2020 |         0 |               2.22173  |\n| PLC          | T\u1ed5ng C\u00f4ng ty H\u00f3a d\u1ea7u Petrolimex - C\u00f4ng ty C\u1ed5 ph\u1ea7n             |   2023 |         0 |               2.22761  |\n| TNG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 v\u00e0 Th\u01b0\u01a1ng m\u1ea1i TNG                      |   2024 |         2 |               2.26609  |\n| VPI          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 V\u0103n Ph\u00fa - Invest                       |   2020 |         0 |               2.28019  |\n| PLC          | T\u1ed5ng C\u00f4ng ty H\u00f3a d\u1ea7u Petrolimex - C\u00f4ng ty C\u1ed5 ph\u1ea7n             |   2021 |         0 |               2.51506  |\n| TMB          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Kinh doanh Than Mi\u1ec1n B\u1eafc - Vinacomin          |   2021 |         0 |               2.53892  |\n| PVG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Kinh doanh LPG Vi\u1ec7t Nam                       |   2021 |         0 |               2.71025  |\n| PVG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Kinh doanh LPG Vi\u1ec7t Nam                       |   2023 |         0 |               2.72341  |\n| PLC          | T\u1ed5ng C\u00f4ng ty H\u00f3a d\u1ea7u Petrolimex - C\u00f4ng ty C\u1ed5 ph\u1ea7n             |   2020 |         0 |               2.74222  |\n| PLC          | T\u1ed5ng C\u00f4ng ty H\u00f3a d\u1ea7u Petrolimex - C\u00f4ng ty C\u1ed5 ph\u1ea7n             |   2022 |         0 |               2.76126  |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan                                |   2023 |         0 |               2.85445  |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan                                |   2022 |         0 |               2.85795  |\n| DVM          | C\u00f4ng ty C\u1ed5 ph\u1ea7n D\u01b0\u1ee3c li\u1ec7u Vi\u1ec7t Nam                            |   2020 |         0 |               2.88006  |\n| VTP          | T\u1ed5ng C\u00f4ng ty C\u1ed5 ph\u1ea7n B\u01b0u ch\u00ednh Viettel                        |   2023 |         0 |               3.0692   |\n| TVD          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Than V\u00e0ng Danh - Vinacomin                    |   2022 |         0 |               3.07163  |\n| VTP          | T\u1ed5ng C\u00f4ng ty C\u1ed5 ph\u1ea7n B\u01b0u ch\u00ednh Viettel                        |   2021 |         0 |               3.09964  |\n| VTP          | T\u1ed5ng C\u00f4ng ty C\u1ed5 ph\u1ea7n B\u01b0u ch\u00ednh Viettel                        |   2022 |         0 |               3.12368  |\n| VIC          | T\u1eadp \u0111o\u00e0n Vingroup - C\u00f4ng ty CP                                |   2022 |         0 |               3.25643  |\n| TVD          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Than V\u00e0ng Danh - Vinacomin                    |   2021 |         0 |               3.27534  |\n| FRT          | C\u00f4ng ty C\u1ed5 ph\u1ea7n B\u00e1n l\u1ebb K\u1ef9 thu\u1eadt s\u1ed1 FPT                        |   2020 |         0 |               3.39756  |\n| VTP          | T\u1ed5ng C\u00f4ng ty C\u1ed5 ph\u1ea7n B\u01b0u ch\u00ednh Viettel                        |   2024 |         2 |               3.41035  |\n| VIC          | T\u1eadp \u0111o\u00e0n Vingroup - C\u00f4ng ty CP                                |   2024 |         2 |               3.44847  |\n| VIC          | T\u1eadp \u0111o\u00e0n Vingroup - C\u00f4ng ty CP                                |   2023 |         0 |               3.50444  |\n| NVL          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n \u0110\u1ea7u t\u01b0 \u0110\u1ecba \u1ed1c No Va                  |   2020 |         0 |               3.52636  |\n| VJC          | C\u00f4ng ty C\u1ed5 ph\u1ea7n H\u00e0ng kh\u00f4ng Vietjet                            |   2022 |         0 |               3.56676  |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan                                |   2020 |         0 |               3.62386  |\n| NVL          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n \u0110\u1ea7u t\u01b0 \u0110\u1ecba \u1ed1c No Va                  |   2021 |         0 |               3.90207  |\n| TMB          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Kinh doanh Than Mi\u1ec1n B\u1eafc - Vinacomin          |   2022 |         0 |               4.03591  |\n| FRT          | C\u00f4ng ty C\u1ed5 ph\u1ea7n B\u00e1n l\u1ebb K\u1ef9 thu\u1eadt s\u1ed1 FPT                        |   2022 |         0 |               4.13522  |\n| TVD          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Than V\u00e0ng Danh - Vinacomin                    |   2020 |         0 |               4.17725  |\n| NVL          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n \u0110\u1ea7u t\u01b0 \u0110\u1ecba \u1ed1c No Va                  |   2023 |         0 |               4.33049  |\n| L18          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 v\u00e0 X\u00e2y d\u1ef1ng s\u1ed1 18                      |   2021 |         0 |               4.3342   |\n| TMB          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Kinh doanh Than Mi\u1ec1n B\u1eafc - Vinacomin          |   2023 |         0 |               4.66769  |\n| PSD          | C\u00f4ng ty C\u1ed5 ph\u1ea7n D\u1ecbch v\u1ee5 Ph\u00e2n ph\u1ed1i T\u1ed5ng h\u1ee3p D\u1ea7u kh\u00ed            |   2023 |         0 |               4.69525  |\n| VJC          | C\u00f4ng ty C\u1ed5 ph\u1ea7n H\u00e0ng kh\u00f4ng Vietjet                            |   2023 |         0 |               4.69885  |\n| L18          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 v\u00e0 X\u00e2y d\u1ef1ng s\u1ed1 18                      |   2022 |         0 |               4.73317  |\n| NVL          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n \u0110\u1ea7u t\u01b0 \u0110\u1ecba \u1ed1c No Va                  |   2022 |         0 |               4.75073  |\n| VPB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Vi\u1ec7t Nam Th\u1ecbnh V\u01b0\u1ee3ng             |   2023 |         0 |               4.84831  |\n| TCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam               |   2020 |         0 |               4.89163  |\n| PSD          | C\u00f4ng ty C\u1ed5 ph\u1ea7n D\u1ecbch v\u1ee5 Ph\u00e2n ph\u1ed1i T\u1ed5ng h\u1ee3p D\u1ea7u kh\u00ed            |   2021 |         0 |               5.01874  |\n| VPB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Vi\u1ec7t Nam Th\u1ecbnh V\u01b0\u1ee3ng             |   2022 |         0 |               5.09663  |\n| TCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam               |   2021 |         0 |               5.11264  |\n| TCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam               |   2022 |         0 |               5.16295  |\n| VPB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Vi\u1ec7t Nam Th\u1ecbnh V\u01b0\u1ee3ng             |   2024 |         2 |               5.26066  |\n| VPB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Vi\u1ec7t Nam Th\u1ecbnh V\u01b0\u1ee3ng             |   2021 |         0 |               5.34471  |\n| FRT          | C\u00f4ng ty C\u1ed5 ph\u1ea7n B\u00e1n l\u1ebb K\u1ef9 thu\u1eadt s\u1ed1 FPT                        |   2021 |         0 |               5.42305  |\n| TCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam               |   2023 |         0 |               5.50936  |\n| TCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam               |   2024 |         2 |               5.6117   |\n| TMB          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Kinh doanh Than Mi\u1ec1n B\u1eafc - Vinacomin          |   2024 |         2 |               5.64646  |\n| L18          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 v\u00e0 X\u00e2y d\u1ef1ng s\u1ed1 18                      |   2020 |         0 |               5.67617  |\n| PSD          | C\u00f4ng ty C\u1ed5 ph\u1ea7n D\u1ecbch v\u1ee5 Ph\u00e2n ph\u1ed1i T\u1ed5ng h\u1ee3p D\u1ea7u kh\u00ed            |   2022 |         0 |               5.71337  |\n| PSD          | C\u00f4ng ty C\u1ed5 ph\u1ea7n D\u1ecbch v\u1ee5 Ph\u00e2n ph\u1ed1i T\u1ed5ng h\u1ee3p D\u1ea7u kh\u00ed            |   2020 |         0 |               5.90465  |\n| FRT          | C\u00f4ng ty C\u1ed5 ph\u1ea7n B\u00e1n l\u1ebb K\u1ef9 thu\u1eadt s\u1ed1 FPT                        |   2023 |         0 |               6.61905  |\n| OCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ph\u01b0\u01a1ng \u0110\u00f4ng                      |   2022 |         0 |               6.67618  |\n| VPB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Vi\u1ec7t Nam Th\u1ecbnh V\u01b0\u1ee3ng             |   2020 |         0 |               6.93709  |\n| L18          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 v\u00e0 X\u00e2y d\u1ef1ng s\u1ed1 18                      |   2024 |         2 |               7.08423  |\n| OCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ph\u01b0\u01a1ng \u0110\u00f4ng                      |   2023 |         0 |               7.41452  |\n| OCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ph\u01b0\u01a1ng \u0110\u00f4ng                      |   2021 |         0 |               7.46095  |\n| OCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ph\u01b0\u01a1ng \u0110\u00f4ng                      |   2020 |         0 |               7.74824  |\n| EIB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Xu\u1ea5t nh\u1eadp kh\u1ea9u Vi\u1ec7t Nam          |   2023 |         0 |               7.9738   |\n| EIB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Xu\u1ea5t nh\u1eadp kh\u1ea9u Vi\u1ec7t Nam          |   2022 |         0 |               8.03598  |\n| MBB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Qu\u00e2n \u0111\u1ed9i                         |   2022 |         0 |               8.1509   |\n| L18          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 v\u00e0 X\u00e2y d\u1ef1ng s\u1ed1 18                      |   2023 |         0 |               8.16639  |\n| EIB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Xu\u1ea5t nh\u1eadp kh\u1ea9u Vi\u1ec7t Nam          |   2021 |         0 |               8.32431  |\n| EIB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Xu\u1ea5t nh\u1eadp kh\u1ea9u Vi\u1ec7t Nam          |   2020 |         0 |               8.53865  |\n| MBB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Qu\u00e2n \u0111\u1ed9i                         |   2021 |         0 |               8.71642  |\n| MBB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Qu\u00e2n \u0111\u1ed9i                         |   2023 |         0 |               8.77089  |\n| MBB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Qu\u00e2n \u0111\u1ed9i                         |   2020 |         0 |               8.87998  |\n| TMB          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Kinh doanh Than Mi\u1ec1n B\u1eafc - Vinacomin          |   2020 |         0 |               8.96134  |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh                          |   2022 |         0 |               8.97033  |\n| ACB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n \u00c1 Ch\u00e2u                           |   2023 |         0 |               9.13015  |\n| TPB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ti\u00ean Phong                       |   2022 |         0 |               9.19368  |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh                          |   2021 |         0 |               9.31087  |\n| ACB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n \u00c1 Ch\u00e2u                           |   2022 |         0 |               9.40194  |\n| VIB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Qu\u1ed1c t\u1ebf Vi\u1ec7t Nam                 |   2022 |         0 |               9.49887  |\n| HDB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ph\u00e1t Tri\u1ec3n Th\u00e0nh ph\u1ed1 H\u1ed3 Ch\u00ed Minh |   2022 |         0 |               9.67507  |\n| VIB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Qu\u1ed1c t\u1ebf Vi\u1ec7t Nam                 |   2023 |         0 |               9.80353  |\n| TPB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ti\u00ean Phong                       |   2023 |         0 |               9.89194  |\n| VCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ngo\u1ea1i th\u01b0\u01a1ng Vi\u1ec7t Nam            |   2023 |         0 |              10.1483   |\n| LPB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n L\u1ed9c Ph\u00e1t Vi\u1ec7t Nam                |   2023 |         0 |              10.2219   |\n| TPB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ti\u00ean Phong                       |   2021 |         0 |              10.2682   |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh                          |   2024 |         2 |              10.3055   |\n| ACB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n \u00c1 Ch\u00e2u                           |   2021 |         0 |              10.7541   |\n| SHB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n S\u00e0i G\u00f2n \u2013 H\u00e0 N\u1ed9i                 |   2024 |         2 |              10.8215   |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh                          |   2023 |         0 |              11.0259   |\n| HDB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ph\u00e1t Tri\u1ec3n Th\u00e0nh ph\u1ed1 H\u1ed3 Ch\u00ed Minh |   2021 |         0 |              11.1666   |\n| SHB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n S\u00e0i G\u00f2n \u2013 H\u00e0 N\u1ed9i                 |   2020 |         0 |              11.2966   |\n| TPB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ti\u00ean Phong                       |   2020 |         0 |              11.3214   |\n| ACB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n \u00c1 Ch\u00e2u                           |   2020 |         0 |              11.5403   |\n| SHB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n S\u00e0i G\u00f2n \u2013 H\u00e0 N\u1ed9i                 |   2023 |         0 |              11.5853   |\n| VIB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Qu\u1ed1c t\u1ebf Vi\u1ec7t Nam                 |   2021 |         0 |              11.7422   |\n| SHB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n S\u00e0i G\u00f2n \u2013 H\u00e0 N\u1ed9i                 |   2022 |         0 |              11.8402   |\n| HDB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ph\u00e1t Tri\u1ec3n Th\u00e0nh ph\u1ed1 H\u1ed3 Ch\u00ed Minh |   2020 |         0 |              11.918    |\n| VCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ngo\u1ea1i th\u01b0\u01a1ng Vi\u1ec7t Nam            |   2021 |         0 |              11.9647   |\n| ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh                          |   2020 |         0 |              12.0583   |\n| VCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ngo\u1ea1i th\u01b0\u01a1ng Vi\u1ec7t Nam            |   2022 |         0 |              12.3717   |\n| HDB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ph\u00e1t Tri\u1ec3n Th\u00e0nh ph\u1ed1 H\u1ed3 Ch\u00ed Minh |   2023 |         0 |              12.5012   |\n| VIB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Qu\u1ed1c t\u1ebf Vi\u1ec7t Nam                 |   2020 |         0 |              12.6129   |\n| LPB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n L\u1ed9c Ph\u00e1t Vi\u1ec7t Nam                |   2022 |         0 |              12.6248   |\n| VCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ngo\u1ea1i th\u01b0\u01a1ng Vi\u1ec7t Nam            |   2020 |         0 |              13.0946   |\n| SHB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n S\u00e0i G\u00f2n \u2013 H\u00e0 N\u1ed9i                 |   2021 |         0 |              13.2578   |\n| STB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n S\u00e0i G\u00f2n Th\u01b0\u01a1ng T\u00edn               |   2023 |         0 |              13.746    |\n| STB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n S\u00e0i G\u00f2n Th\u01b0\u01a1ng T\u00edn               |   2021 |         0 |              14.2101   |\n| STB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n S\u00e0i G\u00f2n Th\u01b0\u01a1ng T\u00edn               |   2022 |         0 |              14.3237   |\n| NVB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Qu\u1ed1c D\u00e2n                         |   2022 |         0 |              14.587    |\n| CTG          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n C\u00f4ng th\u01b0\u01a1ng Vi\u1ec7t Nam             |   2020 |         0 |              14.7056   |\n| CTG          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n C\u00f4ng th\u01b0\u01a1ng Vi\u1ec7t Nam             |   2023 |         0 |              15.1483   |\n| CTG          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n C\u00f4ng th\u01b0\u01a1ng Vi\u1ec7t Nam             |   2021 |         0 |              15.3545   |\n| CTG          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n C\u00f4ng th\u01b0\u01a1ng Vi\u1ec7t Nam             |   2022 |         0 |              15.7188   |\n| STB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n S\u00e0i G\u00f2n Th\u01b0\u01a1ng T\u00edn               |   2020 |         0 |              16.009    |\n| LPB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n L\u1ed9c Ph\u00e1t Vi\u1ec7t Nam                |   2020 |         0 |              16.0284   |\n| LPB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n L\u1ed9c Ph\u00e1t Vi\u1ec7t Nam                |   2021 |         0 |              16.212    |\n| NVB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Qu\u1ed1c D\u00e2n                         |   2021 |         0 |              16.3027   |\n| BID          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 v\u00e0 Ph\u00e1t tri\u1ec3n Vi\u1ec7t Nam    |   2024 |         2 |              17.7161   |\n| BID          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 v\u00e0 Ph\u00e1t tri\u1ec3n Vi\u1ec7t Nam    |   2023 |         0 |              17.7184   |\n| BID          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 v\u00e0 Ph\u00e1t tri\u1ec3n Vi\u1ec7t Nam    |   2020 |         0 |              18.0427   |\n| NVB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Qu\u1ed1c D\u00e2n                         |   2024 |         2 |              19.2545   |\n| BID          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 v\u00e0 Ph\u00e1t tri\u1ec3n Vi\u1ec7t Nam    |   2022 |         0 |              19.3533   |\n| BID          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 v\u00e0 Ph\u00e1t tri\u1ec3n Vi\u1ec7t Nam    |   2021 |         0 |              19.4068   |\n| NVB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Qu\u1ed1c D\u00e2n                         |   2020 |         0 |              20.0192   |\n| VC3          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Nam M\u00ea K\u00f4ng                          |   2022 |         0 |             nan        |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "WITH RankedCompanies AS (\n    SELECT \n        fr.stock_code,\n        ci.company_name,\n        fr.year,\n        fr.quarter,\n        fr.data AS debt_to_equity_ratio,\n        ROW_NUMBER() OVER (PARTITION BY fr.stock_code ORDER BY fr.data ASC) AS rn\n    FROM \n        financial_ratio fr\n    JOIN \n        company_info ci ON fr.stock_code = ci.stock_code\n    WHERE \n        fr.ratio_code = 'DTER'\n        AND ((fr.year = 2020 AND fr.quarter = 0) OR\n             (fr.year = 2021 AND fr.quarter = 0) OR\n             (fr.year = 2022 AND fr.quarter = 0) OR\n             (fr.year = 2023 AND fr.quarter = 0) OR\n             (fr.year = 2024 AND fr.quarter = 2))\n)\nSELECT \n    rc.stock_code,\n    rc.company_name,\n    rc.year,\n    rc.quarter,\n    rc.debt_to_equity_ratio\nFROM \n    RankedCompanies rc\nWHERE \n    rc.rn <= 10\nORDER BY \n    rc.debt_to_equity_ratio ASC, rc.stock_code, rc.year, rc.quarter;\n"
            }
        ],
        "score": 1,
        "difficulty": 3,
        "response": "Table 1\n| stock_code   |   year |   quarter |   dter_value |   prev_dter_value |\n|:-------------|-------:|----------:|-------------:|------------------:|\n| CAP          |   2023 |         0 |     0.102494 |          0.200008 |\n| NHA          |   2020 |         0 |     0.125015 |        nan        |\n| SLS          |   2023 |         0 |     0.136624 |          0.815038 |\n| TCH          |   2020 |         0 |     0.17039  |        nan        |\n| TCH          |   2023 |         0 |     0.176222 |          0.216221 |\n| SLS          |   2024 |         2 |     0.179365 |          0.136624 |\n| TCH          |   2021 |         0 |     0.188442 |          0.17039  |\n| CAP          |   2022 |         0 |     0.200008 |          0.277955 |\n| VCS          |   2024 |         2 |     0.206202 |          0.297329 |\n| PNJ          |   2024 |         2 |     0.209858 |          0.471272 |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "WITH dter_ratios AS (\n  SELECT \n    fr.stock_code,\n    fr.year,\n    fr.quarter,\n    fr.data AS dter_value\n  FROM \n    financial_ratio fr\n  INNER JOIN \n    map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\n  WHERE \n    mcr.ratio_name = 'Debt To Equity Ratio'\n    AND fr.year BETWEEN 2020 AND 2024\n    AND (fr.quarter = 0 OR (fr.year = 2024 AND fr.quarter = 2))\n)\nSELECT \n  stock_code,\n  year,\n  quarter,\n  dter_value,\n  LAG(dter_value, 1, NULL) OVER (PARTITION BY stock_code ORDER BY year, quarter) AS prev_dter_value\nFROM \n  dter_ratios\nORDER BY \n  dter_value ASC\nLIMIT 10;\n"
            }
        ],
        "time": 44.86600995063782,
        "evaluate": 1,
        "input_token": 2161,
        "output_token": 846
    },
    {
        "id": "6ef05b65-adaa-4959-805b-0f7a613617fd",
        "question": "What is the trend of Return on Equity (ROE) for Vietcombank, Techcombank, and ACB from 2020 to Q2 2024?",
        "answer": "Table 1\n| stock_code   |   year |   quarter |       roe |\n|:-------------|-------:|----------:|----------:|\n| ACB          |   2020 |         0 | 0.216734  |\n| ACB          |   2021 |         0 | 0.213865  |\n| ACB          |   2022 |         0 | 0.234232  |\n| ACB          |   2023 |         0 | 0.226122  |\n| ACB          |   2024 |         1 | 0.052218  |\n| TCB          |   2020 |         0 | 0.168632  |\n| TCB          |   2021 |         0 | 0.197927  |\n| TCB          |   2022 |         0 | 0.180176  |\n| TCB          |   2023 |         0 | 0.139608  |\n| TCB          |   2024 |         1 | 0.0459854 |\n| TCB          |   2024 |         2 | 0.0457096 |\n| VCB          |   2020 |         0 | 0.196318  |\n| VCB          |   2021 |         0 | 0.201059  |\n| VCB          |   2022 |         0 | 0.220567  |\n| VCB          |   2023 |         0 | 0.200315  |\n| VCB          |   2024 |         1 | 0.0494831 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    stock_code, \n    year, \n    quarter, \n    data AS roe\nFROM \n    financial_ratio\nWHERE \n    ratio_code = 'ROE'\n    AND stock_code IN ('VCB', 'TCB', 'ACB')\n    AND (\n        (year BETWEEN 2020 AND 2023 AND quarter = 0) OR\n        (year = 2024 AND quarter IN (1, 2))\n    )\nORDER BY \n    stock_code, \n    year, \n    quarter;\n"
            }
        ],
        "score": 1,
        "difficulty": 2,
        "response": "Table 1\n| stock_code   | company_name                                       |   year |   quarter |   roe_value |\n|:-------------|:---------------------------------------------------|-------:|----------:|------------:|\n| ACB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n \u00c1 Ch\u00e2u                |   2020 |         2 |   0.0493524 |\n| ACB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n \u00c1 Ch\u00e2u                |   2020 |         3 |   0.0630206 |\n| ACB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n \u00c1 Ch\u00e2u                |   2020 |         4 |   0.0719231 |\n| ACB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n \u00c1 Ch\u00e2u                |   2021 |         2 |   0.0640966 |\n| ACB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n \u00c1 Ch\u00e2u                |   2021 |         3 |   0.0494926 |\n| ACB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n \u00c1 Ch\u00e2u                |   2021 |         4 |   0.0540857 |\n| ACB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n \u00c1 Ch\u00e2u                |   2022 |         2 |   0.0757336 |\n| ACB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n \u00c1 Ch\u00e2u                |   2022 |         3 |   0.0643583 |\n| ACB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n \u00c1 Ch\u00e2u                |   2022 |         4 |   0.0491202 |\n| ACB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n \u00c1 Ch\u00e2u                |   2023 |         2 | nan         |\n| ACB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n \u00c1 Ch\u00e2u                |   2023 |         3 |   0.0604199 |\n| TCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam    |   2020 |         2 |   0.0428449 |\n| TCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam    |   2020 |         3 |   0.0450409 |\n| TCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam    |   2020 |         4 |   0.0537099 |\n| TCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam    |   2021 |         2 |   0.0572896 |\n| TCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam    |   2021 |         3 |   0.0501452 |\n| TCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam    |   2021 |         4 |   0.0503334 |\n| TCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam    |   2022 |         2 |   0.0562806 |\n| TCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam    |   2022 |         3 |   0.0488406 |\n| TCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam    |   2022 |         4 |   0.031493  |\n| TCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam    |   2023 |         2 |   0.0367734 |\n| TCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam    |   2023 |         3 |   0.0367239 |\n| TCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam    |   2023 |         4 |   0.0381519 |\n| TCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam    |   2024 |         2 |   0.0457096 |\n| VCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ngo\u1ea1i th\u01b0\u01a1ng Vi\u1ec7t Nam |   2020 |         2 |   0.0515214 |\n| VCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ngo\u1ea1i th\u01b0\u01a1ng Vi\u1ec7t Nam |   2020 |         3 |   0.0427012 |\n| VCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ngo\u1ea1i th\u01b0\u01a1ng Vi\u1ec7t Nam |   2020 |         4 |   0.0573927 |\n| VCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ngo\u1ea1i th\u01b0\u01a1ng Vi\u1ec7t Nam |   2021 |         2 |   0.0377385 |\n| VCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ngo\u1ea1i th\u01b0\u01a1ng Vi\u1ec7t Nam |   2021 |         3 |   0.1084    |\n| VCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ngo\u1ea1i th\u01b0\u01a1ng Vi\u1ec7t Nam |   2021 |         4 |   0.0580801 |\n| VCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ngo\u1ea1i th\u01b0\u01a1ng Vi\u1ec7t Nam |   2022 |         2 |   0.0483124 |\n| VCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ngo\u1ea1i th\u01b0\u01a1ng Vi\u1ec7t Nam |   2022 |         3 |   0.0472737 |\n| VCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ngo\u1ea1i th\u01b0\u01a1ng Vi\u1ec7t Nam |   2022 |         4 |   0.0719881 |\n| VCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ngo\u1ea1i th\u01b0\u01a1ng Vi\u1ec7t Nam |   2023 |         2 |   0.139806  |\n| VCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ngo\u1ea1i th\u01b0\u01a1ng Vi\u1ec7t Nam |   2023 |         3 |   0.045712  |\n| VCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ngo\u1ea1i th\u01b0\u01a1ng Vi\u1ec7t Nam |   2023 |         4 |   0.0555349 |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT \n  fr.stock_code,\n  ci.company_name,\n  fr.year,\n  fr.quarter,\n  fr.data AS ROE_Value\nFROM \n  financial_ratio fr\n  INNER JOIN company_info ci ON fr.stock_code = ci.stock_code\n  INNER JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\nWHERE \n  mcr.ratio_name = 'Return On Equity'  -- Filter by ROE\n  AND fr.stock_code IN ('VCB', 'TCB', 'ACB')  -- Filter by stock codes\n  AND fr.quarter IN (2, 3, 4, 6, 7, 8, 10, 11, 12, 14, 15, 16, 18)  -- Filter by quarter values\n  AND fr.year BETWEEN 2020 AND 2024  -- Filter by year range\nORDER BY \n  fr.stock_code, \n  fr.year, \n  fr.quarter\nLIMIT 100;  -- Add limit to the query\n"
            }
        ],
        "time": 45.261253356933594,
        "evaluate": 0,
        "input_token": 5676,
        "output_token": 1580
    },
    {
        "id": "eefe39ae-6424-47d5-ac08-482fc8f15531",
        "question": "For the top 10 companies with Net Income greater than 1,000,000,000,000 VND in 2023, what are their respective Net Profit Margins and Current Ratios?",
        "answer": "Table 1\n| stock_code   | net_profit_margin   | current_ratio   |\n|--------------|---------------------|-----------------|\n\n",
        "code": [
            {
                "language": "sql",
                "code": "WITH TopCompanies AS (\n    SELECT\n        stock_code,\n        SUM(data) AS net_income\n    FROM (\n        SELECT stock_code, data\n        FROM bank_financial_report\n        WHERE category_code = 'IS_021' AND year = 2023 AND quarter = 0\n        \n        UNION ALL\n        \n        SELECT stock_code, data\n        FROM non_bank_financial_report\n        WHERE category_code = 'IS_030' AND year = 2023 AND quarter = 0\n        \n        UNION ALL\n        \n        SELECT stock_code, data\n        FROM securities_financial_report\n        WHERE category_code = 'IS_400' AND year = 2023 AND quarter = 0\n    ) AS combined_reports\n    GROUP BY stock_code\n    HAVING SUM(data) > 1000000\n    ORDER BY net_income DESC\n    LIMIT 10\n)\n\nSELECT\n    tc.stock_code,\n    fr1.data AS net_profit_margin,\n    fr2.data AS current_ratio\nFROM\n    TopCompanies tc\nJOIN financial_ratio fr1 ON tc.stock_code = fr1.stock_code\n    AND fr1.ratio_code = 'NPM' AND fr1.year = 2023 AND fr1.quarter = 0\nJOIN financial_ratio fr2 ON tc.stock_code = fr2.stock_code\n    AND fr2.ratio_code = 'CurrentR' AND fr2.year = 2023 AND fr2.quarter = 0;\n"
            }
        ],
        "score": 1,
        "difficulty": 3,
        "response": "Table 1\n| stock_code   |\n|--------------|\n\nTable 2\n| stock_code   | net_profit_margin   | current_ratio   |\n|--------------|---------------------|-----------------|\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "WITH net_income_reports AS (\n  SELECT 'bank' AS report_type, stock_code, data AS net_income\n  FROM bank_financial_report\n  WHERE year = 2023 AND quarter = 0 AND category_code = 'IS_003'  -- Assuming IS_003 for Net Interest Income (closest to Net Income)\n  UNION ALL\n  SELECT 'non_bank' AS report_type, stock_code, data AS net_income\n  FROM non_bank_financial_report\n  WHERE year = 2023 AND quarter = 0 AND category_code = 'IS_021'  -- Financial income (closest to Net Income)\n  UNION ALL\n  SELECT 'securities' AS report_type, stock_code, data AS net_income\n  FROM securities_financial_report\n  WHERE year = 2023 AND quarter = 0 AND category_code = 'IS_400'  -- Total comprehensive income (closest to Net Income)\n),\ntop_10_companies AS (\n  SELECT stock_code, net_income\n  FROM net_income_reports\n  WHERE net_income > 1000000000000  -- 1,000,000,000,000 VND\n  ORDER BY net_income DESC\n  LIMIT 10\n),\nnet_profit_margin AS (\n  SELECT stock_code, year, quarter, data\n  FROM financial_ratio\n  WHERE ratio_code = 'NPM' AND year = 2023 AND quarter = 0\n),\ncurrent_ratio AS (\n  SELECT stock_code, year, quarter, data\n  FROM financial_ratio\n  WHERE ratio_code = 'CurrentR' AND year = 2023 AND quarter = 0\n)\nSELECT \n  tc.stock_code,\n  npm.data AS net_profit_margin,\n  cr.data AS current_ratio\nFROM top_10_companies tc\nINNER JOIN net_profit_margin npm ON tc.stock_code = npm.stock_code\nINNER JOIN current_ratio cr ON tc.stock_code = cr.stock_code\nLIMIT 10;\n"
            }
        ],
        "time": 86.10419082641602,
        "evaluate": 0,
        "input_token": 10141,
        "output_token": 4526
    },
    {
        "id": "a43c12a4-c2cc-4354-b458-0878a4f70bd0",
        "question": "Rank the top 5 companies with the highest Current Ratio as of December 31, 2023, among companies with total assets exceeding 100 billion VND.",
        "answer": "Table 1\n| stock_code   | industry           |   current_ratio |\n|:-------------|:-------------------|----------------:|\n| HLD          | Real Estate        |         7.25278 |\n| EIB          | Banking            |         6.12482 |\n| TCH          | Real Estate        |         6.00022 |\n| ABB          | Banking            |         5.488   |\n| SLS          | Food and Beverages |         4.98219 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "WITH TotalAssets AS (\n    SELECT stock_code\n    FROM bank_financial_report\n    WHERE category_code = 'BS_300' AND year = 2023 AND quarter = 0 AND data > 100000\n    UNION\n    SELECT stock_code\n    FROM non_bank_financial_report\n    WHERE category_code = 'BS_300' AND year = 2023 AND quarter = 0 AND data > 100000\n    UNION\n    SELECT stock_code\n    FROM securities_financial_report\n    WHERE category_code = 'BS_300' AND year = 2023 AND quarter = 0 AND data > 100000\n),\nCurrentRatios AS (\n    SELECT fr.stock_code, fr.data AS current_ratio\n    FROM financial_ratio fr\n    JOIN TotalAssets ta ON fr.stock_code = ta.stock_code\n    WHERE fr.ratio_code = 'CurrentR' AND fr.year = 2023 AND fr.quarter = 0\n)\nSELECT ci.stock_code, ci.industry, cr.current_ratio\nFROM CurrentRatios cr\nJOIN company_info ci ON cr.stock_code = ci.stock_code\nORDER BY cr.current_ratio DESC\nLIMIT 5;\n"
            }
        ],
        "score": 1,
        "difficulty": 3,
        "response": "Table 1\n| stock_code   |\n|--------------|\n\nTable 2\n| stock_code   | current_ratio   |\n|--------------|-----------------|\n\nTable 3\n| stock_code   | current_ratio   |\n|--------------|-----------------|\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "WITH eligible_companies AS (\n  SELECT DISTINCT \n    bfr.stock_code\n  FROM \n    bank_financial_report bfr\n  JOIN \n    map_category_code_bank mccb ON bfr.category_code = mccb.category_code\n  WHERE \n    bfr.year = 2023 AND bfr.quarter = 0 AND mccb.en_caption = 'Total assets' AND bfr.data > 100000000000\n\n  UNION ALL\n\n  SELECT DISTINCT \n    nbfr.stock_code\n  FROM \n    non_bank_financial_report nbfr\n  JOIN \n    map_category_code_non_bank mccnb ON nbfr.category_code = mccnb.category_code\n  WHERE \n    nbfr.year = 2023 AND nbfr.quarter = 0 AND mccnb.en_caption = 'TOTAL ASSETS' AND nbfr.data > 100000000000\n\n  UNION ALL\n\n  SELECT DISTINCT \n    sfr.stock_code\n  FROM \n    securities_financial_report sfr\n  JOIN \n    map_category_code_securities mccs ON sfr.category_code = mccs.category_code\n  WHERE \n    sfr.year = 2023 AND sfr.quarter = 0 AND mccs.en_caption = 'TOTAL ASSETS' AND sfr.data > 100000000000\n),\n\nranked_companies AS (\n  SELECT \n    ec.stock_code,\n    fr.data AS current_ratio,\n    ROW_NUMBER() OVER (ORDER BY fr.data DESC) as row_num\n  FROM \n    eligible_companies ec\n  JOIN \n    financial_ratio fr ON ec.stock_code = fr.stock_code\n  JOIN \n    map_category_code_ratio mccr ON fr.ratio_code = mccr.ratio_code\n  WHERE \n    fr.year = 2023 AND fr.quarter = 0 AND mccr.ratio_name = 'Current Ratio'\n)\n\nSELECT \n  stock_code,\n  current_ratio\nFROM \n  ranked_companies\nWHERE row_num <= 5;\n"
            }
        ],
        "time": 95.66399836540222,
        "evaluate": 0,
        "input_token": 3267,
        "output_token": 625
    },
    {
        "id": "6ebec9aa-2d66-4d22-a45a-a7e6114dad2b",
        "question": "What is the trend of the Return on Equity (ROE) for Vietcombank, Techcombank, and ACB from 2020 to Q2 2024?",
        "answer": "Table 1\n| stock_code   |   year |   quarter |       roe |\n|:-------------|-------:|----------:|----------:|\n| ACB          |   2020 |         0 | 0.216734  |\n| ACB          |   2021 |         0 | 0.213865  |\n| ACB          |   2022 |         0 | 0.234232  |\n| ACB          |   2023 |         0 | 0.226122  |\n| ACB          |   2024 |         1 | 0.052218  |\n| TCB          |   2020 |         0 | 0.168632  |\n| TCB          |   2021 |         0 | 0.197927  |\n| TCB          |   2022 |         0 | 0.180176  |\n| TCB          |   2023 |         0 | 0.139608  |\n| TCB          |   2024 |         1 | 0.0459854 |\n| TCB          |   2024 |         2 | 0.0457096 |\n| VCB          |   2020 |         0 | 0.196318  |\n| VCB          |   2021 |         0 | 0.201059  |\n| VCB          |   2022 |         0 | 0.220567  |\n| VCB          |   2023 |         0 | 0.200315  |\n| VCB          |   2024 |         1 | 0.0494831 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    stock_code, \n    year, \n    quarter, \n    data AS roe\nFROM \n    financial_ratio\nWHERE \n    ratio_code = 'ROE'\n    AND stock_code IN ('VCB', 'TCB', 'ACB')\n    AND (\n        (year BETWEEN 2020 AND 2023 AND quarter = 0) \n        OR (year = 2024 AND quarter BETWEEN 1 AND 2)\n    )\nORDER BY \n    stock_code, \n    year, \n    quarter;\n"
            }
        ],
        "score": 1,
        "difficulty": 2,
        "response": "Table 1\n| stock_code   |   year |   quarter |   roe_value |\n|:-------------|-------:|----------:|------------:|\n| ACB          |   2020 |         2 |   0.0493524 |\n| ACB          |   2021 |         2 |   0.0640966 |\n| ACB          |   2022 |         2 |   0.0757336 |\n| ACB          |   2023 |         2 | nan         |\n| TCB          |   2020 |         2 |   0.0428449 |\n| TCB          |   2021 |         2 |   0.0572896 |\n| TCB          |   2022 |         2 |   0.0562806 |\n| TCB          |   2023 |         2 |   0.0367734 |\n| TCB          |   2024 |         2 |   0.0457096 |\n| VCB          |   2020 |         2 |   0.0515214 |\n| VCB          |   2021 |         2 |   0.0377385 |\n| VCB          |   2022 |         2 |   0.0483124 |\n| VCB          |   2023 |         2 |   0.139806  |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT \n  fr.stock_code,\n  fr.year,\n  fr.quarter,\n  fr.data AS ROE_Value\nFROM \n  financial_ratio fr\n  INNER JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\n  INNER JOIN company_info ci ON fr.stock_code = ci.stock_code\nWHERE \n  mcr.ratio_name = 'Return On Equity'\n  AND fr.stock_code IN ('VCB', 'TCB', 'ACB')\n  AND (fr.year, fr.quarter) IN ((2020, 2), (2021, 2), (2022, 2), (2023, 2), (2024, 2))\nORDER BY \n  fr.stock_code, fr.year, fr.quarter\nLIMIT 100;  -- Add limit as per database schema requirement\n"
            }
        ],
        "time": 34.88434338569641,
        "evaluate": 0,
        "input_token": 14093,
        "output_token": 3574
    },
    {
        "id": "5f48b85d-d6f3-4010-a6f8-22f11cfaa754",
        "question": "What is the breakdown of equity investments (including both subsidiaries and other investments) for Mobile World Investment and its return on equity (ROE) for the fiscal year 2023?",
        "answer": "Table 1\n| category_code   | en_caption                                  |   data |\n|:----------------|:--------------------------------------------|-------:|\n| BS_213          | Business capital at subsidiaries            |      0 |\n| BS_251          | Investment in subsidiaries                  |      0 |\n| BS_252          | Investment in associates and joint ventures | 286632 |\n| BS_253          | Investment in other entities                |      0 |\n\nTable 2\n|       roe |\n|----------:|\n| 0.0071846 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "-- Query to get the breakdown of equity investments for MWG in 2023\nSELECT \n    nbfr.category_code,\n    mccnb.en_caption,\n    nbfr.data\nFROM \n    non_bank_financial_report nbfr\nJOIN \n    map_category_code_non_bank mccnb ON nbfr.category_code = mccnb.category_code\nWHERE \n    nbfr.stock_code = 'MWG'\n    AND nbfr.year = 2023\n    AND nbfr.quarter = 0\n    AND nbfr.category_code IN ('BS_213', 'BS_251', 'BS_252', 'BS_253');\n\n-- Query to get the ROE for MWG in 2023\nSELECT \n    fr.data AS roe\nFROM \n    financial_ratio fr\nJOIN \n    map_category_code_ratio mccr ON fr.ratio_code = mccr.ratio_code\nWHERE \n    fr.stock_code = 'MWG'\n    AND fr.year = 2023\n    AND fr.quarter = 0\n    AND mccr.ratio_name = 'Return On Equity';\n"
            }
        ],
        "score": 1,
        "difficulty": 3,
        "response": "Table 1\n| invest_on   |\n|-------------|\n\nTable 2\n| stock_code   |   equity_investment |       roe |\n|:-------------|--------------------:|----------:|\n| MWG          |         5.19503e+07 | 0.0071846 |\n| MWG          |         5.3657e+06  | 0.0071846 |\n| MWG          |         4.79564e+06 | 0.0071846 |\n| MWG          |    570068           | 0.0071846 |\n| MWG          |         1.8937e+07  | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n| MWG          |         1.8937e+07  | 0.0071846 |\n| MWG          |         5.15885e+06 | 0.0071846 |\n| MWG          |    308474           | 0.0071846 |\n| MWG          |     95981           | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n| MWG          |         2.08592e+06 | 0.0071846 |\n| MWG          |         2.66848e+06 | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n| MWG          |         2.18242e+07 | 0.0071846 |\n| MWG          |         2.20287e+07 | 0.0071846 |\n| MWG          |   -204448           | 0.0071846 |\n| MWG          |    664536           | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n| MWG          |     13401           | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n| MWG          |         6.01112e+07 | 0.0071846 |\n| MWG          |    481240           | 0.0071846 |\n| MWG          |    159821           | 0.0071846 |\n| MWG          |     23473           | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n| MWG          |         8.1609e+06  | 0.0071846 |\n| MWG          |    457569           | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n| MWG          |      9244           | 0.0071846 |\n| MWG          |    448325           | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n| MWG          |         6.50014e+06 | 0.0071846 |\n| MWG          |         6.43132e+06 | 0.0071846 |\n| MWG          |         2.01393e+07 | 0.0071846 |\n| MWG          |        -1.3708e+07  | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n| MWG          |     68820           | 0.0071846 |\n| MWG          |     90297           | 0.0071846 |\n| MWG          |    -21477           | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n| MWG          |      4493           | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n| MWG          |      4493           | 0.0071846 |\n| MWG          |    746632           | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n| MWG          |    286632           | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n| MWG          |    460000           | 0.0071846 |\n| MWG          |    452067           | 0.0071846 |\n| MWG          |    105411           | 0.0071846 |\n| MWG          |    101088           | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n| MWG          |    245567           | 0.0071846 |\n| MWG          |         6.01112e+07 | 0.0071846 |\n| MWG          |         3.67517e+07 | 0.0071846 |\n| MWG          |         3.07653e+07 | 0.0071846 |\n| MWG          |         7.92707e+06 | 0.0071846 |\n| MWG          |     88995           | 0.0071846 |\n| MWG          |    421532           | 0.0071846 |\n| MWG          |    438404           | 0.0071846 |\n| MWG          |         1.37281e+06 | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n| MWG          |      3405           | 0.0071846 |\n| MWG          |         1.31657e+06 | 0.0071846 |\n| MWG          |         1.91285e+07 | 0.0071846 |\n| MWG          |     67935           | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n| MWG          |         5.98642e+06 | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n| MWG          |         5.98525e+06 | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n| MWG          |      1168           | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n| MWG          |         0           | 0.0071846 |\n\nTable 3\n| stock_code   |   equity_investment | category_code   |       roe |\n|:-------------|--------------------:|:----------------|----------:|\n| MWG          |         1.19234e+08 | IS_001          | 0.0071846 |\n| MWG          |    954396           | IS_002          | 0.0071846 |\n| MWG          |         1.1828e+08  | IS_010          | 0.0071846 |\n| MWG          |         9.57592e+07 | IS_011          | 0.0071846 |\n| MWG          |         2.25206e+07 | IS_020          | 0.0071846 |\n| MWG          |         2.16696e+06 | IS_021          | 0.0071846 |\n| MWG          |         1.55615e+06 | IS_022          | 0.0071846 |\n| MWG          |         1.44772e+06 | IS_023          | 0.0071846 |\n| MWG          |         0           | IS_024          | 0.0071846 |\n| MWG          |         2.09167e+07 | IS_025          | 0.0071846 |\n| MWG          |         1.16765e+06 | IS_026          | 0.0071846 |\n| MWG          |         1.04707e+06 | IS_030          | 0.0071846 |\n| MWG          |     36883           | IS_031          | 0.0071846 |\n| MWG          |    394259           | IS_032          | 0.0071846 |\n| MWG          |   -357375           | IS_040          | 0.0071846 |\n| MWG          |    689692           | IS_050          | 0.0071846 |\n| MWG          |    433257           | IS_051          | 0.0071846 |\n| MWG          |     88606           | IS_052          | 0.0071846 |\n| MWG          |    167829           | IS_060          | 0.0071846 |\n| MWG          |    167669           | IS_061          | 0.0071846 |\n| MWG          |       159           | IS_062          | 0.0071846 |\n| MWG          |       115           | IS_070          | 0.0071846 |\n| MWG          |       115           | IS_071          | 0.0071846 |\n| MWG          |         5.19503e+07 | BS_100          | 0.0071846 |\n| MWG          |         5.3657e+06  | BS_110          | 0.0071846 |\n| MWG          |         4.79564e+06 | BS_111          | 0.0071846 |\n| MWG          |    570068           | BS_112          | 0.0071846 |\n| MWG          |         1.8937e+07  | BS_120          | 0.0071846 |\n| MWG          |         0           | BS_121          | 0.0071846 |\n| MWG          |         0           | BS_122          | 0.0071846 |\n| MWG          |         1.8937e+07  | BS_123          | 0.0071846 |\n| MWG          |         5.15885e+06 | BS_130          | 0.0071846 |\n| MWG          |    308474           | BS_131          | 0.0071846 |\n| MWG          |     95981           | BS_132          | 0.0071846 |\n| MWG          |         0           | BS_133          | 0.0071846 |\n| MWG          |         0           | BS_134          | 0.0071846 |\n| MWG          |         2.08592e+06 | BS_135          | 0.0071846 |\n| MWG          |         2.66848e+06 | BS_136    ",
        "code_response": [
            {
                "language": "sql",
                "code": "WITH company_type AS (\n  SELECT \n    stock_code, \n    CASE \n      WHEN is_securities THEN 'securities_financial_report'\n      ELSE 'non_bank_financial_report'\n    END AS report_table\n  FROM company_info\n  WHERE stock_code IN ('MWG', (SELECT invest_on FROM sub_and_shareholder WHERE stock_code = 'MWG'))\n),\nequity_investments AS (\n  SELECT \n    c.stock_code, \n    r.data AS equity_investment,\n    r.category_code\n  FROM company_type c\n  JOIN (\n    SELECT * FROM non_bank_financial_report\n    UNION ALL\n    SELECT * FROM securities_financial_report\n  ) r ON c.stock_code = r.stock_code\n  WHERE r.year = 2023 AND r.quarter = 0 \n  -- Assuming BS_ prefix for Balance Sheet (Equity) and filtering specific category_code if needed\n  -- AND r.category_code LIKE 'BS_%'\n),\nroe_values AS (\n  SELECT \n    f.stock_code, \n    fr.data AS roe\n  FROM company_type f\n  JOIN financial_ratio fr ON f.stock_code = fr.stock_code\n  JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\n  WHERE mcr.ratio_name = 'Return On Equity' AND fr.year = 2023 AND fr.quarter = 0\n)\nSELECT \n  ei.stock_code, \n  ei.equity_investment,\n  ei.category_code,\n  rv.roe\nFROM equity_investments ei\nLEFT JOIN roe_values rv ON ei.stock_code = rv.stock_code\nLIMIT 100;\n"
            }
        ],
        "time": 85.42218375205994,
        "evaluate": 0,
        "input_token": 5477,
        "output_token": 694
    },
    {
        "id": "0529969a-2008-4b24-bc19-022d11d2ecc6",
        "question": "What were the values of Total Assets, Total Liabilities, and Net Income for Vinamilk, Masan Group, and PetroVietnam Gas for the fiscal year 2023?",
        "answer": "Table 1\n| stock_code   | en_caption                           |        data |\n|:-------------|:-------------------------------------|------------:|\n| VNM          | Net profit from operating activities | 1.09036e+07 |\n| MSN          | Net profit from operating activities | 2.35043e+06 |\n| GAS          | Net profit from operating activities | 1.46191e+07 |\n| GAS          | TOTAL ASSETS                         | 8.77545e+07 |\n| GAS          | C. LIABILITIES                       | 2.24558e+07 |\n| VNM          | TOTAL ASSETS                         | 5.26734e+07 |\n| VNM          | C. LIABILITIES                       | 1.76476e+07 |\n| MSN          | TOTAL ASSETS                         | 1.47383e+08 |\n| MSN          | C. LIABILITIES                       | 1.09146e+08 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    nfr.stock_code,\n    mcc.en_caption,\n    nfr.data\nFROM \n    non_bank_financial_report nfr\nJOIN \n    map_category_code_non_bank mcc ON nfr.category_code = mcc.category_code\nWHERE \n    nfr.stock_code IN ('VNM', 'MSN', 'GAS') \n    AND nfr.year = 2023 \n    AND nfr.quarter = 0 \n    AND nfr.category_code IN ('BS_270', 'BS_300', 'IS_030');\n"
            }
        ],
        "score": 1,
        "difficulty": 2,
        "response": "Table 1\n| stock_code   | company_name     |   total_assets |   total_liabilities |   net_income |\n|:-------------|:-----------------|---------------:|--------------------:|-------------:|\n| VNM          | Vinamilk         |    3.59359e+07 |         1.67375e+07 |  1.09679e+07 |\n| MSN          | Masan Group      |    4.37635e+07 |         1.0362e+08  |  2.56297e+06 |\n| GAS          | PetroVietnam Gas |    6.22178e+07 |         2.55367e+07 |  1.46395e+07 |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT \n  'VNM' AS stock_code, \n  'Vinamilk' AS company_name,\n  (SELECT data FROM non_bank_financial_report WHERE stock_code = 'VNM' AND year = 2023 AND quarter = 0 AND category_code = 'BS_100') AS Total_Assets,\n  (SELECT data FROM non_bank_financial_report WHERE stock_code = 'VNM' AND year = 2023 AND quarter = 0 AND category_code = 'BS_200') AS Total_Liabilities,\n  (SELECT data FROM non_bank_financial_report WHERE stock_code = 'VNM' AND year = 2023 AND quarter = 0 AND category_code = 'IS_050') AS Net_Income\n\nUNION ALL\n\nSELECT \n  'MSN' AS stock_code, \n  'Masan Group' AS company_name,\n  (SELECT data FROM non_bank_financial_report WHERE stock_code = 'MSN' AND year = 2023 AND quarter = 0 AND category_code = 'BS_100') AS Total_Assets,\n  (SELECT data FROM non_bank_financial_report WHERE stock_code = 'MSN' AND year = 2023 AND quarter = 0 AND category_code = 'BS_200') AS Total_Liabilities,\n  (SELECT data FROM non_bank_financial_report WHERE stock_code = 'MSN' AND year = 2023 AND quarter = 0 AND category_code = 'IS_050') AS Net_Income\n\nUNION ALL\n\nSELECT \n  'GAS' AS stock_code, \n  'PetroVietnam Gas' AS company_name,\n  (SELECT data FROM non_bank_financial_report WHERE stock_code = 'GAS' AND year = 2023 AND quarter = 0 AND category_code = 'BS_100') AS Total_Assets,\n  (SELECT data FROM non_bank_financial_report WHERE stock_code = 'GAS' AND year = 2023 AND quarter = 0 AND category_code = 'BS_200') AS Total_Liabilities,\n  (SELECT data FROM non_bank_financial_report WHERE stock_code = 'GAS' AND year = 2023 AND quarter = 0 AND category_code = 'IS_050') AS Net_Income\n\nLIMIT 3;\n"
            }
        ],
        "time": 51.080275535583496,
        "evaluate": 0,
        "input_token": 2857,
        "output_token": 1069
    },
    {
        "id": "c831d896-2da0-445e-8184-0699fc43e0db",
        "question": "What is the trend of Net Profit Margin for Vietcombank, Techcombank, and ACB from 2020 to Q2 2024?",
        "answer": "Table 1\n| stock_code   | year   | quarter   | net_profit_margin   |\n|--------------|--------|-----------|---------------------|\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    stock_code, \n    year, \n    quarter, \n    data AS net_profit_margin\nFROM \n    financial_ratio\nWHERE \n    ratio_code = 'NPM' \n    AND stock_code IN ('VCB', 'TCB', 'ACB')\n    AND (\n        (year BETWEEN 2020 AND 2023 AND quarter = 0) -- Annual reports from 2020 to 2023\n        OR \n        (year = 2024 AND quarter IN (1, 2)) -- Quarterly reports for Q1 and Q2 of 2024\n    )\nORDER BY \n    stock_code, \n    year, \n    quarter;\n"
            }
        ],
        "score": 1,
        "difficulty": 2,
        "response": "Table 1\n| stock_code   | en_company_name   | year   | quarter   | net_profit_margin   |\n|--------------|-------------------|--------|-----------|---------------------|\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT \n  fr.stock_code,\n  ci.company_name AS en_company_name,\n  fr.year,\n  fr.quarter,\n  fr.data AS Net_Profit_Margin\nFROM \n  financial_ratio fr\n  INNER JOIN company_info ci ON fr.stock_code = ci.stock_code\n  INNER JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\nWHERE \n  fr.stock_code IN ('VCB', 'TCB', 'ACB')\n  AND mcr.ratio_name = 'Net profit margin'\n  AND fr.year IN (2020, 2021, 2022, 2023, 2024)\n  AND fr.quarter = 2  -- Q2\nORDER BY \n  fr.stock_code, \n  fr.year\nLIMIT 15;  -- Assuming 3 companies * 5 years = 15 rows\n"
            }
        ],
        "time": 77.31432700157166,
        "evaluate": 0,
        "input_token": 5362,
        "output_token": 2145
    },
    {
        "id": "a6c11447-d4dd-4ae8-99b8-57138309a422",
        "question": "Show the Return on Equity (ROE) for Vinamilk, Masan Group, and Hoa Phat Group from 2020 to Q2 2024.  Calculate the average ROE for each company over this period.",
        "answer": "Table 1\n| stock_code   |   average_roe |\n|:-------------|--------------:|\n| HPG          |     0.136672  |\n| MSN          |     0.0970669 |\n| VNM          |     0.242186  |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    stock_code,\n    AVG(data) AS average_roe\nFROM \n    financial_ratio\nWHERE \n    ratio_code = 'ROE' AND\n    stock_code IN ('VNM', 'MSN', 'HPG') AND\n    ((year BETWEEN 2020 AND 2023 AND quarter = 0) OR\n    (year = 2024 AND quarter IN (1, 2)))\nGROUP BY \n    stock_code;\n"
            }
        ],
        "score": 1,
        "difficulty": 2,
        "response": "Table 1\n| company_name   |   average_roe |\n|:---------------|--------------:|\n| Hoa Phat Group |      0.158574 |\n| Masan Group    |      0.118251 |\n| Vinamilk       |      0.287349 |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "WITH \n  -- Define the stock codes and years/quarters of interest\n  target_companies AS (\n    SELECT 'VNM' AS stock_code, 'Vinamilk' AS company_name UNION ALL\n    SELECT 'MSN', 'Masan Group' UNION ALL\n    SELECT 'HPG', 'Hoa Phat Group'\n  ),\n  \n  -- Define the years and quarters for the desired period\n  target_periods AS (\n    SELECT 2020 AS year, 0 AS quarter UNION ALL\n    SELECT 2021, 0 UNION ALL\n    SELECT 2022, 0 UNION ALL\n    SELECT 2023, 0 UNION ALL\n    SELECT 2024, 0 UNION ALL\n    SELECT 2024, 2  -- Q2 2024\n  )\n\n-- Extract ROE values and calculate average ROE for each company\nSELECT \n  tc.company_name,\n  AVG(fr.data) AS average_roe\nFROM \n  target_companies tc\n  JOIN financial_ratio fr ON tc.stock_code = fr.stock_code\n  JOIN target_periods tp ON fr.year = tp.year AND fr.quarter = tp.quarter\n  JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\nWHERE \n  mcr.ratio_name = 'Return On Equity'\nGROUP BY \n  tc.company_name\nLIMIT 100;  -- Add limit as per database schema requirement\n"
            }
        ],
        "time": 76.2098298072815,
        "evaluate": 0,
        "input_token": 2910,
        "output_token": 807
    },
    {
        "id": "5c4964d0-adc2-4847-9751-de6fad125d24",
        "question": "Calculate the Gross Profit Margin for Vinamilk, Masan Group, and SABECO from 2020 to Q2 2024.  Further, compute the year-on-year growth rate of the Gross Profit Margin for each company during this period.",
        "answer": "Table 1\n| stock_code   |   year |   avg_gpm |   yoy_growth_rate |\n|:-------------|-------:|----------:|------------------:|\n| MSN          |   2020 |  0.231665 |         nan       |\n| MSN          |   2021 |  0.249747 |           7.80519 |\n| MSN          |   2022 |  0.276089 |          10.5474  |\n| MSN          |   2023 |  0.282692 |           2.39156 |\n| SAB          |   2020 |  0.30403  |         nan       |\n| SAB          |   2021 |  0.28849  |          -5.11146 |\n| SAB          |   2022 |  0.307918 |           6.73451 |\n| SAB          |   2023 |  0.298455 |          -3.07321 |\n| VNM          |   2020 |  0.463956 |         nan       |\n| VNM          |   2021 |  0.431363 |          -7.02496 |\n| VNM          |   2022 |  0.398578 |          -7.60046 |\n| VNM          |   2023 |  0.406579 |           2.00742 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "WITH GPM_data AS (\n    SELECT \n        fr.stock_code,\n        fr.year,\n        fr.quarter,\n        fr.data AS gpm\n    FROM \n        financial_ratio fr\n    JOIN \n        map_category_code_ratio mccr ON fr.ratio_code = mccr.ratio_code\n    WHERE \n        mccr.ratio_name = 'Gross Profit Margin' AND\n        fr.stock_code IN ('VNM', 'MSN', 'SAB') AND\n        ((fr.year BETWEEN 2020 AND 2024) AND (fr.quarter = 0 OR (fr.year = 2024 AND fr.quarter <= 2)))\n),\nYearly_GPM AS (\n    SELECT \n        stock_code,\n        year,\n        AVG(gpm) AS avg_gpm\n    FROM \n        GPM_data\n    WHERE \n        quarter = 0\n    GROUP BY \n        stock_code, year\n),\nGrowth_Rate AS (\n    SELECT \n        a.stock_code,\n        a.year,\n        a.avg_gpm,\n        ((a.avg_gpm - b.avg_gpm) / NULLIF(b.avg_gpm, 0)) * 100 AS yoy_growth_rate\n    FROM \n        Yearly_GPM a\n    LEFT JOIN \n        Yearly_GPM b ON a.stock_code = b.stock_code AND a.year = b.year + 1\n)\nSELECT \n    stock_code,\n    year,\n    avg_gpm,\n    yoy_growth_rate\nFROM \n    Growth_Rate\nORDER BY \n    stock_code, year;\n"
            }
        ],
        "score": 1,
        "difficulty": 3,
        "response": "Table 1\n| stock_code   | year   | quarter   | revenue   | cost_of_goods_sold   |\n|--------------|--------|-----------|-----------|----------------------|\n\nTable 2\n| stock_code   |   year |   quarter |      gpm |   yoy_growth_rate |\n|:-------------|-------:|----------:|---------:|------------------:|\n| MSN          |   2020 |         0 | 0.231665 |       nan         |\n| MSN          |   2021 |         0 | 0.249747 |         0.0780519 |\n| MSN          |   2022 |         0 | 0.276089 |         0.105474  |\n| MSN          |   2023 |         0 | 0.282692 |         0.0239156 |\n| SAB          |   2020 |         0 | 0.30403  |       nan         |\n| SAB          |   2021 |         0 | 0.28849  |        -0.0511146 |\n| SAB          |   2022 |         0 | 0.307918 |         0.0673451 |\n| SAB          |   2023 |         0 | 0.298455 |        -0.0307321 |\n| SAB          |   2024 |         2 | 0.3018   |         0.0112066 |\n| VNM          |   2020 |         0 | 0.463956 |       nan         |\n| VNM          |   2021 |         0 | 0.431363 |        -0.0702496 |\n| VNM          |   2022 |         0 | 0.398578 |        -0.0760046 |\n| VNM          |   2023 |         0 | 0.406579 |         0.0200742 |\n\nTable 3\n| stock_code   | year   | quarter   | revenue   | cost_of_goods_sold   | gpm   | yoy_growth_rate   |\n|--------------|--------|-----------|-----------|----------------------|-------|-------------------|\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "WITH target_companies AS (\n  SELECT stock_code\n  FROM company_info\n  WHERE stock_code IN ('VNM', 'MSN', 'SAB')\n),\nrevenue_data AS (\n  SELECT \n    nfr.stock_code,\n    nfr.year,\n    nfr.quarter,\n    nfr.data AS revenue\n  FROM \n    non_bank_financial_report nfr\n  INNER JOIN \n    map_category_code_non_bank mcnb ON nfr.category_code = mcnb.category_code\n  INNER JOIN \n    target_companies tc ON nfr.stock_code = tc.stock_code\n  WHERE \n    mcnb.en_caption = 'Revenue' \n    AND ((nfr.year BETWEEN 2020 AND 2023 AND nfr.quarter = 0) \n    OR (nfr.year = 2024 AND nfr.quarter = 2))\n),\ncost_of_goods_sold_data AS (\n  SELECT \n    nfr.stock_code,\n    nfr.year,\n    nfr.quarter,\n    nfr.data AS cost_of_goods_sold\n  FROM \n    non_bank_financial_report nfr\n  INNER JOIN \n    map_category_code_non_bank mcnb ON nfr.category_code = mcnb.category_code\n  INNER JOIN \n    target_companies tc ON nfr.stock_code = tc.stock_code\n  WHERE \n    mcnb.en_caption = 'Cost of Goods Sold' \n    AND ((nfr.year BETWEEN 2020 AND 2023 AND nfr.quarter = 0) \n    OR (nfr.year = 2024 AND nfr.quarter = 2))\n)\nSELECT \n  rd.stock_code,\n  rd.year,\n  rd.quarter,\n  rd.revenue,\n  cgss.cost_of_goods_sold\nFROM \n  revenue_data rd\nINNER JOIN \n  cost_of_goods_sold_data cgss ON rd.stock_code = cgss.stock_code AND rd.year = cgss.year AND rd.quarter = cgss.quarter\nORDER BY \n  rd.stock_code, rd.year, rd.quarter\nLIMIT 100;\n"
            },
            {
                "language": "sql",
                "code": "WITH target_companies AS (\n  SELECT stock_code\n  FROM company_info\n  WHERE stock_code IN ('VNM', 'MSN', 'SAB')\n),\ngpm_data AS (\n  SELECT \n    fr.stock_code,\n    fr.year,\n    fr.quarter,\n    fr.data AS gpm\n  FROM \n    financial_ratio fr\n  INNER JOIN \n    map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\n  INNER JOIN \n    target_companies tc ON fr.stock_code = tc.stock_code\n  WHERE \n    mcr.ratio_name = 'Gross Profit Margin' \n    AND ((fr.year BETWEEN 2020 AND 2023 AND fr.quarter = 0) \n    OR (fr.year = 2024 AND fr.quarter = 2))\n)\nSELECT \n  gd.stock_code,\n  gd.year,\n  gd.quarter,\n  gd.gpm,\n  CASE \n    WHEN LAG(gd.gpm) OVER (PARTITION BY gd.stock_code ORDER BY gd.year, gd.quarter) IS NULL THEN NULL\n    ELSE (gd.gpm - LAG(gd.gpm) OVER (PARTITION BY gd.stock_code ORDER BY gd.year, gd.quarter)) / LAG(gd.gpm) OVER (PARTITION BY gd.stock_code ORDER BY gd.year, gd.quarter)\n  END AS yoy_growth_rate\nFROM \n  gpm_data gd\nORDER BY \n  gd.stock_code, gd.year, gd.quarter\nLIMIT 100;\n"
            },
            {
                "language": "sql",
                "code": "WITH target_companies AS (\n  SELECT stock_code\n  FROM company_info\n  WHERE stock_code IN ('VNM', 'MSN', 'SAB')\n),\nrevenue_data AS (\n  SELECT \n    nfr.stock_code,\n    nfr.year,\n    nfr.quarter,\n    nfr.data AS revenue\n  FROM \n    non_bank_financial_report nfr\n  INNER JOIN \n    map_category_code_non_bank mcnb ON nfr.category_code = mcnb.category_code\n  INNER JOIN \n    target_companies tc ON nfr.stock_code = tc.stock_code\n  WHERE \n    mcnb.en_caption = 'Revenue' \n    AND ((nfr.year BETWEEN 2020 AND 2023 AND nfr.quarter = 0) \n    OR (nfr.year = 2024 AND nfr.quarter = 2))\n),\ncost_of_goods_sold_data AS (\n  SELECT \n    nfr.stock_code,\n    nfr.year,\n    nfr.quarter,\n    nfr.data AS cost_of_goods_sold\n  FROM \n    non_bank_financial_report nfr\n  INNER JOIN \n    map_category_code_non_bank mcnb ON nfr.category_code = mcnb.category_code\n  INNER JOIN \n    target_companies tc ON nfr.stock_code = tc.stock_code\n  WHERE \n    mcnb.en_caption = 'Cost of Goods Sold' \n    AND ((nfr.year BETWEEN 2020 AND 2023 AND nfr.quarter = 0) \n    OR (nfr.year = 2024 AND nfr.quarter = 2))\n),\ngpm_data AS (\n  SELECT \n    fr.stock_code,\n    fr.year,\n    fr.quarter,\n    fr.data AS gpm\n  FROM \n    financial_ratio fr\n  INNER JOIN \n    map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\n  INNER JOIN \n    target_companies tc ON fr.stock_code = tc.stock_code\n  WHERE \n    mcr.ratio_name = 'Gross Profit Margin' \n    AND ((fr.year BETWEEN 2020 AND 2023 AND fr.quarter = 0) \n    OR (fr.year = 2024 AND fr.quarter = 2))\n)\nSELECT \n  gd.stock_code,\n  gd.year,\n  gd.quarter,\n  rd.revenue,\n  cgss.cost_of_goods_sold,\n  gd.gpm,\n  CASE \n    WHEN LAG(gd.gpm) OVER (PARTITION BY gd.stock_code ORDER BY gd.year, gd.quarter) IS NULL THEN NULL\n    ELSE (gd.gpm - LAG(gd.gpm) OVER (PARTITION BY gd.stock_code ORDER BY gd.year, gd.quarter)) / LAG(gd.gpm) OVER (PARTITION BY gd.stock_code ORDER BY gd.year, gd.quarter)\n  END AS yoy_growth_rate\nFROM \n  gpm_data gd\nINNER JOIN \n  revenue_data rd ON gd.stock_code = rd.stock_code AND gd.year = rd.year AND gd.quarter = rd.quarter\nINNER JOIN \n  cost_of_goods_sold_data cgss ON gd.stock_code = cgss.stock_code AND gd.year = cgss.year AND gd.quarter = cgss.quarter\nORDER BY \n  gd.stock_code, gd.year, gd.quarter\nLIMIT 100;\n"
            }
        ],
        "time": 236.47649788856506,
        "evaluate": 0.5,
        "input_token": 10054,
        "output_token": 2192
    },
    {
        "id": "14f189a3-a158-450b-9b00-6970b80da60a",
        "question": "Rank the top 5 companies with the highest Return on Equity (ROE) among Vietcombank, Techcombank, ACB, BIDV, and VPBank for the period from 2020 to Q2 2024.",
        "answer": "Table 1\n| stock_code   |   year |   quarter |      roe |\n|:-------------|-------:|----------:|---------:|\n| ACB          |   2022 |         0 | 0.234232 |\n| ACB          |   2023 |         0 | 0.226122 |\n| VCB          |   2022 |         0 | 0.220567 |\n| ACB          |   2020 |         0 | 0.216734 |\n| ACB          |   2021 |         0 | 0.213865 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT stock_code, year, quarter, data AS roe\nFROM financial_ratio\nWHERE ratio_code = 'ROE'\n  AND stock_code IN ('VCB', 'TCB', 'ACB', 'BID', 'VPB')\n  AND (\n    (year = 2024 AND quarter <= 2) OR\n    (year BETWEEN 2020 AND 2023 AND quarter = 0)\n  )\nORDER BY roe DESC\nLIMIT 5;\n"
            }
        ],
        "score": 1,
        "difficulty": 2,
        "response": "Table 1\n| stock_code   |   year |   quarter |   roe_value |   roe_rank |\n|:-------------|-------:|----------:|------------:|-----------:|\n| ACB          |   2022 |         0 |    0.234232 |          1 |\n| ACB          |   2023 |         0 |    0.226122 |          2 |\n| VCB          |   2022 |         0 |    0.220567 |          3 |\n| ACB          |   2020 |         0 |    0.216734 |          4 |\n| ACB          |   2021 |         0 |    0.213865 |          5 |\n\nTable 2\n| stock_code   | industry   | is_bank   |\n|:-------------|:-----------|:----------|\n| VCB          | Banking    | True      |\n| ACB          | Banking    | True      |\n| VPB          | Banking    | True      |\n| TCB          | Banking    | True      |\n| BID          | Banking    | True      |\n\nTable 3\n| stock_code   |   year |   quarter |   roe_value |   roe_rank |\n|:-------------|-------:|----------:|------------:|-----------:|\n| ACB          |   2022 |         0 |    0.234232 |          1 |\n| ACB          |   2023 |         0 |    0.226122 |          2 |\n| VCB          |   2022 |         0 |    0.220567 |          3 |\n| ACB          |   2020 |         0 |    0.216734 |          4 |\n| ACB          |   2021 |         0 |    0.213865 |          5 |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT stock_code, industry, is_bank\nFROM company_info\nWHERE stock_code IN ('VCB', 'TCB', 'ACB', 'BID', 'VPB');\n"
            },
            {
                "language": "sql",
                "code": "WITH ROE_Values AS (\n  SELECT \n    fr.stock_code,\n    fr.year,\n    fr.quarter,\n    fr.data AS ROE_Value\n  FROM \n    financial_ratio fr\n  INNER JOIN \n    map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\n  WHERE \n    mcr.ratio_name = 'Return On Equity'\n    AND fr.stock_code IN ('VCB', 'TCB', 'ACB', 'BID', 'VPB')\n    AND ((fr.year BETWEEN 2020 AND 2023 AND fr.quarter = 0) OR (fr.year = 2024 AND fr.quarter = 2))\n)\nSELECT \n  stock_code,\n  year,\n  quarter,\n  ROE_Value,\n  RANK() OVER (ORDER BY ROE_Value DESC) AS ROE_Rank\nFROM \n  ROE_Values\nORDER BY \n  ROE_Rank\nLIMIT 5;\n"
            },
            {
                "language": "sql",
                "code": "-- Step 1 (Verification)\nSELECT stock_code, industry, is_bank\nFROM company_info\nWHERE stock_code IN ('VCB', 'TCB', 'ACB', 'BID', 'VPB');\n\n-- Step 2 (Main Query)\nWITH ROE_Values AS (\n  SELECT \n    fr.stock_code,\n    fr.year,\n    fr.quarter,\n    fr.data AS ROE_Value\n  FROM \n    financial_ratio fr\n  INNER JOIN \n    map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\n  WHERE \n    mcr.ratio_name = 'Return On Equity'\n    AND fr.stock_code IN ('VCB', 'TCB', 'ACB', 'BID', 'VPB')\n    AND ((fr.year BETWEEN 2020 AND 2023 AND fr.quarter = 0) OR (fr.year = 2024 AND fr.quarter = 2))\n)\nSELECT \n  stock_code,\n  year,\n  quarter,\n  ROE_Value,\n  RANK() OVER (ORDER BY ROE_Value DESC) AS ROE_Rank\nFROM \n  ROE_Values\nORDER BY \n  ROE_Rank\nLIMIT 5;\n"
            }
        ],
        "time": 49.95185041427612,
        "evaluate": 0.5,
        "input_token": 8209,
        "output_token": 3475
    },
    {
        "id": "0139ac4a-8687-4aac-a031-3b29b413d83a",
        "question": "For the period 2020-Q2 2024, which 10 companies have the highest total assets,  with the condition that total assets must be greater than 100 billion VND?",
        "answer": "Table 1\n| stock_code   |   total_assets |\n|:-------------|---------------:|\n| BID          |    3.1738e+10  |\n| CTG          |    2.57372e+10 |\n| VCB          |    2.56522e+10 |\n| TCB          |    1.1165e+10  |\n| VPB          |    9.8242e+09  |\n| VIC          |    9.36372e+09 |\n| MBB          |    9.02315e+09 |\n| STB          |    8.76012e+09 |\n| SHB          |    8.57265e+09 |\n| ACB          |    7.8037e+09  |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "WITH total_assets AS (\n    SELECT\n        c.stock_code,\n        SUM(f.data) AS total_assets\n    FROM\n        company_info c\n    LEFT JOIN bank_financial_report f ON c.stock_code = f.stock_code\n    WHERE\n        f.category_code = 'BS_300'\n        AND f.year BETWEEN 2020 AND 2024\n        AND f.quarter != 0\n    GROUP BY c.stock_code\n\n    UNION ALL\n\n    SELECT\n        c.stock_code,\n        SUM(f.data) AS total_assets\n    FROM\n        company_info c\n    LEFT JOIN non_bank_financial_report f ON c.stock_code = f.stock_code\n    WHERE\n        f.category_code = 'BS_270'\n        AND f.year BETWEEN 2020 AND 2024\n        AND f.quarter != 0\n    GROUP BY c.stock_code\n\n    UNION ALL\n\n    SELECT\n        c.stock_code,\n        SUM(f.data) AS total_assets\n    FROM\n        company_info c\n    LEFT JOIN securities_financial_report f ON c.stock_code = f.stock_code\n    WHERE\n        f.category_code = 'BS_270'\n        AND f.year BETWEEN 2020 AND 2024\n        AND f.quarter != 0\n    GROUP BY c.stock_code\n)\n\nSELECT\n    t.stock_code,\n    t.total_assets\nFROM\n    total_assets t\nWHERE\n    t.total_assets > 100000\nORDER BY\n    t.total_assets DESC\nLIMIT 10;\n"
            }
        ],
        "score": 1,
        "difficulty": 3,
        "response": "Table 1\n| stock_code   | company_name   | latest_year   | highest_total_assets   |\n|--------------|----------------|---------------|------------------------|\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "WITH filtered_companies AS (\n  SELECT \n    'bank' AS report_type,\n    bfr.stock_code,\n    bfr.year,\n    bfr.quarter,\n    bfr.data AS total_assets\n  FROM \n    bank_financial_report bfr\n  INNER JOIN \n    map_category_code_bank mccb ON bfr.category_code = mccb.category_code\n  WHERE \n    mccb.en_caption = 'Total assets'\n    AND bfr.year BETWEEN 2020 AND 2024\n    AND (bfr.quarter = 0 OR (bfr.year > 2020 AND bfr.quarter = 2))\n    AND bfr.data > 100000000000  -- 100 billion VND\n\n  UNION ALL\n\n  SELECT \n    'non_bank' AS report_type,\n    nbfr.stock_code,\n    nbfr.year,\n    nbfr.quarter,\n    nbfr.data AS total_assets\n  FROM \n    non_bank_financial_report nbfr\n  INNER JOIN \n    map_category_code_non_bank mccnb ON nbfr.category_code = mccnb.category_code\n  WHERE \n    mccnb.en_caption = 'TOTAL ASSETS'\n    AND nbfr.year BETWEEN 2020 AND 2024\n    AND (nbfr.quarter = 0 OR (nbfr.year > 2020 AND nbfr.quarter = 2))\n    AND nbfr.data > 100000000000  -- 100 billion VND\n\n  UNION ALL\n\n  SELECT \n    'securities' AS report_type,\n    sfr.stock_code,\n    sfr.year,\n    sfr.quarter,\n    sfr.data AS total_assets\n  FROM \n    securities_financial_report sfr\n  INNER JOIN \n    map_category_code_securities mccs ON sfr.category_code = mccs.category_code\n  WHERE \n    mccs.en_caption = 'TOTAL ASSETS'\n    AND sfr.year BETWEEN 2020 AND 2024\n    AND (sfr.quarter = 0 OR (sfr.year > 2020 AND sfr.quarter = 2))\n    AND sfr.data > 100000000000  -- 100 billion VND\n)\n\nSELECT \n  fc.stock_code,\n  ci.company_name,\n  MAX(fc.year) AS latest_year,\n  MAX(fc.total_assets) AS highest_total_assets\nFROM \n  filtered_companies fc\n  LEFT JOIN company_info ci ON fc.stock_code = ci.stock_code\nGROUP BY \n  fc.stock_code, ci.company_name\nORDER BY \n  highest_total_assets DESC\nLIMIT 10;\n"
            }
        ],
        "time": 76.76666474342346,
        "evaluate": 0,
        "input_token": 2956,
        "output_token": 724
    },
    {
        "id": "514613cf-7002-4698-a3b7-93db835122c6",
        "question": "Rank the top 5 companies with total assets greater than 100,000 billion VND as of December 31, 2023, based on their Return on Equity (ROE).",
        "answer": "Table 1\n| stock_code   | industry   |      roe |\n|:-------------|:-----------|---------:|\n| HDB          | Banking    | 0.232433 |\n| ACB          | Banking    | 0.226122 |\n| VIB          | Banking    | 0.225702 |\n| MBB          | Banking    | 0.217698 |\n| VCB          | Banking    | 0.200315 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "WITH total_assets AS (\n    SELECT \n        stock_code,\n        SUM(data) AS total_assets\n    FROM (\n        SELECT stock_code, data\n        FROM bank_financial_report\n        WHERE category_code = 'BS_300' AND year = 2023 AND quarter = 0\n        \n        UNION ALL\n        \n        SELECT stock_code, data\n        FROM non_bank_financial_report\n        WHERE category_code = 'BS_270' AND year = 2023 AND quarter = 0\n        \n        UNION ALL\n        \n        SELECT stock_code, data\n        FROM securities_financial_report\n        WHERE category_code = 'BS_270' AND year = 2023 AND quarter = 0\n    ) AS combined_assets\n    GROUP BY stock_code\n    HAVING SUM(data) > 100000000\n)\n\nSELECT \n    fr.stock_code,\n    ci.industry,\n    fr.data AS roe\nFROM \n    financial_ratio fr\nJOIN \n    total_assets ta ON fr.stock_code = ta.stock_code\nJOIN \n    company_info ci ON fr.stock_code = ci.stock_code\nWHERE \n    fr.ratio_code = 'ROE' AND fr.year = 2023 AND fr.quarter = 0\nORDER BY \n    fr.data DESC\nLIMIT 5;\n"
            }
        ],
        "score": 1,
        "difficulty": 4,
        "response": "Table 1\n| stock_code   |\n|:-------------|\n| ABB          |\n| ACB          |\n| BCM          |\n| BID          |\n| CAP          |\n| CEO          |\n| CMG          |\n| CTG          |\n| DBC          |\n| DCM          |\n| DGC          |\n| DHT          |\n| DTD          |\n| DVM          |\n| DXG          |\n| EIB          |\n| FPT          |\n| FRT          |\n| GAS          |\n| GVR          |\n| HDB          |\n| HDC          |\n| HLD          |\n| HPG          |\n| HUT          |\n| KDH          |\n| L14          |\n| L18          |\n| LAS          |\n| LHC          |\n| LPB          |\n| MBB          |\n| MBS          |\n| MSN          |\n| MWG          |\n| NHA          |\n| NKG          |\n| NTP          |\n| NVL          |\n| OCB          |\n| ORS          |\n| PLC          |\n| PNJ          |\n| POW          |\n| PSD          |\n| PVC          |\n| PVG          |\n| PVS          |\n| PVT          |\n| SAB          |\n| SAF          |\n| SHB          |\n| SLS          |\n| SSI          |\n| STB          |\n| TCB          |\n| TCH          |\n| TIG          |\n| TMB          |\n| TNG          |\n| TPB          |\n| TVD          |\n| VC3          |\n| VCB          |\n| VCS          |\n| VGI          |\n| VHM          |\n| VIB          |\n| VIC          |\n| VIX          |\n| VJC          |\n| VND          |\n| VNM          |\n| VPB          |\n| VPI          |\n| VRE          |\n| VTP          |\n| YEG          |\n\nTable 2\n| stock_code   |   roe_value |\n|:-------------|------------:|\n| TMB          |    0.476625 |\n| TMB          |    0.476625 |\n| SLS          |    0.443074 |\n| SLS          |    0.443074 |\n| CAP          |    0.43171  |\n\nTable 3\n| stock_code   |   roe_value |\n|:-------------|------------:|\n| TMB          |    0.476625 |\n| TMB          |    0.476625 |\n| SLS          |    0.443074 |\n| SLS          |    0.443074 |\n| CAP          |    0.43171  |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "WITH \n-- Union all financial reports for total assets, filtering for annual reports (quarter = 0) in 2023\ntotal_assets AS (\n  SELECT stock_code, data \n  FROM (\n    SELECT stock_code, year, quarter, category_code, data \n    FROM bank_financial_report \n    WHERE year = 2023 AND quarter = 0 \n    UNION ALL \n    SELECT stock_code, year, quarter, category_code, data \n    FROM non_bank_financial_report \n    WHERE year = 2023 AND quarter = 0 \n    UNION ALL \n    SELECT stock_code, year, quarter, category_code, data \n    FROM securities_financial_report \n    WHERE year = 2023 AND quarter = 0 \n  ) AS all_reports\n  -- Join with mapping tables to filter for total assets category\n  INNER JOIN (\n    SELECT category_code FROM map_category_code_bank WHERE en_caption = 'Total assets'\n    UNION \n    SELECT category_code FROM map_category_code_non_bank WHERE en_caption = 'TOTAL ASSETS'\n    UNION \n    SELECT category_code FROM map_category_code_securities WHERE en_caption = 'TOTAL ASSETS'\n  ) AS total_assets_codes ON all_reports.category_code = total_assets_codes.category_code\n),\n-- Filter companies with total assets > 100,000,000,000,000 VND (considering data in Million VND)\neligible_companies AS (\n  SELECT stock_code \n  FROM total_assets \n  WHERE data > 100000  -- Corrected the syntax error here (removed comma)\n)\n\n-- Select distinct stock_codes (company IDs) from eligible_companies\nSELECT DISTINCT stock_code \nFROM eligible_companies\nLIMIT 100;\n"
            },
            {
                "language": "sql",
                "code": "WITH \n-- Define eligible_companies CTE here to avoid errors\neligible_companies AS (\n  WITH \n  total_assets AS (\n    SELECT stock_code, data \n    FROM (\n      SELECT stock_code, year, quarter, category_code, data \n      FROM bank_financial_report \n      WHERE year = 2023 AND quarter = 0 \n      UNION ALL \n      SELECT stock_code, year, quarter, category_code, data \n      FROM non_bank_financial_report \n      WHERE year = 2023 AND quarter = 0 \n      UNION ALL \n      SELECT stock_code, year, quarter, category_code, data \n      FROM securities_financial_report \n      WHERE year = 2023 AND quarter = 0 \n    ) AS all_reports\n    INNER JOIN (\n      SELECT category_code FROM map_category_code_bank WHERE en_caption = 'Total assets'\n      UNION \n      SELECT category_code FROM map_category_code_non_bank WHERE en_caption = 'TOTAL ASSETS'\n      UNION \n      SELECT category_code FROM map_category_code_securities WHERE en_caption = 'TOTAL ASSETS'\n    ) AS total_assets_codes ON all_reports.category_code = total_assets_codes.category_code\n  ),\n  -- Filter companies with total assets > 100,000,000,000,000 VND (considering data in Million VND)\n  eligible_companies AS (\n    SELECT stock_code \n    FROM total_assets \n    WHERE data > 100000  \n  )\n  SELECT * FROM eligible_companies\n),\n-- Extract ROE values for eligible companies\nroe_values AS (\n  SELECT \n    fr.stock_code, \n    fr.data AS roe_value\n  FROM \n    financial_ratio fr\n  INNER JOIN \n    eligible_companies ec ON fr.stock_code = ec.stock_code\n  INNER JOIN \n    map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\n  WHERE \n    mcr.ratio_name = 'Return On Equity'\n    AND fr.year = 2023 AND fr.quarter = 0  \n)\n\n-- Rank companies by ROE and select the top 5\nSELECT \n  stock_code, \n  roe_value\nFROM \n  (\n    SELECT \n      stock_code, \n      roe_value,\n      ROW_NUMBER() OVER (ORDER BY roe_value DESC) AS roe_rank\n    FROM \n      roe_values\n  ) AS ranked_companies\nWHERE \n  roe_rank <= 5\nLIMIT 100;\n"
            },
            {
                "language": "sql",
                "code": "WITH \ntotal_assets AS (\n  SELECT stock_code, data \n  FROM (\n    SELECT stock_code, year, quarter, category_code, data \n    FROM bank_financial_report \n    WHERE year = 2023 AND quarter = 0 \n    UNION ALL \n    SELECT stock_code, year, quarter, category_code, data \n    FROM non_bank_financial_report \n    WHERE year = 2023 AND quarter = 0 \n    UNION ALL \n    SELECT stock_code, year, quarter, category_code, data \n    FROM securities_financial_report \n    WHERE year = 2023 AND quarter = 0 \n  ) AS all_reports\n  INNER JOIN (\n    SELECT category_code FROM map_category_code_bank WHERE en_caption = 'Total assets'\n    UNION \n    SELECT category_code FROM map_category_code_non_bank WHERE en_caption = 'TOTAL ASSETS'\n    UNION \n    SELECT category_code FROM map_category_code_securities WHERE en_caption = 'TOTAL ASSETS'\n  ) AS total_assets_codes ON all_reports.category_code = total_assets_codes.category_code\n),\neligible_companies AS (\n  SELECT stock_code \n  FROM total_assets \n  WHERE data > 100000  \n),\nroe_values AS (\n  SELECT \n    fr.stock_code, \n    fr.data AS roe_value\n  FROM \n    financial_ratio fr\n  INNER JOIN \n    eligible_companies ec ON fr.stock_code = ec.stock_code\n  INNER JOIN \n    map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\n  WHERE \n    mcr.ratio_name = 'Return On Equity'\n    AND fr.year = 2023 AND fr.quarter = 0  \n),\nranked_companies AS (\n  SELECT \n    stock_code, \n    roe_value,\n    ROW_NUMBER() OVER (ORDER BY roe_value DESC) AS roe_rank\n  FROM \n    roe_values\n)\nSELECT \n  stock_code, \n  roe_value\nFROM \n  ranked_companies\nWHERE \n  roe_rank <= 5\nLIMIT 100;\n"
            }
        ],
        "time": 215.67033290863037,
        "evaluate": 0,
        "input_token": 5064,
        "output_token": 2045
    },
    {
        "id": "62907a1f-3544-4f00-acbc-9099a5fa6f67",
        "question": "What were the Return on Equity (ROE) and Debt-to-Equity ratios for Vietcombank and Techcombank in 2023?",
        "answer": "Table 1\n| stock_code   | ratio_code   |      data |\n|:-------------|:-------------|----------:|\n| TCB          | DTER         |  5.50936  |\n| VCB          | DTER         | 10.1483   |\n| TCB          | ROE          |  0.139608 |\n| VCB          | ROE          |  0.200315 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    stock_code, \n    ratio_code, \n    data \nFROM \n    financial_ratio \nWHERE \n    (stock_code = 'VCB' OR stock_code = 'TCB') \n    AND year = 2023 \n    AND quarter = 0 \n    AND (ratio_code = 'ROE' OR ratio_code = 'DTER');\n"
            }
        ],
        "score": 1,
        "difficulty": 1,
        "response": "Table 1\n| stock_code   | ratio_code   | ratio_name           |   ratio_value |   year |\n|:-------------|:-------------|:---------------------|--------------:|-------:|\n| TCB          | DTER         | Debt To Equity Ratio |      5.50936  |   2023 |\n| VCB          | DTER         | Debt To Equity Ratio |     10.1483   |   2023 |\n| TCB          | ROE          | Return On Equity     |      0.139608 |   2023 |\n| VCB          | ROE          | Return On Equity     |      0.200315 |   2023 |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT \n  fr.stock_code,\n  fr.ratio_code,\n  mcr.ratio_name,\n  fr.data AS ratio_value,\n  fr.year\nFROM \n  financial_ratio fr\n  INNER JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\nWHERE \n  fr.stock_code IN ('VCB', 'TCB')  -- Identified stock codes\n  AND fr.year = 2023  -- Specified year\n  AND fr.quarter = 0  -- Annual report (quarter = 0)\n  AND fr.ratio_code IN ('ROE', 'DTER')  -- Specified ratios\nLIMIT 100;  -- Added limit as per database schema requirements\n"
            }
        ],
        "time": 38.492669105529785,
        "evaluate": 0.5,
        "input_token": 5546,
        "output_token": 1673
    },
    {
        "id": "e2b68420-a9fe-4c34-b33a-0b2f2f44c423",
        "question": "Compare the operating cash flow and capital expenditures of Vinamilk and Masan Group for the period from 2020 to Q2 2024.  Calculate the free cash flow for each company during this period.",
        "answer": "Table 1\n| stock_code   |   year |   quarter |   operating_cash_flow |   capital_expenditures |   free_cash_flow |\n|:-------------|-------:|----------:|----------------------:|-----------------------:|-----------------:|\n| MSN          |   2020 |         0 |           1.3513e+06  |           -3.67816e+06 |      5.02946e+06 |\n| MSN          |   2021 |         0 |           1.14391e+06 |           -2.80543e+06 |      3.94934e+06 |\n| MSN          |   2022 |         0 |          -3.78885e+06 |           -4.16532e+06 | 376469           |\n| MSN          |   2023 |         0 |      500461           |           -2.2288e+06  |      2.72926e+06 |\n| MSN          |   2024 |         1 |      -35373           |      -396763           | 361390           |\n| VNM          |   2020 |         0 |           1.01802e+07 |           -1.26482e+06 |      1.1445e+07  |\n| VNM          |   2021 |         0 |           9.43197e+06 |           -1.53102e+06 |      1.0963e+07  |\n| VNM          |   2022 |         0 |           8.82727e+06 |           -1.45691e+06 |      1.02842e+07 |\n| VNM          |   2023 |         0 |           7.88742e+06 |           -1.57964e+06 |      9.46706e+06 |\n| VNM          |   2024 |         1 |      907549           |      -378452           |      1.286e+06   |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    nbfr.stock_code,\n    nbfr.year,\n    nbfr.quarter,\n    SUM(CASE WHEN nbfr.category_code = 'CF_020' THEN nbfr.data ELSE 0 END) AS operating_cash_flow,\n    SUM(CASE WHEN nbfr.category_code = 'CF_021' THEN nbfr.data ELSE 0 END) AS capital_expenditures,\n    SUM(CASE WHEN nbfr.category_code = 'CF_020' THEN nbfr.data ELSE 0 END) - \n    SUM(CASE WHEN nbfr.category_code = 'CF_021' THEN nbfr.data ELSE 0 END) AS free_cash_flow\nFROM \n    non_bank_financial_report nbfr\nWHERE \n    nbfr.stock_code IN ('VNM', 'MSN') AND\n    ((nbfr.year = 2020 AND nbfr.quarter = 0) OR\n     (nbfr.year = 2021 AND nbfr.quarter = 0) OR\n     (nbfr.year = 2022 AND nbfr.quarter = 0) OR\n     (nbfr.year = 2023 AND nbfr.quarter = 0) OR\n     (nbfr.year = 2024 AND nbfr.quarter <= 2))\n    AND nbfr.category_code IN ('CF_020', 'CF_021')\nGROUP BY \n    nbfr.stock_code, nbfr.year, nbfr.quarter\nORDER BY \n    nbfr.stock_code, nbfr.year, nbfr.quarter;\n"
            }
        ],
        "score": 1,
        "difficulty": 3,
        "response": "Table 1\n| stock_code   |   year |   quarter | category_code   |             data |\n|:-------------|-------:|----------:|:----------------|-----------------:|\n| VNM          |   2020 |         0 | IS_001          |      5.97229e+07 |\n| VNM          |   2021 |         0 | IS_001          |      6.10121e+07 |\n| VNM          |   2022 |         0 | IS_001          |      6.00747e+07 |\n| VNM          |   2023 |         0 | IS_001          |      6.04789e+07 |\n| VNM          |   2020 |         0 | IS_002          |  86622           |\n| VNM          |   2021 |         0 | IS_002          |  92909           |\n| VNM          |   2022 |         0 | IS_002          | 118483           |\n| VNM          |   2023 |         0 | IS_002          | 109997           |\n| VNM          |   2020 |         0 | IS_010          |      5.96363e+07 |\n| VNM          |   2021 |         0 | IS_010          |      6.09192e+07 |\n| VNM          |   2022 |         0 | IS_010          |      5.99562e+07 |\n| VNM          |   2023 |         0 | IS_010          |      6.03689e+07 |\n| VNM          |   2020 |         0 | IS_011          |      3.19677e+07 |\n| VNM          |   2021 |         0 | IS_011          |      3.46409e+07 |\n| VNM          |   2022 |         0 | IS_011          |      3.6059e+07  |\n| VNM          |   2023 |         0 | IS_011          |      3.58242e+07 |\n| VNM          |   2020 |         0 | IS_020          |      2.76686e+07 |\n| VNM          |   2021 |         0 | IS_020          |      2.62783e+07 |\n| VNM          |   2022 |         0 | IS_020          |      2.38972e+07 |\n| VNM          |   2023 |         0 | IS_020          |      2.45447e+07 |\n| VNM          |   2020 |         0 | IS_021          |      1.58109e+06 |\n| VNM          |   2021 |         0 | IS_021          |      1.21468e+06 |\n| VNM          |   2022 |         0 | IS_021          |      1.3799e+06  |\n| VNM          |   2023 |         0 | IS_021          |      1.71637e+06 |\n| VNM          |   2020 |         0 | IS_022          | 308569           |\n| VNM          |   2021 |         0 | IS_022          | 202338           |\n| VNM          |   2022 |         0 | IS_022          | 617537           |\n| VNM          |   2023 |         0 | IS_022          | 503122           |\n| VNM          |   2020 |         0 | IS_023          | 143818           |\n| VNM          |   2021 |         0 | IS_023          |  88799           |\n| VNM          |   2022 |         0 | IS_023          | 166039           |\n| VNM          |   2023 |         0 | IS_023          | 354094           |\n| VNM          |   2020 |         0 | IS_024          |   3882           |\n| VNM          |   2021 |         0 | IS_024          | -45044           |\n| VNM          |   2022 |         0 | IS_024          | -24475           |\n| VNM          |   2023 |         0 | IS_024          | -80631           |\n| VNM          |   2020 |         0 | IS_025          |      1.34475e+07 |\n| VNM          |   2021 |         0 | IS_025          |      1.29507e+07 |\n| VNM          |   2022 |         0 | IS_025          |      1.25482e+07 |\n| VNM          |   2023 |         0 | IS_025          |      1.30181e+07 |\n| VNM          |   2020 |         0 | IS_026          |      1.95816e+06 |\n| VNM          |   2021 |         0 | IS_026          |      1.56731e+06 |\n| VNM          |   2022 |         0 | IS_026          |      1.59584e+06 |\n| VNM          |   2023 |         0 | IS_026          |      1.75562e+06 |\n| VNM          |   2020 |         0 | IS_030          |      1.35394e+07 |\n| VNM          |   2021 |         0 | IS_030          |      1.27276e+07 |\n| VNM          |   2022 |         0 | IS_030          |      1.04911e+07 |\n| VNM          |   2023 |         0 | IS_030          |      1.09036e+07 |\n| VNM          |   2020 |         0 | IS_031          | 212386           |\n| VNM          |   2021 |         0 | IS_031          | 422823           |\n| VNM          |   2022 |         0 | IS_031          | 289021           |\n| VNM          |   2023 |         0 | IS_031          | 353408           |\n| VNM          |   2020 |         0 | IS_032          | 233230           |\n| VNM          |   2021 |         0 | IS_032          | 228207           |\n| VNM          |   2022 |         0 | IS_032          | 284551           |\n| VNM          |   2023 |         0 | IS_032          | 289142           |\n| VNM          |   2020 |         0 | IS_040          | -20844           |\n| VNM          |   2021 |         0 | IS_040          | 194615           |\n| VNM          |   2022 |         0 | IS_040          |   4469           |\n| VNM          |   2023 |         0 | IS_040          |  64266           |\n| VNM          |   2020 |         0 | IS_050          |      1.35185e+07 |\n| VNM          |   2021 |         0 | IS_050          |      1.29222e+07 |\n| VNM          |   2022 |         0 | IS_050          |      1.04955e+07 |\n| VNM          |   2023 |         0 | IS_050          |      1.09679e+07 |\n| VNM          |   2020 |         0 | IS_051          |      2.31067e+06 |\n| VNM          |   2021 |         0 | IS_051          |      2.32098e+06 |\n| VNM          |   2022 |         0 | IS_051          |      1.95625e+06 |\n| VNM          |   2023 |         0 | IS_051          |      1.94836e+06 |\n| VNM          |   2020 |         0 | IS_052          | -27870           |\n| VNM          |   2021 |         0 | IS_052          | -31282           |\n| VNM          |   2022 |         0 | IS_052          | -38288           |\n| VNM          |   2023 |         0 | IS_052          |    181           |\n| VNM          |   2020 |         0 | IS_060          |      1.12357e+07 |\n| VNM          |   2021 |         0 | IS_060          |      1.06325e+07 |\n| VNM          |   2022 |         0 | IS_060          |      8.57758e+06 |\n| VNM          |   2023 |         0 | IS_060          |      9.01935e+06 |\n| VNM          |   2020 |         0 | IS_061          |      1.10989e+07 |\n| VNM          |   2021 |         0 | IS_061          |      1.05325e+07 |\n| VNM          |   2022 |         0 | IS_061          |      8.51602e+06 |\n| VNM          |   2023 |         0 | IS_061          |      8.87381e+06 |\n| VNM          |   2020 |         0 | IS_062          | 136795           |\n| VNM          |   2021 |         0 | IS_062          | 100058           |\n| VNM          |   2022 |         0 | IS_062          |  61551           |\n| VNM          |   2023 |         0 | IS_062          | 145541           |\n| VNM          |   2020 |         0 | IS_070          |   4770           |\n| VNM          |   2021 |         0 | IS_070          |   4517           |\n| VNM          |   2022 |         0 | IS_070          |   3632           |\n| VNM          |   2023 |         0 | IS_070          |   3796           |\n| VNM          |   2020 |         0 | IS_071          |      0           |\n| VNM          |   2021 |         0 | IS_071          |      0           |\n| VNM          |   2022 |         0 | IS_071          |      0           |\n| VNM          |   2023 |         0 | IS_071          |      0           |\n| MSN          |   2020 |         0 | IS_001          |      7.88683e+07 |\n| MSN          |   2021 |         0 | IS_001          |      8.97916e+07 |\n| MSN          |   2022 |         0 | IS_001          |      7.63808e+07 |\n| MSN          |   2023 |         0 | IS_001          |      7.8517e+07  |\n| MSN          |   2020 |         0 | IS_002          |      1.65051e+06 |\n| MSN          |   2021 |         0 | IS_002          |      1.16285e+06 |\n| MSN          |   2022 |         0 | IS_002          | 191525           |\n| MSN          |   2023 |         0 | IS_002          | 265380           |\n\nTable 2\n| stock_code   |   year |   quarter |   free_cash_flow |\n|:-------------|-------:|----------:|-----------------:|\n| MSN          |   2020 |         0 |                0 |\n| MSN          |   2021 |         0 |                0 |\n| MSN          |   2022 |         0 |                0 |\n| MSN          |   2023 |         0 |           ",
        "code_response": [
            {
                "language": "sql",
                "code": "-- Retrieve stock codes for Vinamilk (VNM) and Masan Group (MSN)\nWITH target_companies AS (\n  SELECT stock_code\n  FROM company_info\n  WHERE stock_code IN ('VNM', 'MSN')\n)\n-- Retrieve operating cash flow and capital expenditures\nSELECT \n  t.stock_code,\n  n.year,\n  n.quarter,\n  n.category_code,\n  n.data\nFROM \n  target_companies t\n  JOIN non_bank_financial_report n ON t.stock_code = n.stock_code\n  JOIN map_category_code_non_bank m ON n.category_code = m.category_code\nWHERE \n  (n.year BETWEEN 2020 AND 2023 AND n.quarter = 0)  -- Annual reports for 2020-2023\n  OR (n.year = 2024 AND n.quarter IN (1, 2))  -- Q1 and Q2 reports for 2024\n  AND m.en_caption IN ('Operating Cash Flow', 'Capital Expenditures')  -- Assuming these captions match the desired categories\nLIMIT 100;\n"
            },
            {
                "language": "sql",
                "code": "-- Calculate Free Cash Flow (FCF) for each company\nWITH \n  -- Retrieve stock codes for Vinamilk (VNM) and Masan Group (MSN)\n  target_companies AS (\n    SELECT stock_code\n    FROM company_info\n    WHERE stock_code IN ('VNM', 'MSN')\n  ),\n  -- Retrieve operating cash flow and capital expenditures\n  financial_data AS (\n    SELECT \n      t.stock_code,\n      n.year,\n      n.quarter,\n      m.en_caption,\n      n.data\n    FROM \n      target_companies t\n      JOIN non_bank_financial_report n ON t.stock_code = n.stock_code\n      JOIN map_category_code_non_bank m ON n.category_code = m.category_code\n    WHERE \n      (n.year BETWEEN 2020 AND 2023 AND n.quarter = 0)  -- Annual reports for 2020-2023\n      OR (n.year = 2024 AND n.quarter IN (1, 2))  -- Q1 and Q2 reports for 2024\n      AND m.en_caption IN ('Operating Cash Flow', 'Capital Expenditures')\n  ),\n  -- Pivot data for easier calculation\n  pivoted_data AS (\n    SELECT \n      stock_code,\n      year,\n      quarter,\n      SUM(CASE WHEN en_caption = 'Operating Cash Flow' THEN data ELSE 0 END) AS operating_cash_flow,\n      SUM(CASE WHEN en_caption = 'Capital Expenditures' THEN data ELSE 0 END) AS capital_expenditures\n    FROM \n      financial_data\n    GROUP BY \n      stock_code, year, quarter\n  )\n-- Calculate FCF and compare results\nSELECT \n  stock_code,\n  year,\n  quarter,\n  operating_cash_flow - capital_expenditures AS free_cash_flow\nFROM \n  pivoted_data\nORDER BY \n  stock_code, year, quarter\nLIMIT 100;\n"
            },
            {
                "language": "sql",
                "code": "WITH \n  target_companies AS (\n    SELECT stock_code\n    FROM company_info\n    WHERE stock_code IN ('VNM', 'MSN')\n  ),\n  financial_data AS (\n    SELECT \n      t.stock_code,\n      n.year,\n      n.quarter,\n      m.en_caption,\n      n.data\n    FROM \n      target_companies t\n      JOIN non_bank_financial_report n ON t.stock_code = n.stock_code\n      JOIN map_category_code_non_bank m ON n.category_code = m.category_code\n    WHERE \n      (n.year BETWEEN 2020 AND 2023 AND n.quarter = 0)  \n      OR (n.year = 2024 AND n.quarter IN (1, 2))  \n      AND m.en_caption IN ('Operating Cash Flow', 'Capital Expenditures')\n  ),\n  pivoted_data AS (\n    SELECT \n      stock_code,\n      year,\n      quarter,\n      SUM(CASE WHEN en_caption = 'Operating Cash Flow' THEN data ELSE 0 END) AS operating_cash_flow,\n      SUM(CASE WHEN en_caption = 'Capital Expenditures' THEN data ELSE 0 END) AS capital_expenditures\n    FROM \n      financial_data\n    GROUP BY \n      stock_code, year, quarter\n  )\nSELECT \n  stock_code,\n  year,\n  quarter,\n  operating_cash_flow - capital_expenditures AS free_cash_flow\nFROM \n  pivoted_data\nORDER BY \n  stock_code, year, quarter\nLIMIT 100;\n"
            }
        ],
        "time": 72.96809840202332,
        "evaluate": 0,
        "input_token": 6737,
        "output_token": 3437
    },
    {
        "id": "0759f255-d239-4e78-be61-78f7c00f8b42",
        "question": "What is the total amount of  property, plant, and equipment (PP&E) for Vinamilk, Masan Group, and Hoa Phat Group at the end of 2023?",
        "answer": "Table 1\n| stock_code   |   total_ppe |\n|:-------------|------------:|\n| HPG          | 7.19984e+07 |\n| MSN          | 4.28858e+07 |\n| VNM          | 1.26897e+07 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    stock_code, \n    SUM(data) AS total_ppe\nFROM \n    non_bank_financial_report\nWHERE \n    year = 2023 \n    AND quarter = 0 \n    AND stock_code IN ('VNM', 'MSN', 'HPG')\n    AND category_code IN ('BS_221', 'BS_224', 'BS_227')\nGROUP BY \n    stock_code;\n"
            }
        ],
        "score": 1,
        "difficulty": 2,
        "response": "Table 1\n| stock_code   | industry   | total_pp_e   |\n|--------------|------------|--------------|\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT \n  ci.stock_code,\n  ci.industry,\n  nbfr.data AS total_pp_e\nFROM \n  company_info ci\n  INNER JOIN non_bank_financial_report nbfr ON ci.stock_code = nbfr.stock_code\n  INNER JOIN map_category_code_non_bank mccnb ON nbfr.category_code = mccnb.category_code\nWHERE \n  ci.stock_code IN ('VNM', 'MSN', 'HPG')  -- Target stock codes\n  AND nbfr.year = 2023  -- Reporting year\n  AND nbfr.quarter = 0  -- Annual report (end of year)\n  AND mccnb.en_caption = 'Property, Plant and Equipment'  -- Assuming this caption for BS_211\n  -- If you have the exact category_code, use: AND nbfr.category_code = 'BS_211'\nLIMIT 100;  -- Add limit as per the database schema guidelines\n"
            }
        ],
        "time": 40.166290521621704,
        "evaluate": 0,
        "input_token": 2454,
        "output_token": 682
    },
    {
        "id": "c7ee3213-142c-4b94-ac63-6f90c9317169",
        "question": "What is the trend of Return on Equity (ROE) for Vietcombank, Techcombank, and ACB from 2020 to Q2 2024, considering their respective subsidiaries' financial performance?",
        "answer": "Table 1\n|   year |   quarter | stock_code   |       roe |\n|-------:|----------:|:-------------|----------:|\n|   2020 |         0 | ACB          | 0.216734  |\n|   2020 |         0 | ACB          | 0.216734  |\n|   2020 |         0 | ACB          | 0.216734  |\n|   2020 |         0 | ACB          | 0.216734  |\n|   2020 |         0 | ACB          | 0.216734  |\n|   2020 |         0 | ACB          | 0.216734  |\n|   2020 |         0 | ACB          | 0.216734  |\n|   2020 |         0 | ACB          | 0.216734  |\n|   2020 |         0 | ACB          | 0.216734  |\n|   2020 |         0 | ACB          | 0.216734  |\n|   2020 |         0 | ACB          | 0.216734  |\n|   2021 |         0 | ACB          | 0.213865  |\n|   2021 |         0 | ACB          | 0.213865  |\n|   2021 |         0 | ACB          | 0.213865  |\n|   2021 |         0 | ACB          | 0.213865  |\n|   2021 |         0 | ACB          | 0.213865  |\n|   2021 |         0 | ACB          | 0.213865  |\n|   2021 |         0 | ACB          | 0.213865  |\n|   2021 |         0 | ACB          | 0.213865  |\n|   2021 |         0 | ACB          | 0.213865  |\n|   2021 |         0 | ACB          | 0.213865  |\n|   2021 |         0 | ACB          | 0.213865  |\n|   2022 |         0 | ACB          | 0.234232  |\n|   2022 |         0 | ACB          | 0.234232  |\n|   2022 |         0 | ACB          | 0.234232  |\n|   2022 |         0 | ACB          | 0.234232  |\n|   2022 |         0 | ACB          | 0.234232  |\n|   2022 |         0 | ACB          | 0.234232  |\n|   2022 |         0 | ACB          | 0.234232  |\n|   2022 |         0 | ACB          | 0.234232  |\n|   2022 |         0 | ACB          | 0.234232  |\n|   2022 |         0 | ACB          | 0.234232  |\n|   2022 |         0 | ACB          | 0.234232  |\n|   2023 |         0 | ACB          | 0.226122  |\n|   2023 |         0 | ACB          | 0.226122  |\n|   2023 |         0 | ACB          | 0.226122  |\n|   2023 |         0 | ACB          | 0.226122  |\n|   2023 |         0 | ACB          | 0.226122  |\n|   2023 |         0 | ACB          | 0.226122  |\n|   2023 |         0 | ACB          | 0.226122  |\n|   2023 |         0 | ACB          | 0.226122  |\n|   2023 |         0 | ACB          | 0.226122  |\n|   2023 |         0 | ACB          | 0.226122  |\n|   2023 |         0 | ACB          | 0.226122  |\n|   2024 |         1 | ACB          | 0.052218  |\n|   2024 |         1 | ACB          | 0.052218  |\n|   2024 |         1 | ACB          | 0.052218  |\n|   2024 |         1 | ACB          | 0.052218  |\n|   2024 |         1 | ACB          | 0.052218  |\n|   2024 |         1 | ACB          | 0.052218  |\n|   2024 |         1 | ACB          | 0.052218  |\n|   2024 |         1 | ACB          | 0.052218  |\n|   2024 |         1 | ACB          | 0.052218  |\n|   2024 |         1 | ACB          | 0.052218  |\n|   2024 |         1 | ACB          | 0.052218  |\n|   2020 |         0 | EIB          | 0.0636274 |\n|   2020 |         0 | EIB          | 0.0636274 |\n|   2020 |         0 | EIB          | 0.0636274 |\n|   2021 |         0 | EIB          | 0.0542841 |\n|   2021 |         0 | EIB          | 0.0542841 |\n|   2021 |         0 | EIB          | 0.0542841 |\n|   2022 |         0 | EIB          | 0.143836  |\n|   2022 |         0 | EIB          | 0.143836  |\n|   2022 |         0 | EIB          | 0.143836  |\n|   2023 |         0 | EIB          | 0.0964624 |\n|   2023 |         0 | EIB          | 0.0964624 |\n|   2023 |         0 | EIB          | 0.0964624 |\n|   2024 |         1 | EIB          | 0.0229559 |\n|   2024 |         1 | EIB          | 0.0229559 |\n|   2024 |         1 | EIB          | 0.0229559 |\n|   2020 |         0 | MBB          | 0.171779  |\n|   2020 |         0 | MBB          | 0.171779  |\n|   2021 |         0 | MBB          | 0.21159   |\n|   2021 |         0 | MBB          | 0.21159   |\n|   2022 |         0 | MBB          | 0.228042  |\n|   2022 |         0 | MBB          | 0.228042  |\n|   2023 |         0 | MBB          | 0.217698  |\n|   2023 |         0 | MBB          | 0.217698  |\n|   2020 |         0 | MSN          | 0.055733  |\n|   2021 |         0 | MSN          | 0.238597  |\n|   2022 |         0 | MSN          | 0.129771  |\n|   2023 |         0 | MSN          | 0.0489033 |\n|   2024 |         1 | MSN          | 0.0123309 |\n|   2020 |         0 | OCB          | 0.202736  |\n|   2020 |         0 | OCB          | 0.202736  |\n|   2021 |         0 | OCB          | 0.202016  |\n|   2021 |         0 | OCB          | 0.202016  |\n|   2022 |         0 | OCB          | 0.138876  |\n|   2022 |         0 | OCB          | 0.138876  |\n|   2023 |         0 | OCB          | 0.11576   |\n|   2023 |         0 | OCB          | 0.11576   |\n|   2024 |         1 | OCB          | 0.03233   |\n|   2024 |         1 | OCB          | 0.03233   |\n|   2020 |         0 | PVT          | 0.132256  |\n|   2021 |         0 | PVT          | 0.119846  |\n|   2022 |         0 | PVT          | 0.144227  |\n|   2023 |         0 | PVT          | 0.135265  |\n|   2024 |         1 | PVT          | 0.0327416 |\n|   2024 |         2 | PVT          | 0.0394265 |\n|   2020 |         0 | TCB          | 0.168632  |\n|   2020 |         0 | TCB          | 0.168632  |\n|   2020 |         0 | TCB          | 0.168632  |\n|   2021 |         0 | TCB          | 0.197927  |\n|   2021 |         0 | TCB          | 0.197927  |\n|   2021 |         0 | TCB          | 0.197927  |\n|   2022 |         0 | TCB          | 0.180176  |\n|   2022 |         0 | TCB          | 0.180176  |\n|   2022 |         0 | TCB          | 0.180176  |\n|   2023 |         0 | TCB          | 0.139608  |\n|   2023 |         0 | TCB          | 0.139608  |\n|   2023 |         0 | TCB          | 0.139608  |\n|   2024 |         1 | TCB          | 0.0459854 |\n|   2024 |         1 | TCB          | 0.0459854 |\n|   2024 |         1 | TCB          | 0.0459854 |\n|   2024 |         2 | TCB          | 0.0457096 |\n|   2024 |         2 | TCB          | 0.0457096 |\n|   2024 |         2 | TCB          | 0.0457096 |\n|   2020 |         0 | VCB          | 0.196318  |\n|   2020 |         0 | VCB          | 0.196318  |\n|   2020 |         0 | VCB          | 0.196318  |\n|   2020 |         0 | VCB          | 0.196318  |\n|   2020 |         0 | VCB          | 0.196318  |\n|   2020 |         0 | VCB          | 0.196318  |\n|   2020 |         0 | VCB          | 0.196318  |\n|   2020 |         0 | VCB          | 0.196318  |\n|   2020 |         0 | VCB          | 0.196318  |\n|   2020 |         0 | VCB          | 0.196318  |\n|   2021 |         0 | VCB          | 0.201059  |\n|   2021 |         0 | VCB          | 0.201059  |\n|   2021 |         0 | VCB          | 0.201059  |\n|   2021 |         0 | VCB          | 0.201059  |\n|   2021 |         0 | VCB          | 0.201059  |\n|   2021 |         0 | VCB          | 0.201059  |\n|   2021 |         0 | VCB          | 0.201059  |\n|   2021 |         0 | VCB          | 0.201059  |\n|   2021 |         0 | VCB          | 0.201059  |\n|   2021 |         0 | VCB          | 0.201059  |\n|   2022 |         0 | VCB          | 0.220567  |\n|   2022 |         0 | VCB          | 0.220567  |\n|   2022 |         0 | VCB          | 0.220567  |\n|   2022 |         0 | VCB          | 0.220567  |\n|   2022 |         0 | VCB          | 0.220567  |\n|   2022 |         0 | VCB          | 0.220567  |\n|   2022 |         0 | VCB          | 0.220567  |\n|   2022 |         0 | VCB          | 0.220567  |\n|   2022 |         0 | VCB          | 0.220567  |\n|   2022 |         0 | VCB          | 0.220567  |\n|   2023 |         0 | VCB          | 0.200315  |\n|   2023 |         0 | VCB          | 0.200315  |\n|   2023 |         0 | VCB          | 0.200315  |\n|   2023 |         0 | VCB          | 0.200315  |\n|   2023 |         0 | VCB          | 0.200315  |\n|   2023 |         0 | VCB          | 0.200315  |\n|   2023 |         0 | VCB          | 0.200315  |\n|   2023 |         0 | VCB          | 0.200315  |\n|   2023 |         0 | VCB          | 0.200315  |\n|   2023 |         0 | VCB          | 0.200315  |\n|   2024 |         1 | VCB          | 0.0494831 |\n|   2024 |         1 | VCB          | 0.0494831 |\n|   2024 |         1 | VCB          | 0.0494831 |\n|   2024 |         1 | VCB          | 0.0494831 |\n|   2024 |         1 | VCB          | 0.0494831 |\n|   2024 |         1 | VCB          | 0.0494831 |\n|   2024 |         1 | VCB          | 0.0494831 |\n|   2024 |         1 | VCB          | 0.0494831 |\n|   2024 |         1 | VCB          | 0.0494831 |\n|   2024 |         1 | VCB          | 0.0494831 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    fr.year, \n    fr.quarter, \n    fr.stock_code, \n    fr.data AS roe\nFROM \n    financial_ratio fr\nJOIN \n    map_category_code_ratio mccr ON fr.ratio_code = mccr.ratio_code\nJOIN \n    sub_and_shareholder ssh ON fr.stock_code = ssh.stock_code OR fr.stock_code = ssh.invest_on\nWHERE \n    mccr.ratio_name = 'Return On Equity'\n    AND (ssh.stock_code IN ('VCB', 'TCB', 'ACB') OR ssh.invest_on IN ('VCB', 'TCB', 'ACB'))\n    AND fr.year BETWEEN 2020 AND 2024\n    AND (fr.quarter = 0 OR (fr.year = 2024 AND fr.quarter <= 2))\nORDER BY \n    fr.stock_code, \n    fr.year, \n    fr.quarter;\n"
            }
        ],
        "score": 1,
        "difficulty": 4,
        "response": "Table 1\n| parent_stock_code   | subsidiary_stock_code   |\n|:--------------------|:------------------------|\n| VCB                 | PGI                     |\n| VCB                 | EIB                     |\n| VCB                 | MBB                     |\n| VCB                 | HVN                     |\n| VCB                 | PVD                     |\n| VCB                 | OCB                     |\n| ACB                 | PXS                     |\n| ACB                 | BTS                     |\n| ACB                 | VOS                     |\n| ACB                 | DVC                     |\n| ACB                 | ALT                     |\n| ACB                 | PVT                     |\n| ACB                 | DPM                     |\n| ACB                 | EIB                     |\n| ACB                 | ITA                     |\n| ACB                 | PSB                     |\n| ACB                 | VBB                     |\n| TCB                 | VCG                     |\n| TCB                 | HVN                     |\n| VCB                 | EIB                     |\n| VCB                 | MBB                     |\n| VCB                 | OCB                     |\n| VCB                 |                         |\n| ACB                 |                         |\n| TCB                 |                         |\n\nTable 2\n| stock_code   |   year |   quarter | ratio_name       |    roe_value |\n|:-------------|-------:|----------:|:-----------------|-------------:|\n| ACB          |   2020 |         1 | Return On Equity |   0.0522587  |\n| ACB          |   2020 |         2 | Return On Equity |   0.0493524  |\n| ACB          |   2020 |         3 | Return On Equity |   0.0630206  |\n| ACB          |   2020 |         4 | Return On Equity |   0.0719231  |\n| ACB          |   2021 |         1 | Return On Equity |   0.0654744  |\n| ACB          |   2021 |         2 | Return On Equity |   0.0640966  |\n| ACB          |   2021 |         3 | Return On Equity |   0.0494926  |\n| ACB          |   2021 |         4 | Return On Equity |   0.0540857  |\n| ACB          |   2022 |         1 | Return On Equity |   0.0682014  |\n| ACB          |   2022 |         2 | Return On Equity |   0.0757336  |\n| ACB          |   2022 |         3 | Return On Equity |   0.0643583  |\n| ACB          |   2022 |         4 | Return On Equity |   0.0491202  |\n| ACB          |   2023 |         1 | Return On Equity |   0.0661285  |\n| ACB          |   2023 |         2 | Return On Equity | nan          |\n| ACB          |   2023 |         3 | Return On Equity |   0.0604199  |\n| EIB          |   2020 |         1 | Return On Equity |   0.0226563  |\n| EIB          |   2020 |         1 | Return On Equity |   0.0226563  |\n| EIB          |   2020 |         1 | Return On Equity |   0.0226563  |\n| EIB          |   2020 |         2 | Return On Equity |   0.00463626 |\n| EIB          |   2020 |         2 | Return On Equity |   0.00463626 |\n| EIB          |   2020 |         2 | Return On Equity |   0.00463626 |\n| EIB          |   2020 |         3 | Return On Equity |   0.0259155  |\n| EIB          |   2020 |         3 | Return On Equity |   0.0259155  |\n| EIB          |   2020 |         3 | Return On Equity |   0.0259155  |\n| EIB          |   2020 |         4 | Return On Equity |   0.0118351  |\n| EIB          |   2020 |         4 | Return On Equity |   0.0118351  |\n| EIB          |   2020 |         4 | Return On Equity |   0.0118351  |\n| EIB          |   2021 |         1 | Return On Equity |   0.0101296  |\n| EIB          |   2021 |         1 | Return On Equity |   0.0101296  |\n| EIB          |   2021 |         1 | Return On Equity |   0.0101296  |\n| EIB          |   2021 |         2 | Return On Equity |   0.015775   |\n| EIB          |   2021 |         2 | Return On Equity |   0.015775   |\n| EIB          |   2021 |         2 | Return On Equity |   0.015775   |\n| EIB          |   2021 |         3 | Return On Equity |   0.0186707  |\n| EIB          |   2021 |         3 | Return On Equity |   0.0186707  |\n| EIB          |   2021 |         3 | Return On Equity |   0.0186707  |\n| EIB          |   2021 |         4 | Return On Equity |   0.0107492  |\n| EIB          |   2021 |         4 | Return On Equity |   0.0107492  |\n| EIB          |   2021 |         4 | Return On Equity |   0.0107492  |\n| EIB          |   2022 |         1 | Return On Equity |   0.0350819  |\n| EIB          |   2022 |         1 | Return On Equity |   0.0350819  |\n| EIB          |   2022 |         1 | Return On Equity |   0.0350819  |\n| EIB          |   2022 |         2 | Return On Equity |   0.0456879  |\n| EIB          |   2022 |         2 | Return On Equity |   0.0456879  |\n| EIB          |   2022 |         2 | Return On Equity |   0.0456879  |\n| EIB          |   2022 |         3 | Return On Equity |   0.050865   |\n| EIB          |   2022 |         3 | Return On Equity |   0.050865   |\n| EIB          |   2022 |         3 | Return On Equity |   0.050865   |\n| EIB          |   2022 |         4 | Return On Equity |   0.0197067  |\n| EIB          |   2022 |         4 | Return On Equity |   0.0197067  |\n| EIB          |   2022 |         4 | Return On Equity |   0.0197067  |\n| EIB          |   2023 |         1 | Return On Equity |   0.0329119  |\n| EIB          |   2023 |         1 | Return On Equity |   0.0329119  |\n| EIB          |   2023 |         1 | Return On Equity |   0.0329119  |\n| EIB          |   2023 |         2 | Return On Equity |   0.0197283  |\n| EIB          |   2023 |         2 | Return On Equity |   0.0197283  |\n| EIB          |   2023 |         2 | Return On Equity |   0.0197283  |\n| EIB          |   2023 |         3 | Return On Equity |   0.0111711  |\n| EIB          |   2023 |         3 | Return On Equity |   0.0111711  |\n| EIB          |   2023 |         3 | Return On Equity |   0.0111711  |\n| MBB          |   2020 |         1 | Return On Equity |   0.0405342  |\n| MBB          |   2020 |         1 | Return On Equity |   0.0405342  |\n| MBB          |   2020 |         2 | Return On Equity |   0.0521778  |\n| MBB          |   2020 |         2 | Return On Equity |   0.0521778  |\n| MBB          |   2020 |         3 | Return On Equity |   0.0502199  |\n| MBB          |   2020 |         3 | Return On Equity |   0.0502199  |\n| MBB          |   2020 |         4 | Return On Equity |   0.0401243  |\n| MBB          |   2020 |         4 | Return On Equity |   0.0401243  |\n| MBB          |   2021 |         1 | Return On Equity |   0.0682441  |\n| MBB          |   2021 |         1 | Return On Equity |   0.0682441  |\n| MBB          |   2021 |         2 | Return On Equity |   0.0488157  |\n| MBB          |   2021 |         2 | Return On Equity |   0.0488157  |\n| MBB          |   2021 |         3 | Return On Equity |   0.0530561  |\n| MBB          |   2021 |         3 | Return On Equity |   0.0530561  |\n| MBB          |   2021 |         4 | Return On Equity |   0.0592516  |\n| MBB          |   2021 |         4 | Return On Equity |   0.0592516  |\n| MBB          |   2022 |         1 | Return On Equity |   0.0704771  |\n| MBB          |   2022 |         1 | Return On Equity |   0.0704771  |\n| MBB          |   2022 |         2 | Return On Equity |   0.0676073  |\n| MBB          |   2022 |         2 | Return On Equity |   0.0676073  |\n| MBB          |   2022 |         3 | Return On Equity |   0.0663274  |\n| MBB          |   2022 |         3 | Return On Equity |   0.0663274  |\n| MBB          |   2022 |         4 | Return On Equity |   0.0452189  |\n| MBB          |   2022 |         4 | Return On Equity |   0.0452189  |\n| MBB          |   2023 |         1 | Return On Equity |   0.0614098  |\n| MBB          |   2023 |         1 | Return On Equity |   0.0614098  |\n| MBB          |   2023 |         2 | Return On Equity |   0.0578888  |\n| MBB          |   2023 |         2 | Return On Equity |   0.0578888  |\n| MBB          |   2023 |         3 | Return On Equity |   0.063432   |\n| MBB          |   2023 |         3 | Return On Equity |   0.063432   |\n| OCB    ",
        "code_response": [
            {
                "language": "sql",
                "code": "-- Step 1: Identify stock codes and subsidiaries\nWITH target_companies AS (\n  SELECT stock_code\n  FROM company_info\n  WHERE stock_code IN ('VCB', 'TCB', 'ACB')\n)\nSELECT \n  tc.stock_code AS parent_stock_code,\n  ssh.invest_on AS subsidiary_stock_code\nFROM \n  target_companies tc\n  LEFT JOIN sub_and_shareholder ssh ON tc.stock_code = ssh.stock_code\nUNION ALL\nSELECT \n  stock_code AS parent_stock_code,\n  NULL AS subsidiary_stock_code\nFROM \n  target_companies\nLIMIT 100;\n"
            },
            {
                "language": "sql",
                "code": "-- Step 2: Extract pre-calculated Return on Equity (ROE) values\nWITH target_companies AS (\n  SELECT stock_code\n  FROM company_info\n  WHERE stock_code IN ('VCB', 'TCB', 'ACB')\n),\ntarget_subsidaries AS (\n  SELECT ssh.invest_on AS stock_code\n  FROM sub_and_shareholder ssh\n  WHERE ssh.stock_code IN ('VCB', 'TCB', 'ACB')\n  UNION ALL\n  SELECT stock_code\n  FROM target_companies\n),\ntarget_stock_codes AS (\n  SELECT stock_code FROM target_subsidaries\n)\nSELECT \n  fr.stock_code,\n  fr.year,\n  fr.quarter,\n  mcr.ratio_name,\n  fr.data AS roe_value\nFROM \n  financial_ratio fr\n  INNER JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\n  INNER JOIN target_stock_codes tsc ON fr.stock_code = tsc.stock_code\nWHERE \n  mcr.ratio_name = 'Return On Equity'\n  AND ((fr.year BETWEEN 2020 AND 2023 AND fr.quarter!= 0) OR (fr.year = 2024 AND fr.quarter = 2))\nORDER BY \n  fr.stock_code, fr.year, fr.quarter\nLIMIT 100;\n"
            },
            {
                "language": "sql",
                "code": "WITH target_companies AS (\n  SELECT stock_code\n  FROM company_info\n  WHERE stock_code IN ('VCB', 'TCB', 'ACB')\n),\ntarget_subsidaries AS (\n  SELECT ssh.invest_on AS stock_code\n  FROM sub_and_shareholder ssh\n  WHERE ssh.stock_code IN ('VCB', 'TCB', 'ACB')\n  UNION ALL\n  SELECT stock_code\n  FROM target_companies\n),\ntarget_stock_codes AS (\n  SELECT stock_code FROM target_subsidaries\n),\nidentified_stock_codes AS (\n  SELECT \n    tc.stock_code AS parent_stock_code,\n    ssh.invest_on AS subsidiary_stock_code\n  FROM \n    target_companies tc\n    LEFT JOIN sub_and_shareholder ssh ON tc.stock_code = ssh.stock_code\n  UNION ALL\n  SELECT \n    stock_code AS parent_stock_code,\n    NULL AS subsidiary_stock_code\n  FROM \n    target_companies\n)\nSELECT \n  fr.stock_code,\n  fr.year,\n  fr.quarter,\n  mcr.ratio_name,\n  fr.data AS roe_value\nFROM \n  financial_ratio fr\n  INNER JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\n  INNER JOIN identified_stock_codes isc ON fr.stock_code = isc.parent_stock_code OR fr.stock_code = isc.subsidiary_stock_code\nWHERE \n  mcr.ratio_name = 'Return On Equity'\n  AND ((fr.year BETWEEN 2020 AND 2023 AND fr.quarter!= 0) OR (fr.year = 2024 AND fr.quarter = 2))\nORDER BY \n  fr.stock_code, fr.year, fr.quarter\nLIMIT 100;\n"
            }
        ],
        "time": 89.45830821990967,
        "evaluate": 0,
        "input_token": 6178,
        "output_token": 969
    },
    {
        "id": "360e3adc-d07d-4357-9c84-5526619e7f5f",
        "question": "How has the Net Profit Margin of Vinamilk, Masan Group, and other companies with significant investments in subsidiaries evolved from 2020 to Q2 2024?  Analyze this considering the profitability contributions from their subsidiaries.",
        "answer": "Table 1\n| stock_code   | en_company_name   | year   | quarter   | net_profit_margin   |\n|--------------|-------------------|--------|-----------|---------------------|\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    fr.stock_code,\n    ci.en_company_name,\n    fr.year,\n    fr.quarter,\n    fr.data AS net_profit_margin\nFROM \n    financial_ratio fr\nJOIN \n    map_category_code_ratio mccr ON fr.ratio_code = mccr.ratio_code\nJOIN \n    company_info ci ON fr.stock_code = ci.stock_code\nLEFT JOIN \n    sub_and_shareholder ss ON ci.stock_code = ss.stock_code\nWHERE \n    mccr.ratio_name = 'Net profit margin'\n    AND (ci.stock_code = 'VNM' OR ci.stock_code = 'MSN' OR ss.stock_code IS NOT NULL)\n    AND fr.year BETWEEN 2020 AND 2024\n    AND (fr.quarter = 0 OR (fr.year = 2024 AND fr.quarter = 2))\nORDER BY \n    fr.stock_code, fr.year, fr.quarter;\n"
            }
        ],
        "score": 1,
        "difficulty": 3,
        "response": "Table 1\n| stock_code   | subsidiary   |\n|:-------------|:-------------|\n| VNM          | TDW          |\n| VNM          | SRF          |\n| VNM          | SBT          |\n| VNM          | MCM          |\n| VNM          | VLC          |\n| MSN          | CMF          |\n| MSN          | MML          |\n| MSN          | VSN          |\n| MSN          | QHW          |\n| MSN          | VCF          |\n| MSN          | MCH          |\n| MSN          | MSR          |\n| MSN          | TCB          |\n\nTable 2\n| company_code   | year   | quarter   | net_profit_margin   |\n|----------------|--------|-----------|---------------------|\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "WITH target_companies AS (\n  SELECT stock_code\n  FROM company_info\n  WHERE stock_code IN ('VNM', 'MSN')\n  UNION ALL\n  SELECT stock_code\n  FROM company_info\n  WHERE issue_share > (SELECT AVG(issue_share) FROM company_info)\n),\nsubsidaries AS (\n  SELECT \n    tc.stock_code AS parent_company,\n    ssh.invest_on AS subsidiary\n  FROM \n    target_companies tc\n    LEFT JOIN sub_and_shareholder ssh ON tc.stock_code = ssh.stock_code\n),\nnpm_filter AS (\n  SELECT ratio_code\n  FROM map_category_code_ratio\n  WHERE ratio_name = 'Net profit margin'\n),\ncompany_list AS (\n  SELECT stock_code AS company_code FROM target_companies\n  UNION\n  SELECT subsidiary AS company_code FROM subsidaries WHERE subsidiary IS NOT NULL\n)\nSELECT \n  cl.company_code,\n  fr.year,\n  fr.quarter,\n  fr.data AS net_profit_margin\nFROM \n  financial_ratio fr\n  INNER JOIN npm_filter nf ON fr.ratio_code = nf.ratio_code\n  INNER JOIN company_list cl ON fr.stock_code = cl.company_code\nWHERE \n  fr.year BETWEEN 2020 AND 2024\n  AND (fr.quarter = 0 OR (fr.year = 2024 AND fr.quarter = 2))\nLIMIT 100;\n"
            }
        ],
        "time": 127.42932176589966,
        "evaluate": 0,
        "input_token": 8881,
        "output_token": 1923
    },
    {
        "id": "2021f2a2-50f4-49c3-8242-38373e361aa0",
        "question": "What is the trend of total assets and total liabilities for Vietcombank, Techcombank, and VPBank from 2020 to Q2 2024, broken down by the assets and liabilities of their subsidiaries and other investments?",
        "answer": "Table 1\n| stock_code   |   year |   quarter | category          |   bank_data |   subsidiary_data |\n|:-------------|-------:|----------:|:------------------|------------:|------------------:|\n| TCB          |   2020 |         0 | Total assets      | 4.39603e+08 |                 0 |\n| TCB          |   2020 |         0 | Total liabilities | 3.64988e+08 |                 0 |\n| TCB          |   2021 |         0 | Total assets      | 5.68729e+08 |                 0 |\n| TCB          |   2021 |         0 | Total liabilities | 4.75687e+08 |                 0 |\n| TCB          |   2022 |         0 | Total assets      | 6.99033e+08 |                 0 |\n| TCB          |   2022 |         0 | Total liabilities | 5.85608e+08 |                 0 |\n| TCB          |   2023 |         0 | Total assets      | 8.49482e+08 |                 0 |\n| TCB          |   2023 |         0 | Total liabilities | 7.17866e+08 |                 0 |\n| TCB          |   2024 |         2 | Total assets      | 9.08307e+08 |                 0 |\n| TCB          |   2024 |         2 | Total liabilities | 7.69755e+08 |                 0 |\n| VCB          |   2020 |         0 | Total assets      | 1.32623e+09 |                 0 |\n| VCB          |   2020 |         0 | Total liabilities | 1.23214e+09 |                 0 |\n| VCB          |   2021 |         0 | Total assets      | 1.41467e+09 |                 0 |\n| VCB          |   2021 |         0 | Total liabilities | 1.30556e+09 |                 0 |\n| VCB          |   2022 |         0 | Total assets      | 1.81382e+09 |                 0 |\n| VCB          |   2022 |         0 | Total liabilities | 1.67817e+09 |                 0 |\n| VCB          |   2023 |         0 | Total assets      | 1.83961e+09 |                 0 |\n| VCB          |   2023 |         0 | Total liabilities | 1.6746e+09  |                 0 |\n| VPB          |   2020 |         0 | Total assets      | 4.19027e+08 |                 0 |\n| VPB          |   2020 |         0 | Total liabilities | 3.66233e+08 |                 0 |\n| VPB          |   2021 |         0 | Total assets      | 5.47409e+08 |                 0 |\n| VPB          |   2021 |         0 | Total liabilities | 4.61131e+08 |                 0 |\n| VPB          |   2022 |         0 | Total assets      | 6.31013e+08 |                 0 |\n| VPB          |   2022 |         0 | Total liabilities | 5.27511e+08 |                 0 |\n| VPB          |   2023 |         0 | Total assets      | 8.17567e+08 |                 0 |\n| VPB          |   2023 |         0 | Total liabilities | 6.77771e+08 |                 0 |\n| VPB          |   2024 |         2 | Total assets      | 8.64392e+08 |                 0 |\n| VPB          |   2024 |         2 | Total liabilities | 7.26325e+08 |                 0 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "WITH bank_assets_liabilities AS (\n    SELECT\n        stock_code,\n        year,\n        quarter,\n        category_code,\n        data\n    FROM\n        bank_financial_report\n    WHERE\n        stock_code IN ('VCB', 'TCB', 'VPB')\n        AND category_code IN ('BS_300', 'BS_400') -- Total assets and total liabilities\n        AND ((year BETWEEN 2020 AND 2024) AND (quarter = 0 OR (year = 2024 AND quarter = 2)))\n),\nsubsidiary_investments AS (\n    SELECT\n        ss.stock_code,\n        ss.invest_on,\n        bf.year,\n        bf.quarter,\n        bf.category_code,\n        bf.data\n    FROM\n        sub_and_shareholder ss\n    JOIN\n        bank_financial_report bf ON ss.invest_on = bf.stock_code\n    WHERE\n        ss.stock_code IN ('VCB', 'TCB', 'VPB')\n        AND bf.category_code IN ('BS_211', 'BS_213', 'BS_214') -- Investments in subsidiaries and other entities\n        AND ((bf.year BETWEEN 2020 AND 2024) AND (bf.quarter = 0 OR (bf.year = 2024 AND bf.quarter = 2)))\n)\nSELECT\n    ba.stock_code,\n    ba.year,\n    ba.quarter,\n    mc.en_caption AS category,\n    ba.data AS bank_data,\n    COALESCE(SUM(si.data), 0) AS subsidiary_data\nFROM\n    bank_assets_liabilities ba\nJOIN\n    map_category_code_bank mc ON ba.category_code = mc.category_code\nLEFT JOIN\n    subsidiary_investments si ON ba.stock_code = si.stock_code AND ba.year = si.year AND ba.quarter = si.quarter AND ba.category_code = si.category_code\nGROUP BY\n    ba.stock_code, ba.year, ba.quarter, mc.en_caption, ba.data\nORDER BY\n    ba.stock_code, ba.year, ba.quarter, mc.en_caption;\n"
            }
        ],
        "score": 1,
        "difficulty": 4,
        "response": "Table 1\n| stock_code   | subsidiary   |\n|:-------------|:-------------|\n| VCB          | PGI          |\n| VCB          | EIB          |\n| VCB          | MBB          |\n| VCB          | HVN          |\n| VCB          | PVD          |\n| VCB          | OCB          |\n| VPB          | SGP          |\n| VPB          | FDC          |\n| TCB          | VCG          |\n| TCB          | HVN          |\n| VCB          | EIB          |\n| VCB          | MBB          |\n| VCB          | OCB          |\n\nTable 2\n| bank_stock_code   | subsidiary   |   year |   quarter |   total_assets |   total_liabilities |\n|:------------------|:-------------|-------:|----------:|---------------:|--------------------:|\n| TCB               | HVN          |   2020 |         1 |    3.91808e+08 |         3.27217e+08 |\n| TCB               | HVN          |   2020 |         2 |    3.95861e+08 |         3.28432e+08 |\n| TCB               | HVN          |   2020 |         3 |    4.01462e+08 |         3.30853e+08 |\n| TCB               | HVN          |   2020 |         4 |    4.39603e+08 |         3.64988e+08 |\n| TCB               | HVN          |   2021 |         1 |    4.62823e+08 |         3.8373e+08  |\n| TCB               | HVN          |   2021 |         2 |    5.04304e+08 |         4.20403e+08 |\n| TCB               | HVN          |   2021 |         3 |    5.41635e+08 |         4.53251e+08 |\n| TCB               | HVN          |   2021 |         4 |    5.68811e+08 |         4.75756e+08 |\n| TCB               | HVN          |   2022 |         1 |    6.1527e+08  |         5.16684e+08 |\n| TCB               | HVN          |   2022 |         2 |    6.23745e+08 |         5.19272e+08 |\n| TCB               | HVN          |   2022 |         3 |    6.71354e+08 |         5.61454e+08 |\n| TCB               | HVN          |   2022 |         4 |    6.99033e+08 |         5.85608e+08 |\n| TCB               | HVN          |   2023 |         1 |    7.23518e+08 |         6.05552e+08 |\n| TCB               | HVN          |   2023 |         2 |    7.3247e+08  |         6.10005e+08 |\n| TCB               | HVN          |   2023 |         3 |    7.81279e+08 |         6.54149e+08 |\n| TCB               | HVN          |   2023 |         4 |    8.18107e+08 |         7.00639e+08 |\n| TCB               | HVN          |   2024 |         1 |    8.85653e+08 |         7.47781e+08 |\n| TCB               | HVN          |   2024 |         2 |    9.08307e+08 |         7.69755e+08 |\n| TCB               | VCG          |   2020 |         1 |    3.91808e+08 |         3.27217e+08 |\n| TCB               | VCG          |   2020 |         2 |    3.95861e+08 |         3.28432e+08 |\n| TCB               | VCG          |   2020 |         3 |    4.01462e+08 |         3.30853e+08 |\n| TCB               | VCG          |   2020 |         4 |    4.39603e+08 |         3.64988e+08 |\n| TCB               | VCG          |   2021 |         1 |    4.62823e+08 |         3.8373e+08  |\n| TCB               | VCG          |   2021 |         2 |    5.04304e+08 |         4.20403e+08 |\n| TCB               | VCG          |   2021 |         3 |    5.41635e+08 |         4.53251e+08 |\n| TCB               | VCG          |   2021 |         4 |    5.68811e+08 |         4.75756e+08 |\n| TCB               | VCG          |   2022 |         1 |    6.1527e+08  |         5.16684e+08 |\n| TCB               | VCG          |   2022 |         2 |    6.23745e+08 |         5.19272e+08 |\n| TCB               | VCG          |   2022 |         3 |    6.71354e+08 |         5.61454e+08 |\n| TCB               | VCG          |   2022 |         4 |    6.99033e+08 |         5.85608e+08 |\n| TCB               | VCG          |   2023 |         1 |    7.23518e+08 |         6.05552e+08 |\n| TCB               | VCG          |   2023 |         2 |    7.3247e+08  |         6.10005e+08 |\n| TCB               | VCG          |   2023 |         3 |    7.81279e+08 |         6.54149e+08 |\n| TCB               | VCG          |   2023 |         4 |    8.18107e+08 |         7.00639e+08 |\n| TCB               | VCG          |   2024 |         1 |    8.85653e+08 |         7.47781e+08 |\n| TCB               | VCG          |   2024 |         2 |    9.08307e+08 |         7.69755e+08 |\n| VCB               | EIB          |   2020 |         1 |    2.28854e+09 |         2.1184e+09  |\n| VCB               | EIB          |   2020 |         2 |    2.37052e+09 |         2.19137e+09 |\n| VCB               | EIB          |   2020 |         3 |    2.37714e+09 |         2.18999e+09 |\n| VCB               | EIB          |   2020 |         4 |    2.65507e+09 |         2.45736e+09 |\n| VCB               | EIB          |   2021 |         1 |    2.55793e+09 |         2.35592e+09 |\n| VCB               | EIB          |   2021 |         2 |    2.60727e+09 |         2.3974e+09  |\n| VCB               | EIB          |   2021 |         3 |    2.77047e+09 |         2.55142e+09 |\n| VCB               | EIB          |   2021 |         4 |    2.82953e+09 |         2.60719e+09 |\n| VCB               | EIB          |   2022 |         1 |    2.9255e+09  |         2.69134e+09 |\n| VCB               | EIB          |   2022 |         2 |    3.20478e+09 |         2.9588e+09  |\n| VCB               | EIB          |   2022 |         3 |    3.29933e+09 |         3.04255e+09 |\n| VCB               | EIB          |   2022 |         4 |    3.62838e+09 |         3.3524e+09  |\n| VCB               | EIB          |   2023 |         1 |    3.69286e+09 |         3.40355e+09 |\n| VCB               | EIB          |   2023 |         2 |    3.40855e+09 |         3.10454e+09 |\n| VCB               | EIB          |   2023 |         3 |    3.46261e+09 |         3.14412e+09 |\n| VCB               | EIB          |   2023 |         4 |    3.67845e+09 |         3.34136e+09 |\n| VCB               | EIB          |   2024 |         1 |    3.54743e+09 |         3.2002e+09  |\n| VCB               | HVN          |   2020 |         1 |    1.14427e+09 |         1.0592e+09  |\n| VCB               | HVN          |   2020 |         2 |    1.18526e+09 |         1.09568e+09 |\n| VCB               | HVN          |   2020 |         3 |    1.18857e+09 |         1.095e+09   |\n| VCB               | HVN          |   2020 |         4 |    1.32754e+09 |         1.22868e+09 |\n| VCB               | HVN          |   2021 |         1 |    1.27897e+09 |         1.17796e+09 |\n| VCB               | HVN          |   2021 |         2 |    1.30363e+09 |         1.1987e+09  |\n| VCB               | HVN          |   2021 |         3 |    1.38524e+09 |         1.27571e+09 |\n| VCB               | HVN          |   2021 |         4 |    1.41477e+09 |         1.30359e+09 |\n| VCB               | HVN          |   2022 |         1 |    1.46275e+09 |         1.34567e+09 |\n| VCB               | HVN          |   2022 |         2 |    1.60239e+09 |         1.4794e+09  |\n| VCB               | HVN          |   2022 |         3 |    1.64966e+09 |         1.52127e+09 |\n| VCB               | HVN          |   2022 |         4 |    1.81419e+09 |         1.6762e+09  |\n| VCB               | HVN          |   2023 |         1 |    1.84643e+09 |         1.70177e+09 |\n| VCB               | HVN          |   2023 |         2 |    1.70427e+09 |         1.55227e+09 |\n| VCB               | HVN          |   2023 |         3 |    1.73131e+09 |         1.57206e+09 |\n| VCB               | HVN          |   2023 |         4 |    1.83922e+09 |         1.67068e+09 |\n| VCB               | HVN          |   2024 |         1 |    1.77371e+09 |         1.6001e+09  |\n| VCB               | MBB          |   2020 |         1 |    2.28854e+09 |         2.1184e+09  |\n| VCB               | MBB          |   2020 |         2 |    2.37052e+09 |         2.19137e+09 |\n| VCB               | MBB          |   2020 |         3 |    2.37714e+09 |         2.18999e+09 |\n| VCB               | MBB          |   2020 |         4 |    2.65507e+09 |         2.45736e+09 |\n| VCB               | MBB          |   2021 |         1 |    2.55793e+09 |         2.35592e+09 |\n| VCB               | MBB         ",
        "code_response": [
            {
                "language": "sql",
                "code": "-- Step 1: Identify stock codes and retrieve subsidiary information\nWITH target_banks AS (\n  SELECT stock_code\n  FROM company_info\n  WHERE stock_code IN ('VCB', 'TCB', 'VPB')\n)\nSELECT \n  tb.stock_code,\n  ssh.invest_on AS subsidiary\nFROM target_banks tb\nLEFT JOIN sub_and_shareholder ssh ON tb.stock_code = ssh.stock_code\nLIMIT 100;  -- Add limit as per the note\n"
            },
            {
                "language": "sql",
                "code": "-- Step 2: Extract quarterly total assets and total liabilities\nWITH target_banks AS (\n  SELECT stock_code\n  FROM company_info\n  WHERE stock_code IN ('VCB', 'TCB', 'VPB')\n),\nsubsidiaries AS (\n  SELECT \n    tb.stock_code,\n    ssh.invest_on AS subsidiary\n  FROM target_banks tb\n  LEFT JOIN sub_and_shareholder ssh ON tb.stock_code = ssh.stock_code\n)\nSELECT \n  COALESCE(sb.stock_code, bfr.stock_code) AS bank_stock_code,\n  COALESCE(sb.subsidiary, 'N/A') AS subsidiary,\n  bfr.year,\n  bfr.quarter,\n  -- Assuming BS_300 for Total Assets and BS_400 for Total Liabilities based on map_category_code_bank\n  SUM(CASE WHEN bfr.category_code = 'BS_300' THEN bfr.data ELSE 0 END) AS total_assets,\n  SUM(CASE WHEN bfr.category_code = 'BS_400' THEN bfr.data ELSE 0 END) AS total_liabilities\nFROM bank_financial_report bfr\nLEFT JOIN subsidiaries sb ON bfr.stock_code = sb.stock_code OR bfr.stock_code = sb.subsidiary\nWHERE bfr.stock_code IN ('VCB', 'TCB', 'VPB')  -- Include subsidiaries if any\n  AND bfr.year BETWEEN 2020 AND 2024\n  AND bfr.quarter IN (1, 2, 3, 4)  -- Exclude Q0 (yearly data)\nGROUP BY \n  COALESCE(sb.stock_code, bfr.stock_code),\n  COALESCE(sb.subsidiary, 'N/A'),\n  bfr.year,\n  bfr.quarter\nORDER BY \n  bank_stock_code,\n  subsidiary,\n  year,\n  quarter\nLIMIT 100;  -- Add limit as per the note\n"
            },
            {
                "language": "sql",
                "code": "-- Combined Query (Essentially Step 2 with Step 1 as CTE)\nWITH target_banks AS (\n  SELECT stock_code\n  FROM company_info\n  WHERE stock_code IN ('VCB', 'TCB', 'VPB')\n),\nsubsidiaries AS (\n  SELECT \n    tb.stock_code,\n    ssh.invest_on AS subsidiary\n  FROM target_banks tb\n  LEFT JOIN sub_and_shareholder ssh ON tb.stock_code = ssh.stock_code\n)\nSELECT \n  COALESCE(sb.stock_code, bfr.stock_code) AS bank_stock_code,\n  COALESCE(sb.subsidiary, 'N/A') AS subsidiary,\n  bfr.year,\n  bfr.quarter,\n  -- Assuming BS_300 for Total Assets and BS_400 for Total Liabilities based on map_category_code_bank\n  SUM(CASE WHEN bfr.category_code = 'BS_300' THEN bfr.data ELSE 0 END) AS total_assets,\n  SUM(CASE WHEN bfr.category_code = 'BS_400' THEN bfr.data ELSE 0 END) AS total_liabilities\nFROM bank_financial_report bfr\nLEFT JOIN subsidiaries sb ON bfr.stock_code = sb.stock_code OR bfr.stock_code = sb.subsidiary\nWHERE bfr.stock_code IN ('VCB', 'TCB', 'VPB')  -- Include subsidiaries if any\n  AND bfr.year BETWEEN 2020 AND 2024\n  AND bfr.quarter IN (1, 2, 3, 4)  -- Exclude Q0 (yearly data)\nGROUP BY \n  COALESCE(sb.stock_code, bfr.stock_code),\n  COALESCE(sb.subsidiary, 'N/A'),\n  bfr.year,\n  bfr.quarter\nORDER BY \n  bank_stock_code,\n  subsidiary,\n  year,\n  quarter\nLIMIT 100;  -- Add limit as per the note\n"
            }
        ],
        "time": 72.66064763069153,
        "evaluate": 0,
        "input_token": 6814,
        "output_token": 2773
    },
    {
        "id": "2bd167d2-27c8-45cc-bf1a-c5bf42eb5ec9",
        "question": "What is the Return on Equity (ROE) for Vinamilk and Masan Group for the fiscal year 2023?",
        "answer": "Table 1\n| stock_code   |       roe |\n|:-------------|----------:|\n| MSN          | 0.0489033 |\n| VNM          | 0.257506  |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT stock_code, data AS ROE\nFROM financial_ratio\nWHERE ratio_code = 'ROE'\n  AND stock_code IN ('VNM', 'MSN')\n  AND year = 2023\n  AND quarter = 0;\n"
            }
        ],
        "score": 1,
        "difficulty": 1,
        "response": "Table 1\n| stock_code   | industry           |   year |   quarter | ratio_name       |   roe_value |\n|:-------------|:-------------------|-------:|----------:|:-----------------|------------:|\n| VNM          | Food and Beverages |   2023 |         0 | Return On Equity |   0.257506  |\n| MSN          | Food and Beverages |   2023 |         0 | Return On Equity |   0.0489033 |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT \n  fr.stock_code,\n  ci.industry,\n  fr.year,\n  fr.quarter,\n  mcr.ratio_name,\n  fr.data AS ROE_Value\nFROM \n  financial_ratio fr\n  INNER JOIN company_info ci ON fr.stock_code = ci.stock_code\n  INNER JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\nWHERE \n  fr.stock_code IN ('VNM', 'MSN')\n  AND fr.year = 2023\n  AND fr.quarter = 0\n  AND mcr.ratio_code = 'ROE'\nLIMIT 100;\n"
            }
        ],
        "time": 28.554114818572998,
        "evaluate": 0.5,
        "input_token": 0,
        "output_token": 0
    },
    {
        "id": "b7305bbf-5414-4848-8c0d-223f54960820",
        "question": "Rank the top 5 companies with total assets greater than 100,000 billion VND as of December 31, 2023, based on their Return on Equity (ROE).",
        "answer": "Table 1\n| stock_code   | industry   |      roe |\n|:-------------|:-----------|---------:|\n| HDB          | Banking    | 0.232433 |\n| ACB          | Banking    | 0.226122 |\n| VIB          | Banking    | 0.225702 |\n| MBB          | Banking    | 0.217698 |\n| VCB          | Banking    | 0.200315 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "WITH total_assets AS (\n    SELECT stock_code, data AS total_assets\n    FROM bank_financial_report\n    WHERE category_code = 'BS_300' AND year = 2023 AND quarter = 0\n    UNION ALL\n    SELECT stock_code, data AS total_assets\n    FROM non_bank_financial_report\n    WHERE category_code = 'BS_270' AND year = 2023 AND quarter = 0\n    UNION ALL\n    SELECT stock_code, data AS total_assets\n    FROM securities_financial_report\n    WHERE category_code = 'BS_270' AND year = 2023 AND quarter = 0\n),\nfiltered_companies AS (\n    SELECT stock_code\n    FROM total_assets\n    WHERE total_assets > 100000000\n),\nroe_data AS (\n    SELECT stock_code, data AS roe\n    FROM financial_ratio\n    WHERE ratio_code = 'ROE' AND year = 2023 AND quarter = 0\n)\nSELECT ci.stock_code, ci.industry, roe_data.roe\nFROM filtered_companies fc\nJOIN roe_data ON fc.stock_code = roe_data.stock_code\nJOIN company_info ci ON fc.stock_code = ci.stock_code\nORDER BY roe_data.roe DESC\nLIMIT 5;\n"
            }
        ],
        "score": 1,
        "difficulty": 3,
        "response": "Table 1\n| stock_code   |\n|--------------|\n\nTable 2\n| stock_code   | roe_value   |\n|--------------|-------------|\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "WITH total_assets AS (\n  SELECT \n    'bank' AS company_type,\n    bfr.stock_code,\n    bfr.data AS total_asset_value\n  FROM \n    bank_financial_report bfr\n  INNER JOIN \n    map_category_code_bank mccb ON bfr.category_code = mccb.category_code\n  WHERE \n    bfr.year = 2023 AND bfr.quarter = 0 AND mccb.en_caption = 'Total assets' AND mccb.category_code = 'BS_300'\n\n  UNION ALL\n\n  SELECT \n    'non_bank' AS company_type,\n    nbfr.stock_code,\n    nbfr.data AS total_asset_value\n  FROM \n    non_bank_financial_report nbfr\n  INNER JOIN \n    map_category_code_non_bank mccnb ON nbfr.category_code = mccnb.category_code\n  WHERE \n    nbfr.year = 2023 AND nbfr.quarter = 0 AND mccnb.en_caption = 'TOTAL ASSETS' AND mccnb.category_code = 'BS_270'\n\n  UNION ALL\n\n  SELECT \n    'securities' AS company_type,\n    sfr.stock_code,\n    sfr.data AS total_asset_value\n  FROM \n    securities_financial_report sfr\n  INNER JOIN \n    map_category_code_securities mccs ON sfr.category_code = mccs.category_code\n  WHERE \n    sfr.year = 2023 AND sfr.quarter = 0 AND mccs.en_caption = 'TOTAL ASSETS' AND mccs.category_code = 'BS_270'\n),\nidentified_companies AS (\n  SELECT \n    stock_code\n  FROM \n    total_assets\n  WHERE \n    total_asset_value > 100000000000000  -- 100,000 billion VND\n),\nroe_values AS (\n  SELECT \n    ic.stock_code,\n    fr.data AS roe_value\n  FROM \n    identified_companies ic\n  INNER JOIN \n    financial_ratio fr ON ic.stock_code = fr.stock_code\n  INNER JOIN \n    map_category_code_ratio mccr ON fr.ratio_code = mccr.ratio_code\n  WHERE \n    mccr.ratio_name = 'Return On Equity' AND fr.year = 2023 AND fr.quarter = 0\n)\nSELECT \n  stock_code,\n  roe_value\nFROM \n  roe_values\nWHERE \n  roe_value IS NOT NULL  -- Ensure we're ranking valid ROE values\nORDER BY \n  roe_value DESC\nLIMIT 5;\n"
            }
        ],
        "time": 86.87991690635681,
        "evaluate": 0,
        "input_token": 3104,
        "output_token": 707
    },
    {
        "id": "15ce94fa-2646-4432-b91e-8ef1497dda44",
        "question": "For the period 2020-Q2 2024, provide the year-over-year change in the return on equity (ROE) for Vinamilk, Masan Group, and Hoa Phat Group,  separately showing the impact of their subsidiaries and investments on their overall ROE.",
        "answer": "Table 1\n| main_company   |   year |   quarter |   main_company_roe | subsidiary_code   |   subsidiary_roe |\n|:---------------|-------:|----------:|-------------------:|:------------------|-----------------:|\n| HPG            |   2020 |         2 |         0.0524064  |                   |      nan         |\n| HPG            |   2020 |         3 |         0.0688363  |                   |      nan         |\n| HPG            |   2020 |         4 |         0.0787021  |                   |      nan         |\n| HPG            |   2021 |         0 |         0.380268   |                   |      nan         |\n| HPG            |   2021 |         1 |         0.10579    |                   |      nan         |\n| HPG            |   2021 |         2 |         0.131719   |                   |      nan         |\n| HPG            |   2021 |         3 |         0.122748   |                   |      nan         |\n| HPG            |   2021 |         4 |         0.0817293  |                   |      nan         |\n| HPG            |   2022 |         0 |         0.0878594  |                   |      nan         |\n| HPG            |   2022 |         1 |         0.0829275  |                   |      nan         |\n| HPG            |   2022 |         2 |         0.0402598  |                   |      nan         |\n| HPG            |   2022 |         3 |        -0.0182075  |                   |      nan         |\n| HPG            |   2022 |         4 |        -0.020796   |                   |      nan         |\n| HPG            |   2023 |         0 |         0.0661282  |                   |      nan         |\n| HPG            |   2023 |         1 |         0.00397384 |                   |      nan         |\n| HPG            |   2023 |         2 |         0.0147948  |                   |      nan         |\n| HPG            |   2023 |         3 |         0.0200306  |                   |      nan         |\n| HPG            |   2023 |         4 |         0.0288708  |                   |      nan         |\n| HPG            |   2024 |         1 |         0.027164   |                   |      nan         |\n| HPG            |   2024 |         2 |         0.0305454  |                   |      nan         |\n| MSN            |   2020 |         2 |         0.00174282 | TCB               |        0.0428449 |\n| MSN            |   2020 |         3 |         0.0340108  | TCB               |        0.0450409 |\n| MSN            |   2020 |         4 |         0.0233474  | TCB               |        0.0537099 |\n| MSN            |   2021 |         0 |         0.238597   | TCB               |        0.197927  |\n| MSN            |   2021 |         1 |         0.0134906  | TCB               |        0.0565945 |\n| MSN            |   2021 |         2 |         0.0335106  | TCB               |        0.0572896 |\n| MSN            |   2021 |         3 |         0.0490112  | TCB               |        0.0501452 |\n| MSN            |   2021 |         4 |         0.168149   | TCB               |        0.0503334 |\n| MSN            |   2022 |         0 |         0.129771   | TCB               |        0.180176  |\n| MSN            |   2022 |         1 |         0.0515801  | TCB               |        0.0569507 |\n| MSN            |   2022 |         2 |         0.0313142  | TCB               |        0.0562806 |\n| MSN            |   2022 |         3 |         0.0236221  | TCB               |        0.0488406 |\n| MSN            |   2022 |         4 |         0.021933   | TCB               |        0.031493  |\n| MSN            |   2023 |         0 |         0.0489033  | TCB               |        0.139608  |\n| MSN            |   2023 |         1 |         0.0118431  | TCB               |        0.0384612 |\n| MSN            |   2023 |         2 |         0.0114376  | TCB               |        0.0367734 |\n| MSN            |   2023 |         3 |         0.0127258  | TCB               |        0.0367239 |\n| MSN            |   2023 |         4 |         0.013515   | TCB               |        0.0381519 |\n| MSN            |   2024 |         1 |         0.0123309  | TCB               |        0.0459854 |\n| VNM            |   2020 |         2 |         0.095333   |                   |      nan         |\n| VNM            |   2020 |         3 |         0.0990225  |                   |      nan         |\n| VNM            |   2020 |         4 |         0.0664599  |                   |      nan         |\n| VNM            |   2021 |         0 |         0.296583   |                   |      nan         |\n| VNM            |   2021 |         1 |         0.0764615  |                   |      nan         |\n| VNM            |   2021 |         2 |         0.0832651  |                   |      nan         |\n| VNM            |   2021 |         3 |         0.0874017  |                   |      nan         |\n| VNM            |   2021 |         4 |         0.0617182  |                   |      nan         |\n| VNM            |   2022 |         0 |         0.26138    |                   |      nan         |\n| VNM            |   2022 |         1 |         0.06528    |                   |      nan         |\n| VNM            |   2022 |         2 |         0.057095   |                   |      nan         |\n| VNM            |   2022 |         3 |         0.0686339  |                   |      nan         |\n| VNM            |   2022 |         4 |         0.0569567  |                   |      nan         |\n| VNM            |   2023 |         0 |         0.257506   |                   |      nan         |\n| VNM            |   2023 |         1 |         0.0552366  |                   |      nan         |\n| VNM            |   2023 |         2 |         0.112804   |                   |      nan         |\n| VNM            |   2023 |         3 |         0.0745011  |                   |      nan         |\n| VNM            |   2023 |         4 |         0.0671136  |                   |      nan         |\n| VNM            |   2024 |         1 |         0.0615314  |                   |      nan         |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "WITH main_company_roe AS (\n    SELECT \n        fr.stock_code,\n        fr.year,\n        fr.quarter,\n        fr.data AS roe\n    FROM \n        financial_ratio fr\n    JOIN \n        map_category_code_ratio mccr ON fr.ratio_code = mccr.ratio_code\n    WHERE \n        mccr.ratio_name = 'Return On Equity'\n        AND fr.stock_code IN ('VNM', 'MSN', 'HPG')\n        AND ((fr.year = 2020 AND fr.quarter >= 2) OR (fr.year > 2020 AND fr.year < 2024) OR (fr.year = 2024 AND fr.quarter <= 2))\n),\nsubsidiary_roe AS (\n    SELECT \n        s.stock_code,\n        s.invest_on AS subsidiary_code,\n        fr.year,\n        fr.quarter,\n        fr.data AS roe\n    FROM \n        sub_and_shareholder s\n    JOIN \n        financial_ratio fr ON s.invest_on = fr.stock_code\n    JOIN \n        map_category_code_ratio mccr ON fr.ratio_code = mccr.ratio_code\n    WHERE \n        mccr.ratio_name = 'Return On Equity'\n        AND s.stock_code IN ('VNM', 'MSN', 'HPG')\n        AND ((fr.year = 2020 AND fr.quarter >= 2) OR (fr.year > 2020 AND fr.year < 2024) OR (fr.year = 2024 AND fr.quarter <= 2))\n)\nSELECT \n    mc.stock_code AS main_company,\n    mc.year,\n    mc.quarter,\n    mc.roe AS main_company_roe,\n    sr.subsidiary_code,\n    sr.roe AS subsidiary_roe\nFROM \n    main_company_roe mc\nLEFT JOIN \n    subsidiary_roe sr ON mc.stock_code = sr.stock_code AND mc.year = sr.year AND mc.quarter = sr.quarter\nORDER BY \n    mc.stock_code, mc.year, mc.quarter, sr.subsidiary_code;\n"
            }
        ],
        "score": 1,
        "difficulty": 4,
        "response": "Table 1\n| stock_code   | subsidiary_investment   |\n|:-------------|:------------------------|\n| MSN          | TCB                     |\n| VNM          | VLC                     |\n| VNM          | MCM                     |\n| VNM          | SBT                     |\n| VNM          | SRF                     |\n| VNM          | TDW                     |\n| MSN          | MSR                     |\n| MSN          | MCH                     |\n| MSN          | VCF                     |\n| MSN          | QHW                     |\n| MSN          | VSN                     |\n| MSN          | MML                     |\n| MSN          | CMF                     |\n| HPG          |                         |\n| VNM          | SCIC                    |\n| HPG          | MBS                     |\n| MSN          |                         |\n\nTable 2\n| stock_code   |   year |   quarter | entity_type           |        roe |   yoy_change |\n|:-------------|-------:|----------:|:----------------------|-----------:|-------------:|\n| HPG          |   2020 |         3 | Parent Company        |  0.0688363 |    0.313509  |\n| HPG          |   2020 |         4 | Parent Company        |  0.0787021 |    0.143322  |\n| HPG          |   2020 |         4 | Parent Company        |  0.0787021 |    0         |\n| HPG          |   2020 |         3 | Parent Company        |  0.0688363 |    0.313509  |\n| HPG          |   2021 |         4 | Parent Company        |  0.0817293 |    0.187299  |\n| HPG          |   2021 |         2 | Parent Company        |  0.131719  |    0.611649  |\n| HPG          |   2021 |         3 | Parent Company        |  0.122748  |   -0.0681035 |\n| HPG          |   2021 |         2 | Parent Company        |  0.131719  |    0.0730805 |\n| HPG          |   2021 |         3 | Parent Company        |  0.122748  |   -0.0681035 |\n| HPG          |   2021 |         4 | Parent Company        |  0.0817293 |   -0.334172  |\n| HPG          |   2022 |         4 | Parent Company        | -0.020796  |   -1.25445   |\n| HPG          |   2022 |         2 | Parent Company        |  0.0402598 |   -2.93594   |\n| HPG          |   2022 |         4 | Parent Company        | -0.020796  |   -1.51655   |\n| HPG          |   2022 |         2 | Parent Company        |  0.0402598 |   -2.93594   |\n| HPG          |   2022 |         3 | Parent Company        | -0.0182075 |   -1.45225   |\n| HPG          |   2022 |         3 | Parent Company        | -0.0182075 |   -0         |\n| HPG          |   2023 |         2 | Parent Company        |  0.0147948 |   -1.81257   |\n| HPG          |   2023 |         2 | Parent Company        |  0.0147948 |    0         |\n| HPG          |   2023 |         3 | Parent Company        |  0.0200306 |    0.353896  |\n| HPG          |   2023 |         4 | Parent Company        |  0.0288708 |    0.441332  |\n| HPG          |   2023 |         4 | Parent Company        |  0.0288708 |    0         |\n| HPG          |   2023 |         3 | Parent Company        |  0.0200306 |   -0.306198  |\n| HPG          |   2024 |         2 | Parent Company        |  0.0305454 |    0.524937  |\n| HPG          |   2024 |         2 | Parent Company        |  0.0305454 |    0         |\n| MSN          |   2020 |         3 | Parent Company        |  0.0340108 |  nan         |\n| MSN          |   2020 |         4 | Parent Company        |  0.0233474 |   -0.313529  |\n| MSN          |   2021 |         2 | Parent Company        |  0.0335106 |   18.2277    |\n| MSN          |   2021 |         3 | Parent Company        |  0.0490112 |    0.46256   |\n| MSN          |   2021 |         4 | Parent Company        |  0.168149  |    2.43082   |\n| MSN          |   2022 |         3 | Parent Company        |  0.0236221 |   -0.859516  |\n| MSN          |   2022 |         4 | Parent Company        |  0.021933  |   -0.0715061 |\n| MSN          |   2022 |         2 | Parent Company        |  0.0313142 |    0.42772   |\n| MSN          |   2023 |         4 | Parent Company        |  0.013515  |   -0.568407  |\n| MSN          |   2023 |         3 | Parent Company        |  0.0127258 |   -0.0583921 |\n| MSN          |   2023 |         2 | Parent Company        |  0.0114376 |   -0.101231  |\n| MSN          |   2020 |         3 | Subsidiary/Investment |  0.0340108 |  nan         |\n| MSN          |   2020 |         3 | Subsidiary/Investment |  0.0340108 |    0         |\n| MSN          |   2020 |         3 | Subsidiary/Investment |  0.0340108 |    0         |\n| MSN          |   2020 |         3 | Subsidiary/Investment |  0.0340108 |    0         |\n| MSN          |   2020 |         4 | Subsidiary/Investment |  0.0233474 |   12.3963    |\n| MSN          |   2020 |         4 | Subsidiary/Investment |  0.0233474 |    0         |\n| MSN          |   2020 |         4 | Subsidiary/Investment |  0.0233474 |    0         |\n| MSN          |   2020 |         4 | Subsidiary/Investment |  0.0233474 |    0         |\n| MSN          |   2020 |         4 | Subsidiary/Investment |  0.0233474 |    0         |\n| MSN          |   2020 |         4 | Subsidiary/Investment |  0.0233474 |    0         |\n| MSN          |   2020 |         4 | Subsidiary/Investment |  0.0233474 |    0         |\n| MSN          |   2020 |         4 | Subsidiary/Investment |  0.0233474 |    0         |\n| MSN          |   2020 |         3 | Subsidiary/Investment |  0.0340108 |    0.456727  |\n| MSN          |   2020 |         3 | Subsidiary/Investment |  0.0340108 |    0         |\n| MSN          |   2020 |         3 | Subsidiary/Investment |  0.0340108 |    0         |\n| MSN          |   2020 |         3 | Subsidiary/Investment |  0.0340108 |    0         |\n| MSN          |   2021 |         4 | Subsidiary/Investment |  0.168149  |    3.94398   |\n| MSN          |   2021 |         4 | Subsidiary/Investment |  0.168149  |    0         |\n| MSN          |   2021 |         4 | Subsidiary/Investment |  0.168149  |    0         |\n| MSN          |   2021 |         4 | Subsidiary/Investment |  0.168149  |    0         |\n| MSN          |   2021 |         4 | Subsidiary/Investment |  0.168149  |    0         |\n| MSN          |   2021 |         4 | Subsidiary/Investment |  0.168149  |    0         |\n| MSN          |   2021 |         3 | Subsidiary/Investment |  0.0490112 |   -0.708525  |\n| MSN          |   2021 |         4 | Subsidiary/Investment |  0.168149  |    2.43082   |\n| MSN          |   2021 |         4 | Subsidiary/Investment |  0.168149  |    0         |\n| MSN          |   2021 |         3 | Subsidiary/Investment |  0.0490112 |   -0.708525  |\n| MSN          |   2021 |         3 | Subsidiary/Investment |  0.0490112 |    0         |\n| MSN          |   2021 |         2 | Subsidiary/Investment |  0.0335106 |   -0.316267  |\n| MSN          |   2021 |         2 | Subsidiary/Investment |  0.0335106 |    0         |\n| MSN          |   2021 |         2 | Subsidiary/Investment |  0.0335106 |    0         |\n| MSN          |   2021 |         2 | Subsidiary/Investment |  0.0335106 |    0         |\n| MSN          |   2021 |         2 | Subsidiary/Investment |  0.0335106 |    0         |\n| MSN          |   2021 |         2 | Subsidiary/Investment |  0.0335106 |    0         |\n| MSN          |   2021 |         2 | Subsidiary/Investment |  0.0335106 |    0         |\n| MSN          |   2021 |         2 | Subsidiary/Investment |  0.0335106 |    0         |\n| MSN          |   2021 |         3 | Subsidiary/Investment |  0.0490112 |    0.46256   |\n| MSN          |   2021 |         3 | Subsidiary/Investment |  0.0490112 |    0         |\n| MSN          |   2021 |         3 | Subsidiary/Investment |  0.0490112 |    0         |\n| MSN          |   2021 |         3 | Subsidiary/Investment |  0.0490112 |    0         |\n| MSN          |   2021 |         3 | Subsidiary/Investment |  0.0490112 |    0         |\n| MSN          |   2022 |         3 | Subsidiary/Investment |  0.0236221 |   -0.518026  |\n| MSN          |   2022 |         3 | Subsidiary/Investment |  0.0236221 |    0         |\n| MSN          |   2022 |         3 | Subsidiary/Investm",
        "code_response": [
            {
                "language": "sql",
                "code": "-- Step 1: Identify stock codes and retrieve subsidiary/investment information\nWITH target_companies AS (\n  SELECT stock_code\n  FROM company_info\n  WHERE stock_code IN ('VNM', 'MSN', 'HPG')\n)\nSELECT \n  tc.stock_code,\n  ssh.invest_on AS subsidiary_investment\nFROM target_companies tc\nLEFT JOIN sub_and_shareholder ssh ON tc.stock_code = ssh.stock_code\nUNION ALL\nSELECT \n  tc.stock_code,\n  ssh.stock_code AS parent_company\nFROM target_companies tc\nLEFT JOIN sub_and_shareholder ssh ON tc.stock_code = ssh.invest_on\nLIMIT 100;  -- Add limit to the query\n"
            },
            {
                "language": "sql",
                "code": "-- Step 2: Extract ROE values and calculate year-over-year change\nWITH target_companies AS (\n  SELECT stock_code\n  FROM company_info\n  WHERE stock_code IN ('VNM', 'MSN', 'HPG')\n),\nroes AS (\n  SELECT \n    fr.stock_code,\n    fr.year,\n    fr.quarter,\n    fr.data AS roe,\n    CASE \n      WHEN ssh.invest_on IS NOT NULL THEN 'Subsidiary/Investment'\n      ELSE 'Parent Company'\n    END AS entity_type\n  FROM financial_ratio fr\n  JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\n  JOIN target_companies tc ON fr.stock_code = tc.stock_code\n  LEFT JOIN sub_and_shareholder ssh ON fr.stock_code = ssh.stock_code\n  WHERE mcr.ratio_name = 'Return On Equity'\n  AND fr.year BETWEEN 2020 AND 2024\n  AND fr.quarter IN (2, 3, 4)  -- Q2 to Q4\n  UNION ALL\n  SELECT \n    fr.stock_code,\n    fr.year,\n    fr.quarter,\n    fr.data AS roe,\n    'Parent Company' AS entity_type\n  FROM financial_ratio fr\n  JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\n  JOIN target_companies tc ON fr.stock_code = tc.stock_code\n  WHERE mcr.ratio_name = 'Return On Equity'\n  AND fr.year BETWEEN 2020 AND 2024\n  AND fr.quarter IN (2, 3, 4)  -- Q2 to Q4\n),\nroes_with_yoy AS (\n  SELECT \n    stock_code,\n    year,\n    quarter,\n    roe,\n    entity_type,\n    LAG(roe) OVER (PARTITION BY stock_code, entity_type ORDER BY year) AS prev_roe,\n    (roe - LAG(roe) OVER (PARTITION BY stock_code, entity_type ORDER BY year)) / \n      LAG(roe) OVER (PARTITION BY stock_code, entity_type ORDER BY year) AS yoy_change\n  FROM roes\n)\nSELECT \n  stock_code,\n  year,\n  quarter,\n  entity_type,\n  roe,\n  yoy_change\nFROM roes_with_yoy\nWHERE year > 2020 OR (year = 2020 AND quarter > 2)  -- Filter out 2020-Q1 and earlier\nLIMIT 100;  -- Add limit to the query\n"
            },
            {
                "language": "sql",
                "code": "-- Combined Query\nWITH target_companies AS (\n  SELECT stock_code\n  FROM company_info\n  WHERE stock_code IN ('VNM', 'MSN', 'HPG')\n),\nroes AS (\n  SELECT \n    fr.stock_code,\n    fr.year,\n    fr.quarter,\n    fr.data AS roe,\n    CASE \n      WHEN ssh.invest_on IS NOT NULL THEN 'Subsidiary/Investment'\n      ELSE 'Parent Company'\n    END AS entity_type\n  FROM financial_ratio fr\n  JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\n  JOIN target_companies tc ON fr.stock_code = tc.stock_code\n  LEFT JOIN sub_and_shareholder ssh ON fr.stock_code = ssh.stock_code\n  WHERE mcr.ratio_name = 'Return On Equity'\n  AND fr.year BETWEEN 2020 AND 2024\n  AND fr.quarter IN (2, 3, 4)  -- Q2 to Q4\n  UNION ALL\n  SELECT \n    fr.stock_code,\n    fr.year,\n    fr.quarter,\n    fr.data AS roe,\n    'Parent Company' AS entity_type\n  FROM financial_ratio fr\n  JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\n  JOIN target_companies tc ON fr.stock_code = tc.stock_code\n  WHERE mcr.ratio_name = 'Return On Equity'\n  AND fr.year BETWEEN 2020 AND 2024\n  AND fr.quarter IN (2, 3, 4)  -- Q2 to Q4\n),\nroes_with_yoy AS (\n  SELECT \n    stock_code,\n    year,\n    quarter,\n    roe,\n    entity_type,\n    LAG(roe) OVER (PARTITION BY stock_code, entity_type ORDER BY year) AS prev_roe,\n    (roe - LAG(roe) OVER (PARTITION BY stock_code, entity_type ORDER BY year)) / \n      LAG(roe) OVER (PARTITION BY stock_code, entity_type ORDER BY year) AS yoy_change\n  FROM roes\n),\ntarget_companies_with_subs AS (\n  SELECT \n    tc.stock_code,\n    ssh.invest_on AS subsidiary_investment\n  FROM target_companies tc\n  LEFT JOIN sub_and_shareholder ssh ON tc.stock_code = ssh.stock_code\n  UNION ALL\n  SELECT \n    tc.stock_code,\n    ssh.stock_code AS parent_company\n  FROM target_companies tc\n  LEFT JOIN sub_and_shareholder ssh ON tc.stock_code = ssh.invest_on\n)\nSELECT \n  rwy.stock_code,\n  rwy.year,\n  rwy.quarter,\n  rwy.entity_type,\n  rwy.roe,\n  rwy.yoy_change,\n  tcs.subsidiary_investment\nFROM roes_with_yoy rwy\nJOIN target_companies_with_subs tcs ON rwy.stock_code = tcs.stock_code\nWHERE rwy.year > 2020 OR (rwy.year = 2020 AND rwy.quarter > 2)  -- Filter out 2020-Q1 and earlier\nLIMIT 100;  -- Add limit to the query\n"
            }
        ],
        "time": 86.61514782905579,
        "evaluate": 0,
        "input_token": 4418,
        "output_token": 2273
    },
    {
        "id": "517268fa-0be0-45f0-ab11-c3ff9ba775a3",
        "question": "Calculate the Debt-to-Equity ratio for VinGroup, Masan Group, and Hoa Phat Group in Q2 2024.  Analyze the impact of their subsidiary investments on their overall leverage.",
        "answer": "Table 1\n| stock_code   |   debt_to_equity_ratio |   investment_in_subsidiaries |\n|:-------------|-----------------------:|-----------------------------:|\n| HPG          |               0.901137 |                            0 |\n| VIC          |               3.44847  |                            0 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "-- Step 1: Identify the stock codes for the companies\nWITH company_codes AS (\n    SELECT 'VIC' AS stock_code\n    UNION ALL\n    SELECT 'MSN'\n    UNION ALL\n    SELECT 'HPG'\n)\n\n-- Step 2: Retrieve Debt-to-Equity ratio for Q2 2024\nSELECT \n    fr.stock_code,\n    fr.data AS debt_to_equity_ratio,\n    nbf.data AS investment_in_subsidiaries\nFROM \n    financial_ratio fr\nJOIN \n    company_codes cc ON fr.stock_code = cc.stock_code\nJOIN \n    map_category_code_ratio mccr ON fr.ratio_code = mccr.ratio_code\nLEFT JOIN \n    non_bank_financial_report nbf ON fr.stock_code = nbf.stock_code \n    AND nbf.year = 2024 \n    AND nbf.quarter = 2 \n    AND nbf.category_code = 'BS_251' -- Investment in subsidiaries\nWHERE \n    fr.year = 2024 \n    AND fr.quarter = 2 \n    AND mccr.ratio_name = 'Debt To Equity Ratio';\n"
            }
        ],
        "score": 1,
        "difficulty": 3,
        "response": "Table 1\n| stock_code   | subsidiary_investment   |\n|:-------------|:------------------------|\n| MSN          | TCB                     |\n| VIC          | VRE                     |\n| MSN          | MSR                     |\n| MSN          | MCH                     |\n| MSN          | VCF                     |\n| MSN          | QHW                     |\n| MSN          | VSN                     |\n| MSN          | MML                     |\n| MSN          | CMF                     |\n| VIC          | VEF                     |\n| VIC          | VNB                     |\n| VIC          | VHM                     |\n| HPG          |                         |\n| MBS          | HPG                     |\n\nTable 2\n| parent_stock_code   | subsidiary_stock_code   | debt_to_equity_ratio   |\n|---------------------|-------------------------|------------------------|\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "WITH target_companies AS (\n  SELECT stock_code\n  FROM company_info\n  WHERE stock_code IN ('HPG', 'MSN', 'VIC')  -- Assuming stock codes from provided company details\n)\nSELECT \n  tc.stock_code,\n  ssh.invest_on AS subsidiary_investment\nFROM \n  target_companies tc\n  LEFT JOIN sub_and_shareholder ssh ON tc.stock_code = ssh.stock_code\nUNION ALL\nSELECT \n  ssh.stock_code,\n  ssh.invest_on AS subsidiary_investment\nFROM \n  sub_and_shareholder ssh\n  INNER JOIN target_companies tc ON ssh.invest_on = tc.stock_code\nLIMIT 100;\n"
            },
            {
                "language": "sql",
                "code": "WITH \n  -- Step 1 result (simplified for brevity)\n  target_companies AS (\n    SELECT stock_code\n    FROM company_info\n    WHERE stock_code IN ('HPG', 'MSN', 'VIC')\n  ),\n  \n  -- Subsidiary investments (including both directions)\n  subsidiary_investments AS (\n    SELECT \n      tc.stock_code AS parent_stock_code,\n      COALESCE(ssh.invest_on, ssh.stock_code) AS subsidiary_stock_code\n    FROM \n      target_companies tc\n      LEFT JOIN sub_and_shareholder ssh ON tc.stock_code = ssh.stock_code\n    UNION ALL\n    SELECT \n      ssh.invest_on AS parent_stock_code,\n      ssh.stock_code AS subsidiary_stock_code\n    FROM \n      sub_and_shareholder ssh\n      INNER JOIN target_companies tc ON ssh.invest_on = tc.stock_code\n  ),\n  \n  -- Extract Debt and Equity values for Q2 2024\n  financial_data AS (\n    SELECT \n      si.parent_stock_code,\n      si.subsidiary_stock_code,\n      'Debt' AS type,\n      nbfr.data AS value\n    FROM \n      subsidiary_investments si\n      INNER JOIN non_bank_financial_report nbfr ON si.subsidiary_stock_code = nbfr.stock_code\n      INNER JOIN map_category_code_non_bank mccnb ON nbfr.category_code = mccnb.category_code\n    WHERE \n      nbfr.year = 2024 AND nbfr.quarter = 2\n      AND mccnb.en_caption = 'Total Debt'  -- Assuming BS_200 is Total Debt\n    UNION ALL\n    SELECT \n      si.parent_stock_code,\n      si.subsidiary_stock_code,\n      'Equity' AS type,\n      nbfr.data AS value\n    FROM \n      subsidiary_investments si\n      INNER JOIN non_bank_financial_report nbfr ON si.subsidiary_stock_code = nbfr.stock_code\n      INNER JOIN map_category_code_non_bank mccnb ON nbfr.category_code = mccnb.category_code\n    WHERE \n      nbfr.year = 2024 AND nbfr.quarter = 2\n      AND mccnb.en_caption = 'Total Equity'  -- Assuming BS_300 is Total Equity\n  )\n  \n-- Analyze the impact of subsidiary investments on the overall leverage\nSELECT \n  fd.parent_stock_code,\n  fd.subsidiary_stock_code,\n  -- Calculate Debt-to-Equity Ratio (if pre-calculated ratio not available)\n  CASE \n    WHEN SUM(CASE WHEN fd.type = 'Equity' THEN fd.value ELSE 0 END) = 0 THEN NULL\n    ELSE SUM(CASE WHEN fd.type = 'Debt' THEN fd.value ELSE 0 END) / \n         SUM(CASE WHEN fd.type = 'Equity' THEN fd.value ELSE 0 END)\n  END AS debt_to_equity_ratio\nFROM \n  financial_data fd\nGROUP BY \n  fd.parent_stock_code, fd.subsidiary_stock_code\nLIMIT 100;\n"
            }
        ],
        "time": 55.75118017196655,
        "evaluate": 0,
        "input_token": 2305,
        "output_token": 1343
    },
    {
        "id": "6eb862c7-4017-4799-a708-7e1fa7a4b1fd",
        "question": "Compare the Return on Equity (ROE) and Debt-to-Equity ratios for Vinamilk, Masan Group, and Sabeco in Q4 2023.  Also provide the total equity and total liabilities for each company in that quarter.",
        "answer": "Table 1\n| stock_code   | ratio_code   |   ratio_value |\n|:-------------|:-------------|--------------:|\n| MSN          | DTER         |     2.85445   |\n| SAB          | DTER         |     0.336332  |\n| VNM          | DTER         |     0.503847  |\n| MSN          | ROE          |     0.013515  |\n| SAB          | ROE          |     0.0379247 |\n| VNM          | ROE          |     0.0671136 |\n\nTable 2\n| stock_code   | category_code   |       value |\n|:-------------|:----------------|------------:|\n| VNM          | BS_300          | 1.76476e+07 |\n| VNM          | BS_400          | 3.50257e+07 |\n| MSN          | BS_300          | 1.09146e+08 |\n| SAB          | BS_300          | 8.57147e+06 |\n| MSN          | BS_400          | 3.82372e+07 |\n| SAB          | BS_400          | 2.54852e+07 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "-- Step 1: Retrieve ROE and Debt-to-Equity Ratios for the specified companies\nSELECT \n    fr.stock_code,\n    fr.ratio_code,\n    fr.data AS ratio_value\nFROM \n    financial_ratio fr\nWHERE \n    fr.stock_code IN ('VNM', 'MSN', 'SAB') \n    AND fr.year = 2023 \n    AND fr.quarter = 4\n    AND fr.ratio_code IN ('ROE', 'DTER');\n\n-- Step 2: Retrieve Total Equity and Total Liabilities for the specified companies\nSELECT \n    nfr.stock_code,\n    nfr.category_code,\n    nfr.data AS value\nFROM \n    non_bank_financial_report nfr\nWHERE \n    nfr.stock_code IN ('VNM', 'MSN', 'SAB') \n    AND nfr.year = 2023 \n    AND nfr.quarter = 4\n    AND nfr.category_code IN ('BS_400', 'BS_300'); -- BS_400 for Total Equity, BS_300 for Total Liabilities\n"
            }
        ],
        "score": 1,
        "difficulty": 3,
        "response": "Table 1\n| stock_code   | ratio_code   |   ratio_value | ratio_name           |\n|:-------------|:-------------|--------------:|:---------------------|\n| MSN          | DTER         |     2.85445   | Debt To Equity Ratio |\n| SAB          | DTER         |     0.336332  | Debt To Equity Ratio |\n| VNM          | DTER         |     0.503847  | Debt To Equity Ratio |\n| MSN          | ROE          |     0.013515  | Return On Equity     |\n| SAB          | ROE          |     0.0379247 | Return On Equity     |\n| VNM          | ROE          |     0.0671136 | Return On Equity     |\n\nTable 2\n| stock_code   | category_code   | value   |\n|--------------|-----------------|---------|\n\nTable 3\n| stock_code   | ratio_code   |   ratio_value | ratio_name           |\n|:-------------|:-------------|--------------:|:---------------------|\n| MSN          | DTER         |     2.85445   | Debt To Equity Ratio |\n| SAB          | DTER         |     0.336332  | Debt To Equity Ratio |\n| VNM          | DTER         |     0.503847  | Debt To Equity Ratio |\n| SAB          | ROE          |     0.0379247 | Return On Equity     |\n| MSN          | ROE          |     0.013515  | Return On Equity     |\n| VNM          | ROE          |     0.0671136 | Return On Equity     |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT stock_code\nFROM company_info\nWHERE stock_code IN ('VNM', 'MSN', 'SAB');\n"
            },
            {
                "language": "sql",
                "code": "SELECT \n  fr.stock_code,\n  fr.ratio_code,\n  fr.data AS ratio_value,\n  mcr.ratio_name\nFROM \n  financial_ratio fr\n  INNER JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\nWHERE \n  fr.stock_code IN ('VNM', 'MSN', 'SAB')\n  AND fr.year = 2023\n  AND fr.quarter = 4\n  AND mcr.ratio_name IN ('Return On Equity', 'Debt To Equity Ratio');\n"
            },
            {
                "language": "sql",
                "code": "SELECT \n  nfr.stock_code,\n  nfr.category_code,\n  nfr.data AS value\nFROM \n  non_bank_financial_report nfr\n  INNER JOIN map_category_code_non_bank mcnb ON nfr.category_code = mcnb.category_code\nWHERE \n  nfr.stock_code IN ('VNM', 'MSN', 'SAB')\n  AND nfr.year = 2023\n  AND nfr.quarter = 4\n  AND mcnb.en_caption IN ('Total Equity', 'Total Liabilities');\n"
            },
            {
                "language": "sql",
                "code": "WITH roe_dte_ratios AS (\n  SELECT \n    fr.stock_code,\n    fr.ratio_code,\n    fr.data AS ratio_value,\n    mcr.ratio_name\n  FROM \n    financial_ratio fr\n    INNER JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\n  WHERE \n    fr.stock_code IN ('VNM', 'MSN', 'SAB')\n    AND fr.year = 2023\n    AND fr.quarter = 4\n    AND mcr.ratio_name IN ('Return On Equity', 'Debt To Equity Ratio')\n),\ntotal_equity_liabilities AS (\n  SELECT \n    nfr.stock_code,\n    nfr.category_code,\n    nfr.data AS value,\n    mcnb.en_caption\n  FROM \n    non_bank_financial_report nfr\n    INNER JOIN map_category_code_non_bank mcnb ON nfr.category_code = mcnb.category_code\n  WHERE \n    nfr.stock_code IN ('VNM', 'MSN', 'SAB')\n    AND nfr.year = 2023\n    AND nfr.quarter = 4\n    AND mcnb.en_caption IN ('Total Equity', 'Total Liabilities')\n)\nSELECT * FROM roe_dte_ratios\nUNION ALL\nSELECT \n  stock_code,\n  category_code AS ratio_code,\n  value AS ratio_value,\n  en_caption AS ratio_name\nFROM \n  total_equity_liabilities\nLIMIT 100;\n"
            }
        ],
        "time": 65.95157361030579,
        "evaluate": 0.5,
        "input_token": 4292,
        "output_token": 1944
    },
    {
        "id": "0a7260e6-0f4a-4061-bd8f-11bea613819f",
        "question": "What was the Return on Equity (ROE) for Vietcombank, Techcombank, and VPBank in Q2 2024, and how does this compare to their respective ROE in Q2 2020, considering their investments in subsidiaries?",
        "answer": "Table 1\n| stock_code   | company_name                                       |   year |   quarter |       roe |\n|:-------------|:---------------------------------------------------|-------:|----------:|----------:|\n| TCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam    |   2020 |         2 | 0.0428449 |\n| TCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam    |   2020 |         2 | 0.0428449 |\n| TCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam    |   2024 |         2 | 0.0457096 |\n| TCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam    |   2024 |         2 | 0.0457096 |\n| VCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ngo\u1ea1i th\u01b0\u01a1ng Vi\u1ec7t Nam |   2020 |         2 | 0.0515214 |\n| VCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ngo\u1ea1i th\u01b0\u01a1ng Vi\u1ec7t Nam |   2020 |         2 | 0.0515214 |\n| VCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ngo\u1ea1i th\u01b0\u01a1ng Vi\u1ec7t Nam |   2020 |         2 | 0.0515214 |\n| VCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ngo\u1ea1i th\u01b0\u01a1ng Vi\u1ec7t Nam |   2020 |         2 | 0.0515214 |\n| VCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ngo\u1ea1i th\u01b0\u01a1ng Vi\u1ec7t Nam |   2020 |         2 | 0.0515214 |\n| VCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ngo\u1ea1i th\u01b0\u01a1ng Vi\u1ec7t Nam |   2020 |         2 | 0.0515214 |\n| VCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ngo\u1ea1i th\u01b0\u01a1ng Vi\u1ec7t Nam |   2020 |         2 | 0.0515214 |\n| VCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ngo\u1ea1i th\u01b0\u01a1ng Vi\u1ec7t Nam |   2020 |         2 | 0.0515214 |\n| VCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ngo\u1ea1i th\u01b0\u01a1ng Vi\u1ec7t Nam |   2020 |         2 | 0.0515214 |\n| VPB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Vi\u1ec7t Nam Th\u1ecbnh V\u01b0\u1ee3ng  |   2020 |         2 | 0.0621598 |\n| VPB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Vi\u1ec7t Nam Th\u1ecbnh V\u01b0\u1ee3ng  |   2020 |         2 | 0.0621598 |\n| VPB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Vi\u1ec7t Nam Th\u1ecbnh V\u01b0\u1ee3ng  |   2024 |         2 | 0.026311  |\n| VPB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Vi\u1ec7t Nam Th\u1ecbnh V\u01b0\u1ee3ng  |   2024 |         2 | 0.026311  |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    fr.stock_code, \n    ci.company_name, \n    fr.year, \n    fr.quarter, \n    fr.data AS roe\nFROM \n    financial_ratio fr\nJOIN \n    map_category_code_ratio mccr ON fr.ratio_code = mccr.ratio_code\nJOIN \n    company_info ci ON fr.stock_code = ci.stock_code\nLEFT JOIN \n    sub_and_shareholder ss ON fr.stock_code = ss.stock_code\nWHERE \n    mccr.ratio_name = 'Return On Equity'\n    AND fr.quarter = 2\n    AND fr.year IN (2020, 2024)\n    AND fr.stock_code IN ('VCB', 'TCB', 'VPB')\nORDER BY \n    fr.stock_code, fr.year;\n"
            }
        ],
        "score": 1,
        "difficulty": 3,
        "response": "Table 1\n| stock_code   |   year |   quarter |       roe |\n|:-------------|-------:|----------:|----------:|\n| TCB          |   2020 |         2 | 0.0428449 |\n| TCB          |   2024 |         2 | 0.0457096 |\n| VCB          |   2020 |         2 | 0.0515214 |\n| VPB          |   2020 |         2 | 0.0621598 |\n| VPB          |   2024 |         2 | 0.026311  |\n\nTable 2\n| stock_code   |   year |   quarter |       roe | subsidiary_investment   |\n|:-------------|-------:|----------:|----------:|:------------------------|\n| TCB          |   2020 |         2 | 0.0428449 | VCG                     |\n| TCB          |   2020 |         2 | 0.0428449 | HVN                     |\n| TCB          |   2024 |         2 | 0.0457096 | VCG                     |\n| TCB          |   2024 |         2 | 0.0457096 | HVN                     |\n| VCB          |   2020 |         2 | 0.0515214 | PGI                     |\n| VCB          |   2020 |         2 | 0.0515214 | EIB                     |\n| VCB          |   2020 |         2 | 0.0515214 | MBB                     |\n| VCB          |   2020 |         2 | 0.0515214 | HVN                     |\n| VCB          |   2020 |         2 | 0.0515214 | PVD                     |\n| VCB          |   2020 |         2 | 0.0515214 | OCB                     |\n| VCB          |   2020 |         2 | 0.0515214 | EIB                     |\n| VCB          |   2020 |         2 | 0.0515214 | MBB                     |\n| VCB          |   2020 |         2 | 0.0515214 | OCB                     |\n| VPB          |   2020 |         2 | 0.0621598 | SGP                     |\n| VPB          |   2020 |         2 | 0.0621598 | FDC                     |\n| VPB          |   2024 |         2 | 0.026311  | SGP                     |\n| VPB          |   2024 |         2 | 0.026311  | FDC                     |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "-- Revised Combined Query\nWITH target_companies AS (\n  SELECT stock_code\n  FROM company_info\n  WHERE stock_code IN ('VCB', 'TCB', 'VPB')\n),\nroes AS (\n  SELECT \n    fr.stock_code,\n    fr.year,\n    fr.quarter,\n    fr.data AS roe\n  FROM \n    financial_ratio fr\n  INNER JOIN \n    map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\n  INNER JOIN \n    target_companies tc ON fr.stock_code = tc.stock_code\n  WHERE \n    mcr.ratio_name = 'Return On Equity' \n    AND ((fr.year = 2020 AND fr.quarter = 2) \n         OR (fr.year = 2024 AND fr.quarter = 2))\n),\nsubsidary_investments AS (\n  SELECT \n    sc.stock_code,\n    ssh.invest_on\n  FROM \n    target_companies sc\n  LEFT JOIN \n    sub_and_shareholder ssh ON sc.stock_code = ssh.stock_code\n)\nSELECT \n  r.stock_code,\n  r.year,\n  r.quarter,\n  r.roe,\n  si.invest_on AS subsidiary_investment\nFROM \n  roes r\nLEFT JOIN \n  subsidary_investments si ON r.stock_code = si.stock_code\nLIMIT 100;\n"
            }
        ],
        "time": 92.27237057685852,
        "evaluate": 0.5,
        "input_token": 3423,
        "output_token": 754
    },
    {
        "id": "756db2fc-d60a-4119-93a9-f965164708dd",
        "question": "What is the trend of the Net Profit Margin ratio for Vietcombank, Techcombank, and ACB from 2020 to Q2 2024?",
        "answer": "Table 1\n| stock_code   | year   | quarter   | net_profit_margin   |\n|--------------|--------|-----------|---------------------|\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    fr.stock_code, \n    fr.year, \n    fr.quarter, \n    fr.data AS net_profit_margin\nFROM \n    financial_ratio fr\nJOIN \n    map_category_code_ratio mccr ON fr.ratio_code = mccr.ratio_code\nWHERE \n    mccr.ratio_name = 'Net profit margin' AND\n    fr.stock_code IN ('VCB', 'TCB', 'ACB') AND\n    ((fr.year BETWEEN 2020 AND 2023 AND fr.quarter = 0) OR\n     (fr.year = 2024 AND fr.quarter = 2))\nORDER BY \n    fr.stock_code, \n    fr.year, \n    fr.quarter;\n"
            }
        ],
        "score": 1,
        "difficulty": 2,
        "response": "Table 1\n| stock_code   | company_name   | year   | quarter   | net_profit_margin   |\n|--------------|----------------|--------|-----------|---------------------|\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT \n  fr.stock_code,\n  ci.company_name,\n  fr.year,\n  fr.quarter,\n  fr.data AS net_profit_margin\nFROM \n  financial_ratio fr\n  INNER JOIN company_info ci ON fr.stock_code = ci.stock_code\nWHERE \n  fr.ratio_code = 'NPM'  -- Net Profit Margin\n  AND fr.stock_code IN ('VCB', 'TCB', 'ACB')  -- Target companies\n  AND fr.year BETWEEN 2020 AND 2024  -- Target years\n  AND fr.quarter = 2  -- Only Q2 for each year\nORDER BY \n  fr.stock_code, \n  fr.year, \n  fr.quarter\nLIMIT 100;  -- Add limit as per database schema requirement\n"
            }
        ],
        "time": 44.06599545478821,
        "evaluate": 0,
        "input_token": 5935,
        "output_token": 2125
    },
    {
        "id": "22005fc2-07f4-41f8-9b53-2ebb12689756",
        "question": "Compare the Return on Equity (ROE) and the Debt-to-Equity ratio of Vinamilk, Masan Group, and SABECO from 2020 to Q2 2024.",
        "answer": "Table 1\n| stock_code   |   year |   quarter | ratio_name           |      data |\n|:-------------|-------:|----------:|:---------------------|----------:|\n| MSN          |   2020 |         0 | Debt To Equity Ratio | 3.62386   |\n| MSN          |   2020 |         0 | Return On Equity     | 0.055733  |\n| MSN          |   2021 |         0 | Debt To Equity Ratio | 1.97835   |\n| MSN          |   2021 |         0 | Return On Equity     | 0.238597  |\n| MSN          |   2022 |         0 | Debt To Equity Ratio | 2.85795   |\n| MSN          |   2022 |         0 | Return On Equity     | 0.129771  |\n| MSN          |   2023 |         0 | Debt To Equity Ratio | 2.85445   |\n| MSN          |   2023 |         0 | Return On Equity     | 0.0489033 |\n| MSN          |   2024 |         1 | Debt To Equity Ratio | 2.77309   |\n| MSN          |   2024 |         1 | Return On Equity     | 0.0123309 |\n| SAB          |   2020 |         0 | Debt To Equity Ratio | 0.290342  |\n| SAB          |   2020 |         0 | Return On Equity     | 0.232702  |\n| SAB          |   2021 |         0 | Debt To Equity Ratio | 0.349295  |\n| SAB          |   2021 |         0 | Return On Equity     | 0.173903  |\n| SAB          |   2022 |         0 | Debt To Equity Ratio | 0.401541  |\n| SAB          |   2022 |         0 | Return On Equity     | 0.223652  |\n| SAB          |   2023 |         0 | Debt To Equity Ratio | 0.336332  |\n| SAB          |   2023 |         0 | Return On Equity     | 0.166962  |\n| SAB          |   2024 |         1 | Debt To Equity Ratio | 0.215054  |\n| SAB          |   2024 |         1 | Return On Equity     | 0.038694  |\n| SAB          |   2024 |         2 | Debt To Equity Ratio | 0.359095  |\n| SAB          |   2024 |         2 | Return On Equity     | 0.0524845 |\n| VNM          |   2020 |         0 | Debt To Equity Ratio | 0.439424  |\n| VNM          |   2020 |         0 | Return On Equity     | 0.333928  |\n| VNM          |   2021 |         0 | Debt To Equity Ratio | 0.487649  |\n| VNM          |   2021 |         0 | Return On Equity     | 0.296583  |\n| VNM          |   2022 |         0 | Debt To Equity Ratio | 0.477386  |\n| VNM          |   2022 |         0 | Return On Equity     | 0.26138   |\n| VNM          |   2023 |         0 | Debt To Equity Ratio | 0.503847  |\n| VNM          |   2023 |         0 | Return On Equity     | 0.257506  |\n| VNM          |   2024 |         1 | Debt To Equity Ratio | 0.440127  |\n| VNM          |   2024 |         1 | Return On Equity     | 0.0615314 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    fr.stock_code,\n    fr.year,\n    fr.quarter,\n    mccr.ratio_name,\n    fr.data\nFROM \n    financial_ratio fr\nJOIN \n    map_category_code_ratio mccr ON fr.ratio_code = mccr.ratio_code\nWHERE \n    fr.stock_code IN ('VNM', 'MSN', 'SAB')\n    AND mccr.ratio_code IN ('ROE', 'DTER')\n    AND (\n        (fr.year = 2020 AND fr.quarter = 0) OR\n        (fr.year = 2021 AND fr.quarter = 0) OR\n        (fr.year = 2022 AND fr.quarter = 0) OR\n        (fr.year = 2023 AND fr.quarter = 0) OR\n        (fr.year = 2024 AND fr.quarter IN (1, 2))\n    )\nORDER BY \n    fr.stock_code, fr.year, fr.quarter, mccr.ratio_name;\n"
            }
        ],
        "score": 1,
        "difficulty": 2,
        "response": "Error in getting the answer",
        "code_response": "Error in getting the code",
        "evaluate": 0,
        "input_token": 911,
        "output_token": 243
    },
    {
        "id": "a9d94d50-4a5e-4023-8fa7-0ef92a370a01",
        "question": "For Q1 2023, what was the net income attributable to the parent company for  Vinamilk, and what proportion of this net income was generated by its subsidiaries and associates?  Provide a breakdown of the net income contribution from each significant subsidiary if available.",
        "answer": "Table 1\n|   net_income_parent | subsidiary_code   | category   | contribution   |\n|--------------------:|:------------------|:-----------|:---------------|\n|         1.85673e+06 |                   |            |                |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "WITH parent_net_income AS (\n    SELECT \n        stock_code,\n        data AS net_income_parent\n    FROM \n        non_bank_financial_report\n    WHERE \n        stock_code = 'VNM' \n        AND year = 2023 \n        AND quarter = 1 \n        AND category_code = 'IS_061'\n),\nsubsidiary_contributions AS (\n    SELECT \n        s.invest_on AS subsidiary_code,\n        m.en_caption AS category,\n        f.data AS contribution\n    FROM \n        sub_and_shareholder s\n    JOIN \n        non_bank_financial_report f ON s.invest_on = f.stock_code\n    JOIN \n        map_category_code_non_bank m ON f.category_code = m.category_code\n    WHERE \n        s.stock_code = 'VNM'\n        AND f.year = 2023\n        AND f.quarter = 1\n        AND m.en_caption = 'Share of profit/(loss) from joint ventures and associates'\n)\nSELECT \n    p.net_income_parent,\n    s.subsidiary_code,\n    s.category,\n    s.contribution\nFROM \n    parent_net_income p\nLEFT JOIN \n    subsidiary_contributions s ON p.stock_code = 'VNM';\n"
            }
        ],
        "score": 1,
        "difficulty": 3,
        "response": "Table 1\n| net_income_parent   |\n|---------------------|\n\nTable 2\n| subsidiary   | net_income_contribution   |\n|--------------|---------------------------|\n\nTable 3\n| vinamilk_net_income   | significant_subsidary   | subsidiary_net_income_contribution   |\n|:----------------------|:------------------------|:-------------------------------------|\n|                       |                         |                                      |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT stock_code \nFROM company_info \nWHERE industry = 'Food and Beverages' AND en_company_name = 'Vietnam Dairy Products Joint Stock Company'\n"
            },
            {
                "language": "sql",
                "code": "SELECT invest_on \nFROM sub_and_shareholder \nWHERE stock_code = 'VNM'\n"
            },
            {
                "language": "sql",
                "code": "SELECT T1.data AS net_income_parent \nFROM non_bank_financial_report T1\nJOIN map_category_code_non_bank T2 ON T1.category_code = T2.category_code\nWHERE T1.stock_code = 'VNM' \n  AND T1.year = 2023 \n  AND T1.quarter = 1 \n  AND T2.en_caption = 'Net Income Attributable to Parent Company'\nLIMIT 1;\n"
            },
            {
                "language": "sql",
                "code": "SELECT \n  T1.invest_on AS subsidiary, \n  T2.data AS net_income_contribution\nFROM \n  sub_and_shareholder T1\n  JOIN non_bank_financial_report T2 ON T1.invest_on = T2.stock_code\n  JOIN map_category_code_non_bank T3 ON T2.category_code = T3.category_code\nWHERE \n  T1.stock_code = 'VNM' \n  AND T2.year = 2023 \n  AND T2.quarter = 1 \n  AND T3.en_caption = 'Net Income Attributable to Parent Company'\n  AND T1.invest_on = 'VHM'  -- Focus on the significant subsidiary (if available)\nLIMIT 1;\n"
            },
            {
                "language": "sql",
                "code": "-- Assuming we only need the first matching record for each query\nWITH \n  vinamilk_net_income AS (\n    SELECT T1.data AS net_income_parent \n    FROM non_bank_financial_report T1\n    JOIN map_category_code_non_bank T2 ON T1.category_code = T2.category_code\n    WHERE T1.stock_code = 'VNM' \n      AND T1.year = 2023 \n      AND T1.quarter = 1 \n      AND T2.en_caption = 'Net Income Attributable to Parent Company'\n    LIMIT 1\n  ),\n  \n  subsidiary_contribution AS (\n    SELECT \n      T1.invest_on AS subsidiary, \n      T2.data AS net_income_contribution\n    FROM \n      sub_and_shareholder T1\n      JOIN non_bank_financial_report T2 ON T1.invest_on = T2.stock_code\n      JOIN map_category_code_non_bank T3 ON T2.category_code = T3.category_code\n    WHERE \n      T1.stock_code = 'VNM' \n      AND T2.year = 2023 \n      AND T2.quarter = 1 \n      AND T3.en_caption = 'Net Income Attributable to Parent Company'\n      AND T1.invest_on = 'VHM'  -- Focus on the significant subsidiary (if available)\n    LIMIT 1\n  )\n\nSELECT \n  (SELECT net_income_parent FROM vinamilk_net_income) AS vinamilk_net_income,\n  (SELECT subsidiary FROM subsidiary_contribution) AS significant_subsidary,\n  (SELECT net_income_contribution FROM subsidiary_contribution) AS subsidiary_net_income_contribution\nLIMIT 1;\n"
            }
        ],
        "time": 64.89837598800659,
        "evaluate": 0,
        "input_token": 1812,
        "output_token": 1024
    },
    {
        "id": "6e85dfc8-0e0f-484a-ac9c-b472109731ef",
        "question": "What was the current ratio for Vietcombank and Techcombank in 2022?",
        "answer": "Table 1\n| stock_code   |    data |\n|:-------------|--------:|\n| TCB          | 3.29776 |\n| VCB          | 3.56816 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT stock_code, data\nFROM financial_ratio\nWHERE ratio_code = 'CurrentR'\n  AND stock_code IN ('VCB', 'TCB')\n  AND year = 2022\n  AND quarter = 0;\n"
            }
        ],
        "score": 1,
        "difficulty": 1,
        "response": "Table 1\n| stock_code   | company_name                                       |   year |   current_ratio |\n|:-------------|:---------------------------------------------------|-------:|----------------:|\n| VCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ngo\u1ea1i th\u01b0\u01a1ng Vi\u1ec7t Nam |   2022 |         3.56816 |\n| TCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam    |   2022 |         3.29776 |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT \n  fr.stock_code,\n  ci.company_name,\n  fr.year,\n  fr.data AS current_ratio\nFROM \n  financial_ratio fr\n  INNER JOIN company_info ci ON fr.stock_code = ci.stock_code\nWHERE \n  fr.stock_code IN ('VCB', 'TCB')\n  AND fr.year = 2022\n  AND fr.quarter = 0\n  AND fr.ratio_code = 'CurrentR'\nLIMIT 100;\n"
            }
        ],
        "time": 37.2004292011261,
        "evaluate": 1,
        "input_token": 8198,
        "output_token": 3819
    },
    {
        "id": "18574cdb-3c4f-4bed-ba96-57d62355afc8",
        "question": "What is the Return on Equity (ROE) and Return on Assets (ROA) for Vinamilk and Masan Group from 2020 to Q2 2024?  Provide data for each quarter separately.",
        "answer": "Table 1\n| stock_code   |   year |   quarter | ratio_name       |         data |\n|:-------------|-------:|----------:|:-----------------|-------------:|\n| MSN          |   2020 |         1 | Return On Assets | -0.00205902  |\n| MSN          |   2020 |         1 | Return On Equity | -0.00419562  |\n| MSN          |   2020 |         2 | Return On Assets |  0.000518152 |\n| MSN          |   2020 |         2 | Return On Equity |  0.00174282  |\n| MSN          |   2020 |         3 | Return On Assets |  0.00890101  |\n| MSN          |   2020 |         3 | Return On Equity |  0.0340108   |\n| MSN          |   2020 |         4 | Return On Assets |  0.00504934  |\n| MSN          |   2020 |         4 | Return On Equity |  0.0233474   |\n| MSN          |   2021 |         1 | Return On Assets |  0.0029478   |\n| MSN          |   2021 |         1 | Return On Equity |  0.0134906   |\n| MSN          |   2021 |         2 | Return On Assets |  0.00872816  |\n| MSN          |   2021 |         2 | Return On Equity |  0.0335106   |\n| MSN          |   2021 |         3 | Return On Assets |  0.0128556   |\n| MSN          |   2021 |         3 | Return On Equity |  0.0490112   |\n| MSN          |   2021 |         4 | Return On Assets |  0.056457    |\n| MSN          |   2021 |         4 | Return On Equity |  0.168149    |\n| MSN          |   2022 |         1 | Return On Assets |  0.0152471   |\n| MSN          |   2022 |         1 | Return On Equity |  0.0515801   |\n| MSN          |   2022 |         2 | Return On Assets |  0.00969881  |\n| MSN          |   2022 |         2 | Return On Equity |  0.0313142   |\n| MSN          |   2022 |         3 | Return On Assets |  0.00654813  |\n| MSN          |   2022 |         3 | Return On Equity |  0.0236221   |\n| MSN          |   2022 |         4 | Return On Assets |  0.00568514  |\n| MSN          |   2022 |         4 | Return On Equity |  0.021933    |\n| MSN          |   2023 |         1 | Return On Assets |  0.00301441  |\n| MSN          |   2023 |         1 | Return On Equity |  0.0118431   |\n| MSN          |   2023 |         2 | Return On Assets |  0.00304694  |\n| MSN          |   2023 |         2 | Return On Equity |  0.0114376   |\n| MSN          |   2023 |         3 | Return On Assets |  0.0033398   |\n| MSN          |   2023 |         3 | Return On Equity |  0.0127258   |\n| MSN          |   2023 |         4 | Return On Assets |  0.00350634  |\n| MSN          |   2023 |         4 | Return On Equity |  0.013515    |\n| MSN          |   2024 |         1 | Return On Assets |  0.00326811  |\n| MSN          |   2024 |         1 | Return On Equity |  0.0123309   |\n| VNM          |   2020 |         1 | Return On Assets |  0.0602688   |\n| VNM          |   2020 |         1 | Return On Equity |  0.0861112   |\n| VNM          |   2020 |         2 | Return On Assets |  0.0621928   |\n| VNM          |   2020 |         2 | Return On Equity |  0.095333    |\n| VNM          |   2020 |         3 | Return On Assets |  0.0622698   |\n| VNM          |   2020 |         3 | Return On Equity |  0.0990225   |\n| VNM          |   2020 |         4 | Return On Assets |  0.0461712   |\n| VNM          |   2020 |         4 | Return On Equity |  0.0664599   |\n| VNM          |   2021 |         1 | Return On Assets |  0.0508692   |\n| VNM          |   2021 |         1 | Return On Equity |  0.0764615   |\n| VNM          |   2021 |         2 | Return On Assets |  0.0539576   |\n| VNM          |   2021 |         2 | Return On Equity |  0.0832651   |\n| VNM          |   2021 |         3 | Return On Assets |  0.0568629   |\n| VNM          |   2021 |         3 | Return On Equity |  0.0874017   |\n| VNM          |   2021 |         4 | Return On Assets |  0.0414871   |\n| VNM          |   2021 |         4 | Return On Equity |  0.0617182   |\n| VNM          |   2022 |         1 | Return On Assets |  0.043085    |\n| VNM          |   2022 |         1 | Return On Equity |  0.06528     |\n| VNM          |   2022 |         2 | Return On Assets |  0.039045    |\n| VNM          |   2022 |         2 | Return On Equity |  0.057095    |\n| VNM          |   2022 |         3 | Return On Assets |  0.0453687   |\n| VNM          |   2022 |         3 | Return On Equity |  0.0686339   |\n| VNM          |   2022 |         4 | Return On Assets |  0.0385524   |\n| VNM          |   2022 |         4 | Return On Equity |  0.0569567   |\n| VNM          |   2023 |         1 | Return On Assets |  0.0386935   |\n| VNM          |   2023 |         1 | Return On Equity |  0.0552366   |\n| VNM          |   2023 |         2 | Return On Assets |  0.0811356   |\n| VNM          |   2023 |         2 | Return On Equity |  0.112804    |\n| VNM          |   2023 |         3 | Return On Assets |  0.0460866   |\n| VNM          |   2023 |         3 | Return On Equity |  0.0745011   |\n| VNM          |   2023 |         4 | Return On Assets |  0.044628    |\n| VNM          |   2023 |         4 | Return On Equity |  0.0671136   |\n| VNM          |   2024 |         1 | Return On Assets |  0.0427264   |\n| VNM          |   2024 |         1 | Return On Equity |  0.0615314   |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    fr.stock_code,\n    fr.year,\n    fr.quarter,\n    mcr.ratio_name,\n    fr.data\nFROM \n    financial_ratio fr\nJOIN \n    map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\nWHERE \n    fr.stock_code IN ('VNM', 'MSN')\n    AND mcr.ratio_name IN ('Return On Equity', 'Return On Assets')\n    AND ((fr.year = 2020 AND fr.quarter != 0) OR\n         (fr.year = 2021 AND fr.quarter != 0) OR\n         (fr.year = 2022 AND fr.quarter != 0) OR\n         (fr.year = 2023 AND fr.quarter != 0) OR\n         (fr.year = 2024 AND fr.quarter IN (1, 2)))\nORDER BY \n    fr.stock_code, fr.year, fr.quarter, mcr.ratio_name;\n"
            }
        ],
        "score": 1,
        "difficulty": 2,
        "response": "Table 1\n| stock_code   | industry           |\n|:-------------|:-------------------|\n| VNM          | Food and Beverages |\n| MSN          | Food and Beverages |\n\nTable 2\n| stock_code   | industry           |   year |   quarter | ratio_name       |         data |\n|:-------------|:-------------------|-------:|----------:|:-----------------|-------------:|\n| MSN          | Food and Beverages |   2020 |         1 | Return On Assets | -0.00205902  |\n| MSN          | Food and Beverages |   2020 |         1 | Return On Equity | -0.00419562  |\n| MSN          | Food and Beverages |   2020 |         2 | Return On Assets |  0.000518152 |\n| MSN          | Food and Beverages |   2020 |         2 | Return On Equity |  0.00174282  |\n| MSN          | Food and Beverages |   2021 |         1 | Return On Assets |  0.0029478   |\n| MSN          | Food and Beverages |   2021 |         1 | Return On Equity |  0.0134906   |\n| MSN          | Food and Beverages |   2021 |         2 | Return On Assets |  0.00872816  |\n| MSN          | Food and Beverages |   2021 |         2 | Return On Equity |  0.0335106   |\n| MSN          | Food and Beverages |   2022 |         1 | Return On Assets |  0.0152471   |\n| MSN          | Food and Beverages |   2022 |         1 | Return On Equity |  0.0515801   |\n| MSN          | Food and Beverages |   2022 |         2 | Return On Assets |  0.00969881  |\n| MSN          | Food and Beverages |   2022 |         2 | Return On Equity |  0.0313142   |\n| MSN          | Food and Beverages |   2023 |         1 | Return On Assets |  0.00301441  |\n| MSN          | Food and Beverages |   2023 |         1 | Return On Equity |  0.0118431   |\n| MSN          | Food and Beverages |   2023 |         2 | Return On Assets |  0.00304694  |\n| MSN          | Food and Beverages |   2023 |         2 | Return On Equity |  0.0114376   |\n| MSN          | Food and Beverages |   2024 |         1 | Return On Assets |  0.00326811  |\n| MSN          | Food and Beverages |   2024 |         1 | Return On Equity |  0.0123309   |\n| VNM          | Food and Beverages |   2020 |         1 | Return On Assets |  0.0602688   |\n| VNM          | Food and Beverages |   2020 |         1 | Return On Equity |  0.0861112   |\n| VNM          | Food and Beverages |   2020 |         2 | Return On Assets |  0.0621928   |\n| VNM          | Food and Beverages |   2020 |         2 | Return On Equity |  0.095333    |\n| VNM          | Food and Beverages |   2021 |         1 | Return On Assets |  0.0508692   |\n| VNM          | Food and Beverages |   2021 |         1 | Return On Equity |  0.0764615   |\n| VNM          | Food and Beverages |   2021 |         2 | Return On Assets |  0.0539576   |\n| VNM          | Food and Beverages |   2021 |         2 | Return On Equity |  0.0832651   |\n| VNM          | Food and Beverages |   2022 |         1 | Return On Assets |  0.043085    |\n| VNM          | Food and Beverages |   2022 |         1 | Return On Equity |  0.06528     |\n| VNM          | Food and Beverages |   2022 |         2 | Return On Assets |  0.039045    |\n| VNM          | Food and Beverages |   2022 |         2 | Return On Equity |  0.057095    |\n| VNM          | Food and Beverages |   2023 |         1 | Return On Assets |  0.0386935   |\n| VNM          | Food and Beverages |   2023 |         1 | Return On Equity |  0.0552366   |\n| VNM          | Food and Beverages |   2023 |         2 | Return On Assets |  0.0811356   |\n| VNM          | Food and Beverages |   2023 |         2 | Return On Equity |  0.112804    |\n| VNM          | Food and Beverages |   2024 |         1 | Return On Assets |  0.0427264   |\n| VNM          | Food and Beverages |   2024 |         1 | Return On Equity |  0.0615314   |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT stock_code, industry\nFROM company_info\nWHERE stock_code IN ('VNM', 'MSN');\n"
            },
            {
                "language": "sql",
                "code": "SELECT \n  fr.stock_code,\n  ci.industry,\n  fr.year,\n  fr.quarter,\n  mcr.ratio_name,\n  fr.data\nFROM \n  financial_ratio fr\n  INNER JOIN company_info ci ON fr.stock_code = ci.stock_code\n  INNER JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\nWHERE \n  fr.stock_code IN ('VNM', 'MSN')\n  AND fr.year BETWEEN 2020 AND 2024\n  AND fr.quarter!= 0  -- Quarters only (excluding annual reports)\n  AND fr.quarter <= 2  -- Up to Q2 2024\n  AND mcr.ratio_name IN ('Return On Equity', 'Return On Assets')\nORDER BY \n  fr.stock_code, \n  fr.year, \n  fr.quarter, \n  mcr.ratio_name\nLIMIT 100;  -- Add limit as per database schema requirements\n"
            }
        ],
        "time": 39.71504807472229,
        "evaluate": 0,
        "input_token": 2066,
        "output_token": 554
    },
    {
        "id": "55ac4539-ffb5-4f26-ac74-c282a46db6b7",
        "question": "What is the trend of the Return on Equity (ROE) for Vietcombank, Techcombank, and ACB from 2020 to Q2 2024?",
        "answer": "Table 1\n| stock_code   |   year |   quarter |       roe |\n|:-------------|-------:|----------:|----------:|\n| ACB          |   2020 |         0 | 0.216734  |\n| ACB          |   2021 |         0 | 0.213865  |\n| ACB          |   2022 |         0 | 0.234232  |\n| ACB          |   2023 |         0 | 0.226122  |\n| ACB          |   2024 |         1 | 0.052218  |\n| TCB          |   2020 |         0 | 0.168632  |\n| TCB          |   2021 |         0 | 0.197927  |\n| TCB          |   2022 |         0 | 0.180176  |\n| TCB          |   2023 |         0 | 0.139608  |\n| TCB          |   2024 |         1 | 0.0459854 |\n| TCB          |   2024 |         2 | 0.0457096 |\n| VCB          |   2020 |         0 | 0.196318  |\n| VCB          |   2021 |         0 | 0.201059  |\n| VCB          |   2022 |         0 | 0.220567  |\n| VCB          |   2023 |         0 | 0.200315  |\n| VCB          |   2024 |         1 | 0.0494831 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    stock_code, \n    year, \n    quarter, \n    data AS roe\nFROM \n    financial_ratio\nWHERE \n    ratio_code = 'ROE'\n    AND stock_code IN ('VCB', 'TCB', 'ACB')\n    AND (\n        (year BETWEEN 2020 AND 2023 AND quarter = 0) -- Annual data from 2020 to 2023\n        OR (year = 2024 AND quarter BETWEEN 1 AND 2) -- Quarterly data for Q1 and Q2 of 2024\n    )\nORDER BY \n    stock_code, \n    year, \n    quarter;\n"
            }
        ],
        "score": 1,
        "difficulty": 2,
        "response": "Table 1\n| stock_code   | company_name                                       |   year |   quarter |   roe_value |\n|:-------------|:---------------------------------------------------|-------:|----------:|------------:|\n| ACB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n \u00c1 Ch\u00e2u                |   2020 |         2 |   0.0493524 |\n| ACB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n \u00c1 Ch\u00e2u                |   2020 |         4 |   0.0719231 |\n| ACB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n \u00c1 Ch\u00e2u                |   2021 |         2 |   0.0640966 |\n| ACB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n \u00c1 Ch\u00e2u                |   2021 |         4 |   0.0540857 |\n| ACB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n \u00c1 Ch\u00e2u                |   2022 |         2 |   0.0757336 |\n| ACB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n \u00c1 Ch\u00e2u                |   2022 |         4 |   0.0491202 |\n| ACB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n \u00c1 Ch\u00e2u                |   2023 |         2 | nan         |\n| TCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam    |   2020 |         2 |   0.0428449 |\n| TCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam    |   2020 |         4 |   0.0537099 |\n| TCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam    |   2021 |         2 |   0.0572896 |\n| TCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam    |   2021 |         4 |   0.0503334 |\n| TCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam    |   2022 |         2 |   0.0562806 |\n| TCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam    |   2022 |         4 |   0.031493  |\n| TCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam    |   2023 |         2 |   0.0367734 |\n| TCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam    |   2023 |         4 |   0.0381519 |\n| TCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam    |   2024 |         2 |   0.0457096 |\n| VCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ngo\u1ea1i th\u01b0\u01a1ng Vi\u1ec7t Nam |   2020 |         2 |   0.0515214 |\n| VCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ngo\u1ea1i th\u01b0\u01a1ng Vi\u1ec7t Nam |   2020 |         4 |   0.0573927 |\n| VCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ngo\u1ea1i th\u01b0\u01a1ng Vi\u1ec7t Nam |   2021 |         2 |   0.0377385 |\n| VCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ngo\u1ea1i th\u01b0\u01a1ng Vi\u1ec7t Nam |   2021 |         4 |   0.0580801 |\n| VCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ngo\u1ea1i th\u01b0\u01a1ng Vi\u1ec7t Nam |   2022 |         2 |   0.0483124 |\n| VCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ngo\u1ea1i th\u01b0\u01a1ng Vi\u1ec7t Nam |   2022 |         4 |   0.0719881 |\n| VCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ngo\u1ea1i th\u01b0\u01a1ng Vi\u1ec7t Nam |   2023 |         2 |   0.139806  |\n| VCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ngo\u1ea1i th\u01b0\u01a1ng Vi\u1ec7t Nam |   2023 |         4 |   0.0555349 |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT \n  fr.stock_code,\n  ci.company_name,\n  fr.year,\n  fr.quarter,\n  fr.data AS ROE_Value\nFROM \n  financial_ratio fr\n  INNER JOIN company_info ci ON fr.stock_code = ci.stock_code\n  INNER JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\nWHERE \n  fr.ratio_code = 'ROE'  -- Return on Equity\n  AND fr.stock_code IN ('VCB', 'TCB', 'ACB')  -- Identified stock codes\n  AND fr.quarter IN (2, 4, 6, 8)  -- Q2 values\n  AND fr.year IN (2020, 2021, 2022, 2023, 2024)  -- Corresponding year values\nORDER BY \n  fr.stock_code, \n  fr.year, \n  fr.quarter\nLIMIT 100;  -- Add limit as per the database schema requirement\n"
            }
        ],
        "time": 39.580395221710205,
        "evaluate": 0,
        "input_token": 11058,
        "output_token": 3064
    },
    {
        "id": "8f89fda6-e0a1-4b9e-851f-61c5b9d2a533",
        "question": "Compare the Net Profit Margin and the Current Ratio of Vinamilk and Masan Group from 2020 to Q2 2024.  Analyze the changes in these ratios over time for both companies, focusing on any significant variations and potential contributing factors.",
        "answer": "Table 1\n| stock_code   |   year |   quarter | ratio_name    |     data |\n|:-------------|-------:|----------:|:--------------|---------:|\n| MSN          |   2020 |         0 | Current Ratio | 0.773354 |\n| MSN          |   2021 |         0 | Current Ratio | 1.27032  |\n| MSN          |   2022 |         0 | Current Ratio | 0.73558  |\n| MSN          |   2023 |         0 | Current Ratio | 0.874439 |\n| VNM          |   2020 |         0 | Current Ratio | 2.09132  |\n| VNM          |   2021 |         0 | Current Ratio | 2.11895  |\n| VNM          |   2022 |         0 | Current Ratio | 2.06801  |\n| VNM          |   2023 |         0 | Current Ratio | 2.1016   |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    fr.stock_code,\n    fr.year,\n    fr.quarter,\n    mccr.ratio_name,\n    fr.data\nFROM \n    financial_ratio fr\nJOIN \n    map_category_code_ratio mccr ON fr.ratio_code = mccr.ratio_code\nWHERE \n    fr.stock_code IN ('VNM', 'MSN')\n    AND mccr.ratio_code IN ('NPM', 'CurrentR')\n    AND (\n        (fr.year BETWEEN 2020 AND 2024 AND fr.quarter = 0) OR\n        (fr.year = 2024 AND fr.quarter = 2)\n    )\nORDER BY \n    fr.stock_code, \n    fr.year, \n    fr.quarter, \n    mccr.ratio_name;\n"
            }
        ],
        "score": 1,
        "difficulty": 2,
        "response": "Table 1\n| stock_code   |   year |   quarter | ratio_name    |   ratio_value |\n|:-------------|-------:|----------:|:--------------|--------------:|\n| MSN          |   2021 |         0 | Current Ratio |      1.27032  |\n| MSN          |   2022 |         0 | Current Ratio |      0.73558  |\n| MSN          |   2023 |         0 | Current Ratio |      0.874439 |\n| VNM          |   2020 |         0 | Current Ratio |      2.09132  |\n| VNM          |   2022 |         0 | Current Ratio |      2.06801  |\n| MSN          |   2020 |         0 | Current Ratio |      0.773354 |\n| VNM          |   2021 |         0 | Current Ratio |      2.11895  |\n| VNM          |   2023 |         0 | Current Ratio |      2.1016   |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT \n  fr.stock_code,\n  fr.year,\n  fr.quarter,\n  mcr.ratio_name AS ratio_name,\n  fr.data AS ratio_value\nFROM \n  financial_ratio fr\n  INNER JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\n  INNER JOIN company_info ci ON fr.stock_code = ci.stock_code\nWHERE \n  (fr.stock_code = 'VNM' OR fr.stock_code = 'MSN')\n  AND mcr.ratio_name IN ('Net profit margin', 'Current Ratio')\n  AND fr.year BETWEEN 2020 AND 2024\n  AND (fr.quarter = 0 OR (fr.year = 2024 AND fr.quarter = 2))\nLIMIT 100;\n"
            }
        ],
        "time": 36.556986570358276,
        "evaluate": 1,
        "input_token": 1970,
        "output_token": 522
    },
    {
        "id": "5acf9fe2-b166-443f-8511-111e3acea0ce",
        "question": "Rank the top 5 companies with the highest Return on Equity (ROE) from 2020 to Q2 2024, calculated as Net Income divided by Average Shareholder Equity.",
        "answer": "Table 1\n| stock_code   | company_name                                   | en_company_name                                                         | industry                             |   year |   quarter |        roe |\n|:-------------|:-----------------------------------------------|:------------------------------------------------------------------------|:-------------------------------------|-------:|----------:|-----------:|\n| VC3          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Nam M\u00ea K\u00f4ng           | Nam MeKong Group Joint Stock Company                                    | Real Estate                          |   2022 |         0 | nan        |\n| GAS          | T\u1ed5ng C\u00f4ng ty Kh\u00ed Vi\u1ec7t Nam - C\u00f4ng ty C\u1ed5 ph\u1ea7n    | PetroVietnam Gas Joint Stock Corporation                                | Utilities (Electricity, Water & Gas) |   2024 |         1 | nan        |\n| DGC          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n H\u00f3a ch\u1ea5t \u0110\u1ee9c Giang    | Ducgiang Chemicals Group Joint Stock Company                            | Chemicals                            |   2022 |         0 |   0.557243 |\n| CAP          | C\u00f4ng ty C\u1ed5 ph\u1ea7n L\u00e2m N\u00f4ng s\u1ea3n Th\u1ef1c ph\u1ea9m Y\u00ean B\u00e1i | Yen Bai Joint Stock Forest Agricultural Products And Foodstuffs Company | Basic Resources                      |   2022 |         0 |   0.546075 |\n| L14          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Licogi 14                      | Licogi 14 Joint Stock Company                                           | Construction and Materials           |   2021 |         0 |   0.493854 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    fr.stock_code,\n    ci.company_name,\n    ci.en_company_name,\n    ci.industry,\n    fr.year,\n    fr.quarter,\n    fr.data AS roe\nFROM \n    financial_ratio fr\nJOIN \n    company_info ci ON fr.stock_code = ci.stock_code\nWHERE \n    fr.ratio_code = 'ROE'\n    AND ((fr.year = 2020 AND fr.quarter = 0) OR\n         (fr.year = 2021 AND fr.quarter = 0) OR\n         (fr.year = 2022 AND fr.quarter = 0) OR\n         (fr.year = 2023 AND fr.quarter = 0) OR\n         (fr.year = 2024 AND fr.quarter IN (1, 2)))\nORDER BY \n    fr.data DESC\nLIMIT 5;\n"
            }
        ],
        "score": 1,
        "difficulty": 2,
        "response": "",
        "code_response": [
            {
                "language": "sql",
                "code": "-- Create a temporary view for financial_data to avoid CTE nesting issues\nCREATE TEMPORARY VIEW financial_data AS\n  SELECT \n    'non_bank' AS company_type,\n    nbf.stock_code,\n    nbf.year,\n    nbf.quarter,\n    nbf.data AS net_income,  \n    nb.bs_data AS shareholder_equity  \n  FROM \n    non_bank_financial_report nbf\n  JOIN \n    map_category_code_non_bank mcnb ON nbf.category_code = mcnb.category_code\n  LEFT JOIN \n    (SELECT \n       nbf2.stock_code, \n       nbf2.year, \n       nbf2.quarter, \n       nbf2.data AS bs_data\n     FROM \n       non_bank_financial_report nbf2\n     JOIN \n       map_category_code_non_bank mcnb2 ON nbf2.category_code = mcnb2.category_code\n     WHERE \n       mcnb2.category_code = 'BS_400') nb\n    ON nbf.stock_code = nb.stock_code AND nbf.year = nb.year AND nbf.quarter = nb.quarter\n  WHERE \n    mcnb.en_caption = 'Net profit from operating activities'\n    AND nbf.year BETWEEN 2020 AND 2024\n    AND nbf.quarter IN (1, 2, 3, 4)\n\n  UNION ALL\n\n  SELECT \n    'bank' AS company_type,\n    bfr.stock_code,\n    bfr.year,\n    bfr.quarter,\n    bfr.data AS net_income,  \n    mb.bs_data AS shareholder_equity  \n  FROM \n    bank_financial_report bfr\n  JOIN \n    map_category_code_bank mcb ON bfr.category_code = mcb.category_code\n  LEFT JOIN \n    (SELECT \n       bfr2.stock_code, \n       bfr2.year, \n       bfr2.quarter, \n       bfr2.data AS bs_data\n     FROM \n       bank_financial_report bfr2\n     JOIN \n       map_category_code_bank mcb2 ON bfr2.category_code = mcb2.category_code\n     WHERE \n       mcb2.category_code = 'BS_500') mb\n    ON bfr.stock_code = mb.stock_code AND bfr.year = mb.year AND bfr.quarter = mb.quarter\n  WHERE \n    mcb.en_caption = 'Net profit/(loss) from other activities'\n    AND bfr.year BETWEEN 2020 AND 2024\n    AND bfr.quarter IN (1, 2, 3, 4)\n\n  UNION ALL\n\n  SELECT \n    'securities' AS company_type,\n    sfr.stock_code,\n    sfr.year,\n    sfr.quarter,\n    sfr.data AS net_income,  \n    ms.bs_data AS shareholder_equity  \n  FROM \n    securities_financial_report sfr\n  JOIN \n    map_category_code_securities mcs ON sfr.category_code = mcs.category_code\n  LEFT JOIN \n    (SELECT \n       sfr2.stock_code, \n       sfr2.year, \n       sfr2.quarter, \n       sfr2.data AS bs_data\n     FROM \n       securities_financial_report sfr2\n     JOIN \n       map_category_code_securities mcs2 ON sfr2.category_code = mcs2.category_code\n     WHERE \n       mcs2.category_code = 'BS_400') ms\n    ON sfr.stock_code = ms.stock_code AND sfr.year = ms.year AND sfr.quarter = ms.quarter\n  WHERE \n    mcs.en_caption = 'Total comprehensive income'\n    AND sfr.year BETWEEN 2020 AND 2024\n    AND sfr.quarter IN (1, 2, 3, 4);\n\n-- Calculate ROE, rank, and identify top 5 companies\nSELECT \n  stock_code,\n  AVG(roe) AS avg_roe\nFROM (\n  SELECT \n    stock_code,\n    year,\n    quarter,\n    CASE \n      WHEN shareholder_equity = 0 THEN NULL  -- Avoid division by zero\n      ELSE net_income / shareholder_equity \n    END AS roe\n  FROM \n    financial_data\n) subquery\nGROUP BY \n  stock_code\nORDER BY \n  avg_roe DESC\nLIMIT 5;\n"
            }
        ],
        "time": 164.88895082473755,
        "evaluate": 0,
        "input_token": 6371,
        "output_token": 1751
    },
    {
        "id": "87f74847-ecb4-42ee-8cfc-46eb78d61d84",
        "question": "For the period 2020 to Q2 2024, rank the top 10 companies based on their Debt-to-Equity ratio, calculated as Total Debt divided by Total Equity.  This ratio will show the financial leverage of each company.",
        "answer": "Table 1\n| stock_code   | industry    |   year |   quarter |   debt_to_equity_ratio |\n|:-------------|:------------|-------:|----------:|-----------------------:|\n| VC3          | Real Estate |   2022 |         0 |               nan      |\n| NVB          | Banking     |   2020 |         0 |                20.0192 |\n| BID          | Banking     |   2021 |         0 |                19.4068 |\n| BID          | Banking     |   2022 |         0 |                19.3533 |\n| NVB          | Banking     |   2024 |         2 |                19.2545 |\n| BID          | Banking     |   2020 |         0 |                18.0427 |\n| BID          | Banking     |   2023 |         0 |                17.7184 |\n| BID          | Banking     |   2024 |         2 |                17.7161 |\n| NVB          | Banking     |   2021 |         0 |                16.3027 |\n| LPB          | Banking     |   2021 |         0 |                16.212  |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    fr.stock_code,\n    ci.industry,\n    fr.year,\n    fr.quarter,\n    fr.data AS debt_to_equity_ratio\nFROM \n    financial_ratio fr\nJOIN \n    company_info ci ON fr.stock_code = ci.stock_code\nWHERE \n    fr.ratio_code = 'DTER'\n    AND ((fr.year = 2020 AND fr.quarter = 0) OR\n         (fr.year = 2021 AND fr.quarter = 0) OR\n         (fr.year = 2022 AND fr.quarter = 0) OR\n         (fr.year = 2023 AND fr.quarter = 0) OR\n         (fr.year = 2024 AND fr.quarter = 2))\nORDER BY \n    fr.data DESC\nLIMIT 10;\n"
            }
        ],
        "score": 1,
        "difficulty": 2,
        "response": "Table 1\n| stock_code   | company_type   |   year |   quarter |   debt_to_equity_ratio |\n|:-------------|:---------------|-------:|----------:|-----------------------:|\n| NVB          | bank           |   2024 |         2 |            2.06624e+07 |\n| NVB          | bank           |   2024 |         2 |            2.06624e+07 |\n| NVB          | bank           |   2024 |         2 |            1.96423e+07 |\n| NVB          | bank           |   2024 |         2 |            1.70826e+07 |\n| NVB          | bank           |   2020 |         0 |            1.70677e+07 |\n| NVB          | bank           |   2021 |         2 |            1.6794e+07  |\n| NVB          | bank           |   2021 |         2 |            1.6794e+07  |\n| NVB          | bank           |   2021 |         2 |            1.59213e+07 |\n| NVB          | bank           |   2022 |         2 |            1.50938e+07 |\n| NVB          | bank           |   2022 |         2 |            1.50938e+07 |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "WITH relevant_companies AS (\n  SELECT stock_code\n  FROM company_info\n  WHERE (EXISTS (SELECT 1 FROM bank_financial_report WHERE year = 2020 AND quarter = 0 AND company_info.stock_code = bank_financial_report.stock_code)\n         OR EXISTS (SELECT 1 FROM non_bank_financial_report WHERE year = 2020 AND quarter = 0 AND company_info.stock_code = non_bank_financial_report.stock_code)\n         OR EXISTS (SELECT 1 FROM securities_financial_report WHERE year = 2020 AND quarter = 0 AND company_info.stock_code = securities_financial_report.stock_code))\n    OR (EXISTS (SELECT 1 FROM bank_financial_report WHERE year BETWEEN 2021 AND 2024 AND quarter BETWEEN 1 AND 2 AND company_info.stock_code = bank_financial_report.stock_code)\n        OR EXISTS (SELECT 1 FROM non_bank_financial_report WHERE year BETWEEN 2021 AND 2024 AND quarter BETWEEN 1 AND 2 AND company_info.stock_code = non_bank_financial_report.stock_code)\n        OR EXISTS (SELECT 1 FROM securities_financial_report WHERE year BETWEEN 2021 AND 2024 AND quarter BETWEEN 1 AND 2 AND company_info.stock_code = securities_financial_report.stock_code))\n)\n, financial_data AS (\n  SELECT \n    'non_bank' AS company_type,\n    b.stock_code,\n    b.year,\n    b.quarter,\n    (b.data - e.data) AS total_debt,\n    e.data AS total_equity\n  FROM non_bank_financial_report b\n  JOIN map_category_code_non_bank m ON b.category_code = m.category_code\n  JOIN non_bank_financial_report e ON b.stock_code = e.stock_code AND e.category_code = 'BS_400'\n  WHERE b.category_code = 'BS_440' AND b.stock_code IN (SELECT stock_code FROM relevant_companies)\n  AND (b.year = 2020 AND b.quarter = 0) OR (b.year BETWEEN 2021 AND 2024 AND b.quarter = 2)\n\n  UNION ALL\n\n  SELECT \n    'bank' AS company_type,\n    b.stock_code,\n    b.year,\n    b.quarter,\n    b.data AS total_debt,\n    e.data AS total_equity\n  FROM bank_financial_report b\n  JOIN map_category_code_bank m ON b.category_code = m.category_code\n  JOIN bank_financial_report e ON b.stock_code = e.stock_code AND e.category_code = 'BS_500'\n  WHERE b.category_code = 'BS_400' AND b.stock_code IN (SELECT stock_code FROM relevant_companies)\n  AND (b.year = 2020 AND b.quarter = 0) OR (b.year BETWEEN 2021 AND 2024 AND b.quarter = 2)\n\n  UNION ALL\n\n  SELECT \n    'securities' AS company_type,\n    b.stock_code,\n    b.year,\n    b.quarter,\n    (b.data - e.data) AS total_debt,\n    e.data AS total_equity\n  FROM securities_financial_report b\n  JOIN map_category_code_securities m ON b.category_code = m.category_code\n  JOIN securities_financial_report e ON b.stock_code = e.stock_code AND e.category_code = 'BS_400'\n  WHERE b.category_code = 'BS_440' AND b.stock_code IN (SELECT stock_code FROM relevant_companies)\n  AND (b.year = 2020 AND b.quarter = 0) OR (b.year BETWEEN 2021 AND 2024 AND b.quarter = 2)\n)\nSELECT \n  stock_code,\n  company_type,\n  year,\n  quarter,\n  CASE \n    WHEN total_equity = 0 THEN NULL  -- Avoid division by zero\n    ELSE total_debt / total_equity \n  END AS debt_to_equity_ratio\nFROM financial_data\nWHERE total_equity <> 0  -- Exclude rows with zero total equity\nORDER BY debt_to_equity_ratio DESC\nLIMIT 10;\n"
            }
        ],
        "time": 167.89060997962952,
        "evaluate": 0,
        "input_token": 4771,
        "output_token": 1150
    },
    {
        "id": "6bd17126-d46e-4133-bedf-a54fcef397a2",
        "question": "What were the Return on Equity (ROE) and Return on Assets (ROA) for Vietcombank and Techcombank in 2022?",
        "answer": "Table 1\n| stock_code   | ratio_code   |   ratio_value |\n|:-------------|:-------------|--------------:|\n| VCB          | ROE          |     0.220567  |\n| TCB          | ROA          |     0.0292353 |\n| TCB          | ROE          |     0.180176  |\n| VCB          | ROA          |     0.0164951 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    stock_code, \n    ratio_code, \n    data AS ratio_value\nFROM \n    financial_ratio\nWHERE \n    (stock_code = 'VCB' OR stock_code = 'TCB') \n    AND (ratio_code = 'ROE' OR ratio_code = 'ROA') \n    AND year = 2022 \n    AND quarter = 0;\n"
            }
        ],
        "score": 1,
        "difficulty": 2,
        "response": "Table 1\n| stock_code   | ratio            |   ratio_value |\n|:-------------|:-----------------|--------------:|\n| TCB          | Return On Assets |     0.0292353 |\n| TCB          | Return On Equity |     0.180176  |\n| VCB          | Return On Assets |     0.0164951 |\n| VCB          | Return On Equity |     0.220567  |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT \n  fr.stock_code,\n  mcr.ratio_name AS ratio,\n  fr.data AS ratio_value\nFROM \n  financial_ratio fr\n  INNER JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\nWHERE \n  fr.stock_code IN ('VCB', 'TCB')\n  AND fr.year = 2022\n  AND fr.quarter = 0\n  AND mcr.ratio_code IN ('ROE', 'ROA')\nLIMIT 4;  -- Assuming each bank will have both ROE and ROA, thus 4 rows max\n"
            }
        ],
        "time": 42.01334476470947,
        "evaluate": 1,
        "input_token": 3179,
        "output_token": 885
    },
    {
        "id": "bae902e9-0a14-42b8-a499-26336872e762",
        "question": "Compare the Net Income, Total Assets, and Total Liabilities of Vinamilk and Masan Group for the fiscal year 2023.  Calculate the Debt-to-Equity ratio for both companies.",
        "answer": "Table 1\n| stock_code   |   net_income |   total_assets |   total_liabilities |   debt_to_equity_ratio |\n|:-------------|-------------:|---------------:|--------------------:|-----------------------:|\n| MSN          |  2.35043e+06 |    1.47383e+08 |         1.09146e+08 |               2.85445  |\n| VNM          |  1.09036e+07 |    5.26734e+07 |         1.76476e+07 |               0.503847 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "WITH financial_data AS (\n    SELECT \n        stock_code,\n        SUM(CASE WHEN category_code = 'IS_030' THEN data ELSE 0 END) AS net_income,\n        SUM(CASE WHEN category_code = 'BS_270' THEN data ELSE 0 END) AS total_assets,\n        SUM(CASE WHEN category_code = 'BS_300' THEN data ELSE 0 END) AS total_liabilities\n    FROM \n        non_bank_financial_report\n    WHERE \n        stock_code IN ('VNM', 'MSN') AND\n        year = 2023 AND\n        quarter = 0\n    GROUP BY \n        stock_code\n)\nSELECT \n    fd.stock_code,\n    fd.net_income,\n    fd.total_assets,\n    fd.total_liabilities,\n    (fd.total_liabilities / (fd.total_assets - fd.total_liabilities)) AS debt_to_equity_ratio\nFROM \n    financial_data fd;\n"
            }
        ],
        "score": 1,
        "difficulty": 3,
        "response": "Table 1\n| stock_code   | en_caption   | data   |\n|--------------|--------------|--------|\n\nTable 2\n| stock_code   | ratio_name           |   debt_to_equity_ratio |\n|:-------------|:---------------------|-----------------------:|\n| MSN          | Debt To Equity Ratio |               2.85445  |\n| VNM          | Debt To Equity Ratio |               0.503847 |\n\nTable 3\n| stock_code   | financial_metric   | financial_data   | debt_to_equity_ratio   |\n|--------------|--------------------|------------------|------------------------|\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "-- Retrieve stock codes for Vinamilk (VNM) and Masan Group (MSN)\nWITH company_codes AS (\n  SELECT stock_code\n  FROM company_info\n  WHERE stock_code IN ('VNM', 'MSN')\n)\n-- Retrieve financial data for Net Income, Total Assets, and Total Liabilities\nSELECT \n  c.stock_code,\n  m.en_caption,\n  f.data\nFROM \n  company_codes c\n  JOIN non_bank_financial_report f ON c.stock_code = f.stock_code\n  JOIN map_category_code_non_bank m ON f.category_code = m.category_code\nWHERE \n  f.year = 2023 AND f.quarter = 0\n  AND m.en_caption IN ('Net Income', 'Total Assets', 'Total Liabilities')\nORDER BY \n  c.stock_code, m.en_caption\nLIMIT 100;\n"
            },
            {
                "language": "sql",
                "code": "-- Retrieve Debt-to-Equity ratio for Vinamilk (VNM) and Masan Group (MSN)\nSELECT \n  c.stock_code,\n  r.ratio_name,\n  f.data AS debt_to_equity_ratio\nFROM \n  company_info c\n  JOIN financial_ratio f ON c.stock_code = f.stock_code\n  JOIN map_category_code_ratio r ON f.ratio_code = r.ratio_code\nWHERE \n  c.stock_code IN ('VNM', 'MSN')\n  AND f.year = 2023 AND f.quarter = 0\n  AND r.ratio_name = 'Debt To Equity Ratio'\nORDER BY \n  c.stock_code\nLIMIT 100;\n"
            },
            {
                "language": "sql",
                "code": "-- Combined query for financial data and Debt-to-Equity ratio\nWITH company_codes AS (\n  SELECT stock_code\n  FROM company_info\n  WHERE stock_code IN ('VNM', 'MSN')\n),\nfinancial_data AS (\n  SELECT \n    c.stock_code,\n    m.en_caption,\n    f.data\n  FROM \n    company_codes c\n    JOIN non_bank_financial_report f ON c.stock_code = f.stock_code\n    JOIN map_category_code_non_bank m ON f.category_code = m.category_code\n  WHERE \n    f.year = 2023 AND f.quarter = 0\n    AND m.en_caption IN ('Net Income', 'Total Assets', 'Total Liabilities')\n),\ndebt_to_equity_ratio AS (\n  SELECT \n    c.stock_code,\n    r.ratio_name,\n    f.data AS debt_to_equity_ratio\n  FROM \n    company_info c\n    JOIN financial_ratio f ON c.stock_code = f.stock_code\n    JOIN map_category_code_ratio r ON f.ratio_code = r.ratio_code\n  WHERE \n    c.stock_code IN ('VNM', 'MSN')\n    AND f.year = 2023 AND f.quarter = 0\n    AND r.ratio_name = 'Debt To Equity Ratio'\n)\nSELECT \n  fd.stock_code,\n  fd.en_caption AS financial_metric,\n  fd.data AS financial_data,\n  der.debt_to_equity_ratio\nFROM \n  financial_data fd\n  LEFT JOIN debt_to_equity_ratio der ON fd.stock_code = der.stock_code\nORDER BY \n  fd.stock_code, fd.en_caption\nLIMIT 100;\n"
            }
        ],
        "time": 91.53189182281494,
        "evaluate": 0,
        "input_token": 6890,
        "output_token": 2781
    },
    {
        "id": "ccdf4a0a-dd91-4147-a7b5-61cd342fc390",
        "question": "For the year 2021, what were the values of  accounts receivable, and inventory for Mobile World Investment, Vinamilk, and Masan Group?  Additionally, provide a breakdown of the investments in subsidiaries or associated companies for each of these companies, specifying the investment value and the nature of the investment (e.g., equity stake, loan).",
        "answer": "Table 1\n| stock_code   | category                                    |            value |\n|:-------------|:--------------------------------------------|-----------------:|\n| VNM          | Trade receivables                           |      4.36777e+06 |\n| VNM          | Inventories                                 |      6.82049e+06 |\n| MSN          | Trade receivables                           |      2.48022e+06 |\n| MSN          | Inventories                                 |      1.29479e+07 |\n| MWG          | Trade receivables                           | 384236           |\n| MWG          | Inventories                                 |      2.98501e+07 |\n| VNM          | Investment in subsidiaries                  |      0           |\n| VNM          | Investment in subsidiaries                  |      0           |\n| VNM          | Investment in subsidiaries                  |      0           |\n| VNM          | Investment in subsidiaries                  |      0           |\n| VNM          | Investment in subsidiaries                  |      0           |\n| VNM          | Investment in associates and joint ventures | 661023           |\n| VNM          | Investment in associates and joint ventures | 661023           |\n| VNM          | Investment in associates and joint ventures | 661023           |\n| VNM          | Investment in associates and joint ventures | 661023           |\n| VNM          | Investment in associates and joint ventures | 661023           |\n| MSN          | Investment in subsidiaries                  |      0           |\n| MSN          | Investment in subsidiaries                  |      0           |\n| MSN          | Investment in subsidiaries                  |      0           |\n| MSN          | Investment in subsidiaries                  |      0           |\n| MSN          | Investment in subsidiaries                  |      0           |\n| MSN          | Investment in subsidiaries                  |      0           |\n| MSN          | Investment in subsidiaries                  |      0           |\n| MSN          | Investment in subsidiaries                  |      0           |\n| MSN          | Investment in associates and joint ventures |      2.45388e+07 |\n| MSN          | Investment in associates and joint ventures |      2.45388e+07 |\n| MSN          | Investment in associates and joint ventures |      2.45388e+07 |\n| MSN          | Investment in associates and joint ventures |      2.45388e+07 |\n| MSN          | Investment in associates and joint ventures |      2.45388e+07 |\n| MSN          | Investment in associates and joint ventures |      2.45388e+07 |\n| MSN          | Investment in associates and joint ventures |      2.45388e+07 |\n| MSN          | Investment in associates and joint ventures |      2.45388e+07 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "-- Query to get accounts receivable and inventory values for the specified companies\nSELECT \n    nbfr.stock_code,\n    mccnb.en_caption AS category,\n    nbfr.data AS value\nFROM \n    non_bank_financial_report nbfr\nJOIN \n    map_category_code_non_bank mccnb ON nbfr.category_code = mccnb.category_code\nWHERE \n    nbfr.stock_code IN ('MWG', 'VNM', 'MSN')\n    AND nbfr.year = 2021\n    AND nbfr.quarter = 0\n    AND nbfr.category_code IN ('BS_131', 'BS_141')\n\nUNION ALL\n\n-- Query to get investment details for the specified companies\nSELECT \n    s.stock_code,\n    CASE \n        WHEN nbfr.category_code = 'BS_251' THEN 'Investment in subsidiaries'\n        WHEN nbfr.category_code = 'BS_252' THEN 'Investment in associates and joint ventures'\n    END AS category,\n    nbfr.data AS value\nFROM \n    non_bank_financial_report nbfr\nJOIN \n    sub_and_shareholder s ON nbfr.stock_code = s.stock_code\nWHERE \n    nbfr.stock_code IN ('MWG', 'VNM', 'MSN')\n    AND nbfr.year = 2021\n    AND nbfr.quarter = 0\n    AND nbfr.category_code IN ('BS_251', 'BS_252');\n"
            }
        ],
        "score": 1,
        "difficulty": 3,
        "response": "Table 1\n| stock_code   |   accounts_receivable |   inventory |\n|:-------------|----------------------:|------------:|\n| MSN          |      332753           | 1.28134e+07 |\n| MWG          |           1.42366e+07 | 2.91672e+07 |\n| VNM          |           2.10257e+07 | 6.77307e+06 |\n\nTable 2\n| stock_code   |   accounts_receivable |   inventory | invested_company   |\n|:-------------|----------------------:|------------:|:-------------------|\n| MSN          |      332753           | 1.28134e+07 | TCB                |\n| MSN          |      332753           | 1.28134e+07 | MSR                |\n| MSN          |      332753           | 1.28134e+07 | MCH                |\n| MSN          |      332753           | 1.28134e+07 | VCF                |\n| MSN          |      332753           | 1.28134e+07 | QHW                |\n| MSN          |      332753           | 1.28134e+07 | VSN                |\n| MSN          |      332753           | 1.28134e+07 | MML                |\n| MSN          |      332753           | 1.28134e+07 | CMF                |\n| MWG          |           1.42366e+07 | 2.91672e+07 |                    |\n| VNM          |           2.10257e+07 | 6.77307e+06 | VLC                |\n| VNM          |           2.10257e+07 | 6.77307e+06 | MCM                |\n| VNM          |           2.10257e+07 | 6.77307e+06 | SBT                |\n| VNM          |           2.10257e+07 | 6.77307e+06 | SRF                |\n| VNM          |           2.10257e+07 | 6.77307e+06 | TDW                |\n\nTable 3\n| stock_code   |   accounts_receivable |   inventory | invested_company   |\n|:-------------|----------------------:|------------:|:-------------------|\n| MSN          |                     0 |           0 | TCB                |\n| MSN          |                     0 |           0 | MSR                |\n| MSN          |                     0 |           0 | MCH                |\n| MSN          |                     0 |           0 | VCF                |\n| MSN          |                     0 |           0 | QHW                |\n| MSN          |                     0 |           0 | VSN                |\n| MSN          |                     0 |           0 | MML                |\n| MSN          |                     0 |           0 | CMF                |\n| MWG          |                     0 |           0 |                    |\n| VNM          |                     0 |           0 | VLC                |\n| VNM          |                     0 |           0 | MCM                |\n| VNM          |                     0 |           0 | SBT                |\n| VNM          |                     0 |           0 | SRF                |\n| VNM          |                     0 |           0 | TDW                |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "-- Combine financial data (2021, quarter=0) with investment information\nWITH target_companies AS (\n  SELECT stock_code\n  FROM company_info\n  WHERE stock_code IN ('MWG', 'VNM', 'MSN')  -- Assuming these are the correct stock codes\n)\nSELECT \n  tc.stock_code,\n  COALESCE(ar.data, 0) AS accounts_receivable,\n  COALESCE(inv.data, 0) AS inventory,\n  ssh.invest_on AS invested_company\nFROM \n  target_companies tc\n  LEFT JOIN non_bank_financial_report ar \n    ON tc.stock_code = ar.stock_code \n    AND ar.year = 2021 \n    AND ar.quarter = 0 \n    AND ar.category_code = (  -- Assuming BS_120 for Accounts Receivable, replace with actual value\n      SELECT category_code \n      FROM map_category_code_non_bank \n      WHERE en_caption = 'Accounts Receivable'  -- Replace with actual caption if different\n    )\n  LEFT JOIN non_bank_financial_report inv \n    ON tc.stock_code = inv.stock_code \n    AND inv.year = 2021 \n    AND inv.quarter = 0 \n    AND inv.category_code = (  -- Assuming BS_140 for Inventory, replace with actual value\n      SELECT category_code \n      FROM map_category_code_non_bank \n      WHERE en_caption = 'Inventory'  -- Replace with actual caption if different\n    )\n  LEFT JOIN sub_and_shareholder ssh \n    ON tc.stock_code = ssh.stock_code\nLIMIT 100;\n"
            }
        ],
        "time": 89.4364116191864,
        "evaluate": 0,
        "input_token": 3417,
        "output_token": 595
    },
    {
        "id": "8dbfe18f-c50c-4fc6-b067-98938f4e5f02",
        "question": "Rank the top 5 companies with the highest Return on Equity (ROE) exceeding 20% as of Q2 2024, based on their financial statements.",
        "answer": "Table 1\n| stock_code   | industry   | roe   |\n|--------------|------------|-------|\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    fr.stock_code, \n    ci.industry,\n    fr.data AS roe\nFROM \n    financial_ratio fr\nJOIN \n    company_info ci ON fr.stock_code = ci.stock_code\nWHERE \n    fr.ratio_code = 'ROE' \n    AND fr.year = 2024 \n    AND fr.quarter = 2 \n    AND fr.data > 20\nORDER BY \n    fr.data DESC\nLIMIT 5;\n"
            }
        ],
        "score": 1,
        "difficulty": 2,
        "response": "Table 1\n| stock_code   | roe_value   |\n|--------------|-------------|\n\nTable 2\n| stock_code   | industry   | roe_value   |\n|--------------|------------|-------------|\n\nTable 3\n| stock_code   | industry   | roe_value   |\n|--------------|------------|-------------|\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT stock_code, data AS roe_value\nFROM financial_ratio\nWHERE ratio_code = 'ROE'  -- Assuming 'ROE' is the correct ratio_code for Return on Equity\n  AND year = 2024\n  AND quarter = 2  -- Q2 2024\n  AND data > 20  -- ROE > 20%\n"
            },
            {
                "language": "sql",
                "code": "SELECT \n  ci.stock_code,\n  ci.industry,\n  fr.roe_value\nFROM (\n  SELECT stock_code, data AS roe_value\n  FROM financial_ratio\n  WHERE ratio_code = 'ROE'\n    AND year = 2024\n    AND quarter = 2\n    AND data > 20\n  ORDER BY data DESC\n  LIMIT 5\n) fr\nJOIN company_info ci ON fr.stock_code = ci.stock_code\n"
            },
            {
                "language": "sql",
                "code": "SELECT \n  ci.stock_code,\n  ci.industry,\n  fr.roe_value\nFROM (\n  SELECT stock_code, data AS roe_value\n  FROM financial_ratio\n  WHERE ratio_code = 'ROE'\n    AND year = 2024\n    AND quarter = 2\n    AND data > 20\n  ORDER BY data DESC\n  LIMIT 5\n) fr\nJOIN company_info ci ON fr.stock_code = ci.stock_code\nLIMIT 100;  -- Added limit as per database schema guidelines\n"
            }
        ],
        "time": 33.51380896568298,
        "evaluate": 0,
        "input_token": 5421,
        "output_token": 1603
    },
    {
        "id": "a49609f8-52db-4822-bc87-a6f207297116",
        "question": "What were the Return on Equity (ROE) and Return on Assets (ROA) for Vietcombank, Techcombank, and ACB in 2022?",
        "answer": "Table 1\n| stock_code   | ratio_code   |      data |\n|:-------------|:-------------|----------:|\n| TCB          | ROA          | 0.0292353 |\n| TCB          | ROE          | 0.180176  |\n| VCB          | ROA          | 0.0164951 |\n| ACB          | ROA          | 0.0225181 |\n| ACB          | ROE          | 0.234232  |\n| VCB          | ROE          | 0.220567  |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    stock_code, \n    ratio_code, \n    data \nFROM \n    financial_ratio \nWHERE \n    (stock_code = 'VCB' OR stock_code = 'TCB' OR stock_code = 'ACB') \n    AND (ratio_code = 'ROE' OR ratio_code = 'ROA') \n    AND year = 2022 \n    AND quarter = 0;\n"
            }
        ],
        "score": 1,
        "difficulty": 1,
        "response": "Table 1\n| stock_code   |\n|:-------------|\n| VCB          |\n| ACB          |\n| TCB          |\n\nTable 2\n| stock_code   | ratio_name       |      data |\n|:-------------|:-----------------|----------:|\n| ACB          | Return On Assets | 0.0225181 |\n| ACB          | Return On Equity | 0.234232  |\n| TCB          | Return On Assets | 0.0292353 |\n| TCB          | Return On Equity | 0.180176  |\n| VCB          | Return On Assets | 0.0164951 |\n| VCB          | Return On Equity | 0.220567  |\n\nTable 3\n| stock_code   | ratio_name       |      data |\n|:-------------|:-----------------|----------:|\n| ACB          | Return On Assets | 0.0225181 |\n| ACB          | Return On Equity | 0.234232  |\n| TCB          | Return On Assets | 0.0292353 |\n| TCB          | Return On Equity | 0.180176  |\n| VCB          | Return On Assets | 0.0164951 |\n| VCB          | Return On Equity | 0.220567  |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT stock_code \nFROM company_info \nWHERE en_company_name IN (\n  'Joint Stock Commercial Bank For Foreign Trade Of Vietnam',  -- Vietcombank\n  'Vietnam Technological And Commercial Joint Stock Bank',     -- Techcombank\n  'Asia Commercial Joint Stock Bank'                           -- ACB\n)\n"
            },
            {
                "language": "sql",
                "code": "SELECT \n  fr.stock_code,\n  mcr.ratio_name,\n  fr.data\nFROM \n  financial_ratio fr\n  INNER JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\n  INNER JOIN (\n    SELECT stock_code \n    FROM company_info \n    WHERE en_company_name IN (\n      'Joint Stock Commercial Bank For Foreign Trade Of Vietnam',  \n      'Vietnam Technological And Commercial Joint Stock Bank',     \n      'Asia Commercial Joint Stock Bank'                           \n    )\n  ) identified_companies ON fr.stock_code = identified_companies.stock_code\nWHERE \n  mcr.ratio_name IN ('Return On Equity', 'Return On Assets')\n  AND fr.year = 2022\n  AND fr.quarter = 0\nLIMIT 100;  -- Adding a limit as per the database access note\n"
            },
            {
                "language": "sql",
                "code": "WITH identified_companies AS (\n  SELECT stock_code \n  FROM company_info \n  WHERE en_company_name IN (\n    'Joint Stock Commercial Bank For Foreign Trade Of Vietnam',  \n    'Vietnam Technological And Commercial Joint Stock Bank',     \n    'Asia Commercial Joint Stock Bank'                           \n  )\n)\nSELECT \n  fr.stock_code,\n  mcr.ratio_name,\n  fr.data\nFROM \n  financial_ratio fr\n  INNER JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\n  INNER JOIN identified_companies ic ON fr.stock_code = ic.stock_code\nWHERE \n  mcr.ratio_name IN ('Return On Equity', 'Return On Assets')\n  AND fr.year = 2022\n  AND fr.quarter = 0\nLIMIT 100;\n"
            }
        ],
        "time": 35.51500582695007,
        "evaluate": 1,
        "input_token": 2282,
        "output_token": 628
    },
    {
        "id": "d839218c-d2ce-460b-855c-57b2db066d6b",
        "question": "What were the values of Total Assets, Total Liabilities, and Net Income for Vinamilk, Masan Group, and Mobile World Investment in 2023?",
        "answer": "Table 1\n| stock_code   |   year | category                             |        data |\n|:-------------|-------:|:-------------------------------------|------------:|\n| VNM          |   2023 | Net profit from operating activities | 1.09036e+07 |\n| MSN          |   2023 | Net profit from operating activities | 2.35043e+06 |\n| MSN          |   2023 | TOTAL ASSETS                         | 1.47383e+08 |\n| MSN          |   2023 | C. LIABILITIES                       | 1.09146e+08 |\n| MWG          |   2023 | Net profit from operating activities | 1.04707e+06 |\n| VNM          |   2023 | TOTAL ASSETS                         | 5.26734e+07 |\n| VNM          |   2023 | C. LIABILITIES                       | 1.76476e+07 |\n| MWG          |   2023 | TOTAL ASSETS                         | 6.01112e+07 |\n| MWG          |   2023 | C. LIABILITIES                       | 3.67517e+07 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    nfr.stock_code,\n    nfr.year,\n    mcc.en_caption AS category,\n    nfr.data\nFROM \n    non_bank_financial_report nfr\nJOIN \n    map_category_code_non_bank mcc ON nfr.category_code = mcc.category_code\nWHERE \n    nfr.year = 2023\n    AND nfr.quarter = 0\n    AND nfr.stock_code IN ('VNM', 'MSN', 'MWG')\n    AND nfr.category_code IN ('BS_270', 'BS_300', 'IS_030');\n"
            }
        ],
        "score": 1,
        "difficulty": 2,
        "response": "Table 1\n| stock_code   | category_code   | en_caption                                   |        data |\n|:-------------|:----------------|:---------------------------------------------|------------:|\n| MSN          | BS_100          | A. CURRENT ASSETS                            | 4.37635e+07 |\n| MSN          | BS_200          | B. NON-CURRENT ASSETS                        | 1.0362e+08  |\n| MSN          | IS_010          | Net revenue from sales and services rendered | 7.82516e+07 |\n| MWG          | BS_100          | A. CURRENT ASSETS                            | 5.19503e+07 |\n| MWG          | BS_200          | B. NON-CURRENT ASSETS                        | 8.1609e+06  |\n| MWG          | IS_010          | Net revenue from sales and services rendered | 1.1828e+08  |\n| VNM          | BS_100          | A. CURRENT ASSETS                            | 3.59359e+07 |\n| VNM          | BS_200          | B. NON-CURRENT ASSETS                        | 1.67375e+07 |\n| VNM          | IS_010          | Net revenue from sales and services rendered | 6.03689e+07 |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT \n  stock_code,\n  category_code,\n  en_caption,\n  data\nFROM \n  (\n    SELECT \n      nbf.stock_code,\n      nbf.category_code,\n      mcnb.en_caption,\n      nbf.data\n    FROM \n      non_bank_financial_report nbf\n      INNER JOIN map_category_code_non_bank mcnb \n        ON nbf.category_code = mcnb.category_code\n    WHERE \n      nbf.stock_code IN ('VNM', 'MSN', 'MWG')\n      AND nbf.year = 2023\n      AND nbf.quarter = 0\n      AND nbf.category_code IN ('BS_100', 'BS_200', 'IS_010')\n  ) AS subquery\nORDER BY \n  stock_code, category_code\nLIMIT 100;\n"
            }
        ],
        "time": 41.40528631210327,
        "evaluate": 0,
        "input_token": 2439,
        "output_token": 677
    },
    {
        "id": "e7873bd4-6132-4705-a91f-5c55cd3b9b66",
        "question": "What was the average Return on Equity (ROE) for  Vietcombank, Techcombank, and  VPBank  in 2022, and how did this compare to their respective subsidiaries' average ROE for the same year?",
        "answer": "Table 1\n| bank   |   bank_avg_roe |   subsidiary_avg_roe |\n|:-------|---------------:|---------------------:|\n| TCB    |       0.180176 |           nan        |\n| VCB    |       0.220567 |             0.170252 |\n| VPB    |       0.163367 |           nan        |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "WITH bank_roe AS (\n    SELECT \n        stock_code, \n        AVG(data) AS avg_roe\n    FROM \n        financial_ratio\n    WHERE \n        ratio_code = 'ROE' \n        AND year = 2022 \n        AND quarter = 0\n        AND stock_code IN ('VCB', 'TCB', 'VPB')\n    GROUP BY \n        stock_code\n),\nsubsidiary_roe AS (\n    SELECT \n        s.stock_code, \n        AVG(fr.data) AS avg_roe\n    FROM \n        sub_and_shareholder s\n    JOIN \n        financial_ratio fr ON s.invest_on = fr.stock_code\n    WHERE \n        fr.ratio_code = 'ROE' \n        AND fr.year = 2022 \n        AND fr.quarter = 0\n        AND s.stock_code IN ('VCB', 'TCB', 'VPB')\n    GROUP BY \n        s.stock_code\n)\nSELECT \n    b.stock_code AS bank,\n    b.avg_roe AS bank_avg_roe,\n    s.avg_roe AS subsidiary_avg_roe\nFROM \n    bank_roe b\nLEFT JOIN \n    subsidiary_roe s ON b.stock_code = s.stock_code;\n"
            }
        ],
        "score": 1,
        "difficulty": 3,
        "response": "Error in getting the answer",
        "code_response": "Error in getting the code",
        "evaluate": 0,
        "input_token": 1501,
        "output_token": 453
    },
    {
        "id": "7d5b40dc-a4a2-4e05-96fb-4716676e6d36",
        "question": "Calculate the Debt-to-Equity ratio for  Vinamilk,  Masan Group, and  PetroVietnam Gas in 2023 Q2.  Analyze the relationship between these ratios and the financial health of their respective subsidiaries or investments.",
        "answer": "Table 1\n| stock_code   | en_company_name                            |   year |   quarter |   debt_to_equity_ratio |\n|:-------------|:-------------------------------------------|-------:|----------:|-----------------------:|\n| VNM          | Vietnam Dairy Products Joint Stock Company |   2023 |         2 |               0.390309 |\n| MSN          | Masan Group Corporation                    |   2023 |         2 |               2.75379  |\n| GAS          | PetroVietnam Gas Joint Stock Corporation   |   2023 |         2 |               0.308313 |\n\nTable 2\n| stock_code   | invest_on   | parent_company                           | subsidiary_company                                    |\n|:-------------|:------------|:-----------------------------------------|:------------------------------------------------------|\n| MSN          | TCB         | Masan Group Corporation                  | Vietnam Technological And Commercial Joint Stock Bank |\n| GAS          | PVG         | PetroVietnam Gas Joint Stock Corporation | Petro Vietnam LPG Joint Stock Company                 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "-- Step 1: Retrieve the Debt-to-Equity ratio for the specified companies in 2023 Q2\nSELECT \n    fr.stock_code,\n    ci.en_company_name,\n    fr.year,\n    fr.quarter,\n    fr.data AS debt_to_equity_ratio\nFROM \n    financial_ratio fr\nJOIN \n    company_info ci ON fr.stock_code = ci.stock_code\nWHERE \n    fr.ratio_code = 'DTER'\n    AND fr.year = 2023\n    AND fr.quarter = 2\n    AND fr.stock_code IN ('VNM', 'MSN', 'GAS');\n\n-- Step 2: Retrieve the subsidiaries or investments for each company\nSELECT \n    ss.stock_code,\n    ss.invest_on,\n    ci.en_company_name AS parent_company,\n    ci2.en_company_name AS subsidiary_company\nFROM \n    sub_and_shareholder ss\nJOIN \n    company_info ci ON ss.stock_code = ci.stock_code\nJOIN \n    company_info ci2 ON ss.invest_on = ci2.stock_code\nWHERE \n    ss.stock_code IN ('VNM', 'MSN', 'GAS');\n"
            }
        ],
        "score": 1,
        "difficulty": 3,
        "response": "Error in getting the answer",
        "code_response": "Error in getting the code",
        "evaluate": 0,
        "input_token": 618,
        "output_token": 467
    },
    {
        "id": "9bd1bf8b-a936-4ee0-b7ef-3f081505fae5",
        "question": "What were the total current assets and current liabilities for Vietcombank, Techcombank, and VPBank in 2022, and what were their respective current ratios for that year?  Further, provide the details of their significant subsidiaries' contribution to these figures.",
        "answer": "Table 1\n| stock_code   |   total_current_assets |   total_current_liabilities |   current_ratio | subsidiary_stock_code   |   subsidiary_current_assets |   subsidiary_current_liabilities |\n|:-------------|-----------------------:|----------------------------:|----------------:|:------------------------|----------------------------:|---------------------------------:|\n| TCB          |                      0 |              7826           |         3.29776 |                         |                             |                                  |\n| VCB          |                      0 |                 6.73148e+07 |         3.56816 | EIB                     |                           0 |                  48522           |\n| VCB          |                      0 |                 6.73148e+07 |         3.56816 | MBB                     |                           0 |                  63576           |\n| VCB          |                      0 |                 6.73148e+07 |         3.56816 | OCB                     |                           0 |                      5.18926e+06 |\n| VPB          |                      0 |                 1.92923e+06 |         2.24166 |                         |                             |                                  |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "-- Step 1: Retrieve total current assets and current liabilities for the specified banks\nWITH bank_assets_liabilities AS (\n    SELECT \n        stock_code,\n        SUM(CASE WHEN category_code = 'BS_100' THEN data ELSE 0 END) AS total_current_assets,\n        SUM(CASE WHEN category_code = 'BS_310' THEN data ELSE 0 END) AS total_current_liabilities\n    FROM \n        bank_financial_report\n    WHERE \n        stock_code IN ('VCB', 'TCB', 'VPB')\n        AND year = 2022\n        AND quarter = 0\n    GROUP BY \n        stock_code\n),\n\n-- Step 2: Retrieve current ratio for the specified banks\nbank_current_ratios AS (\n    SELECT \n        stock_code,\n        data AS current_ratio\n    FROM \n        financial_ratio\n    WHERE \n        ratio_code = 'CurrentR'\n        AND stock_code IN ('VCB', 'TCB', 'VPB')\n        AND year = 2022\n        AND quarter = 0\n),\n\n-- Step 3: Retrieve subsidiaries' contributions\nsubsidiaries_contributions AS (\n    SELECT \n        s.stock_code,\n        s.invest_on,\n        SUM(CASE WHEN f.category_code = 'BS_100' THEN f.data ELSE 0 END) AS subsidiary_current_assets,\n        SUM(CASE WHEN f.category_code = 'BS_310' THEN f.data ELSE 0 END) AS subsidiary_current_liabilities\n    FROM \n        sub_and_shareholder s\n    JOIN \n        bank_financial_report f ON s.invest_on = f.stock_code\n    WHERE \n        s.stock_code IN ('VCB', 'TCB', 'VPB')\n        AND f.year = 2022\n        AND f.quarter = 0\n    GROUP BY \n        s.stock_code, s.invest_on\n)\n\n-- Final output combining all the information\nSELECT \n    a.stock_code,\n    a.total_current_assets,\n    a.total_current_liabilities,\n    r.current_ratio,\n    sc.invest_on AS subsidiary_stock_code,\n    sc.subsidiary_current_assets,\n    sc.subsidiary_current_liabilities\nFROM \n    bank_assets_liabilities a\nJOIN \n    bank_current_ratios r ON a.stock_code = r.stock_code\nLEFT JOIN \n    subsidiaries_contributions sc ON a.stock_code = sc.stock_code\nORDER BY \n    a.stock_code, sc.invest_on;\n"
            }
        ],
        "score": 1,
        "difficulty": 4,
        "response": "Table 1\n| stock_code   |   total_current_assets |   total_current_liabilities |\n|:-------------|-----------------------:|----------------------------:|\n| VCB          |                      0 |                 6.73148e+07 |\n| VPB          |                      0 |                 1.92923e+06 |\n| TCB          |                      0 |              7826           |\n\nTable 2\n| bank_stock_code   | subsidiary_stock_code   |   total_current_assets |   total_current_liabilities |   current_ratio |\n|:------------------|:------------------------|-----------------------:|----------------------------:|----------------:|\n| VCB               | PGI                     |                      0 |                 0           |         0       |\n| VCB               | EIB                     |                      0 |             24261           |         5.16642 |\n| VCB               | MBB                     |                      0 |             31788           |         0.73213 |\n| VCB               | HVN                     |                      0 |                 0           |         0       |\n| VCB               | PVD                     |                      0 |                 0           |         0       |\n| VCB               | OCB                     |                      0 |                 2.59463e+06 |         2.74653 |\n| VPB               | SGP                     |                      0 |                 0           |         0       |\n| VPB               | FDC                     |                      0 |                 0           |         0       |\n| TCB               | VCG                     |                      0 |                 0           |         0       |\n| TCB               | HVN                     |                      0 |                 0           |         0       |\n| VCB               | EIB                     |                      0 |             24261           |         5.16642 |\n| VCB               | MBB                     |                      0 |             31788           |         0.73213 |\n| VCB               | OCB                     |                      0 |                 2.59463e+06 |         2.74653 |\n\nTable 3\n| bank_stock_code   | subsidiary_stock_code   |   total_current_assets |   total_current_liabilities |   current_ratio |\n|:------------------|:------------------------|-----------------------:|----------------------------:|----------------:|\n| VCB               | PGI                     |                      0 |                 0           |         0       |\n| VCB               | EIB                     |                      0 |             24261           |         5.16642 |\n| VCB               | MBB                     |                      0 |             31788           |         0.73213 |\n| VCB               | HVN                     |                      0 |                 0           |         0       |\n| VCB               | PVD                     |                      0 |                 0           |         0       |\n| VCB               | OCB                     |                      0 |                 2.59463e+06 |         2.74653 |\n| VPB               | SGP                     |                      0 |                 0           |         0       |\n| VPB               | FDC                     |                      0 |                 0           |         0       |\n| TCB               | VCG                     |                      0 |                 0           |         0       |\n| TCB               | HVN                     |                      0 |                 0           |         0       |\n| VCB               | EIB                     |                      0 |             24261           |         5.16642 |\n| VCB               | MBB                     |                      0 |             31788           |         0.73213 |\n| VCB               | OCB                     |                      0 |                 2.59463e+06 |         2.74653 |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "WITH bank_stock_codes AS (\n  SELECT stock_code\n  FROM company_info\n  WHERE stock_code IN ('VCB', 'TCB', 'VPB')\n)\nSELECT \n  bsc.stock_code,\n  COALESCE(bsfr_ca.data, 0) AS total_current_assets,\n  COALESCE(bsfr_cl.data, 0) AS total_current_liabilities\nFROM \n  bank_stock_codes bsc\n  LEFT JOIN bank_financial_report bsfr_ca \n    ON bsc.stock_code = bsfr_ca.stock_code \n    AND bsfr_ca.year = 2022 \n    AND bsfr_ca.quarter = 0 \n    AND bsfr_ca.category_code = 'BS_100'  -- Assuming BS_100 represents Total Current Assets for banks\n  LEFT JOIN bank_financial_report bsfr_cl \n    ON bsc.stock_code = bsfr_cl.stock_code \n    AND bsfr_cl.year = 2022 \n    AND bsfr_cl.quarter = 0 \n    AND bsfr_cl.category_code = 'BS_310'  -- Assuming BS_310 represents Current Liabilities for banks\nLIMIT 100;\n"
            },
            {
                "language": "sql",
                "code": "WITH bank_stock_codes AS (\n  SELECT stock_code\n  FROM company_info\n  WHERE stock_code IN ('VCB', 'TCB', 'VPB')\n),\nbank_subsidaries AS (\n  SELECT \n    bsc.stock_code AS bank_stock_code,\n    sas.invest_on AS subsidiary_stock_code\n  FROM \n    bank_stock_codes bsc\n    JOIN sub_and_shareholder sas \n      ON bsc.stock_code = sas.stock_code\n)\nSELECT \n  bs.bank_stock_code,\n  bs.subsidiary_stock_code,\n  COALESCE(bsfr_ca.data, 0) AS total_current_assets,\n  COALESCE(bsfr_cl.data, 0) AS total_current_liabilities,\n  COALESCE(fr.data, 0) AS current_ratio\nFROM \n  bank_subsidaries bs\n  LEFT JOIN bank_financial_report bsfr_ca \n    ON bs.subsidiary_stock_code = bsfr_ca.stock_code \n    AND bsfr_ca.year = 2022 \n    AND bsfr_ca.quarter = 0 \n    AND bsfr_ca.category_code = 'BS_100'  -- Assuming BS_100 represents Total Current Assets for banks\n  LEFT JOIN bank_financial_report bsfr_cl \n    ON bs.subsidiary_stock_code = bsfr_cl.stock_code \n    AND bsfr_cl.year = 2022 \n    AND bsfr_cl.quarter = 0 \n    AND bsfr_cl.category_code = 'BS_310'  -- Assuming BS_310 represents Current Liabilities for banks\n  LEFT JOIN financial_ratio fr \n    ON bs.subsidiary_stock_code = fr.stock_code \n    AND fr.year = 2022 \n    AND fr.quarter = 0 \n    AND fr.ratio_code = 'CurrentR'  -- Retrieve pre-calculated Current Ratio\nLIMIT 100;\n"
            },
            {
                "language": "sql",
                "code": "WITH bank_stock_codes AS (\n  SELECT stock_code\n  FROM company_info\n  WHERE stock_code IN ('VCB', 'TCB', 'VPB')\n),\nbank_subsidaries AS (\n  SELECT \n    bsc.stock_code AS bank_stock_code,\n    sas.invest_on AS subsidiary_stock_code\n  FROM \n    bank_stock_codes bsc\n    JOIN sub_and_shareholder sas \n      ON bsc.stock_code = sas.stock_code\n)\nSELECT \n  bs.bank_stock_code,\n  bs.subsidiary_stock_code,\n  COALESCE(bsfr_ca.data, 0) AS total_current_assets,\n  COALESCE(bsfr_cl.data, 0) AS total_current_liabilities,\n  COALESCE(fr.data, 0) AS current_ratio\nFROM \n  bank_subsidaries bs\n  LEFT JOIN bank_financial_report bsfr_ca \n    ON bs.subsidiary_stock_code = bsfr_ca.stock_code \n    AND bsfr_ca.year = 2022 \n    AND bsfr_ca.quarter = 0 \n    AND bsfr_ca.category_code = 'BS_100'  \n  LEFT JOIN bank_financial_report bsfr_cl \n    ON bs.subsidiary_stock_code = bsfr_cl.stock_code \n    AND bsfr_cl.year = 2022 \n    AND bsfr_cl.quarter = 0 \n    AND bsfr_cl.category_code = 'BS_310'  \n  LEFT JOIN financial_ratio fr \n    ON bs.subsidiary_stock_code = fr.stock_code \n    AND fr.year = 2022 \n    AND fr.quarter = 0 \n    AND fr.ratio_code = 'CurrentR'  \nLIMIT 100;\n"
            }
        ],
        "time": 70.61446356773376,
        "evaluate": 0,
        "input_token": 2793,
        "output_token": 1482
    },
    {
        "id": "92b00988-89ff-42e7-ae1e-2abd01ab7947",
        "question": "What is the trend of the Net Cash Flow from Operating Activities for Vietcombank, Techcombank, and ACB from 2020 to Q2 2024?",
        "answer": "Table 1\n| stock_code   | year   | quarter   | net_cash_flow_operating_activities   |\n|--------------|--------|-----------|--------------------------------------|\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    stock_code, \n    year, \n    quarter, \n    data AS net_cash_flow_operating_activities\nFROM \n    bank_financial_report\nWHERE \n    stock_code IN ('VCB', 'TCB', 'ACB') \n    AND category_code = 'CF_009'\n    AND (\n        (year BETWEEN 2020 AND 2023 AND quarter = 0) -- Annual reports from 2020 to 2023\n        OR (year = 2024 AND quarter BETWEEN 1 AND 2) -- Quarterly reports for Q1 and Q2 of 2024\n    )\nORDER BY \n    stock_code, \n    year, \n    quarter;\n"
            }
        ],
        "score": 1,
        "difficulty": 2,
        "response": "Table 1\n| stock_code   | year   | quarter   | en_caption   | net_cash_flow_operating_activities   |\n|--------------|--------|-----------|--------------|--------------------------------------|\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT \n  bfr.stock_code,\n  bfr.year,\n  bfr.quarter,\n  mccb.en_caption,\n  bfr.data AS net_cash_flow_operating_activities\nFROM \n  bank_financial_report bfr\n  INNER JOIN map_category_code_bank mccb ON bfr.category_code = mccb.category_code\nWHERE \n  bfr.stock_code IN ('VCB', 'TCB', 'ACB')\n  AND mccb.category_code = 'CF_009'\n  AND ((bfr.year = 2020 AND bfr.quarter = 0) \n       OR (bfr.year > 2020 AND bfr.year < 2024 AND bfr.quarter = 0) \n       OR (bfr.year = 2024 AND bfr.quarter = 2))\nORDER BY \n  bfr.stock_code, \n  bfr.year, \n  bfr.quarter\nLIMIT 100;\n"
            }
        ],
        "time": 45.335688829422,
        "evaluate": 0,
        "input_token": 6205,
        "output_token": 2122
    },
    {
        "id": "7e2eeae9-63ca-4551-8421-3e02bfd5c000",
        "question": "What is the trend of  operating cash flow for Vietcombank, Techcombank, and Sacombank from 2020 to Q2 2024?",
        "answer": "Table 1\n| stock_code   | year   | quarter   | operating_cash_flow   |\n|--------------|--------|-----------|-----------------------|\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    stock_code,\n    year,\n    quarter,\n    data AS operating_cash_flow\nFROM \n    bank_financial_report\nWHERE \n    stock_code IN ('VCB', 'TCB', 'STB')\n    AND category_code = 'CF_009'\n    AND (\n        (year BETWEEN 2020 AND 2023 AND quarter = 0) -- Annual reports from 2020 to 2023\n        OR (year = 2024 AND quarter <= 2) -- Quarterly reports for 2024 up to Q2\n    )\nORDER BY \n    stock_code, year, quarter;\n"
            }
        ],
        "score": 1,
        "difficulty": 2,
        "response": "Table 1\n| stock_code   |\n|:-------------|\n| VCB          |\n| STB          |\n| TCB          |\n\nTable 2\n| stock_code   | year   | quarter   | category   | operating_cash_flow   |\n|--------------|--------|-----------|------------|-----------------------|\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT stock_code \nFROM company_info \nWHERE en_company_name IN (\n  'Joint Stock Commercial Bank For Foreign Trade Of Vietnam', \n  'Vietnam Technological And Commercial Joint Stock Bank', \n  'SaiGon Thuong Tin Commercial Joint Stock Bank'\n);\n"
            },
            {
                "language": "sql",
                "code": "SELECT \n  bfr.stock_code,\n  bfr.year,\n  bfr.quarter,\n  mccb.en_caption AS category,\n  bfr.data AS operating_cash_flow\nFROM \n  bank_financial_report bfr\n  INNER JOIN map_category_code_bank mccb ON bfr.category_code = mccb.category_code\nWHERE \n  bfr.stock_code IN ('VCB', 'TCB', 'STB') \n  AND bfr.year BETWEEN 2020 AND 2024\n  AND (\n    (bfr.quarter = 0 AND bfr.year IN (2020, 2021, 2022, 2023, 2024)) \n    OR (bfr.quarter = 2 AND bfr.year = 2024)  -- Specifically include Q2 2024\n  )\n  AND mccb.en_caption = 'Net cash flow from operating activities before changes in assets and working capital'\nLIMIT 100;\n"
            }
        ],
        "time": 37.62602615356445,
        "evaluate": 0,
        "input_token": 2089,
        "output_token": 562
    },
    {
        "id": "1fc45cfe-d70c-4722-89fc-0e61fb8c08ac",
        "question": "Compare the Debt-to-Equity ratio and the Current Ratio of Vinamilk and Masan Group for the fiscal year 2023.",
        "answer": "Table 1\n| stock_code   | ratio_code   |     data |\n|:-------------|:-------------|---------:|\n| MSN          | DTER         | 2.85445  |\n| VNM          | DTER         | 0.503847 |\n| MSN          | CurrentR     | 0.874439 |\n| VNM          | CurrentR     | 2.1016   |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    stock_code, \n    ratio_code, \n    data \nFROM \n    financial_ratio \nWHERE \n    (stock_code = 'VNM' OR stock_code = 'MSN') \n    AND year = 2023 \n    AND quarter = 0 \n    AND (ratio_code = 'DTER' OR ratio_code = 'CurrentR');\n"
            }
        ],
        "score": 1,
        "difficulty": 1,
        "response": "Table 1\n| stock_code   | ratio_name           |   ratio_value |\n|:-------------|:---------------------|--------------:|\n| MSN          | Debt To Equity Ratio |      2.85445  |\n| VNM          | Debt To Equity Ratio |      0.503847 |\n| MSN          | Current Ratio        |      0.874439 |\n| VNM          | Current Ratio        |      2.1016   |\n\nTable 2\n| stock_code   |   year |   quarter |\n|:-------------|-------:|----------:|\n| MSN          |   2023 |         0 |\n| VNM          |   2023 |         0 |\n\nTable 3\n| stock_code   | ratio_name           |   ratio_value |\n|:-------------|:---------------------|--------------:|\n| MSN          | Debt To Equity Ratio |      2.85445  |\n| VNM          | Debt To Equity Ratio |      0.503847 |\n| MSN          | Current Ratio        |      0.874439 |\n| VNM          | Current Ratio        |      2.1016   |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT DISTINCT stock_code, year, quarter\nFROM (\n  SELECT stock_code, year, quarter FROM non_bank_financial_report\n  UNION ALL\n  SELECT stock_code, year, quarter FROM bank_financial_report\n  UNION ALL\n  SELECT stock_code, year, quarter FROM securities_financial_report\n) AS combined_reports\nWHERE stock_code IN ('VNM', 'MSN') AND year = 2023 AND quarter = 0\nLIMIT 100;\n"
            },
            {
                "language": "sql",
                "code": "SELECT \n  fr.stock_code,\n  mcr.ratio_name,\n  fr.data AS ratio_value\nFROM \n  financial_ratio fr\n  INNER JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\nWHERE \n  fr.stock_code IN ('VNM', 'MSN') \n  AND fr.year = 2023 \n  AND fr.quarter = 0\n  AND mcr.ratio_code IN ('DTER', 'CurrentR')\nLIMIT 100;\n"
            },
            {
                "language": "sql",
                "code": "-- Verify reporting data availability (optional)\nSELECT DISTINCT stock_code, year, quarter\nFROM (\n  SELECT stock_code, year, quarter FROM non_bank_financial_report\n  UNION ALL\n  SELECT stock_code, year, quarter FROM bank_financial_report\n  UNION ALL\n  SELECT stock_code, year, quarter FROM securities_financial_report\n) AS combined_reports\nWHERE stock_code IN ('VNM', 'MSN') AND year = 2023 AND quarter = 0\nLIMIT 100;\n\n-- Extract Debt-to-Equity ratio and Current Ratio\nSELECT \n  fr.stock_code,\n  mcr.ratio_name,\n  fr.data AS ratio_value\nFROM \n  financial_ratio fr\n  INNER JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\nWHERE \n  fr.stock_code IN ('VNM', 'MSN') \n  AND fr.year = 2023 \n  AND fr.quarter = 0\n  AND mcr.ratio_code IN ('DTER', 'CurrentR')\nLIMIT 100;\n"
            }
        ],
        "time": 89.50019836425781,
        "evaluate": 1,
        "input_token": 9402,
        "output_token": 2238
    },
    {
        "id": "6332ded8-a846-4f63-9d25-d8dfa9aed104",
        "question": "What is the trend of the Current Ratio for Vietcombank, Techcombank, and ACB from 2020 to Q2 2024?",
        "answer": "Table 1\n| stock_code   |   year |   quarter |   current_ratio |\n|:-------------|-------:|----------:|----------------:|\n| ACB          |   2020 |         0 |         3.69815 |\n| ACB          |   2021 |         0 |         3.97544 |\n| ACB          |   2022 |         0 |         3.81624 |\n| ACB          |   2023 |         0 |         3.04283 |\n| ACB          |   2024 |         1 |         3.29123 |\n| TCB          |   2020 |         0 |         2.83619 |\n| TCB          |   2021 |         0 |         4.35343 |\n| TCB          |   2022 |         0 |         3.29776 |\n| TCB          |   2023 |         0 |         2.66367 |\n| TCB          |   2024 |         1 |         2.40445 |\n| TCB          |   2024 |         2 |         2.88946 |\n| VCB          |   2020 |         0 |         7.25011 |\n| VCB          |   2021 |         0 |         6.29498 |\n| VCB          |   2022 |         0 |         3.56816 |\n| VCB          |   2023 |         0 |         4.7828  |\n| VCB          |   2024 |         1 |         3.48899 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    stock_code, \n    year, \n    quarter, \n    data AS current_ratio\nFROM \n    financial_ratio\nWHERE \n    ratio_code = 'CurrentR' \n    AND stock_code IN ('VCB', 'TCB', 'ACB')\n    AND (\n        (year BETWEEN 2020 AND 2023 AND quarter = 0) -- Annual data for 2020 to 2023\n        OR \n        (year = 2024 AND quarter <= 2) -- Quarterly data for 2024 up to Q2\n    )\nORDER BY \n    stock_code, \n    year, \n    quarter;\n"
            }
        ],
        "score": 1,
        "difficulty": 2,
        "response": "Table 1\n| stock_code   |   year |   quarter | ratio_name    |   current_ratio |\n|:-------------|-------:|----------:|:--------------|----------------:|\n| ACB          |   2020 |         1 | Current Ratio |         3.54284 |\n| ACB          |   2020 |         2 | Current Ratio |         3.46132 |\n| ACB          |   2020 |         3 | Current Ratio |         3.1178  |\n| ACB          |   2020 |         4 | Current Ratio |         3.69815 |\n| ACB          |   2021 |         1 | Current Ratio |         2.28142 |\n| ACB          |   2021 |         2 | Current Ratio |         2.61232 |\n| ACB          |   2021 |         3 | Current Ratio |         3.03271 |\n| ACB          |   2021 |         4 | Current Ratio |         3.97544 |\n| ACB          |   2022 |         1 | Current Ratio |         3.25965 |\n| ACB          |   2022 |         2 | Current Ratio |         3.34928 |\n| ACB          |   2022 |         3 | Current Ratio |         2.91339 |\n| ACB          |   2022 |         4 | Current Ratio |         3.81624 |\n| ACB          |   2023 |         1 | Current Ratio |         3.53987 |\n| ACB          |   2023 |         2 | Current Ratio |       nan       |\n| ACB          |   2023 |         3 | Current Ratio |         3.69457 |\n| ACB          |   2024 |         1 | Current Ratio |         3.29123 |\n| TCB          |   2020 |         1 | Current Ratio |         2.89911 |\n| TCB          |   2020 |         2 | Current Ratio |         3.84263 |\n| TCB          |   2020 |         3 | Current Ratio |         2.47947 |\n| TCB          |   2020 |         4 | Current Ratio |         2.83619 |\n| TCB          |   2021 |         1 | Current Ratio |         3.16037 |\n| TCB          |   2021 |         2 | Current Ratio |         3.90106 |\n| TCB          |   2021 |         3 | Current Ratio |         5.41155 |\n| TCB          |   2021 |         4 | Current Ratio |         4.40216 |\n| TCB          |   2022 |         1 | Current Ratio |         4.20104 |\n| TCB          |   2022 |         2 | Current Ratio |         3.53703 |\n| TCB          |   2022 |         3 | Current Ratio |         3.1711  |\n| TCB          |   2022 |         4 | Current Ratio |         3.29776 |\n| TCB          |   2023 |         1 | Current Ratio |         3.10937 |\n| TCB          |   2023 |         2 | Current Ratio |         2.99619 |\n| TCB          |   2023 |         3 | Current Ratio |         4.18999 |\n| TCB          |   2023 |         4 | Current Ratio |         3.32547 |\n| TCB          |   2024 |         1 | Current Ratio |         2.40445 |\n| TCB          |   2024 |         2 | Current Ratio |         2.88946 |\n| VCB          |   2020 |         1 | Current Ratio |         5.43727 |\n| VCB          |   2020 |         2 | Current Ratio |         5.19794 |\n| VCB          |   2020 |         3 | Current Ratio |         4.72611 |\n| VCB          |   2020 |         4 | Current Ratio |         7.86737 |\n| VCB          |   2021 |         1 | Current Ratio |         5.86813 |\n| VCB          |   2021 |         2 | Current Ratio |         5.28517 |\n| VCB          |   2021 |         3 | Current Ratio |         6.82119 |\n| VCB          |   2021 |         4 | Current Ratio |         6.58505 |\n| VCB          |   2022 |         1 | Current Ratio |         6.06806 |\n| VCB          |   2022 |         2 | Current Ratio |         6.27508 |\n| VCB          |   2022 |         3 | Current Ratio |         6.95249 |\n| VCB          |   2022 |         4 | Current Ratio |         3.62631 |\n| VCB          |   2023 |         1 | Current Ratio |         5.431   |\n| VCB          |   2023 |         2 | Current Ratio |         5.5238  |\n| VCB          |   2023 |         3 | Current Ratio |         5.44838 |\n| VCB          |   2023 |         4 | Current Ratio |         5.24741 |\n| VCB          |   2024 |         1 | Current Ratio |         3.48899 |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT \n  fr.stock_code,\n  fr.year,\n  fr.quarter,\n  mcr.ratio_name,\n  fr.data AS current_ratio\nFROM \n  financial_ratio fr\n  INNER JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\n  INNER JOIN company_info ci ON fr.stock_code = ci.stock_code\nWHERE \n  fr.stock_code IN ('VCB', 'TCB', 'ACB')  -- Target stock codes\n  AND (\n    (fr.year BETWEEN 2020 AND 2023 AND fr.quarter IN (1, 2, 3, 4))  -- 2020-2023 with all quarters\n    OR (fr.year = 2024 AND fr.quarter IN (1, 2))  -- 2024 with Q1 and Q2\n  )\n  AND mcr.ratio_name = 'Current Ratio'  -- Filter for Current Ratio\nORDER BY \n  fr.stock_code,\n  fr.year,\n  fr.quarter\nLIMIT 100;  -- Add a limit to the query (adjust as needed)\n"
            }
        ],
        "time": 32.9061758518219,
        "evaluate": 0,
        "input_token": 1988,
        "output_token": 575
    },
    {
        "id": "13adfa83-6eb5-4eaf-8f6e-0e57464afbf4",
        "question": "Compare the changes in  Property, Plant, and Equipment (PP&E)  for Vinamilk, Hoa Phat Group, and VinGroup from 2020 to Q2 2024.  Show the net increase/decrease each year.",
        "answer": "Table 1\n| stock_code   |   year |   net_change |\n|:-------------|-------:|-------------:|\n| HPG          |   2020 |  1.31123e+08 |\n| HPG          |   2021 |  7.43837e+06 |\n| HPG          |   2022 |  3.10415e+06 |\n| HPG          |   2023 |  2.33091e+06 |\n| HPG          |   2024 | -3.84744e+06 |\n| VIC          |   2020 |  2.5128e+08  |\n| VIC          |   2021 |  1.01122e+07 |\n| VIC          |   2022 | -2.1907e+07  |\n| VIC          |   2023 |  8.13337e+07 |\n| VIC          |   2024 |  6.03128e+07 |\n| VNM          |   2020 |  2.77076e+07 |\n| VNM          |   2021 | -2.29442e+06 |\n| VNM          |   2022 | -1.60678e+06 |\n| VNM          |   2023 |  1.57289e+06 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "WITH ppe_data AS (\n    SELECT \n        stock_code,\n        year,\n        SUM(data) AS total_ppe\n    FROM \n        non_bank_financial_report\n    WHERE \n        category_code IN ('BS_220', 'BS_221', 'BS_224', 'BS_227', 'BS_263')\n        AND stock_code IN ('VNM', 'HPG', 'VIC')\n        AND ((year BETWEEN 2020 AND 2023 AND quarter = 0) OR (year = 2024 AND quarter = 2))\n    GROUP BY \n        stock_code, year\n),\nppe_change AS (\n    SELECT \n        a.stock_code,\n        a.year,\n        a.total_ppe - COALESCE(b.total_ppe, 0) AS net_change\n    FROM \n        ppe_data a\n    LEFT JOIN \n        ppe_data b ON a.stock_code = b.stock_code AND a.year = b.year + 1\n)\nSELECT \n    stock_code,\n    year,\n    net_change\nFROM \n    ppe_change\nORDER BY \n    stock_code, year;\n"
            }
        ],
        "score": 1,
        "difficulty": 3,
        "response": "Table 1\n| stock_code   |   year |   quarter |   pp_e_value |\n|:-------------|-------:|----------:|-------------:|\n| HPG          |   2020 |         0 |  7.47642e+07 |\n| VIC          |   2020 |         0 |  2.5649e+08  |\n| HPG          |   2024 |         2 |  1.22142e+08 |\n| VIC          |   2024 |         2 |  3.81136e+08 |\n| VNM          |   2020 |         0 |  1.87668e+07 |\n\nTable 2\n| stock_code   | year   | quarter   | pp_e_value   |\n|--------------|--------|-----------|--------------|\n\nTable 3\n| stock_code   | year   | pp_e_value   | net_increase_decrease   |\n|--------------|--------|--------------|-------------------------|\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "WITH pp_e_values AS (\n  SELECT \n    nbf.stock_code,\n    nbf.year,\n    nbf.quarter,\n    nbf.data AS pp_e_value\n  FROM \n    non_bank_financial_report nbf\n  INNER JOIN \n    map_category_code_non_bank mccnb ON nbf.category_code = mccnb.category_code\n  WHERE \n    nbf.stock_code IN ('VNM', 'HPG', 'VIC')\n    AND mccnb.en_caption = 'Property, Plant, and Equipment (PP&E)'  -- Use en_caption to find PP&E\n    AND ((nbf.year = 2020 AND nbf.quarter = 0) OR (nbf.year = 2024 AND nbf.quarter = 2))\n)\nSELECT * FROM pp_e_values;\n"
            },
            {
                "language": "sql",
                "code": "WITH pp_e_values AS (\n  SELECT \n    nbf.stock_code,\n    nbf.year,\n    nbf.quarter,\n    nbf.data AS pp_e_value\n  FROM \n    non_bank_financial_report nbf\n  INNER JOIN \n    map_category_code_non_bank mccnb ON nbf.category_code = mccnb.category_code\n  WHERE \n    nbf.stock_code IN ('VNM', 'HPG', 'VIC')\n    AND mccnb.en_caption = 'Property, Plant, and Equipment (PP&E)'  -- Use en_caption to find PP&E\n    AND (nbf.quarter = 0 OR (nbf.year = 2024 AND nbf.quarter = 2))\n),\nyearly_pp_e AS (\n  SELECT \n    stock_code,\n    year,\n    pp_e_value,\n    LAG(pp_e_value) OVER (PARTITION BY stock_code ORDER BY year) AS prev_pp_e_value\n  FROM \n    pp_e_values\n  WHERE \n    quarter = 0\n)\nSELECT \n  stock_code,\n  year,\n  pp_e_value,\n  (pp_e_value - prev_pp_e_value) AS net_increase_decrease\nFROM \n  yearly_pp_e\nWHERE \n  prev_pp_e_value IS NOT NULL  -- Exclude the first year (2020)\nUNION ALL\nSELECT \n  stock_code,\n  2024 AS year,\n  pp_e_value,\n  (pp_e_value - LAG(pp_e_value) OVER (PARTITION BY stock_code ORDER BY year)) AS net_increase_decrease\nFROM \n  pp_e_values\nWHERE \n  stock_code IN ('VNM', 'HPG', 'VIC')\n  AND quarter = 2\nLIMIT 100;  -- Add a limit to the query\n"
            }
        ],
        "time": 84.89254593849182,
        "evaluate": 0,
        "input_token": 3107,
        "output_token": 947
    },
    {
        "id": "5b310386-fc27-4cf8-b9c0-421b0979ffb2",
        "question": "Show the change in  total assets and total liabilities for Vinamilk, Masan Group, and Hoa Phat Group from 2020 to Q2 2024.  Calculate the debt-to-asset ratio for each company for each year.",
        "answer": "Table 1\n| stock_code   |   year |   quarter |   total_assets |   total_liabilities |   debt_to_asset_ratio |\n|:-------------|-------:|----------:|---------------:|--------------------:|----------------------:|\n| HPG          |   2020 |         0 |    1.31511e+08 |         1.31511e+08 |              0.549699 |\n| HPG          |   2021 |         0 |    1.78236e+08 |         1.78236e+08 |              0.490673 |\n| HPG          |   2022 |         0 |    1.70336e+08 |         1.70336e+08 |              0.435743 |\n| HPG          |   2023 |         0 |    1.87783e+08 |         1.87783e+08 |              0.452364 |\n| HPG          |   2024 |         2 |    2.06609e+08 |         2.06609e+08 |              0.473999 |\n| MSN          |   2020 |         0 |    1.15737e+08 |         1.15737e+08 |              0.783731 |\n| MSN          |   2021 |         0 |    1.26093e+08 |         1.26093e+08 |              0.664244 |\n| MSN          |   2022 |         0 |    1.41343e+08 |         1.41343e+08 |              0.740795 |\n| MSN          |   2023 |         0 |    1.47383e+08 |         1.47383e+08 |              0.74056  |\n| VNM          |   2020 |         0 |    4.84325e+07 |         4.84325e+07 |              0.305278 |\n| VNM          |   2021 |         0 |    5.33324e+07 |         5.33324e+07 |              0.327799 |\n| VNM          |   2022 |         0 |    4.84827e+07 |         4.84827e+07 |              0.323129 |\n| VNM          |   2023 |         0 |    5.26734e+07 |         5.26734e+07 |              0.335039 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "WITH AssetLiabilityData AS (\n    SELECT\n        nfr.stock_code,\n        nfr.year,\n        nfr.quarter,\n        CASE\n            WHEN mccnb.en_caption = 'TOTAL ASSETS' THEN nfr.data\n            ELSE 0\n        END AS total_assets,\n        CASE\n            WHEN mccnb.en_caption = 'TOTAL LIABILITIES AND EQUITY' THEN nfr.data\n            ELSE 0\n        END AS total_liabilities\n    FROM\n        non_bank_financial_report nfr\n    JOIN\n        map_category_code_non_bank mccnb ON nfr.category_code = mccnb.category_code\n    WHERE\n        nfr.stock_code IN ('VNM', 'MSN', 'HPG')\n        AND mccnb.en_caption IN ('TOTAL ASSETS', 'TOTAL LIABILITIES AND EQUITY')\n        AND ((nfr.year BETWEEN 2020 AND 2024 AND nfr.quarter = 0) OR (nfr.year = 2024 AND nfr.quarter = 2))\n),\nAggregatedData AS (\n    SELECT\n        stock_code,\n        year,\n        quarter,\n        SUM(total_assets) AS total_assets,\n        SUM(total_liabilities) AS total_liabilities\n    FROM\n        AssetLiabilityData\n    GROUP BY\n        stock_code, year, quarter\n)\nSELECT\n    ad.stock_code,\n    ad.year,\n    ad.quarter,\n    ad.total_assets,\n    ad.total_liabilities,\n    fr.data AS debt_to_asset_ratio\nFROM\n    AggregatedData ad\nLEFT JOIN\n    financial_ratio fr ON ad.stock_code = fr.stock_code AND ad.year = fr.year AND ad.quarter = fr.quarter\nWHERE\n    fr.ratio_code = 'DTAR'\nORDER BY\n    ad.stock_code, ad.year, ad.quarter;\n"
            }
        ],
        "score": 1,
        "difficulty": 4,
        "response": "Table 1\n| stock_code   |   year |   quarter |   debt_to_asset_ratio |\n|:-------------|-------:|----------:|----------------------:|\n| HPG          |   2020 |         0 |              0.549699 |\n| HPG          |   2021 |         0 |              0.490673 |\n| HPG          |   2022 |         0 |              0.435743 |\n| HPG          |   2023 |         0 |              0.452364 |\n| HPG          |   2024 |         2 |              0.473999 |\n| MSN          |   2020 |         0 |              0.783731 |\n| MSN          |   2021 |         0 |              0.664244 |\n| MSN          |   2022 |         0 |              0.740795 |\n| MSN          |   2023 |         0 |              0.74056  |\n| VNM          |   2020 |         0 |              0.305278 |\n| VNM          |   2021 |         0 |              0.327799 |\n| VNM          |   2022 |         0 |              0.323129 |\n| VNM          |   2023 |         0 |              0.335039 |\n\nTable 2\n| stock_code   |   year |   quarter |   total_assets |   total_liabilities |   debt_to_asset_ratio |\n|:-------------|-------:|----------:|---------------:|--------------------:|----------------------:|\n| HPG          |   2020 |         0 |    5.67473e+07 |         7.47642e+07 |              0.549699 |\n| HPG          |   2021 |         0 |    9.41549e+07 |         8.40816e+07 |              0.490673 |\n| HPG          |   2022 |         0 |    8.05147e+07 |         8.98208e+07 |              0.435743 |\n| HPG          |   2023 |         0 |    8.27164e+07 |         1.05066e+08 |              0.452364 |\n| HPG          |   2024 |         2 |    8.44668e+07 |         1.22142e+08 |              0.473999 |\n| MSN          |   2020 |         0 |    2.97607e+07 |         8.59759e+07 |              0.783731 |\n| MSN          |   2021 |         0 |    4.36302e+07 |         8.24633e+07 |              0.664244 |\n| MSN          |   2022 |         0 |    4.76746e+07 |         9.36682e+07 |              0.740795 |\n| MSN          |   2023 |         0 |    4.37635e+07 |         1.0362e+08  |              0.74056  |\n| VNM          |   2020 |         0 |    2.96657e+07 |         1.87668e+07 |              0.305278 |\n| VNM          |   2021 |         0 |    3.61099e+07 |         1.72225e+07 |              0.327799 |\n| VNM          |   2022 |         0 |    3.15604e+07 |         1.69223e+07 |              0.323129 |\n| VNM          |   2023 |         0 |    3.59359e+07 |         1.67375e+07 |              0.335039 |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "WITH company_codes AS (\n  SELECT stock_code\n  FROM company_info\n  WHERE stock_code IN ('VNM', 'MSN', 'HPG')\n),\nfinancial_data AS (\n  SELECT \n    c.stock_code,\n    COALESCE(n_assets.year, n_liabilities.year) AS year,\n    COALESCE(n_assets.quarter, n_liabilities.quarter) AS quarter,\n    COALESCE(n_assets.data, 0) AS total_assets,\n    COALESCE(n_liabilities.data, 0) AS total_liabilities\n  FROM \n    company_codes c\n    LEFT JOIN non_bank_financial_report n_assets\n      ON c.stock_code = n_assets.stock_code\n      AND n_assets.category_code = 'BS_100'  -- Total Assets\n      AND ((n_assets.year BETWEEN 2020 AND 2023 AND n_assets.quarter = 0) \n      OR (n_assets.year = 2024 AND n_assets.quarter = 2))\n    LEFT JOIN non_bank_financial_report n_liabilities\n      ON c.stock_code = n_liabilities.stock_code\n      AND n_liabilities.category_code = 'BS_200'  -- Total Liabilities\n      AND ((n_liabilities.year BETWEEN 2020 AND 2023 AND n_liabilities.quarter = 0) \n      OR (n_liabilities.year = 2024 AND n_liabilities.quarter = 2))\n      AND n_liabilities.stock_code = n_assets.stock_code\n      AND n_liabilities.year = n_assets.year\n      AND n_liabilities.quarter = n_assets.quarter\n),\ndebt_to_asset_ratio AS (\n  SELECT \n    c.stock_code,\n    f.year,\n    f.quarter,\n    f.data AS debt_to_asset_ratio\n  FROM \n    company_codes c\n    JOIN financial_ratio f\n      ON c.stock_code = f.stock_code\n      AND f.ratio_code = 'DTAR'  -- Debt To Assets Ratio\n      AND ((f.year BETWEEN 2020 AND 2023 AND f.quarter = 0) \n      OR (f.year = 2024 AND f.quarter = 2))\n)\nSELECT \n  fd.stock_code,\n  fd.year,\n  fd.quarter,\n  fd.total_assets,\n  fd.total_liabilities,\n  dar.debt_to_asset_ratio\nFROM \n  financial_data fd\n  JOIN debt_to_asset_ratio dar\n    ON fd.stock_code = dar.stock_code\n    AND fd.year = dar.year\n    AND fd.quarter = dar.quarter\nLIMIT 100;\n"
            }
        ],
        "time": 112.94597864151001,
        "evaluate": 0,
        "input_token": 5832,
        "output_token": 2464
    },
    {
        "id": "77119fb1-1ebd-44db-9398-0e378dc3824d",
        "question": "Rank the top 10 companies by their Return on Equity (ROE) for the fiscal year 2023.",
        "answer": "Table 1\n| stock_code   | industry                      |      roe |\n|:-------------|:------------------------------|---------:|\n| TMB          | Basic Resources               | 0.476625 |\n| SLS          | Food and Beverages            | 0.443074 |\n| CAP          | Basic Resources               | 0.43171  |\n| SAF          | Food and Beverages            | 0.2894   |\n| DGC          | Chemicals                     | 0.269533 |\n| DTD          | Real Estate                   | 0.262679 |\n| FPT          | Information Technology        | 0.260183 |\n| VNM          | Food and Beverages            | 0.257506 |\n| VTP          | Industrial Goods and Services | 0.240244 |\n| HDB          | Banking                       | 0.232433 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    fr.stock_code,\n    ci.industry,\n    fr.data AS roe\nFROM \n    financial_ratio fr\nJOIN \n    company_info ci ON fr.stock_code = ci.stock_code\nWHERE \n    fr.ratio_code = 'ROE'\n    AND fr.year = 2023\n    AND fr.quarter = 0\nORDER BY \n    fr.data DESC\nLIMIT 10;\n"
            }
        ],
        "score": 1,
        "difficulty": 2,
        "response": "Table 1\n| stock_code   |   roe_value |\n|:-------------|------------:|\n| BCM          |  0.11709    |\n| CAP          |  0.43171    |\n| CEO          |  0.0194039  |\n| CMG          |  0.120174   |\n| DBC          |  0.00535914 |\n| DCM          |  0.111422   |\n| DGC          |  0.269533   |\n| DHT          |  0.0833632  |\n| DTD          |  0.262679   |\n| DVM          |  0.0626742  |\n| DXG          |  0.0105904  |\n| FPT          |  0.260183   |\n| FRT          | -0.191485   |\n| GAS          |  0.180603   |\n| GVR          |  0.0613502  |\n| HDC          |  0.0691672  |\n| HLD          |  0.00777002 |\n| HPG          |  0.0661282  |\n| HUT          |  0.00498069 |\n| KDH          |  0.0469951  |\n| L14          |  0.0565361  |\n| L18          |  0.095203   |\n| LAS          |  0.104478   |\n| LHC          |  0.183116   |\n| MSN          |  0.0489033  |\n| MWG          |  0.0071846  |\n| NHA          |  0.0136094  |\n| NKG          |  0.0216497  |\n| NTP          |  0.179558   |\n| NVL          |  0.0107248  |\n| PLC          |  0.0775942  |\n| PNJ          |  0.201006   |\n| POW          |  0.0376015  |\n| PSD          |  0.115703   |\n| PVC          |  0.0333631  |\n| PVG          |  0.00224681 |\n| PVS          |  0.0782627  |\n| PVT          |  0.135265   |\n| SAB          |  0.166962   |\n| SAF          |  0.2894     |\n| SLS          |  0.443074   |\n| TCH          |  0.0999835  |\n| TIG          |  0.0876663  |\n| TMB          |  0.476625   |\n| TNG          |  0.118304   |\n| TVD          |  0.19532    |\n| VC3          |  0.105316   |\n| VCS          |  0.169758   |\n| VGI          |  0.0539746  |\n| VHM          |  0.183605   |\n| VIC          |  0.0138715  |\n| VJC          |  0.0151715  |\n| VNM          |  0.257506   |\n| VPI          |  0.113636   |\n| VRE          |  0.116552   |\n| VTP          |  0.240244   |\n| YEG          |  0.0191701  |\n| ABB          |  0.0336445  |\n| ACB          |  0.226122   |\n| BID          |  0.178797   |\n| CTG          |  0.159246   |\n| EIB          |  0.0964624  |\n| HDB          |  0.232433   |\n| LPB          |  0.163326   |\n| MBB          |  0.217698   |\n| OCB          |  0.11576    |\n| SHB          |  0.146208   |\n| STB          |  0.168772   |\n| TCB          |  0.139608   |\n| TPB          |  0.136314   |\n| VCB          |  0.200315   |\n| VIB          |  0.225702   |\n| VPB          |  0.0607614  |\n\nTable 2\n| stock_code   |   roe_value |\n|:-------------|------------:|\n| TMB          |    0.476625 |\n| SLS          |    0.443074 |\n| CAP          |    0.43171  |\n| SAF          |    0.2894   |\n| DGC          |    0.269533 |\n| DTD          |    0.262679 |\n| FPT          |    0.260183 |\n| VNM          |    0.257506 |\n| VTP          |    0.240244 |\n| HDB          |    0.232433 |\n\nTable 3\n| stock_code   |   roe_value |\n|:-------------|------------:|\n| TMB          |    0.476625 |\n| SLS          |    0.443074 |\n| CAP          |    0.43171  |\n| SAF          |    0.2894   |\n| DGC          |    0.269533 |\n| DTD          |    0.262679 |\n| FPT          |    0.260183 |\n| VNM          |    0.257506 |\n| VTP          |    0.240244 |\n| HDB          |    0.232433 |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT \n  ci.stock_code,\n  fr.data AS ROE_value\nFROM \n  company_info ci\n  LEFT JOIN financial_ratio fr ON ci.stock_code = fr.stock_code\n  LEFT JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\nWHERE \n  mcr.ratio_name = 'Return On Equity'  -- Ensure we're getting ROE values\n  AND fr.year = 2023\n  AND fr.quarter = 0  -- Annual report (quarter=0)\n"
            },
            {
                "language": "sql",
                "code": "SELECT \n  stock_code,\n  ROE_value\nFROM (\n  SELECT \n    ci.stock_code,\n    fr.data AS ROE_value,\n    ROW_NUMBER() OVER (ORDER BY fr.data DESC) AS row_num\n  FROM \n    company_info ci\n    LEFT JOIN financial_ratio fr ON ci.stock_code = fr.stock_code\n    LEFT JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\n  WHERE \n    mcr.ratio_name = 'Return On Equity'\n    AND fr.year = 2023\n    AND fr.quarter = 0\n) AS subquery\nWHERE \n  row_num <= 10\nORDER BY \n  ROE_value DESC\nLIMIT 10;\n"
            },
            {
                "language": "sql",
                "code": "SELECT \n  stock_code,\n  ROE_value\nFROM (\n  SELECT \n    ci.stock_code,\n    fr.data AS ROE_value,\n    RANK() OVER (ORDER BY fr.data DESC) AS rank\n  FROM \n    company_info ci\n    LEFT JOIN financial_ratio fr ON ci.stock_code = fr.stock_code\n    LEFT JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\n  WHERE \n    mcr.ratio_name = 'Return On Equity'\n    AND fr.year = 2023\n    AND fr.quarter = 0\n) AS subquery\nWHERE \n  rank <= 10\nORDER BY \n  ROE_value DESC\nLIMIT 10;\n"
            }
        ],
        "time": 35.01452445983887,
        "evaluate": 1,
        "input_token": 5277,
        "output_token": 1566
    },
    {
        "id": "4bfbed15-327d-43f7-98d4-2ed6b6ac6cca",
        "question": "What were the total assets and total liabilities of Vinamilk and Masan Group at the end of 2023?",
        "answer": "Table 1\n| stock_code   | en_caption   |        data |\n|:-------------|:-------------|------------:|\n| VNM          | TOTAL ASSETS | 5.26734e+07 |\n| MSN          | TOTAL ASSETS | 1.47383e+08 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    nfr.stock_code,\n    mcc.en_caption,\n    nfr.data\nFROM \n    non_bank_financial_report nfr\nJOIN \n    map_category_code_non_bank mcc ON nfr.category_code = mcc.category_code\nWHERE \n    nfr.stock_code IN ('VNM', 'MSN') \n    AND nfr.year = 2023 \n    AND nfr.quarter = 0\n    AND mcc.en_caption IN ('TOTAL ASSETS', 'TOTAL LIABILITIES');\n"
            }
        ],
        "score": 1,
        "difficulty": 2,
        "response": "Table 1\n| stock_code   | industry           | total_assets   | total_liabilities   |\n|:-------------|:-------------------|:---------------|:--------------------|\n| VNM          | Food and Beverages |                |                     |\n| MSN          | Food and Beverages |                |                     |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT \n  -- Company identification\n  ci.stock_code,\n  ci.industry,\n  \n  -- Total Assets\n  (SELECT \n     nbfr.data \n   FROM \n     non_bank_financial_report nbfr\n   INNER JOIN \n     map_category_code_non_bank mccnb ON nbfr.category_code = mccnb.category_code\n   WHERE \n     nbfr.stock_code = ci.stock_code \n     AND nbfr.year = 2023 \n     AND nbfr.quarter = 0 \n     AND mccnb.en_caption = 'Total Assets'  -- Replace with actual en_caption if different\n  ) AS total_assets,\n  \n  -- Total Liabilities\n  (SELECT \n     nbfr.data \n   FROM \n     non_bank_financial_report nbfr\n   INNER JOIN \n     map_category_code_non_bank mccnb ON nbfr.category_code = mccnb.category_code\n   WHERE \n     nbfr.stock_code = ci.stock_code \n     AND nbfr.year = 2023 \n     AND nbfr.quarter = 0 \n     AND mccnb.en_caption = 'Total Liabilities'  -- Replace with actual en_caption if different\n  ) AS total_liabilities\n\nFROM \n  company_info ci\n\nWHERE \n  ci.stock_code IN ('VNM', 'MSN')\n\nLIMIT 2;\n"
            }
        ],
        "time": 41.57169699668884,
        "evaluate": 0,
        "input_token": 3733,
        "output_token": 1328
    },
    {
        "id": "557a8a67-6696-4b97-b5fb-a41f9d3101cd",
        "question": "What are the top 5 companies with the highest Total Assets as of Q2 2024?",
        "answer": "Table 1\n| stock_code   | industry    | is_bank   | is_securities   |   total_assets |\n|:-------------|:------------|:----------|:----------------|---------------:|\n| BID          | Banking     | True      | False           |    2.52105e+09 |\n| TCB          | Banking     | True      | False           |    9.08307e+08 |\n| VPB          | Banking     | True      | False           |    8.64392e+08 |\n| VIC          | Real Estate | False     | False           |    7.22259e+08 |\n| SHB          | Banking     | True      | False           |    6.59767e+08 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "-- Query to find the top 5 companies with the highest Total Assets as of Q2 2024\n\nSELECT ci.stock_code, ci.industry, ci.is_bank, ci.is_securities, fr.data AS total_assets\nFROM (\n    SELECT stock_code, data\n    FROM bank_financial_report\n    WHERE category_code = 'BS_300' AND year = 2024 AND quarter = 2\n    \n    UNION ALL\n    \n    SELECT stock_code, data\n    FROM non_bank_financial_report\n    WHERE category_code = 'BS_270' AND year = 2024 AND quarter = 2\n    \n    UNION ALL\n    \n    SELECT stock_code, data\n    FROM securities_financial_report\n    WHERE category_code = 'BS_270' AND year = 2024 AND quarter = 2\n) AS fr\nJOIN company_info ci ON fr.stock_code = ci.stock_code\nORDER BY fr.data DESC\nLIMIT 5;\n"
            }
        ],
        "score": 1,
        "difficulty": 3,
        "response": "Table 1\n| stock_code   | industry    | is_bank   | is_securities   |   total_assets | report_type   |\n|:-------------|:------------|:----------|:----------------|---------------:|:--------------|\n| BID          | Banking     | True      | False           |    2.52105e+09 | bank          |\n| TCB          | Banking     | True      | False           |    9.08307e+08 | bank          |\n| VPB          | Banking     | True      | False           |    8.64392e+08 | bank          |\n| VIC          | Real Estate | False     | False           |    7.22259e+08 | non_bank      |\n| SHB          | Banking     | True      | False           |    6.59767e+08 | bank          |\n\nTable 2\n| stock_code   | industry    | is_bank   | is_securities   |   total_assets | report_type   |\n|:-------------|:------------|:----------|:----------------|---------------:|:--------------|\n| BID          | Banking     | True      | False           |    2.52105e+09 | bank          |\n| TCB          | Banking     | True      | False           |    9.08307e+08 | bank          |\n| VPB          | Banking     | True      | False           |    8.64392e+08 | bank          |\n| VIC          | Real Estate | False     | False           |    7.22259e+08 | non_bank      |\n| SHB          | Banking     | True      | False           |    6.59767e+08 | bank          |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "WITH total_assets AS (\n  SELECT stock_code, data AS total_assets, 'bank' AS report_type\n  FROM bank_financial_report\n  WHERE quarter = 2 AND year = 2024 AND category_code = 'BS_300'\n  \n  UNION ALL\n  \n  SELECT stock_code, data AS total_assets, 'non_bank' AS report_type\n  FROM non_bank_financial_report\n  WHERE quarter = 2 AND year = 2024 AND category_code = 'BS_270'\n  \n  UNION ALL\n  \n  SELECT stock_code, data AS total_assets, 'securities' AS report_type\n  FROM securities_financial_report\n  WHERE quarter = 2 AND year = 2024 AND category_code = 'BS_270'\n)\nSELECT \n  ci.stock_code,\n  ci.industry,\n  ci.is_bank,\n  ci.is_securities,\n  ta.total_assets,\n  ta.report_type\nFROM \n  total_assets ta\n  INNER JOIN company_info ci ON ta.stock_code = ci.stock_code\nORDER BY \n  ta.total_assets DESC\nLIMIT 5;\n"
            }
        ],
        "time": 59.943161964416504,
        "evaluate": 0.5,
        "input_token": 6815,
        "output_token": 2168
    },
    {
        "id": "3092ddf1-2f29-4297-9476-c590de259f84",
        "question": "What is the trend of the Cash Flow from Operating Activities to Total Assets ratio for Vietcombank, Techcombank, and ACB from 2020 to Q2 2024?",
        "answer": "Table 1\n| stock_code   | year   | quarter   | cash_flow_to_total_assets_ratio   |\n|--------------|--------|-----------|-----------------------------------|\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    fr.stock_code, \n    fr.year, \n    fr.quarter, \n    fr.data AS cash_flow_to_total_assets_ratio\nFROM \n    financial_ratio fr\nJOIN \n    map_category_code_ratio mccr ON fr.ratio_code = mccr.ratio_code\nWHERE \n    fr.stock_code IN ('VCB', 'TCB', 'ACB')\n    AND mccr.ratio_name = 'Cash Flow from Operating Activities to Total Assets'\n    AND ((fr.year BETWEEN 2020 AND 2024) AND (fr.quarter = 0 OR (fr.year = 2024 AND fr.quarter <= 2)))\nORDER BY \n    fr.stock_code, \n    fr.year, \n    fr.quarter;\n"
            }
        ],
        "score": 1,
        "difficulty": 2,
        "response": "Table 1\n| stock_code   | year   | quarter   | cash_flow_to_total_assets_ratio   |\n|--------------|--------|-----------|-----------------------------------|\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "WITH \n  -- Extract Cash Flow from Operating Activities\n  cash_flow AS (\n    SELECT \n      stock_code,\n      year,\n      quarter,\n      data AS cash_flow_operating\n    FROM \n      bank_financial_report\n    WHERE \n      category_code = 'CF_009'\n      AND stock_code IN ('VCB', 'TCB', 'ACB')\n      AND (year BETWEEN 2020 AND 2024)\n      AND (quarter = 0 OR (year = 2024 AND quarter = 2))\n  ),\n  \n  -- Extract Total Assets\n  total_assets AS (\n    SELECT \n      stock_code,\n      year,\n      quarter,\n      data AS total_assets\n    FROM \n      bank_financial_report\n    WHERE \n      category_code = 'BS_300'\n      AND stock_code IN ('VCB', 'TCB', 'ACB')\n      AND (year BETWEEN 2020 AND 2024)\n      AND (quarter = 0 OR (year = 2024 AND quarter = 2))\n  )\n\n-- Join and calculate the ratio\nSELECT \n  c.stock_code,\n  c.year,\n  c.quarter,\n  (c.cash_flow_operating / t.total_assets) AS cash_flow_to_total_assets_ratio\nFROM \n  cash_flow c\n  INNER JOIN total_assets t ON c.stock_code = t.stock_code AND c.year = t.year AND c.quarter = t.quarter\nORDER BY \n  c.stock_code, c.year, c.quarter\nLIMIT 100;\n"
            }
        ],
        "time": 39.343372106552124,
        "evaluate": 0,
        "input_token": 2861,
        "output_token": 884
    },
    {
        "id": "d4bb52e6-2407-4f6d-9f90-60c654e8c0b2",
        "question": "What is the trend of the Return on Equity (ROE) for Vietcombank, Techcombank, and ACB from 2020 to Q2 2024?",
        "answer": "Table 1\n| stock_code   |   year |   quarter |       roe |\n|:-------------|-------:|----------:|----------:|\n| ACB          |   2020 |         0 | 0.216734  |\n| ACB          |   2021 |         0 | 0.213865  |\n| ACB          |   2022 |         0 | 0.234232  |\n| ACB          |   2023 |         0 | 0.226122  |\n| TCB          |   2020 |         0 | 0.168632  |\n| TCB          |   2021 |         0 | 0.197927  |\n| TCB          |   2022 |         0 | 0.180176  |\n| TCB          |   2023 |         0 | 0.139608  |\n| TCB          |   2024 |         2 | 0.0457096 |\n| VCB          |   2020 |         0 | 0.196318  |\n| VCB          |   2021 |         0 | 0.201059  |\n| VCB          |   2022 |         0 | 0.220567  |\n| VCB          |   2023 |         0 | 0.200315  |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    stock_code, \n    year, \n    quarter, \n    data AS ROE\nFROM \n    financial_ratio\nWHERE \n    ratio_code = 'ROE' AND\n    stock_code IN ('VCB', 'TCB', 'ACB') AND\n    ((year BETWEEN 2020 AND 2023 AND quarter = 0) OR\n     (year = 2024 AND quarter = 2))\nORDER BY \n    stock_code, year, quarter;\n"
            }
        ],
        "score": 1,
        "difficulty": 2,
        "response": "Table 1\n| stock_code   |   year |   quarter |   roe_value |\n|:-------------|-------:|----------:|------------:|\n| ACB          |   2020 |         2 |   0.0493524 |\n| ACB          |   2021 |         0 |   0.213865  |\n| ACB          |   2022 |         0 |   0.234232  |\n| ACB          |   2023 |         0 |   0.226122  |\n| TCB          |   2020 |         2 |   0.0428449 |\n| TCB          |   2021 |         0 |   0.197927  |\n| TCB          |   2022 |         0 |   0.180176  |\n| TCB          |   2023 |         0 |   0.139608  |\n| TCB          |   2024 |         2 |   0.0457096 |\n| VCB          |   2020 |         2 |   0.0515214 |\n| VCB          |   2021 |         0 |   0.201059  |\n| VCB          |   2022 |         0 |   0.220567  |\n| VCB          |   2023 |         0 |   0.200315  |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "WITH target_companies AS (\n  SELECT 'VCB' AS stock_code UNION\n  SELECT 'TCB' UNION\n  SELECT 'ACB'\n),\ntarget_years AS (\n  SELECT 2020 AS year, 2 AS quarter UNION\n  SELECT 2021, 0 UNION\n  SELECT 2022, 0 UNION\n  SELECT 2023, 0 UNION\n  SELECT 2024, 2\n),\nroe_ratio AS (\n  SELECT ratio_code \n  FROM map_category_code_ratio \n  WHERE ratio_name = 'Return On Equity'\n)\nSELECT \n  tc.stock_code,\n  ty.year,\n  ty.quarter,\n  fr.data AS roe_value\nFROM \n  target_companies tc\n  CROSS JOIN target_years ty\n  JOIN financial_ratio fr ON tc.stock_code = fr.stock_code\n  JOIN roe_ratio rr ON fr.ratio_code = rr.ratio_code\nWHERE \n  fr.year = ty.year \n  AND fr.quarter = ty.quarter\nORDER BY \n  tc.stock_code, \n  ty.year, \n  ty.quarter\nLIMIT 100;\n"
            }
        ],
        "time": 35.85901761054993,
        "evaluate": 0,
        "input_token": 2435,
        "output_token": 879
    },
    {
        "id": "210545b9-e52c-408a-9b0a-96e26978bc0d",
        "question": "What are the top 5 companies with the highest operating cash flow in 2022?",
        "answer": "Table 1\n| stock_code   | industry                             |   operating_cash_flow |\n|:-------------|:-------------------------------------|----------------------:|\n| VHM          | Real Estate                          |           3.10035e+07 |\n| VGI          | Telecommunications                   |           1.36636e+07 |\n| GAS          | Utilities (Electricity, Water & Gas) |           1.27921e+07 |\n| HPG          | Basic Resources                      |           1.22776e+07 |\n| VNM          | Food and Beverages                   |           8.82727e+06 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "(\n    SELECT c.stock_code, c.industry, nfr.data AS operating_cash_flow\n    FROM non_bank_financial_report nfr\n    JOIN company_info c ON nfr.stock_code = c.stock_code\n    WHERE nfr.year = 2022 AND nfr.quarter = 0 AND nfr.category_code = 'CF_020'\n)\nUNION ALL\n(\n    SELECT c.stock_code, c.industry, bfr.data AS operating_cash_flow\n    FROM bank_financial_report bfr\n    JOIN company_info c ON bfr.stock_code = c.stock_code\n    WHERE bfr.year = 2022 AND bfr.quarter = 0 AND bfr.category_code = 'CF_009'\n)\nUNION ALL\n(\n    SELECT c.stock_code, c.industry, sfr.data AS operating_cash_flow\n    FROM securities_financial_report sfr\n    JOIN company_info c ON sfr.stock_code = c.stock_code\n    WHERE sfr.year = 2022 AND sfr.quarter = 0 AND sfr.category_code = 'CF_060'\n)\nORDER BY operating_cash_flow DESC\nLIMIT 5;\n"
            }
        ],
        "score": 1,
        "difficulty": 3,
        "response": "Table 1\n| stock_code   | industry                             |   operating_cash_flow |\n|:-------------|:-------------------------------------|----------------------:|\n| VHM          | Real Estate                          |           3.10035e+07 |\n| VGI          | Telecommunications                   |           1.36636e+07 |\n| GAS          | Utilities (Electricity, Water & Gas) |           1.27921e+07 |\n| HPG          | Basic Resources                      |           1.22776e+07 |\n| VNM          | Food and Beverages                   |           8.82727e+06 |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "WITH operating_cash_flow AS (\n  SELECT \n    'non_bank' AS report_type,\n    nfr.stock_code,\n    nfr.data AS operating_cash_flow\n  FROM \n    non_bank_financial_report nfr\n  WHERE \n    nfr.year = 2022 AND nfr.quarter = 0 AND nfr.category_code = 'CF_020'\n\n  UNION ALL\n\n  SELECT \n    'bank' AS report_type,\n    bfr.stock_code,\n    bfr.data AS operating_cash_flow\n  FROM \n    bank_financial_report bfr\n  WHERE \n    bfr.year = 2022 AND bfr.quarter = 0 AND bfr.category_code = 'CF_009'\n\n  UNION ALL\n\n  SELECT \n    'securities' AS report_type,\n    sfr.stock_code,\n    sfr.data AS operating_cash_flow\n  FROM \n    securities_financial_report sfr\n  WHERE \n    sfr.year = 2022 AND sfr.quarter = 0 AND sfr.category_code = 'CF_060'\n)\n\nSELECT \n  ci.stock_code,\n  ci.industry,\n  ocf.operating_cash_flow\nFROM \n  operating_cash_flow ocf\n  LEFT JOIN company_info ci ON ocf.stock_code = ci.stock_code\nORDER BY \n  ocf.operating_cash_flow DESC\nLIMIT 5;\n"
            }
        ],
        "time": 41.96857309341431,
        "evaluate": 1,
        "input_token": 8815,
        "output_token": 2829
    },
    {
        "id": "916ca955-e277-4c29-8413-c4f9f46fdead",
        "question": "Compare the change in the Free Cash Flow (FCF) to Revenue ratio for Vinamilk, Masan Group, and SABECO from 2020 to Q2 2024.  Calculate FCF as Operating Cash Flow - Capital Expenditures.",
        "answer": "Table 1\n| stock_code   |   year |   quarter |   free_cash_flow |          revenue |   fcf_to_revenue_ratio |\n|:-------------|-------:|----------:|-----------------:|-----------------:|-----------------------:|\n| MSN          |   2020 |         0 |      5.02946e+06 |      1.19577e+06 |              4.20603   |\n| MSN          |   2020 |         2 |      1.39238e+06 | 324589           |              4.28967   |\n| MSN          |   2021 |         0 |      3.94934e+06 |      1.12732e+07 |              0.350331  |\n| MSN          |   2021 |         2 |      2.85035e+06 |      1.14379e+06 |              2.49202   |\n| MSN          |   2022 |         0 | 376469           |      5.22274e+06 |              0.0720826 |\n| MSN          |   2022 |         2 |      1.58818e+06 |      1.26951e+06 |              1.25102   |\n| MSN          |   2023 |         0 |      2.72926e+06 |      2.35043e+06 |              1.16117   |\n| MSN          |   2023 |         2 |      1.95534e+06 | 466572           |              4.19085   |\n| SAB          |   2020 |         0 |      4.49605e+06 |      6.07641e+06 |              0.739919  |\n| SAB          |   2020 |         2 |      1.73514e+06 |      1.4662e+06  |              1.18343   |\n| SAB          |   2021 |         0 |      3.84739e+06 |      4.78023e+06 |              0.804855  |\n| SAB          |   2021 |         2 |      1.70659e+06 |      1.3032e+06  |              1.30954   |\n| SAB          |   2022 |         0 |      4.91168e+06 |      6.82966e+06 |              0.719169  |\n| SAB          |   2022 |         2 |      2.38322e+06 |      2.20974e+06 |              1.0785    |\n| SAB          |   2023 |         0 |      2.2238e+06  |      5.40263e+06 |              0.411614  |\n| SAB          |   2023 |         2 |      1.11413e+06 |      1.53609e+06 |              0.725305  |\n| SAB          |   2024 |         2 |      2.30155e+06 |      1.64767e+06 |              1.39685   |\n| VNM          |   2020 |         0 |      1.1445e+07  |      1.35394e+07 |              0.845311  |\n| VNM          |   2020 |         2 |      5.48195e+06 |      3.72152e+06 |              1.47304   |\n| VNM          |   2021 |         0 |      1.0963e+07  |      1.27276e+07 |              0.861355  |\n| VNM          |   2021 |         2 |      4.48222e+06 |      3.51026e+06 |              1.27689   |\n| VNM          |   2022 |         0 |      1.02842e+07 |      1.04911e+07 |              0.980281  |\n| VNM          |   2022 |         2 |      3.59228e+06 |      2.60094e+06 |              1.38115   |\n| VNM          |   2023 |         0 |      9.46706e+06 |      1.09036e+07 |              0.868248  |\n| VNM          |   2023 |         2 |      4.32854e+06 |      5.09154e+06 |              0.850145  |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "WITH fcf_calculation AS (\n    SELECT \n        stock_code,\n        year,\n        quarter,\n        SUM(CASE WHEN category_code = 'CF_020' THEN data ELSE 0 END) AS operating_cash_flow,\n        SUM(CASE WHEN category_code = 'CF_021' THEN data ELSE 0 END) AS capital_expenditures,\n        SUM(CASE WHEN category_code = 'IS_030' THEN data ELSE 0 END) AS revenue\n    FROM \n        non_bank_financial_report\n    WHERE \n        stock_code IN ('VNM', 'MSN', 'SAB') AND\n        ((year BETWEEN 2020 AND 2024) AND (quarter = 0 OR quarter = 2))\n    GROUP BY \n        stock_code, year, quarter\n)\nSELECT \n    stock_code,\n    year,\n    quarter,\n    (operating_cash_flow - capital_expenditures) AS free_cash_flow,\n    revenue,\n    CASE \n        WHEN revenue != 0 THEN (operating_cash_flow - capital_expenditures) / revenue\n        ELSE NULL\n    END AS fcf_to_revenue_ratio\nFROM \n    fcf_calculation\nORDER BY \n    stock_code, year, quarter;\n"
            }
        ],
        "score": 1,
        "difficulty": 3,
        "response": "Table 1\n| stock_code   |   year |   quarter | free_cash_flow   | fcf_to_revenue_ratio   | change_in_fcf_to_revenue_ratio   |\n|:-------------|-------:|----------:|:-----------------|:-----------------------|:---------------------------------|\n| MSN          |   2020 |         0 |                  |                        |                                  |\n| MSN          |   2021 |         0 |                  |                        |                                  |\n| MSN          |   2022 |         0 |                  |                        |                                  |\n| MSN          |   2023 |         0 |                  |                        |                                  |\n| MSN          |   2024 |         1 |                  |                        |                                  |\n| SAB          |   2020 |         0 |                  |                        |                                  |\n| SAB          |   2021 |         0 |                  |                        |                                  |\n| SAB          |   2022 |         0 |                  |                        |                                  |\n| SAB          |   2023 |         0 |                  |                        |                                  |\n| SAB          |   2024 |         1 |                  |                        |                                  |\n| SAB          |   2024 |         2 |                  |                        |                                  |\n| VNM          |   2020 |         0 |                  |                        |                                  |\n| VNM          |   2021 |         0 |                  |                        |                                  |\n| VNM          |   2022 |         0 |                  |                        |                                  |\n| VNM          |   2023 |         0 |                  |                        |                                  |\n| VNM          |   2024 |         1 |                  |                        |                                  |\n\nTable 2\n| stock_code   |   year |   quarter | free_cash_flow   | fcf_to_revenue_ratio   | change_in_fcf_to_revenue_ratio   |\n|:-------------|-------:|----------:|:-----------------|:-----------------------|:---------------------------------|\n| MSN          |   2020 |         0 |                  |                        |                                  |\n| MSN          |   2021 |         0 |                  |                        |                                  |\n| MSN          |   2022 |         0 |                  |                        |                                  |\n| MSN          |   2023 |         0 |                  |                        |                                  |\n| MSN          |   2024 |         1 |                  |                        |                                  |\n| SAB          |   2020 |         0 |                  |                        |                                  |\n| SAB          |   2021 |         0 |                  |                        |                                  |\n| SAB          |   2022 |         0 |                  |                        |                                  |\n| SAB          |   2023 |         0 |                  |                        |                                  |\n| SAB          |   2024 |         1 |                  |                        |                                  |\n| SAB          |   2024 |         2 |                  |                        |                                  |\n| VNM          |   2020 |         0 |                  |                        |                                  |\n| VNM          |   2021 |         0 |                  |                        |                                  |\n| VNM          |   2022 |         0 |                  |                        |                                  |\n| VNM          |   2023 |         0 |                  |                        |                                  |\n| VNM          |   2024 |         1 |                  |                        |                                  |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "WITH \n  -- Define the stock codes and time frame\n  companies AS (\n    SELECT 'VNM' AS stock_code UNION\n    SELECT 'MSN' UNION\n    SELECT 'SAB'\n  ),\n  \n  -- Retrieve financial data for each company and period\n  financial_data AS (\n    SELECT \n      c.stock_code,\n      n.year,\n      n.quarter,\n      -- Operating Cash Flow\n      MAX(CASE WHEN n.category_code = 'CF_045' THEN n.data END) AS operating_cash_flow,\n      -- Capital Expenditures\n      MAX(CASE WHEN n.category_code = 'CF_046' THEN n.data END) AS capital_expenditures,\n      -- Revenue\n      MAX(CASE WHEN n.category_code = 'IS_001' THEN n.data END) AS revenue\n    FROM \n      companies c\n    JOIN \n      non_bank_financial_report n ON c.stock_code = n.stock_code\n    WHERE \n      n.year BETWEEN 2020 AND 2024\n      AND (n.quarter = 0 OR (n.year = 2024 AND n.quarter IN (1, 2)))\n    GROUP BY \n      c.stock_code, n.year, n.quarter\n  )\n\nSELECT \n  fd.stock_code,\n  fd.year,\n  fd.quarter,\n  (fd.operating_cash_flow - fd.capital_expenditures) AS free_cash_flow,\n  (fd.operating_cash_flow - fd.capital_expenditures) / fd.revenue AS fcf_to_revenue_ratio,\n  ((fd.operating_cash_flow - fd.capital_expenditures) / fd.revenue) - \n  LAG(((fd.operating_cash_flow - fd.capital_expenditures) / fd.revenue), 1, 0) OVER (PARTITION BY fd.stock_code ORDER BY fd.year, fd.quarter) AS change_in_fcf_to_revenue_ratio\nFROM \n  financial_data fd\nORDER BY \n  fd.stock_code, fd.year, fd.quarter\nLIMIT 100;\n"
            }
        ],
        "time": 95.47654223442078,
        "evaluate": 0,
        "input_token": 6723,
        "output_token": 2252
    },
    {
        "id": "01c004d0-974e-44a8-b591-7d38da1708a0",
        "question": "Compare the current ratio and quick ratio of Vinamilk, Masan Group, and SABECO from 2020 to Q2 2024.  Analyze the changes in their cash and short-term investments during this period.",
        "answer": "Table 1\n| stock_code   |   year |   quarter | ratio_name    |   ratio_value |\n|:-------------|-------:|----------:|:--------------|--------------:|\n| MSN          |   2020 |         0 | Current Ratio |      0.773354 |\n| MSN          |   2020 |         0 | Quick Ratio   |      0.451862 |\n| MSN          |   2022 |         0 | Current Ratio |      0.73558  |\n| MSN          |   2022 |         0 | Quick Ratio   |      0.514436 |\n| SAB          |   2020 |         0 | Current Ratio |      3.79993  |\n| SAB          |   2020 |         0 | Quick Ratio   |      3.52024  |\n| SAB          |   2021 |         0 | Current Ratio |      3.16422  |\n| SAB          |   2021 |         0 | Quick Ratio   |      2.93441  |\n| SAB          |   2023 |         0 | Current Ratio |      3.24947  |\n| SAB          |   2023 |         0 | Quick Ratio   |      2.9677   |\n| VNM          |   2020 |         0 | Current Ratio |      2.09132  |\n| VNM          |   2020 |         0 | Quick Ratio   |      1.7462   |\n| VNM          |   2022 |         0 | Current Ratio |      2.06801  |\n| VNM          |   2022 |         0 | Quick Ratio   |      1.70628  |\n| VNM          |   2024 |         1 | Current Ratio |      2.30115  |\n| VNM          |   2024 |         1 | Quick Ratio   |      1.85779  |\n| MSN          |   2021 |         0 | Current Ratio |      1.27032  |\n| MSN          |   2021 |         0 | Quick Ratio   |      0.899436 |\n| MSN          |   2023 |         0 | Current Ratio |      0.874439 |\n| MSN          |   2023 |         0 | Quick Ratio   |      0.61315  |\n| MSN          |   2024 |         1 | Current Ratio |      0.87025  |\n| MSN          |   2024 |         1 | Quick Ratio   |      0.611971 |\n| SAB          |   2022 |         0 | Current Ratio |      2.93495  |\n| SAB          |   2022 |         0 | Quick Ratio   |      2.69688  |\n| SAB          |   2024 |         1 | Current Ratio |      4.68054  |\n| SAB          |   2024 |         1 | Quick Ratio   |      4.27023  |\n| SAB          |   2024 |         2 | Current Ratio |      3.18639  |\n| SAB          |   2024 |         2 | Quick Ratio   |      2.9152   |\n| VNM          |   2021 |         0 | Current Ratio |      2.11895  |\n| VNM          |   2021 |         0 | Quick Ratio   |      1.72213  |\n| VNM          |   2023 |         0 | Current Ratio |      2.1016   |\n| VNM          |   2023 |         0 | Quick Ratio   |      1.74405  |\n\nTable 2\n| stock_code   |   year |   quarter | en_caption                           |   financial_data |\n|:-------------|-------:|----------:|:-------------------------------------|-----------------:|\n| MSN          |   2020 |         0 | I. Cash and cash equivalents         |      7.72144e+06 |\n| MSN          |   2021 |         0 | I. Cash and cash equivalents         |      2.23048e+07 |\n| MSN          |   2022 |         0 | I. Cash and cash equivalents         |      1.38531e+07 |\n| MSN          |   2023 |         0 | I. Cash and cash equivalents         |      1.01245e+07 |\n| MSN          |   2020 |         0 | II. Short-term financial investments | 447250           |\n| MSN          |   2021 |         0 | II. Short-term financial investments | 332753           |\n| MSN          |   2022 |         0 | II. Short-term financial investments |      3.65918e+06 |\n| MSN          |   2023 |         0 | II. Short-term financial investments |      6.79479e+06 |\n| VNM          |   2024 |         1 | I. Cash and cash equivalents         |      1.78825e+06 |\n| MSN          |   2024 |         1 | I. Cash and cash equivalents         |      8.49273e+06 |\n| MSN          |   2024 |         1 | II. Short-term financial investments |      5.32918e+06 |\n| VNM          |   2020 |         0 | I. Cash and cash equivalents         |      2.11124e+06 |\n| VNM          |   2021 |         0 | I. Cash and cash equivalents         |      2.34855e+06 |\n| VNM          |   2022 |         0 | I. Cash and cash equivalents         |      2.29994e+06 |\n| VNM          |   2023 |         0 | I. Cash and cash equivalents         |      2.91203e+06 |\n| VNM          |   2020 |         0 | II. Short-term financial investments |      1.73137e+07 |\n| VNM          |   2021 |         0 | II. Short-term financial investments |      2.10257e+07 |\n| VNM          |   2022 |         0 | II. Short-term financial investments |      1.74141e+07 |\n| VNM          |   2023 |         0 | II. Short-term financial investments |      2.01372e+07 |\n| SAB          |   2020 |         0 | I. Cash and cash equivalents         |      2.72614e+06 |\n| SAB          |   2021 |         0 | I. Cash and cash equivalents         |      3.60645e+06 |\n| SAB          |   2022 |         0 | I. Cash and cash equivalents         |      4.06946e+06 |\n| SAB          |   2023 |         0 | I. Cash and cash equivalents         |      5.03991e+06 |\n| SAB          |   2020 |         0 | II. Short-term financial investments |      1.45474e+07 |\n| SAB          |   2021 |         0 | II. Short-term financial investments |      1.69912e+07 |\n| SAB          |   2022 |         0 | II. Short-term financial investments |      1.94115e+07 |\n| SAB          |   2023 |         0 | II. Short-term financial investments |      1.77411e+07 |\n| VNM          |   2024 |         1 | II. Short-term financial investments |      2.02681e+07 |\n| SAB          |   2024 |         1 | I. Cash and cash equivalents         |      3.2131e+06  |\n| SAB          |   2024 |         2 | I. Cash and cash equivalents         |      6.0341e+06  |\n| SAB          |   2024 |         1 | II. Short-term financial investments |      1.82025e+07 |\n| SAB          |   2024 |         2 | II. Short-term financial investments |      1.73244e+07 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "-- Step 1: Retrieve Current Ratio and Quick Ratio\nSELECT \n    fr.stock_code,\n    fr.year,\n    fr.quarter,\n    mccr.ratio_name,\n    fr.data AS ratio_value\nFROM \n    financial_ratio fr\nJOIN \n    map_category_code_ratio mccr ON fr.ratio_code = mccr.ratio_code\nWHERE \n    fr.stock_code IN ('VNM', 'MSN', 'SAB')\n    AND mccr.ratio_name IN ('Current Ratio', 'Quick Ratio')\n    AND ((fr.year = 2020 AND fr.quarter = 0) OR \n         (fr.year = 2021 AND fr.quarter = 0) OR \n         (fr.year = 2022 AND fr.quarter = 0) OR \n         (fr.year = 2023 AND fr.quarter = 0) OR \n         (fr.year = 2024 AND fr.quarter IN (1, 2)));\n\n-- Step 2: Analyze changes in cash and short-term investments\nSELECT \n    nbf.stock_code,\n    nbf.year,\n    nbf.quarter,\n    mccnb.en_caption,\n    nbf.data AS financial_data\nFROM \n    non_bank_financial_report nbf\nJOIN \n    map_category_code_non_bank mccnb ON nbf.category_code = mccnb.category_code\nWHERE \n    nbf.stock_code IN ('VNM', 'MSN', 'SAB')\n    AND mccnb.en_caption IN ('I. Cash and cash equivalents', 'II. Short-term financial investments')\n    AND ((nbf.year = 2020 AND nbf.quarter = 0) OR \n         (nbf.year = 2021 AND nbf.quarter = 0) OR \n         (nbf.year = 2022 AND nbf.quarter = 0) OR \n         (nbf.year = 2023 AND nbf.quarter = 0) OR \n         (nbf.year = 2024 AND nbf.quarter IN (1, 2)));\n"
            }
        ],
        "score": 1,
        "difficulty": 3,
        "response": "Table 1\n| stock_code   | company_name                   |   year |   quarter | ratio_name                                            |      ratio_value |\n|:-------------|:-------------------------------|-------:|----------:|:------------------------------------------------------|-----------------:|\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Allowance For Doubtful Accounts Ratio                 |     -0.0523087   |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Allowance For Doubtful Accounts To Total Assets Ratio |     -0.000931909 |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Asset To Debt Ratio                                   |      1.27595     |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Basic Earning Power                                   |      0.0526638   |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Basic Earning Power Ratio                             |      0.0526638   |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Cash Debt Coverage Ratio                              |      0.0198552   |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Cash Flow From Sales To Sales                         |      0.0174998   |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Cash Flow Margin                                      |      0.0171815   |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Cash Interest Coverage                                |      1.35841     |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Cash Ratio                                            |      0.198624    |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Cash Return On Assets                                 |      0.0126862   |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Cash Return On Fixed Assets                           |      0.0299046   |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | CFO To Total Equity                                   |      0.0351358   |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Current Ratio                                         |      0.773354    |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Debt To Assets Ratio                                  |      0.783731    |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Debt To Equity Ratio                                  |      3.62386     |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Debt To Tangible Net Worth Ratio                      |      9.26318     |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Debt To Total Capital Ratio                           |      0.783731    |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Earning Quality Ratio                                 |      0.968664    |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | EBITDA                                                | 983176           |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Equity Ratio                                          |      0.216269    |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Financial Income To Net Revenue Ratio                 |      0.0185276   |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Financial Leverage                                    |      0.783731    |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Fixed Asset Self Financing Ratio                      |      1.48219     |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Free Cash Flow                                        |      1.98463e+07 |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | General Solvency Ratio                                |      1.27595     |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Gross Profit Margin                                   |      0.231665    |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Interest Coverage Ratio                               |      1.61662     |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Long Term Asset Self Financing Ratio                  |      0.893994    |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Long Term Debt Coverage Ratio                         |      1.65875     |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Long Term Debt To Equity Capital Ratio                |      2.07076     |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Long Term Debt To Equity Ratio                        |      2.07076     |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Operating Profit Margin                               |      0.0154857   |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Permanent Financing Ratio                             |      0.664111    |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Price Spread Ratio                                    |      0.301516    |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Profitability Of Cost Of Goods Sold                   |      0.0201549   |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Profitability Of Operating Expenses                   |      0.0158305   |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Quick Ratio                                           |      0.451862    |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Receivables To Payables Ratio                         |      0.0952905   |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Receivables To Sales Ratio                            |      0.0267026   |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Receivables To Total Assets Ratio                     |      0.0746821   |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Return On Assets                                      |      0.0120533   |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Return On Equity                                      |      0.055733    |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Return On Fixed Assets                                |      0.0281354   |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Return On Investment                                  |      0.0120533   |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Return On Long Term Operating Assets                  |      0.613257    |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Return On Sales                                       |      0.0180659   |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Short Term Debt To Assets Ratio                       |      0.335889    |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Short Term Debt To Equity Ratio                       |      1.55311     |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2020 |         0 | Time Interest Earned                                  |      1.61662     |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2021 |         0 | Allowance For Doubtful Accounts Ratio                 |     -0.013454    |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2021 |         0 | Allowance For Doubtful Accounts To Total Assets Ratio |     -0.000264637 |\n| MSN          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Masan |   2021 |         0 | Asset To Debt Ratio                  ",
        "code_response": [
            {
                "language": "sql",
                "code": "WITH target_companies AS (\n  SELECT stock_code\n  FROM company_info\n  WHERE stock_code IN ('VNM', 'MSN', 'SAB')\n)\nSELECT \n  fr.stock_code,\n  ci.company_name,\n  fr.year,\n  fr.quarter,\n  mcr.ratio_name,\n  fr.data AS ratio_value\nFROM \n  financial_ratio fr\n  INNER JOIN target_companies tc ON fr.stock_code = tc.stock_code\n  INNER JOIN company_info ci ON fr.stock_code = ci.stock_code\n  INNER JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\nWHERE \n  (fr.year BETWEEN 2020 AND 2023 AND fr.quarter = 0)  -- Annual reports for 2020-2023\n  OR (fr.year = 2024 AND fr.quarter = 2)  -- Q2 2024\n  AND mcr.ratio_name IN ('Current Ratio', 'Quick Ratio')\nORDER BY \n  fr.stock_code, fr.year, fr.quarter, mcr.ratio_name\nLIMIT 100;\n"
            },
            {
                "language": "sql",
                "code": "WITH target_companies AS (\n  SELECT stock_code\n  FROM company_info\n  WHERE stock_code IN ('VNM', 'MSN', 'SAB')\n),\ncash_investments_codes AS (\n  SELECT 'BS_110' AS category_code, 'Cash' AS investment_type UNION ALL\n  SELECT 'BS_120', 'Short-term investments'\n)\nSELECT \n  nfr.stock_code,\n  ci.company_name,\n  nfr.year,\n  nfr.quarter,\n  cic.investment_type,\n  nfr.data AS investment_value\nFROM \n  non_bank_financial_report nfr\n  INNER JOIN target_companies tc ON nfr.stock_code = tc.stock_code\n  INNER JOIN company_info ci ON nfr.stock_code = ci.stock_code\n  INNER JOIN cash_investments_codes cic ON nfr.category_code = cic.category_code\nWHERE \n  (nfr.year BETWEEN 2020 AND 2023 AND nfr.quarter = 0)  -- Annual reports for 2020-2023\n  OR (nfr.year = 2024 AND nfr.quarter = 2)  -- Q2 2024\nORDER BY \n  nfr.stock_code, nfr.year, nfr.quarter, cic.investment_type\nLIMIT 100;\n"
            },
            {
                "language": "python",
                "code": "import pandas as pd\n\n# Assuming df1 and df2 are the result DataFrames from the above SQL queries\ndf1 = pd.read_sql_query(step1_query, your_database_connection)\ndf2 = pd.read_sql_query(step2_query, your_database_connection)\n\n# Merge the DataFrames\nmerged_df = pd.merge(df1, df2, on=['stock_code', 'year', 'quarter'], how='inner')\n\n# Perform analysis on the merged DataFrame\nprint(merged_df)\n"
            }
        ],
        "time": 57.09463167190552,
        "evaluate": 0,
        "input_token": 4858,
        "output_token": 2180
    },
    {
        "id": "9f7f3747-ac23-4eb1-8d0c-49469b2186e6",
        "question": "Analyze the changes in  Free Cash Flow to Firm (FCFF) for Vinamilk, Masan Group, and Hoa Phat Group from 2020 to Q2 2024.  Calculate the FCFF using the indirect method.",
        "answer": "Table 1\n|   year |   quarter | stock_code   | en_company_name                            |        fcff |\n|-------:|----------:|:-------------|:-------------------------------------------|------------:|\n|   2020 |         0 | HPG          | Hoa Phat Group Joint Stock Company         | 3.68935e+07 |\n|   2021 |         0 | HPG          | Hoa Phat Group Joint Stock Company         | 8.1097e+07  |\n|   2022 |         0 | HPG          | Hoa Phat Group Joint Stock Company         | 8.79324e+07 |\n|   2023 |         0 | HPG          | Hoa Phat Group Joint Stock Company         | 6.58285e+07 |\n|   2024 |         2 | HPG          | Hoa Phat Group Joint Stock Company         | 3.70183e+07 |\n|   2020 |         0 | MSN          | Masan Group Corporation                    | 1.98463e+07 |\n|   2021 |         0 | MSN          | Masan Group Corporation                    | 1.66562e+07 |\n|   2022 |         0 | MSN          | Masan Group Corporation                    | 1.2966e+07  |\n|   2023 |         0 | MSN          | Masan Group Corporation                    | 3.16468e+07 |\n|   2020 |         0 | VNM          | Vietnam Dairy Products Joint Stock Company | 2.4254e+07  |\n|   2021 |         0 | VNM          | Vietnam Dairy Products Joint Stock Company | 2.20982e+07 |\n|   2022 |         0 | VNM          | Vietnam Dairy Products Joint Stock Company | 2.19656e+07 |\n|   2023 |         0 | VNM          | Vietnam Dairy Products Joint Stock Company | 2.0475e+07  |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    fr.year, \n    fr.quarter, \n    ci.stock_code, \n    ci.en_company_name, \n    fr.data AS fcff\nFROM \n    financial_ratio fr\nJOIN \n    company_info ci ON fr.stock_code = ci.stock_code\nJOIN \n    map_category_code_ratio mccr ON fr.ratio_code = mccr.ratio_code\nWHERE \n    ci.stock_code IN ('VNM', 'MSN', 'HPG') \n    AND mccr.ratio_name = 'Free Cash Flow'\n    AND ((fr.year BETWEEN 2020 AND 2024 AND fr.quarter = 0) OR (fr.year = 2024 AND fr.quarter = 2))\nORDER BY \n    ci.stock_code, fr.year, fr.quarter;\n"
            }
        ],
        "score": 1,
        "difficulty": 2,
        "response": "Table 1\n| stock_code   |   year |   quarter |   fcff |\n|:-------------|-------:|----------:|-------:|\n| HPG          |   2020 |         0 |      0 |\n| HPG          |   2021 |         0 |      0 |\n| HPG          |   2022 |         0 |      0 |\n| HPG          |   2023 |         0 |      0 |\n| HPG          |   2024 |         2 |      0 |\n| MSN          |   2020 |         0 |      0 |\n| MSN          |   2021 |         0 |      0 |\n| MSN          |   2022 |         0 |      0 |\n| MSN          |   2023 |         0 |      0 |\n| VNM          |   2020 |         0 |      0 |\n| VNM          |   2021 |         0 |      0 |\n| VNM          |   2022 |         0 |      0 |\n| VNM          |   2023 |         0 |      0 |\n\nTable 2\n| stock_code   |   year |   quarter | category_name                                          |             data |\n|:-------------|-------:|----------:|:-------------------------------------------------------|-----------------:|\n| HPG          |   2020 |         0 | Deductions from revenue                                |      1.16054e+06 |\n| HPG          |   2020 |         0 | Depreciation of fixed assets and investment properties |      4.79386e+06 |\n| HPG          |   2020 |         0 | Profit before tax                                      |      1.5357e+07  |\n| HPG          |   2020 |         0 | Provisions                                             |  28314           |\n| HPG          |   2020 |         0 | Revenue from sales and services rendered               |      9.1279e+07  |\n| HPG          |   2021 |         0 | Deductions from revenue                                |      1.18557e+06 |\n| HPG          |   2021 |         0 | Depreciation of fixed assets and investment properties |   5988           |\n| HPG          |   2021 |         0 | Profit before tax                                      |      3.70568e+07 |\n| HPG          |   2021 |         0 | Provisions                                             | 163177           |\n| HPG          |   2021 |         0 | Revenue from sales and services rendered               |      1.50865e+08 |\n| HPG          |   2022 |         0 | Deductions from revenue                                |      1.36154e+06 |\n| HPG          |   2022 |         0 | Depreciation of fixed assets and investment properties |      6.77214e+06 |\n| HPG          |   2022 |         0 | Profit before tax                                      |      9.92294e+06 |\n| HPG          |   2022 |         0 | Provisions                                             |      1.01092e+06 |\n| HPG          |   2022 |         0 | Revenue from sales and services rendered               |      1.42771e+08 |\n| HPG          |   2023 |         0 | Deductions from revenue                                |      1.4022e+06  |\n| HPG          |   2023 |         0 | Depreciation of fixed assets and investment properties |      6.77403e+06 |\n| HPG          |   2023 |         0 | Profit before tax                                      |      7.79273e+06 |\n| HPG          |   2023 |         0 | Provisions                                             |     -1.0942e+06  |\n| HPG          |   2023 |         0 | Revenue from sales and services rendered               |      1.20355e+08 |\n| HPG          |   2024 |         2 | Deductions from revenue                                | 380758           |\n| HPG          |   2024 |         2 | Depreciation of fixed assets and investment properties |      3.45753e+06 |\n| HPG          |   2024 |         2 | Profit before tax                                      |      6.99444e+06 |\n| HPG          |   2024 |         2 | Provisions                                             | 172692           |\n| HPG          |   2024 |         2 | Revenue from sales and services rendered               |      3.99363e+07 |\n| MSN          |   2020 |         0 | Deductions from revenue                                |      1.65051e+06 |\n| MSN          |   2020 |         0 | Depreciation of fixed assets and investment properties |     -1.34166e+06 |\n| MSN          |   2020 |         0 | Profit before tax                                      |      2.32484e+06 |\n| MSN          |   2020 |         0 | Provisions                                             | 252266           |\n| MSN          |   2020 |         0 | Revenue from sales and services rendered               |      7.88683e+07 |\n| MSN          |   2021 |         0 | Deductions from revenue                                |      1.16285e+06 |\n| MSN          |   2021 |         0 | Depreciation of fixed assets and investment properties |      0           |\n| MSN          |   2021 |         0 | Profit before tax                                      |      1.14888e+07 |\n| MSN          |   2021 |         0 | Provisions                                             |  21659           |\n| MSN          |   2021 |         0 | Revenue from sales and services rendered               |      8.97916e+07 |\n| MSN          |   2022 |         0 | Deductions from revenue                                | 191525           |\n| MSN          |   2022 |         0 | Depreciation of fixed assets and investment properties |      4.40652e+06 |\n| MSN          |   2022 |         0 | Profit before tax                                      |      5.14715e+06 |\n| MSN          |   2022 |         0 | Provisions                                             | 232844           |\n| MSN          |   2022 |         0 | Revenue from sales and services rendered               |      7.63808e+07 |\n| MSN          |   2023 |         0 | Deductions from revenue                                | 265380           |\n| MSN          |   2023 |         0 | Depreciation of fixed assets and investment properties |      4.00656e+06 |\n| MSN          |   2023 |         0 | Profit before tax                                      |      2.56297e+06 |\n| MSN          |   2023 |         0 | Provisions                                             | 407345           |\n| MSN          |   2023 |         0 | Revenue from sales and services rendered               |      7.8517e+07  |\n| VNM          |   2020 |         0 | Deductions from revenue                                |  86622           |\n| VNM          |   2020 |         0 | Depreciation of fixed assets and investment properties |      2.81702e+06 |\n| VNM          |   2020 |         0 | Profit before tax                                      |      1.35185e+07 |\n| VNM          |   2020 |         0 | Provisions                                             |  49503           |\n| VNM          |   2020 |         0 | Revenue from sales and services rendered               |      5.97229e+07 |\n| VNM          |   2021 |         0 | Deductions from revenue                                |  92909           |\n| VNM          |   2021 |         0 | Depreciation of fixed assets and investment properties |      2.36688e+06 |\n| VNM          |   2021 |         0 | Profit before tax                                      |      1.29222e+07 |\n| VNM          |   2021 |         0 | Provisions                                             |  33465           |\n| VNM          |   2021 |         0 | Revenue from sales and services rendered               |      6.10121e+07 |\n| VNM          |   2022 |         0 | Deductions from revenue                                | 118483           |\n| VNM          |   2022 |         0 | Depreciation of fixed assets and investment properties |      2.34099e+06 |\n| VNM          |   2022 |         0 | Profit before tax                                      |      1.04955e+07 |\n| VNM          |   2022 |         0 | Provisions                                             |  -4572           |\n| VNM          |   2022 |         0 | Revenue from sales and services rendered               |      6.00747e+07 |\n| VNM          |   2023 |         0 | Deductions from revenue                                | 109997           |\n| VNM          |   2023 |         0 | Depreciation of fixed assets and investment properties |  ",
        "code_response": [
            {
                "language": "sql",
                "code": "WITH \n  -- Identify stock codes for the companies\n  company_codes AS (\n    SELECT stock_code\n    FROM company_info\n    WHERE stock_code IN ('VNM', 'MSN', 'HPG')\n  ),\n\n  -- Retrieve financial data for the specified period\n  financial_data AS (\n    SELECT \n      nbf.stock_code,\n      nbf.year,\n      nbf.quarter,\n      mccn.en_caption AS category_name,\n      nbf.data\n    FROM \n      non_bank_financial_report nbf\n    INNER JOIN \n      map_category_code_non_bank mccn ON nbf.category_code = mccn.category_code\n    INNER JOIN \n      company_codes cc ON nbf.stock_code = cc.stock_code\n    WHERE \n      nbf.year BETWEEN 2020 AND 2024\n      AND (nbf.quarter = 0 OR (nbf.year = 2024 AND nbf.quarter = 2))\n      AND nbf.category_code IN ('IS_001', 'IS_002', 'IS_003', 'CF_001', 'CF_002', 'CF_003')\n  )\n\n-- Select the financial data with assumed category codes\nSELECT \n  fd.stock_code,\n  fd.year,\n  fd.quarter,\n  fd.category_name,\n  fd.data\nFROM \n  financial_data fd\nORDER BY \n  fd.stock_code, fd.year, fd.quarter, fd.category_name\nLIMIT 100;\n"
            },
            {
                "language": "sql",
                "code": "WITH \n  --... (reuse the CTEs from Step 1)\n\n  -- Pivot the financial data to calculate FCFF\n  fcff_calculations AS (\n    SELECT \n      fd.stock_code,\n      fd.year,\n      fd.quarter,\n      SUM(CASE WHEN fd.category_name = 'Net Income' THEN fd.data ELSE 0 END) AS net_income,\n      SUM(CASE WHEN fd.category_name = 'Depreciation' THEN fd.data ELSE 0 END) AS depreciation,\n      SUM(CASE WHEN fd.category_name = 'Amortization' THEN fd.data ELSE 0 END) AS amortization,\n      SUM(CASE WHEN fd.category_name = 'Change in Working Capital' THEN -fd.data ELSE 0 END) AS change_in_wc,\n      SUM(CASE WHEN fd.category_name = 'Capital Expenditures' THEN -fd.data ELSE 0 END) AS capex,\n      SUM(CASE WHEN fd.category_name = 'Net Borrowing' THEN fd.data ELSE 0 END) AS net_borrowing\n    FROM \n      financial_data fd\n    GROUP BY \n      fd.stock_code, fd.year, fd.quarter\n  )\n\n-- Calculate FCFF using the indirect method\nSELECT \n  fc.stock_code,\n  fc.year,\n  fc.quarter,\n  COALESCE(fc.net_income, 0) + \n  COALESCE(fc.depreciation, 0) + \n  COALESCE(fc.amortization, 0) + \n  COALESCE(fc.change_in_wc, 0) + \n  COALESCE(fc.capex, 0) + \n  COALESCE(fc.net_borrowing, 0) AS fcff\nFROM \n  fcff_calculations fc\nORDER BY \n  fc.stock_code, fc.year, fc.quarter\nLIMIT 100;\n"
            },
            {
                "language": "sql",
                "code": "WITH \n  -- Identify stock codes for the companies\n  company_codes AS (\n    SELECT stock_code\n    FROM company_info\n    WHERE stock_code IN ('VNM', 'MSN', 'HPG')\n  ),\n\n  -- Retrieve financial data for the specified period\n  financial_data AS (\n    SELECT \n      nbf.stock_code,\n      nbf.year,\n      nbf.quarter,\n      mccn.en_caption AS category_name,\n      nbf.data\n    FROM \n      non_bank_financial_report nbf\n    INNER JOIN \n      map_category_code_non_bank mccn ON nbf.category_code = mccn.category_code\n    INNER JOIN \n      company_codes cc ON nbf.stock_code = cc.stock_code\n    WHERE \n      nbf.year BETWEEN 2020 AND 2024\n      AND (nbf.quarter = 0 OR (nbf.year = 2024 AND nbf.quarter = 2))\n      AND nbf.category_code IN ('IS_001', 'IS_002', 'IS_003', 'CF_001', 'CF_002', 'CF_003')\n  ),\n\n  -- Pivot the financial data to calculate FCFF\n  fcff_calculations AS (\n    SELECT \n      fd.stock_code,\n      fd.year,\n      fd.quarter,\n      SUM(CASE WHEN fd.category_name = 'Net Income' THEN fd.data ELSE 0 END) AS net_income,\n      SUM(CASE WHEN fd.category_name = 'Depreciation' THEN fd.data ELSE 0 END) AS depreciation,\n      SUM(CASE WHEN fd.category_name = 'Amortization' THEN fd.data ELSE 0 END) AS amortization,\n      SUM(CASE WHEN fd.category_name = 'Change in Working Capital' THEN -fd.data ELSE 0 END) AS change_in_wc,\n      SUM(CASE WHEN fd.category_name = 'Capital Expenditures' THEN -fd.data ELSE 0 END) AS capex,\n      SUM(CASE WHEN fd.category_name = 'Net Borrowing' THEN fd.data ELSE 0 END) AS net_borrowing\n    FROM \n      financial_data fd\n    GROUP BY \n      fd.stock_code, fd.year, fd.quarter\n  )\n\n-- Calculate FCFF using the indirect method\nSELECT \n  fc.stock_code,\n  fc.year,\n  fc.quarter,\n  COALESCE(fc.net_income, 0) + \n  COALESCE(fc.depreciation, 0) + \n  COALESCE(fc.amortization, 0) + \n  COALESCE(fc.change_in_wc, 0) + \n  COALESCE(fc.capex, 0) + \n  COALESCE(fc.net_borrowing, 0) AS fcff\nFROM \n  fcff_calculations fc\nORDER BY \n  fc.stock_code, fc.year, fc.quarter\nLIMIT 100;\n"
            }
        ],
        "time": 198.33314061164856,
        "evaluate": 0,
        "input_token": 12693,
        "output_token": 2498
    },
    {
        "id": "4ac358e0-c6f7-4645-8e8e-fb12eba2bcab",
        "question": "Calculate the return on equity (ROE) for Vinamilk and Masan Group for the fiscal year 2022, and also provide their total equity for the same year.",
        "answer": "Table 1\n| stock_code   |      roe |   total_equity |\n|:-------------|---------:|---------------:|\n| VNM          | 0.26138  |    3.28165e+07 |\n| MSN          | 0.129771 |    3.66367e+07 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "-- Query to get ROE for Vinamilk and Masan Group for the fiscal year 2022\nSELECT \n    fr.stock_code,\n    fr.data AS roe,\n    nbfr.data AS total_equity\nFROM \n    financial_ratio fr\nJOIN \n    non_bank_financial_report nbfr ON fr.stock_code = nbfr.stock_code AND fr.year = nbfr.year\nWHERE \n    fr.ratio_code = 'ROE'\n    AND fr.year = 2022\n    AND fr.quarter = 0\n    AND nbfr.category_code = 'BS_410'\n    AND nbfr.quarter = 0\n    AND fr.stock_code IN ('VNM', 'MSN');\n"
            }
        ],
        "score": 1,
        "difficulty": 3,
        "response": "Table 1\n| stock_code   | company_name   | total_equity   |\n|--------------|----------------|----------------|\n\nTable 2\n| stock_code   | company_name   | total_equity   | roe   |\n|--------------|----------------|----------------|-------|\n\nTable 3\n| stock_code   | company_name   | total_equity   | roe   |\n|--------------|----------------|----------------|-------|\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "WITH company_equity AS (\n  SELECT \n    ci.stock_code,\n    ci.company_name,\n    nbr.data AS total_equity\n  FROM \n    company_info ci\n  JOIN \n    non_bank_financial_report nbr ON ci.stock_code = nbr.stock_code\n  JOIN \n    map_category_code_non_bank mccnb ON nbr.category_code = mccnb.category_code\n  WHERE \n    ci.stock_code IN ('VNM', 'MSN')\n    AND nbr.year = 2022\n    AND nbr.quarter = 0\n    AND mccnb.en_caption = 'Total Equity'  -- Assuming this caption for Total Equity\n),\ncompany_roe AS (\n  SELECT \n    ci.stock_code,\n    ci.company_name,\n    fr.data AS roe\n  FROM \n    company_info ci\n  JOIN \n    financial_ratio fr ON ci.stock_code = fr.stock_code\n  JOIN \n    map_category_code_ratio mccr ON fr.ratio_code = mccr.ratio_code\n  WHERE \n    ci.stock_code IN ('VNM', 'MSN')\n    AND fr.year = 2022\n    AND fr.quarter = 0\n    AND mccr.ratio_name = 'Return On Equity'\n)\nSELECT \n  ce.stock_code,\n  ce.company_name,\n  ce.total_equity,\n  croe.roe\nFROM \n  company_equity ce\nINNER JOIN \n  company_roe croe ON ce.stock_code = croe.stock_code\nLIMIT 100;\n"
            }
        ],
        "time": 120.05571222305298,
        "evaluate": 0,
        "input_token": 0,
        "output_token": 0
    },
    {
        "id": "fea4088b-643e-4e03-9bed-1879ba8538f0",
        "question": "What was the Free Cash Flow to Firm (FCFF) for Vietcombank, Techcombank, and ACB in 2022?",
        "answer": "Table 1\n| stock_code   |   year |        fcff |\n|:-------------|-------:|------------:|\n| ACB          |   2022 | 2.17861e+07 |\n| TCB          |   2022 | 5.66533e+07 |\n| VCB          |   2022 | 1.87481e+08 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT stock_code, year, data AS FCFF\nFROM financial_ratio\nWHERE ratio_code = 'FCF'\n  AND stock_code IN ('VCB', 'TCB', 'ACB')\n  AND year = 2022\n  AND quarter = 0;\n"
            }
        ],
        "score": 1,
        "difficulty": 1,
        "response": "Table 1\n| stock_code   |   year |   quarter | category_code   |              data |\n|:-------------|-------:|----------:|:----------------|------------------:|\n| VCB          |   2022 |         0 | IS_001          |       8.81127e+07 |\n| VCB          |   2022 |         0 | IS_010          |       2.92834e+06 |\n| VCB          |   2022 |         0 | IS_011          |  874378           |\n| VCB          |   2022 |         0 | IS_012          |       2.05396e+06 |\n| VCB          |   2022 |         0 | IS_013          |  208436           |\n| VCB          |   2022 |         0 | IS_014          |       2.12505e+07 |\n| VCB          |   2022 |         0 | IS_015          |       4.68323e+07 |\n| VCB          |   2022 |         0 | IS_016          |       9.46422e+06 |\n| VCB          |   2022 |         0 | IS_017          |       3.73681e+07 |\n| VCB          |   2022 |         0 | IS_018          |       8.40686e+06 |\n| VCB          |   2022 |         0 | IS_019          | -957823           |\n| VCB          |   2022 |         0 | IS_002          |       3.48662e+07 |\n| VCB          |   2022 |         0 | IS_020          |       0           |\n| VCB          |   2022 |         0 | IS_021          |       2.99191e+07 |\n| VCB          |   2022 |         0 | IS_022          |   20040           |\n| VCB          |   2022 |         0 | IS_023          |    5821           |\n| VCB          |   2022 |         0 | IS_003          |       5.32465e+07 |\n| VCB          |   2022 |         0 | IS_004          |       1.2425e+07  |\n| VCB          |   2022 |         0 | IS_005          |       5.58591e+06 |\n| VCB          |   2022 |         0 | IS_006          |       6.8391e+06  |\n| VCB          |   2022 |         0 | IS_007          |       5.76844e+06 |\n| VCB          |   2022 |         0 | IS_008          | -115194           |\n| VCB          |   2022 |         0 | IS_009          |   81595           |\n| ACB          |   2022 |         0 | IS_001          |       4.06988e+07 |\n| ACB          |   2022 |         0 | IS_010          |       1.11049e+06 |\n| ACB          |   2022 |         0 | IS_011          |  120800           |\n| ACB          |   2022 |         0 | IS_012          |  989694           |\n| ACB          |   2022 |         0 | IS_013          |   59456           |\n| ACB          |   2022 |         0 | IS_014          |       1.1605e+07  |\n| ACB          |   2022 |         0 | IS_015          |       1.7185e+07  |\n| ACB          |   2022 |         0 | IS_016          |   70814           |\n| ACB          |   2022 |         0 | IS_017          |       1.71142e+07 |\n| ACB          |   2022 |         0 | IS_018          |       3.44561e+06 |\n| ACB          |   2022 |         0 | IS_019          |  -19596           |\n| ACB          |   2022 |         0 | IS_002          |       1.71653e+07 |\n| ACB          |   2022 |         0 | IS_020          |       0           |\n| ACB          |   2022 |         0 | IS_021          |       1.36882e+07 |\n| ACB          |   2022 |         0 | IS_022          |       0           |\n| ACB          |   2022 |         0 | IS_023          |    4008           |\n| ACB          |   2022 |         0 | IS_003          |       2.35335e+07 |\n| ACB          |   2022 |         0 | IS_004          |       5.05756e+06 |\n| ACB          |   2022 |         0 | IS_005          |       1.53132e+06 |\n| ACB          |   2022 |         0 | IS_006          |       3.52624e+06 |\n| ACB          |   2022 |         0 | IS_007          |       1.04837e+06 |\n| ACB          |   2022 |         0 | IS_008          | -387873           |\n| ACB          |   2022 |         0 | IS_009          |   20648           |\n| TCB          |   2022 |         0 | IS_001          |       4.47526e+07 |\n| TCB          |   2022 |         0 | IS_010          |       4.49995e+06 |\n| TCB          |   2022 |         0 | IS_011          |       2.33257e+06 |\n| TCB          |   2022 |         0 | IS_012          |       2.16738e+06 |\n| TCB          |   2022 |         0 | IS_013          |    8791           |\n| TCB          |   2022 |         0 | IS_014          |       1.3398e+07  |\n| TCB          |   2022 |         0 | IS_015          |       2.75041e+07 |\n| TCB          |   2022 |         0 | IS_016          |       1.93629e+06 |\n| TCB          |   2022 |         0 | IS_017          |       2.55678e+07 |\n| TCB          |   2022 |         0 | IS_018          |       5.17493e+06 |\n| TCB          |   2022 |         0 | IS_019          |  -43590           |\n| TCB          |   2022 |         0 | IS_002          |       1.44629e+07 |\n| TCB          |   2022 |         0 | IS_020          |       0           |\n| TCB          |   2022 |         0 | IS_021          |       2.04364e+07 |\n| TCB          |   2022 |         0 | IS_022          |  286049           |\n| TCB          |   2022 |         0 | IS_023          |    5725           |\n| TCB          |   2022 |         0 | IS_003          |       3.02898e+07 |\n| TCB          |   2022 |         0 | IS_004          |       1.08403e+07 |\n| TCB          |   2022 |         0 | IS_005          |       2.31284e+06 |\n| TCB          |   2022 |         0 | IS_006          |       8.52749e+06 |\n| TCB          |   2022 |         0 | IS_007          | -275063           |\n| TCB          |   2022 |         0 | IS_008          | -241845           |\n| TCB          |   2022 |         0 | IS_009          |  425553           |\n| VCB          |   2022 |         0 | BS_110          |       1.83485e+07 |\n| VCB          |   2022 |         0 | BS_120          |       9.25578e+07 |\n| VCB          |   2022 |         0 | BS_130          |       3.13637e+08 |\n| VCB          |   2022 |         0 | BS_131          |       2.83728e+08 |\n| VCB          |   2022 |         0 | BS_132          |       4.07497e+07 |\n| VCB          |   2022 |         0 | BS_139          |      -1.084e+07   |\n| VCB          |   2022 |         0 | BS_140          |       1.49969e+06 |\n| VCB          |   2022 |         0 | BS_141          |       1.54358e+06 |\n| VCB          |   2022 |         0 | BS_149          |  -43888           |\n| VCB          |   2022 |         0 | BS_150          |  156515           |\n| VCB          |   2022 |         0 | BS_160          |       1.12029e+09 |\n| VCB          |   2022 |         0 | BS_161          |       1.14507e+09 |\n| VCB          |   2022 |         0 | BS_169          |      -2.47794e+07 |\n| VCB          |   2022 |         0 | BS_170          |       1.96171e+08 |\n| VCB          |   2022 |         0 | BS_171          |       1.0074e+08  |\n| VCB          |   2022 |         0 | BS_172          |       9.55134e+07 |\n| VCB          |   2022 |         0 | BS_179          |  -81833           |\n| VCB          |   2022 |         0 | BS_180          |       0           |\n| VCB          |   2022 |         0 | BS_181          |       0           |\n| VCB          |   2022 |         0 | BS_189          |       0           |\n| VCB          |   2022 |         0 | BS_210          |       2.19354e+06 |\n| VCB          |   2022 |         0 | BS_211          |       0           |\n| VCB          |   2022 |         0 | BS_212          |  771075           |\n| VCB          |   2022 |         0 | BS_213          |   11314           |\n| VCB          |   2022 |         0 | BS_214          |       1.52914e+06 |\n| VCB          |   2022 |         0 | BS_219          | -117999           |\n| VCB          |   2022 |         0 | BS_220          |       7.9854e+06  |\n| VCB          |   2022 |         0 | BS_221          |       5.17008e+06 |\n| VCB          |   2022 |         0 | BS_222          |       1.39502e+07 |\n| VCB          |   2022 |         0 | BS_223          |      -8.78009e+06 |\n| VCB          |   2022 |         0 | BS_224          |       0           |\n\nTable 2\n| stock_code   | fcff   |\n|--------------|--------|\n\nTable 3\n| stock_code   |         fcff |\n|:-------------|-------------:|\n| ACB          | -2.12745e+07 |\n| TCB          | -5.54685e+07 |\n| VCB          | -1.83421e+08 |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT \n  stock_code,\n  year,\n  quarter,\n  category_code,\n  data\nFROM \n  bank_financial_report\nWHERE \n  stock_code IN ('VCB', 'TCB', 'ACB')\n  AND year = 2022\n  AND quarter = 0\nLIMIT 100;\n"
            },
            {
                "language": "sql",
                "code": "WITH \n  -- Operating Cash Flow (CF_009)\n  ocf AS (\n    SELECT \n      stock_code,\n      data AS ocf_data\n    FROM \n      bank_financial_report\n    WHERE \n      stock_code IN ('VCB', 'TCB', 'ACB')\n      AND year = 2022\n      AND quarter = 0\n      AND category_code = 'CF_009'\n  ),\n  \n  -- Capital Expenditures (CF_024, assuming this includes CapEx)\n  capex AS (\n    SELECT \n      stock_code,\n      data AS capex_data\n    FROM \n      bank_financial_report\n    WHERE \n      stock_code IN ('VCB', 'TCB', 'ACB')\n      AND year = 2022\n      AND quarter = 0\n      AND category_code = 'CF_024'\n  )\n\n-- Calculate FCFF\nSELECT \n  ocf.stock_code,\n  ocf.ocf_data - capex.capex_data AS fcff\nFROM \n  ocf\n  INNER JOIN capex ON ocf.stock_code = capex.stock_code\nLIMIT 100;\n"
            },
            {
                "language": "sql",
                "code": "WITH \n  -- Financial data for specified banks in 2022 (quarter = 0)\n  bank_data AS (\n    SELECT \n      stock_code,\n      category_code,\n      data\n    FROM \n      bank_financial_report\n    WHERE \n      stock_code IN ('VCB', 'TCB', 'ACB')\n      AND year = 2022\n      AND quarter = 0\n  ),\n  \n  -- Operating Cash Flow (CF_009) and Capital Expenditures (CF_024)\n  ocf_capex AS (\n    SELECT \n      stock_code,\n      SUM(CASE WHEN category_code = 'CF_009' THEN data ELSE 0 END) AS ocf_data,\n      SUM(CASE WHEN category_code = 'CF_024' THEN data ELSE 0 END) AS capex_data\n    FROM \n      bank_data\n    GROUP BY \n      stock_code\n  )\n\n-- Calculate FCFF\nSELECT \n  stock_code,\n  ocf_data - capex_data AS fcff\nFROM \n  ocf_capex\nLIMIT 100;\n"
            }
        ],
        "time": 55.78781867027283,
        "evaluate": 0,
        "input_token": 4537,
        "output_token": 2253
    },
    {
        "id": "65582c45-ca21-4b65-b92a-990a565809d4",
        "question": "Rank the top 10 companies by their total cash and cash equivalents at the end of Q2 2024.",
        "answer": "Table 1\n| stock_code   | industry           | is_bank   | is_securities   |   cash_and_cash_equivalents |\n|:-------------|:-------------------|:----------|:----------------|----------------------------:|\n| BID          | Banking            | True      | False           |                 2.78228e+08 |\n| TCB          | Banking            | True      | False           |                 1.24892e+08 |\n| VPB          | Banking            | True      | False           |                 1.02267e+08 |\n| SHB          | Banking            | True      | False           |                 8.93781e+07 |\n| ABB          | Banking            | True      | False           |                 4.01649e+07 |\n| VIC          | Real Estate        | False     | False           |                 2.85439e+07 |\n| VHM          | Real Estate        | False     | False           |                 1.71802e+07 |\n| PLX          | Oil and Gas        | False     | False           |                 1.55622e+07 |\n| HPG          | Basic Resources    | False     | False           |                 1.3032e+07  |\n| VGI          | Telecommunications | False     | False           |                 1.11629e+07 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT ci.stock_code, ci.industry, ci.is_bank, ci.is_securities, fr.data AS cash_and_cash_equivalents\nFROM (\n    SELECT stock_code, data\n    FROM bank_financial_report\n    WHERE year = 2024 AND quarter = 2 AND category_code = 'CF_045'\n    \n    UNION ALL\n    \n    SELECT stock_code, data\n    FROM non_bank_financial_report\n    WHERE year = 2024 AND quarter = 2 AND category_code = 'CF_070'\n    \n    UNION ALL\n    \n    SELECT stock_code, data\n    FROM securities_financial_report\n    WHERE year = 2024 AND quarter = 2 AND category_code = 'CF_103'\n) AS fr\nJOIN company_info ci ON fr.stock_code = ci.stock_code\nORDER BY fr.data DESC\nLIMIT 10;\n"
            }
        ],
        "score": 1,
        "difficulty": 3,
        "response": "Table 1\n| report_type   | stock_code   | company_name                                               |   total_cash_equivalents |\n|:--------------|:-------------|:-----------------------------------------------------------|-------------------------:|\n| bank          | VPB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Vi\u1ec7t Nam Th\u1ecbnh V\u01b0\u1ee3ng          |              1.02267e+08 |\n| bank          | TCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam            |              1.24892e+08 |\n| bank          | SHB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n S\u00e0i G\u00f2n \u2013 H\u00e0 N\u1ed9i              |              8.93781e+07 |\n| bank          | ABB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh                       |              4.01649e+07 |\n| bank          | BID          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 v\u00e0 Ph\u00e1t tri\u1ec3n Vi\u1ec7t Nam |              2.78228e+08 |\n| bank          | NVB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Qu\u1ed1c D\u00e2n                      |              1.03338e+07 |\n| non_bank      | MWG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 Th\u1ebf Gi\u1edbi Di \u0110\u1ed9ng                    |              5.77646e+06 |\n| non_bank      | VRE          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Vincom Retail                              |              1.00322e+06 |\n| non_bank      | PLX          | T\u1eadp \u0111o\u00e0n X\u0103ng d\u1ea7u Vi\u1ec7t Nam                                 |              1.55622e+07 |\n| non_bank      | SAB          | T\u1ed5ng C\u00f4ng ty C\u1ed5 ph\u1ea7n Bia - R\u01b0\u1ee3u - N\u01b0\u1edbc Gi\u1ea3i kh\u00e1t S\u00e0i G\u00f2n   |              6.0341e+06  |\n| non_bank      | POW          | T\u1ed5ng C\u00f4ng ty \u0110i\u1ec7n l\u1ef1c D\u1ea7u kh\u00ed Vi\u1ec7t Nam - CTCP              |              1.00376e+07 |\n| non_bank      | BCM          | T\u1ed5ng C\u00f4ng ty \u0110\u1ea7u t\u01b0 v\u00e0 Ph\u00e1t tri\u1ec3n C\u00f4ng nghi\u1ec7p - CTCP       |              2.09993e+06 |\n| non_bank      | CEO          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n C.E.O                             |              1.03082e+06 |\n| non_bank      | VTP          | T\u1ed5ng C\u00f4ng ty C\u1ed5 ph\u1ea7n B\u01b0u ch\u00ednh Viettel                     |         832518           |\n| non_bank      | PVT          | T\u1ed5ng C\u00f4ng ty C\u1ed5 ph\u1ea7n V\u1eadn t\u1ea3i D\u1ea7u kh\u00ed                       |              1.12023e+06 |\n| non_bank      | CMG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n C\u00f4ng ngh\u1ec7 CMC                     |         474869           |\n| non_bank      | VGI          | T\u1ed5ng C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 Qu\u1ed1c t\u1ebf Viettel                |              1.11629e+07 |\n| non_bank      | DTD          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 Ph\u00e1t tri\u1ec3n Th\u00e0nh \u0110\u1ea1t                |          78005           |\n| non_bank      | PLC          | T\u1ed5ng C\u00f4ng ty H\u00f3a d\u1ea7u Petrolimex - C\u00f4ng ty C\u1ed5 ph\u1ea7n          |         352915           |\n| non_bank      | PVS          | T\u1ed5ng C\u00f4ng ty C\u1ed5 ph\u1ea7n D\u1ecbch v\u1ee5 K\u1ef9 thu\u1eadt D\u1ea7u kh\u00ed Vi\u1ec7t Nam     |              6.94674e+06 |\n| non_bank      | SLS          | C\u00f4ng ty C\u1ed5 ph\u1ea7n M\u00eda \u0111\u01b0\u1eddng S\u01a1n La                           |         168943           |\n| non_bank      | VCS          | C\u00f4ng ty C\u1ed5 ph\u1ea7n VICOSTONE                                  |              1.56621e+06 |\n| non_bank      | CAP          | C\u00f4ng ty C\u1ed5 ph\u1ea7n L\u00e2m N\u00f4ng s\u1ea3n Th\u1ef1c ph\u1ea9m Y\u00ean B\u00e1i             |          23505           |\n| non_bank      | HPG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n H\u00f2a Ph\u00e1t                          |              1.3032e+07  |\n| non_bank      | VHM          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Vinhomes                                   |              1.71802e+07 |\n| non_bank      | PNJ          | C\u00f4ng ty C\u1ed5 ph\u1ea7n V\u00e0ng b\u1ea1c \u0110\u00e1 qu\u00fd Ph\u00fa Nhu\u1eadn                  |              1.54406e+06 |\n| non_bank      | VIC          | T\u1eadp \u0111o\u00e0n Vingroup - C\u00f4ng ty CP                             |              2.85439e+07 |\n| non_bank      | VPI          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 V\u0103n Ph\u00fa - Invest                    |         300305           |\n| non_bank      | HDC          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Ph\u00e1t tri\u1ec3n Nh\u00e0 B\u00e0 R\u1ecba V\u0169ng T\u00e0u             |         314959           |\n| non_bank      | HUT          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Tasco                                      |              1.80855e+06 |\n| non_bank      | DBC          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Dabaco Vi\u1ec7t Nam                   |         524315           |\n| non_bank      | PVC          | T\u1ed5ng C\u00f4ng ty H\u00f3a ch\u1ea5t v\u00e0 D\u1ecbch v\u1ee5 D\u1ea7u kh\u00ed - C\u00f4ng ty C\u1ed5 ph\u1ea7n |         326833           |\n| non_bank      | L18          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 v\u00e0 X\u00e2y d\u1ef1ng s\u1ed1 18                   |         159792           |\n| non_bank      | LHC          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 v\u00e0 X\u00e2y d\u1ef1ng Th\u1ee7y l\u1ee3i L\u00e2m \u0110\u1ed3ng       |         116912           |\n| non_bank      | TIG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n \u0110\u1ea7u t\u01b0 Th\u0103ng Long                 |         312676           |\n| non_bank      | TMB          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Kinh doanh Than Mi\u1ec1n B\u1eafc - Vinacomin       |          32728           |\n| non_bank      | TNG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 v\u00e0 Th\u01b0\u01a1ng m\u1ea1i TNG                   |         238066           |\n| non_bank      | GVR          | T\u1eadp \u0111o\u00e0n C\u00f4ng nghi\u1ec7p Cao su Vi\u1ec7t Nam - C\u00f4ng ty C\u1ed5 ph\u1ea7n     |              4.14571e+06 |\n| securities    | MBS          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Ch\u1ee9ng kho\u00e1n MB                             |         721758           |\n| securities    | VND          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Ch\u1ee9ng kho\u00e1n VNDIRECT                       |              3.10721e+06 |\n| securities    | SSI          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Ch\u1ee9ng kho\u00e1n SSI                            |              2.13157e+06 |\n| securities    | VIX          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Ch\u1ee9ng kho\u00e1n VIX                            |         571174           |\n| securities    | ORS          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Ch\u1ee9ng kho\u00e1n Ti\u00ean Phong                     |              2.24235e+06 |\n\nTable 2\n| company_name                                               |   total_cash_equivalents | report_type   |\n|:-----------------------------------------------------------|-------------------------:|:--------------|\n| Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 v\u00e0 Ph\u00e1t tri\u1ec3n Vi\u1ec7t Nam |              2.78228e+08 | bank          |\n| Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam            |              1.24892e+08 | bank          |\n| Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Vi\u1ec7t Nam Th\u1ecbnh V\u01b0\u1ee3ng          |              1.02267e+08 | bank          |\n| Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n S\u00e0i G\u00f2n \u2013 H\u00e0 N\u1ed9i              |              8.93781e+07 | bank          |\n| Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh                       |              4.01649e+07 | bank          |\n| T\u1eadp \u0111o\u00e0n Vingroup - C\u00f4ng ty CP                             |              2.85439e+07 | non_bank      |\n| C\u00f4ng ty C\u1ed5 ph\u1ea7n Vinhomes                                   |              1.71802e+07 | non_bank      |\n| T\u1eadp \u0111o\u00e0n X\u0103ng d\u1ea7u Vi\u1ec7t Nam                                 |              1.55622e+07 | non_bank      |\n| C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n H\u00f2a Ph\u00e1t                          |              1.3032e+07  | non_bank      |\n| T\u1ed5ng C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 Qu\u1ed1c t\u1ebf Viettel                |              1.11629e+07 | non_bank      |\n\nTable 3\n| company_name                                               |   total_cash_equivalents | report_type   |\n|:-----------------------------------------------------------|-------------------------:|:--------------|\n| Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 v\u00e0 Ph\u00e1t tri\u1ec3n Vi\u1ec7t Nam |              2.78228e+08 | bank          |\n| Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam            |              1.24892e+08 | bank          |\n| Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Vi\u1ec7t Nam Th\u1ecbnh V\u01b0\u1ee3ng          |              1.02267e+08 | bank          |\n| Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n S\u00e0i G\u00f2n \u2013 H\u00e0 N\u1ed9i              |              8.93781e+07 | bank          |\n| Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n An B\u00ecnh                       |              4.01649e+07 | bank          |\n| T\u1eadp \u0111o\u00e0n Vingroup - C\u00f4ng ty CP                             |              2.85439e+07 | non_bank      |\n| C\u00f4ng ty C\u1ed5 ph\u1ea7n Vinhomes                                   |              1.71802e+07 | non_bank      |\n| T\u1eadp \u0111o\u00e0n X\u0103ng d\u1ea7u Vi\u1ec7t Nam                                 |              1.55622e+07 | non_bank      |\n| C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n H\u00f2a Ph\u00e1t                          |              1.3032e+07  | non_bank      |\n| T\u1ed5ng C\u00f4ng ty C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 Qu\u1ed1c t\u1ebf Viettel                |              1.11629e+07 | n",
        "code_response": [
            {
                "language": "sql",
                "code": "WITH consolidated_data AS (\n  SELECT \n    'bank' AS report_type,\n    bfr.stock_code,\n    ci.company_name,\n    bfr.data AS total_cash_equivalents\n  FROM \n    bank_financial_report bfr\n    INNER JOIN company_info ci ON bfr.stock_code = ci.stock_code\n  WHERE \n    bfr.quarter = 2 AND bfr.year = 2024 AND bfr.category_code = 'CF_045'\n\n  UNION ALL\n\n  SELECT \n    'non_bank' AS report_type,\n    nbfr.stock_code,\n    ci.company_name,\n    nbfr.data AS total_cash_equivalents\n  FROM \n    non_bank_financial_report nbfr\n    INNER JOIN company_info ci ON nbfr.stock_code = ci.stock_code\n  WHERE \n    nbfr.quarter = 2 AND nbfr.year = 2024 AND nbfr.category_code = 'BS_110'\n\n  UNION ALL\n\n  SELECT \n    'securities' AS report_type,\n    sfr.stock_code,\n    ci.company_name,\n    sfr.data AS total_cash_equivalents\n  FROM \n    securities_financial_report sfr\n    INNER JOIN company_info ci ON sfr.stock_code = ci.stock_code\n  WHERE \n    sfr.quarter = 2 AND sfr.year = 2024 AND sfr.category_code = 'CF_103'\n)\n\nSELECT \n  company_name,\n  total_cash_equivalents,\n  report_type\nFROM (\n  SELECT \n    company_name,\n    total_cash_equivalents,\n    report_type,\n    DENSE_RANK() OVER (ORDER BY total_cash_equivalents DESC) AS rank\n  FROM \n    consolidated_data\n) ranked_data\nWHERE \n  rank <= 10\nORDER BY \n  total_cash_equivalents DESC\nLIMIT 10;\n"
            }
        ],
        "time": 87.50126123428345,
        "evaluate": 1,
        "input_token": 4819,
        "output_token": 684
    },
    {
        "id": "b402ce7e-32ae-4413-bf24-57e2a907327e",
        "question": "Rank the top 5 companies with the highest Return on Equity (ROE) for Q2 2024.",
        "answer": "Table 1\n| stock_code   | industry                      |       roe |\n|:-------------|:------------------------------|----------:|\n| TMB          | Basic Resources               | 0.0752439 |\n| VTP          | Industrial Goods and Services | 0.0581527 |\n| SLS          | Food and Beverages            | 0.0572923 |\n| SAB          | Food and Beverages            | 0.0524845 |\n| VHM          | Real Estate                   | 0.0513036 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT fr.stock_code, ci.industry, fr.data AS roe\nFROM financial_ratio fr\nJOIN map_category_code_ratio mccr ON fr.ratio_code = mccr.ratio_code\nJOIN company_info ci ON fr.stock_code = ci.stock_code\nWHERE mccr.ratio_name = 'Return On Equity'\n  AND fr.year = 2024\n  AND fr.quarter = 2\nORDER BY fr.data DESC\nLIMIT 5;\n"
            }
        ],
        "score": 1,
        "difficulty": 2,
        "response": "Table 1\n| stock_code   |   roe_value |\n|:-------------|------------:|\n| BCM          | 0.0198788   |\n| CAP          | 0.0397788   |\n| CEO          | 0.00226653  |\n| CMG          | 0.0282697   |\n| DBC          | 0.0297701   |\n| DTD          | 0.016301    |\n| GVR          | 0.0178876   |\n| HDC          | 0.0223757   |\n| HPG          | 0.0305454   |\n| HUT          | 0.00522736  |\n| L18          | 0.0246036   |\n| LHC          | 0.0368007   |\n| MWG          | 0.0442797   |\n| PLC          | 0.000401325 |\n| PLX          | 0.0448033   |\n| PNJ          | 0.0400225   |\n| POW          | 0.0131912   |\n| PVC          | 0.00456312  |\n| PVS          | 0.0149501   |\n| PVT          | 0.0394265   |\n| SAB          | 0.0524845   |\n| SLS          | 0.0572923   |\n| TIG          | 0.0262947   |\n| TMB          | 0.0752439   |\n| TNG          | 0.0478626   |\n| VCS          | 0.0494299   |\n| VGI          | 0.0362167   |\n| VHM          | 0.0513036   |\n| VIC          | 0.00421307  |\n| VPI          | 0.00665701  |\n| VRE          | 0.0255812   |\n| VTP          | 0.0581527   |\n| ABB          | 0.0231456   |\n| BID          | 0.0485079   |\n| NVB          | 0.0093981   |\n| SHB          | 0.0407679   |\n| TCB          | 0.0457096   |\n| VPB          | 0.026311    |\n\nTable 2\n| stock_code   |   roe_value |\n|:-------------|------------:|\n| TMB          |   0.0752439 |\n| VTP          |   0.0581527 |\n| SLS          |   0.0572923 |\n| SAB          |   0.0524845 |\n| VHM          |   0.0513036 |\n\nTable 3\n| stock_code   |   roe_value |\n|:-------------|------------:|\n| TMB          |   0.0752439 |\n| VTP          |   0.0581527 |\n| SLS          |   0.0572923 |\n| SAB          |   0.0524845 |\n| VHM          |   0.0513036 |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT \n  fr.stock_code, \n  fr.data AS ROE_value\nFROM \n  financial_ratio fr\n  INNER JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\nWHERE \n  fr.quarter = 2 \n  AND fr.year = 2024 \n  AND mcr.ratio_name = 'Return On Equity'\n"
            },
            {
                "language": "sql",
                "code": "SELECT \n  stock_code, \n  ROE_value\nFROM (\n  SELECT \n    fr.stock_code, \n    fr.data AS ROE_value,\n    ROW_NUMBER() OVER (ORDER BY fr.data DESC) AS rank\n  FROM \n    financial_ratio fr\n    INNER JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\n  WHERE \n    fr.quarter = 2 \n    AND fr.year = 2024 \n    AND mcr.ratio_name = 'Return On Equity'\n) subquery\nWHERE \n  rank <= 5\nLIMIT 5;\n"
            },
            {
                "language": "sql",
                "code": "SELECT \n  stock_code, \n  ROE_value\nFROM (\n  SELECT \n    fr.stock_code, \n    fr.data AS ROE_value,\n    ROW_NUMBER() OVER (ORDER BY fr.data DESC) AS rank\n  FROM \n    financial_ratio fr\n    INNER JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\n  WHERE \n    fr.quarter = 2 \n    AND fr.year = 2024 \n    AND mcr.ratio_name = 'Return On Equity'\n) subquery\nWHERE \n  rank <= 5\nLIMIT 5;\n"
            }
        ],
        "time": 32.77591347694397,
        "evaluate": 1,
        "input_token": 7194,
        "output_token": 2142
    },
    {
        "id": "aec88c44-7b88-47ca-a04a-e599e1ddaeda",
        "question": "Rank the top 5 companies with the highest Return on Equity (ROE) from 2020 to Q2 2024, calculated annually.",
        "answer": "Table 1\n| stock_code   | industry                   |   year |        roe |\n|:-------------|:---------------------------|-------:|-----------:|\n| VC3          | Real Estate                |   2022 | nan        |\n| DGC          | Chemicals                  |   2022 |   0.557243 |\n| CAP          | Basic Resources            |   2022 |   0.546075 |\n| L14          | Construction and Materials |   2021 |   0.493854 |\n| CAP          | Basic Resources            |   2021 |   0.479184 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    fr.stock_code, \n    ci.industry, \n    fr.year, \n    fr.data AS roe\nFROM \n    financial_ratio fr\nJOIN \n    map_category_code_ratio mccr ON fr.ratio_code = mccr.ratio_code\nJOIN \n    company_info ci ON fr.stock_code = ci.stock_code\nWHERE \n    mccr.ratio_name = 'Return On Equity'\n    AND fr.year BETWEEN 2020 AND 2024\n    AND fr.quarter = 0\nORDER BY \n    fr.data DESC\nLIMIT 5;\n"
            }
        ],
        "score": 1,
        "difficulty": 2,
        "response": "Table 1\n| stock_code   | company_name                                             |   year |   quarter |   roe_value |\n|:-------------|:---------------------------------------------------------|-------:|----------:|------------:|\n| VCS          | C\u00f4ng ty C\u1ed5 ph\u1ea7n VICOSTONE                                |   2020 |         0 |   0.370266  |\n| VNM          | C\u00f4ng ty C\u1ed5 ph\u1ea7n S\u1eefa Vi\u1ec7t Nam                             |   2020 |         0 |   0.333928  |\n| DBC          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Dabaco Vi\u1ec7t Nam                 |   2020 |         0 |   0.332852  |\n| VHM          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Vinhomes                                 |   2020 |         0 |   0.316465  |\n| SAF          | C\u00f4ng ty C\u1ed5 ph\u1ea7n L\u01b0\u01a1ng th\u1ef1c Th\u1ef1c ph\u1ea9m SAFOCO              |   2020 |         0 |   0.305784  |\n| L14          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Licogi 14                                |   2021 |         0 |   0.493854  |\n| CAP          | C\u00f4ng ty C\u1ed5 ph\u1ea7n L\u00e2m N\u00f4ng s\u1ea3n Th\u1ef1c ph\u1ea9m Y\u00ean B\u00e1i           |   2021 |         0 |   0.479184  |\n| DGC          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n H\u00f3a ch\u1ea5t \u0110\u1ee9c Giang              |   2021 |         0 |   0.396995  |\n| NKG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Th\u00e9p Nam Kim                             |   2021 |         0 |   0.388814  |\n| HPG          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n H\u00f2a Ph\u00e1t                        |   2021 |         0 |   0.380268  |\n| VC3          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n Nam M\u00ea K\u00f4ng                     |   2022 |         0 | nan         |\n| DGC          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n H\u00f3a ch\u1ea5t \u0110\u1ee9c Giang              |   2022 |         0 |   0.557243  |\n| CAP          | C\u00f4ng ty C\u1ed5 ph\u1ea7n L\u00e2m N\u00f4ng s\u1ea3n Th\u1ef1c ph\u1ea9m Y\u00ean B\u00e1i           |   2022 |         0 |   0.546075  |\n| TMB          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Kinh doanh Than Mi\u1ec1n B\u1eafc - Vinacomin     |   2022 |         0 |   0.432194  |\n| DCM          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Ph\u00e2n b\u00f3n D\u1ea7u Kh\u00ed C\u00e0 Mau                  |   2022 |         0 |   0.40744   |\n| TMB          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Kinh doanh Than Mi\u1ec1n B\u1eafc - Vinacomin     |   2023 |         0 |   0.476625  |\n| SLS          | C\u00f4ng ty C\u1ed5 ph\u1ea7n M\u00eda \u0111\u01b0\u1eddng S\u01a1n La                         |   2023 |         0 |   0.443074  |\n| CAP          | C\u00f4ng ty C\u1ed5 ph\u1ea7n L\u00e2m N\u00f4ng s\u1ea3n Th\u1ef1c ph\u1ea9m Y\u00ean B\u00e1i           |   2023 |         0 |   0.43171   |\n| SAF          | C\u00f4ng ty C\u1ed5 ph\u1ea7n L\u01b0\u01a1ng th\u1ef1c Th\u1ef1c ph\u1ea9m SAFOCO              |   2023 |         0 |   0.2894    |\n| DGC          | C\u00f4ng ty C\u1ed5 ph\u1ea7n T\u1eadp \u0111o\u00e0n H\u00f3a ch\u1ea5t \u0110\u1ee9c Giang              |   2023 |         0 |   0.269533  |\n| TMB          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Kinh doanh Than Mi\u1ec1n B\u1eafc - Vinacomin     |   2024 |         2 |   0.0752439 |\n| VTP          | T\u1ed5ng C\u00f4ng ty C\u1ed5 ph\u1ea7n B\u01b0u ch\u00ednh Viettel                   |   2024 |         2 |   0.0581527 |\n| SLS          | C\u00f4ng ty C\u1ed5 ph\u1ea7n M\u00eda \u0111\u01b0\u1eddng S\u01a1n La                         |   2024 |         2 |   0.0572923 |\n| SAB          | T\u1ed5ng C\u00f4ng ty C\u1ed5 ph\u1ea7n Bia - R\u01b0\u1ee3u - N\u01b0\u1edbc Gi\u1ea3i kh\u00e1t S\u00e0i G\u00f2n |   2024 |         2 |   0.0524845 |\n| VHM          | C\u00f4ng ty C\u1ed5 ph\u1ea7n Vinhomes                                 |   2024 |         2 |   0.0513036 |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "WITH ranked_companies AS (\n  SELECT \n    fr.stock_code,\n    ci.company_name,\n    fr.year,\n    fr.quarter,\n    fr.data AS roe_value,\n    DENSE_RANK() OVER (PARTITION BY fr.year, fr.quarter ORDER BY fr.data DESC) AS rank\n  FROM \n    financial_ratio fr\n  INNER JOIN \n    company_info ci ON fr.stock_code = ci.stock_code\n  INNER JOIN \n    map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\n  WHERE \n    mcr.ratio_name = 'Return On Equity'\n    AND ((fr.year BETWEEN 2020 AND 2023 AND fr.quarter = 0) OR (fr.year = 2024 AND fr.quarter = 2))\n)\nSELECT \n  stock_code,\n  company_name,\n  year,\n  quarter,\n  roe_value\nFROM \n  ranked_companies\nWHERE \n  rank <= 5\nORDER BY \n  year, quarter, rank\nLIMIT 100;  -- Added limit as per database access note\n"
            }
        ],
        "time": 33.098809003829956,
        "evaluate": 0,
        "input_token": 0,
        "output_token": 0
    },
    {
        "id": "bd8cbad4-191a-45e2-a174-5bbacabaa07b",
        "question": "What are the top 10 companies with the lowest Debt-to-Equity ratio as of Q4 2023?",
        "answer": "Table 1\n| stock_code   | industry                             | is_bank   | is_securities   |   debt_to_equity_ratio |\n|:-------------|:-------------------------------------|:----------|:----------------|-----------------------:|\n| CAP          | Basic Resources                      | False     | False           |               0.102041 |\n| SLS          | Food and Beverages                   | False     | False           |               0.136624 |\n| TCH          | Real Estate                          | False     | False           |               0.17618  |\n| VRE          | Real Estate                          | False     | False           |               0.259786 |\n| DGC          | Chemicals                            | False     | False           |               0.291074 |\n| VCS          | Construction and Materials           | False     | False           |               0.297329 |\n| SAB          | Food and Beverages                   | False     | False           |               0.336332 |\n| GAS          | Utilities (Electricity, Water & Gas) | False     | False           |               0.343894 |\n| YEG          | Media                                | False     | False           |               0.356841 |\n| GVR          | Chemicals                            | False     | False           |               0.428991 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    ci.stock_code,\n    ci.industry,\n    ci.is_bank,\n    ci.is_securities,\n    fr.data AS debt_to_equity_ratio\nFROM \n    financial_ratio fr\nJOIN \n    company_info ci ON fr.stock_code = ci.stock_code\nWHERE \n    fr.ratio_code = 'DTER'\n    AND fr.year = 2023\n    AND fr.quarter = 4\nORDER BY \n    fr.data ASC\nLIMIT 10;\n"
            }
        ],
        "score": 1,
        "difficulty": 2,
        "response": "Table 1\n| stock_code   | industry                             |\n|:-------------|:-------------------------------------|\n| MWG          | Retail                               |\n| NHA          | Construction and Materials           |\n| VNM          | Food and Beverages                   |\n| HPG          | Basic Resources                      |\n| VHM          | Real Estate                          |\n| PNJ          | Personal and Household Goods         |\n| YEG          | Media                                |\n| FPT          | Information Technology               |\n| MSN          | Food and Beverages                   |\n| GAS          | Utilities (Electricity, Water & Gas) |\n| VRE          | Real Estate                          |\n| VJC          | Travel and Leisure                   |\n| VIC          | Real Estate                          |\n| PLX          | Oil and Gas                          |\n| SAB          | Food and Beverages                   |\n| POW          | Utilities (Electricity, Water & Gas) |\n| GVR          | Chemicals                            |\n| BCM          | Real Estate                          |\n| VPI          | Real Estate                          |\n| DVM          | Healthcare                           |\n| KDH          | Real Estate                          |\n| HDC          | Real Estate                          |\n| TCH          | Real Estate                          |\n| CEO          | Real Estate                          |\n| HUT          | Automobiles and Parts                |\n| NVL          | Real Estate                          |\n| DBC          | Food and Beverages                   |\n| SAF          | Food and Beverages                   |\n| DHT          | Retail                               |\n| VTP          | Industrial Goods and Services        |\n| PVT          | Industrial Goods and Services        |\n| FRT          | Retail                               |\n| DGC          | Chemicals                            |\n| DCM          | Chemicals                            |\n| NKG          | Basic Resources                      |\n| CMG          | Information Technology               |\n| VGI          | Telecommunications                   |\n| PVC          | Oil and Gas                          |\n| CAP          | Basic Resources                      |\n| DTD          | Real Estate                          |\n| HLD          | Real Estate                          |\n| L14          | Construction and Materials           |\n| PVN          | nan                                  |\n| L18          | Construction and Materials           |\n| LAS          | Chemicals                            |\n| LHC          | Construction and Materials           |\n| NTP          | Construction and Materials           |\n| PLC          | Chemicals                            |\n| PSD          | Retail                               |\n| PVG          | Utilities (Electricity, Water & Gas) |\n| PVS          | Oil and Gas                          |\n| SLS          | Food and Beverages                   |\n| TIG          | Real Estate                          |\n| TMB          | Basic Resources                      |\n| TNG          | Personal and Household Goods         |\n| TVD          | Basic Resources                      |\n| VC3          | Real Estate                          |\n| VCS          | Construction and Materials           |\n| DXG          | Real Estate                          |\n| MBS          | Financial Services                   |\n| VND          | Financial Services                   |\n| SSI          | Financial Services                   |\n| VIX          | Financial Services                   |\n| ORS          | Financial Services                   |\n| SCIC         | nan                                  |\n| Viettel      | nan                                  |\n\nTable 2\n| stock_code   | industry                             |   debttoequityratio |\n|:-------------|:-------------------------------------|--------------------:|\n| CAP          | Basic Resources                      |            0.102041 |\n| SLS          | Food and Beverages                   |            0.136624 |\n| TCH          | Real Estate                          |            0.17618  |\n| VRE          | Real Estate                          |            0.259786 |\n| DGC          | Chemicals                            |            0.291074 |\n| VCS          | Construction and Materials           |            0.297329 |\n| SAB          | Food and Beverages                   |            0.336332 |\n| GAS          | Utilities (Electricity, Water & Gas) |            0.343894 |\n| YEG          | Media                                |            0.356841 |\n| GVR          | Chemicals                            |            0.428991 |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT stock_code, industry \nFROM company_info \nWHERE (is_bank = FALSE OR is_securities = TRUE); \n-- This query is not directly used in the final result, but it helps identify the companies of interest.\n"
            },
            {
                "language": "sql",
                "code": "SELECT \n  fr.stock_code, \n  ci.industry, \n  fr.data AS DebtToEquityRatio\nFROM \n  financial_ratio fr\n  INNER JOIN company_info ci ON fr.stock_code = ci.stock_code\n  INNER JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\nWHERE \n  mcr.ratio_name = 'Debt To Equity Ratio' \n  AND fr.year = 2023 \n  AND fr.quarter = 4  -- Q4 2023\n  AND (ci.is_bank = FALSE OR ci.is_securities = TRUE)  -- Focus on non-bank and securities companies\nORDER BY \n  fr.data ASC  -- Lowest Debt-to-Equity ratio first\nLIMIT 10;  -- Top 10 companies\n"
            }
        ],
        "time": 34.170451641082764,
        "evaluate": 0.5,
        "input_token": 2099,
        "output_token": 625
    },
    {
        "id": "6a06e8b7-04a8-4b93-b5a5-7c40198b6678",
        "question": "For the first half of 2024, what were the total assets and total liabilities of Vinamilk and Mobile World Investment?",
        "answer": "Table 1\n| stock_code   |   year |   quarter | en_caption     |   total_value |\n|:-------------|-------:|----------:|:---------------|--------------:|\n| MWG          |   2024 |         1 | C. LIABILITIES |   3.75094e+07 |\n| MWG          |   2024 |         1 | TOTAL ASSETS   |   6.35435e+07 |\n| MWG          |   2024 |         2 | C. LIABILITIES |   3.93931e+07 |\n| MWG          |   2024 |         2 | TOTAL ASSETS   |   6.58698e+07 |\n| VNM          |   2024 |         1 | C. LIABILITIES |   1.57863e+07 |\n| VNM          |   2024 |         1 | TOTAL ASSETS   |   5.16539e+07 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    nfr.stock_code,\n    nfr.year,\n    nfr.quarter,\n    mcc.en_caption,\n    SUM(nfr.data) AS total_value\nFROM \n    non_bank_financial_report nfr\nJOIN \n    map_category_code_non_bank mcc ON nfr.category_code = mcc.category_code\nWHERE \n    nfr.stock_code IN ('VNM', 'MWG')\n    AND nfr.year = 2024\n    AND nfr.quarter IN (1, 2)\n    AND mcc.category_code IN ('BS_270', 'BS_300')\nGROUP BY \n    nfr.stock_code, nfr.year, nfr.quarter, mcc.en_caption\nORDER BY \n    nfr.stock_code, nfr.year, nfr.quarter, mcc.en_caption;\n"
            }
        ],
        "score": 1,
        "difficulty": 3,
        "response": "Error in getting the answer",
        "code_response": "Error in getting the code",
        "evaluate": 0,
        "input_token": 2731,
        "output_token": 1000
    },
    {
        "id": "ac3dd378-1331-4ca0-babb-f307a8f5378a",
        "question": "Compare the Cash Conversion Cycle (CCC) of Vinamilk and Masan Group in 2023 Q2.  Calculate CCC using the average inventory, accounts receivable, and accounts payable.",
        "answer": "Table 1\n| stock_code   |   inventory |   receivables |    payables |     dio |      dso |      dpo |     ccc |\n|:-------------|------------:|--------------:|------------:|--------:|---------:|---------:|--------:|\n| VNM          | 6.31989e+06 |   4.5048e+06  | 3.48324e+06 | 17314.8 | 12341.9  |  9543.11 | 20113.6 |\n| VNM          | 6.34626e+06 |   4.5048e+06  | 3.48324e+06 | 17387   | 12341.9  |  9543.11 | 20185.8 |\n| MSN          | 1.39022e+07 |   2.38814e+06 | 6.60183e+06 | 38088.2 |  6542.85 | 18087.2  | 26543.8 |\n| MSN          | 1.42982e+07 |   2.38814e+06 | 6.60183e+06 | 39173.2 |  6542.85 | 18087.2  | 27628.8 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "WITH Inventory AS (\n    SELECT stock_code, data AS inventory\n    FROM non_bank_financial_report\n    WHERE year = 2023 AND quarter = 2 AND category_code IN ('BS_140', 'BS_141')\n      AND stock_code IN ('VNM', 'MSN')\n),\nReceivables AS (\n    SELECT stock_code, data AS receivables\n    FROM non_bank_financial_report\n    WHERE year = 2023 AND quarter = 2 AND category_code = 'BS_131'\n      AND stock_code IN ('VNM', 'MSN')\n),\nPayables AS (\n    SELECT stock_code, data AS payables\n    FROM non_bank_financial_report\n    WHERE year = 2023 AND quarter = 2 AND category_code = 'BS_311'\n      AND stock_code IN ('VNM', 'MSN')\n)\nSELECT \n    i.stock_code,\n    i.inventory,\n    r.receivables,\n    p.payables,\n    -- Assuming some constants for days in period and cost of goods sold for calculation\n    (i.inventory / 365) AS DIO, \n    (r.receivables / 365) AS DSO,\n    (p.payables / 365) AS DPO,\n    ((i.inventory / 365) + (r.receivables / 365) - (p.payables / 365)) AS CCC\nFROM Inventory i\nJOIN Receivables r ON i.stock_code = r.stock_code\nJOIN Payables p ON i.stock_code = p.stock_code;\n"
            }
        ],
        "score": 1,
        "difficulty": 3,
        "response": "Table 1\n| stock_code   |   avg_inventory |   accounts_receivable |   accounts_payable |\n|:-------------|----------------:|----------------------:|-------------------:|\n| VNM          |               0 |                     0 |                  0 |\n| MSN          |               0 |                     0 |                  0 |\n\nTable 2\n| stock_code   |   simplified_ccc_proxy |\n|:-------------|-----------------------:|\n| VNM          |                      0 |\n| MSN          |                      0 |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "-- Hypothetical category codes, replace with actual ones\n-- BS_INV for Average Inventory, BS_AR for Accounts Receivable, BS_AP for Accounts Payable\n\nSELECT \n  'VNM' AS stock_code, \n  -- Assuming BS_INV, BS_AR, BS_AP are actual category codes for Inventory, Receivable, Payable respectively\n  SUM(CASE WHEN category_code = 'BS_INV' THEN data ELSE 0 END) AS avg_inventory,\n  SUM(CASE WHEN category_code = 'BS_AR' THEN data ELSE 0 END) AS accounts_receivable,\n  SUM(CASE WHEN category_code = 'BS_AP' THEN data ELSE 0 END) AS accounts_payable\nFROM \n  non_bank_financial_report\nWHERE \n  stock_code = 'VNM' AND year = 2023 AND quarter = 2\n\nUNION ALL\n\nSELECT \n  'MSN' AS stock_code, \n  SUM(CASE WHEN category_code = 'BS_INV' THEN data ELSE 0 END) AS avg_inventory,\n  SUM(CASE WHEN category_code = 'BS_AR' THEN data ELSE 0 END) AS accounts_receivable,\n  SUM(CASE WHEN category_code = 'BS_AP' THEN data ELSE 0 END) AS accounts_payable\nFROM \n  non_bank_financial_report\nWHERE \n  stock_code = 'MSN' AND year = 2023 AND quarter = 2\nLIMIT 2;\n"
            },
            {
                "language": "sql",
                "code": "WITH financial_data AS (\n  -- Paste the query from Step 1 here\n  SELECT \n    'VNM' AS stock_code, \n    SUM(CASE WHEN category_code = 'BS_INV' THEN data ELSE 0 END) AS avg_inventory,\n    SUM(CASE WHEN category_code = 'BS_AR' THEN data ELSE 0 END) AS accounts_receivable,\n    SUM(CASE WHEN category_code = 'BS_AP' THEN data ELSE 0 END) AS accounts_payable\n  FROM \n    non_bank_financial_report\n  WHERE \n    stock_code = 'VNM' AND year = 2023 AND quarter = 2\n\n  UNION ALL\n\n  SELECT \n    'MSN' AS stock_code, \n    SUM(CASE WHEN category_code = 'BS_INV' THEN data ELSE 0 END) AS avg_inventory,\n    SUM(CASE WHEN category_code = 'BS_AR' THEN data ELSE 0 END) AS accounts_receivable,\n    SUM(CASE WHEN category_code = 'BS_AP' THEN data ELSE 0 END) AS accounts_payable\n  FROM \n    non_bank_financial_report\n  WHERE \n    stock_code = 'MSN' AND year = 2023 AND quarter = 2\n)\nSELECT \n  stock_code,\n  -- Simplified Conceptual Approach (Not Traditional CCC Calculation)\n  -- Assuming direct averages as proxies for turnover periods\n  (avg_inventory + accounts_receivable - accounts_payable) AS simplified_ccc_proxy\nFROM \n  financial_data\nLIMIT 2;\n"
            }
        ],
        "time": 60.775880098342896,
        "evaluate": 0,
        "input_token": 1907,
        "output_token": 1136
    },
    {
        "id": "5ee33432-80c6-40b3-9525-1c8791410fae",
        "question": "Rank the top 10 companies by Return on Equity (ROE) for the fiscal year 2022.",
        "answer": "Table 1\n| stock_code   |   roe_value |\n|:-------------|------------:|\n| VC3          |  nan        |\n| DGC          |    0.557243 |\n| CAP          |    0.546075 |\n| TMB          |    0.432194 |\n| DCM          |    0.40744  |\n| SAF          |    0.293575 |\n| TVD          |    0.265397 |\n| VNM          |    0.26138  |\n| VIB          |    0.259372 |\n| FPT          |    0.256007 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    fr.stock_code, \n    fr.data AS roe_value\nFROM \n    financial_ratio fr\nJOIN \n    map_category_code_ratio mccr ON fr.ratio_code = mccr.ratio_code\nWHERE \n    mccr.ratio_name = 'Return On Equity' \n    AND fr.year = 2022 \n    AND fr.quarter = 0\nORDER BY \n    roe_value DESC\nLIMIT 10;\n"
            }
        ],
        "score": 1,
        "difficulty": 2,
        "response": "Table 1\n| stock_code   |     roe_value |\n|:-------------|--------------:|\n| BCM          |   0.0955323   |\n| CAP          |   0.546075    |\n| CEO          |   0.0835176   |\n| CMG          |   0.11371     |\n| DBC          |   0.0011191   |\n| DCM          |   0.40744     |\n| DGC          |   0.557243    |\n| DHT          |   0.123885    |\n| DTD          |   0.161925    |\n| DVM          |   0.083944    |\n| DXG          |   0.037892    |\n| FPT          |   0.256007    |\n| FRT          |   0.194245    |\n| GAS          |   0.246289    |\n| GVR          |   0.0889024   |\n| HDC          |   0.225682    |\n| HLD          |   0.0115416   |\n| HPG          |   0.0878594   |\n| HUT          |   0.037136    |\n| KDH          |   0.0917583   |\n| L14          |   0.0469793   |\n| L18          |   0.071126    |\n| LAS          |   0.0658133   |\n| LHC          |   0.19065     |\n| MSN          |   0.129771    |\n| MWG          |   0.171386    |\n| NHA          |   0.00438288  |\n| NKG          |  -0.0234384   |\n| NTP          |   0.1694      |\n| NVL          |   0.0486756   |\n| PLC          |   0.0951919   |\n| PLX          |   0.0684685   |\n| PNJ          |   0.214433    |\n| POW          |   0.0767072   |\n| PSD          |   0.22088     |\n| PVC          |   0.0327001   |\n| PVG          |   0.032697    |\n| PVS          |   0.0729385   |\n| PVT          |   0.144227    |\n| SAB          |   0.223652    |\n| SAF          |   0.293575    |\n| SLS          |   0.246868    |\n| TCH          |   0.0411945   |\n| TIG          |   0.0885005   |\n| TMB          |   0.432194    |\n| TNG          |   0.177484    |\n| TVD          |   0.265397    |\n| VC3          | nan           |\n| VCS          |   0.235934    |\n| VGI          |   0.0529294   |\n| VHM          |   0.196345    |\n| VIC          |   0.0150701   |\n| VJC          |  -0.151828    |\n| VNM          |   0.26138     |\n| VPI          |   0.130989    |\n| VRE          |   0.0830861   |\n| VTP          |   0.184659    |\n| YEG          |   0.0274488   |\n| ABB          |   0.103937    |\n| ACB          |   0.234232    |\n| BID          |   0.176793    |\n| CTG          |   0.155638    |\n| EIB          |   0.143836    |\n| HDB          |   0.210527    |\n| LPB          |   0.187496    |\n| MBB          |   0.228042    |\n| NVB          |   1.38787e-06 |\n| OCB          |   0.138876    |\n| SHB          |   0.180142    |\n| STB          |   0.130497    |\n| TCB          |   0.180176    |\n| TPB          |   0.194198    |\n| VCB          |   0.220567    |\n| VIB          |   0.259372    |\n| VPB          |   0.163367    |\n\nTable 2\n| stock_code   |   roe_value |\n|:-------------|------------:|\n| VC3          |  nan        |\n| DGC          |    0.557243 |\n| CAP          |    0.546075 |\n| TMB          |    0.432194 |\n| DCM          |    0.40744  |\n| SAF          |    0.293575 |\n| TVD          |    0.265397 |\n| VNM          |    0.26138  |\n| VIB          |    0.259372 |\n| FPT          |    0.256007 |\n\nTable 3\n| stock_code   |   roe_value |\n|:-------------|------------:|\n| VC3          |  nan        |\n| DGC          |    0.557243 |\n| CAP          |    0.546075 |\n| TMB          |    0.432194 |\n| DCM          |    0.40744  |\n| SAF          |    0.293575 |\n| TVD          |    0.265397 |\n| VNM          |    0.26138  |\n| VIB          |    0.259372 |\n| FPT          |    0.256007 |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "-- Extract stock codes with their corresponding ROE values for FY2022\nSELECT \n  stock_code, \n  data AS roe_value\nFROM \n  financial_ratio\nWHERE \n  ratio_code = 'ROE'  -- Assuming 'ROE' is the correct ratio_code for Return on Equity\n  AND year = 2022\n  AND quarter = 0  -- For annual reports\n"
            },
            {
                "language": "sql",
                "code": "-- Rank top 10 companies by ROE for FY2022 and select the top 10\nSELECT \n  stock_code, \n  roe_value\nFROM (\n  SELECT \n    stock_code, \n    data AS roe_value,\n    ROW_NUMBER() OVER (ORDER BY data DESC) AS roe_rank\n  FROM \n    financial_ratio\n  WHERE \n    ratio_code = 'ROE'\n    AND year = 2022\n    AND quarter = 0\n) AS ranked_roe\nWHERE \n  roe_rank <= 10\nLIMIT 10;\n"
            },
            {
                "language": "sql",
                "code": "SELECT \n  stock_code, \n  roe_value\nFROM (\n  SELECT \n    stock_code, \n    data AS roe_value,\n    ROW_NUMBER() OVER (ORDER BY data DESC) AS roe_rank\n  FROM \n    financial_ratio\n  WHERE \n    ratio_code = 'ROE'\n    AND year = 2022\n    AND quarter = 0\n) AS ranked_roe\nWHERE \n  roe_rank <= 10\nLIMIT 10;\n"
            }
        ],
        "time": 38.55984449386597,
        "evaluate": 0.5,
        "input_token": 3952,
        "output_token": 1126
    },
    {
        "id": "823d1e17-605a-4502-be5d-4ddcaa72ab21",
        "question": "What are the top 5 companies with the highest Total Assets as of December 31, 2023?",
        "answer": "Table 1\n| stock_code   | industry   |   issue_share |   total_assets |\n|:-------------|:-----------|--------------:|---------------:|\n| BID          | Banking    |    5.7004e+09 |    2.30081e+09 |\n| CTG          | Banking    |    5.37e+09   |    2.03261e+09 |\n| VCB          | Banking    |    5.5891e+09 |    1.83961e+09 |\n| MBB          | Banking    |    5.2871e+09 |    9.44954e+08 |\n| TCB          | Banking    |    7.045e+09  |    8.49482e+08 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "-- Step 1: Identify the category codes for \"Total Assets\"\n-- For banks, the category code is BS_300\n-- For non-bank corporations, the category code is BS_270\n-- For securities firms, the category code is BS_270\n\n-- Step 2, 3, 4: Retrieve, combine, and order the data\n\nSELECT ci.stock_code, ci.industry, ci.issue_share, total_assets\nFROM (\n    SELECT stock_code, data AS total_assets\n    FROM bank_financial_report\n    WHERE category_code = 'BS_300' AND year = 2023 AND quarter = 0\n    \n    UNION ALL\n    \n    SELECT stock_code, data AS total_assets\n    FROM non_bank_financial_report\n    WHERE category_code = 'BS_270' AND year = 2023 AND quarter = 0\n    \n    UNION ALL\n    \n    SELECT stock_code, data AS total_assets\n    FROM securities_financial_report\n    WHERE category_code = 'BS_270' AND year = 2023 AND quarter = 0\n) AS combined_reports\nJOIN company_info ci ON combined_reports.stock_code = ci.stock_code\nORDER BY total_assets DESC\nLIMIT 5;\n"
            }
        ],
        "score": 1,
        "difficulty": 3,
        "response": "Table 1\n| stock_code   |   total_assets |\n|:-------------|---------------:|\n| BID          |    2.30081e+09 |\n| CTG          |    2.03261e+09 |\n| VCB          |    1.83961e+09 |\n| MBB          |    9.44954e+08 |\n| TCB          |    8.49482e+08 |\n\nTable 2\n| stock_code   | company_name                                               | en_company_name                                                       | industry   | is_bank   | is_securities   |   total_assets |\n|:-------------|:-----------------------------------------------------------|:----------------------------------------------------------------------|:-----------|:----------|:----------------|---------------:|\n| BID          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n \u0110\u1ea7u t\u01b0 v\u00e0 Ph\u00e1t tri\u1ec3n Vi\u1ec7t Nam | Joint Stock Commercial Bank for Investment and Development of Vietnam | Banking    | True      | False           |    2.30081e+09 |\n| CTG          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n C\u00f4ng th\u01b0\u01a1ng Vi\u1ec7t Nam          | Vietnam Joint Stock Commercial Bank For Industry and Trade            | Banking    | True      | False           |    2.03261e+09 |\n| VCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ngo\u1ea1i th\u01b0\u01a1ng Vi\u1ec7t Nam         | Joint Stock Commercial Bank For Foreign Trade Of Vietnam              | Banking    | True      | False           |    1.83961e+09 |\n| MBB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Qu\u00e2n \u0111\u1ed9i                      | Military Commercial Joint Stock Bank                                  | Banking    | True      | False           |    9.44954e+08 |\n| TCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam            | Vietnam Technological And Commercial Joint Stock Bank                 | Banking    | True      | False           |    8.49482e+08 |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "WITH ranked_companies AS (\n  SELECT \n    stock_code,\n    data AS total_assets,\n    ROW_NUMBER() OVER (ORDER BY data DESC) AS rank\n  FROM (\n    SELECT stock_code, data, 'bank' AS report_type\n    FROM bank_financial_report\n    WHERE category_code = 'BS_300' AND year = 2023 AND quarter = 0\n    \n    UNION ALL\n    \n    SELECT stock_code, data, 'non_bank' AS report_type\n    FROM non_bank_financial_report\n    WHERE category_code = 'BS_270' AND year = 2023 AND quarter = 0\n    \n    UNION ALL\n    \n    SELECT stock_code, data, 'securities' AS report_type\n    FROM securities_financial_report\n    WHERE category_code = 'BS_270' AND year = 2023 AND quarter = 0\n  ) AS union_table\n)\nSELECT \n  stock_code,\n  total_assets\nFROM \n  ranked_companies\nWHERE \n  rank <= 5\nLIMIT 5;\n"
            },
            {
                "language": "sql",
                "code": "WITH ranked_companies AS (\n  SELECT \n    stock_code,\n    data AS total_assets,\n    ROW_NUMBER() OVER (ORDER BY data DESC) AS rank\n  FROM (\n    SELECT stock_code, data, 'bank' AS report_type\n    FROM bank_financial_report\n    WHERE category_code = 'BS_300' AND year = 2023 AND quarter = 0\n    \n    UNION ALL\n    \n    SELECT stock_code, data, 'non_bank' AS report_type\n    FROM non_bank_financial_report\n    WHERE category_code = 'BS_270' AND year = 2023 AND quarter = 0\n    \n    UNION ALL\n    \n    SELECT stock_code, data, 'securities' AS report_type\n    FROM securities_financial_report\n    WHERE category_code = 'BS_270' AND year = 2023 AND quarter = 0\n  ) AS union_table\n)\nSELECT \n  ci.stock_code,\n  ci.company_name,\n  ci.en_company_name,\n  ci.industry,\n  ci.is_bank,\n  ci.is_securities,\n  rc.total_assets\nFROM \n  ranked_companies rc\n  JOIN company_info ci ON rc.stock_code = ci.stock_code\nWHERE \n  rc.rank <= 5\nLIMIT 5;\n"
            }
        ],
        "time": 40.74191188812256,
        "evaluate": 1,
        "input_token": 3931,
        "output_token": 2325
    },
    {
        "id": "5635fb56-7037-4c79-9db7-8435e6f0e120",
        "question": "Rank the top 5 companies with total assets greater than 100,000 billion VND  based on Return on Equity (ROE) for the period 2020-Q2 2024, showing ROE values for each company.",
        "answer": "Table 1\n| stock_code   | industry    |     avg_roe |\n|:-------------|:------------|------------:|\n| ACB          | Banking     | nan         |\n| VIB          | Banking     |   0.0698803 |\n| VHM          | Real Estate |   0.0646859 |\n| VCB          | Banking     |   0.0624534 |\n| MBB          | Banking     |   0.056319  |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "WITH total_assets AS (\n    SELECT stock_code, MAX(data) AS max_total_assets\n    FROM (\n        SELECT stock_code, data\n        FROM bank_financial_report\n        WHERE category_code = 'BS_300' AND quarter != 0 AND year BETWEEN 2020 AND 2024\n\n        UNION ALL\n\n        SELECT stock_code, data\n        FROM non_bank_financial_report\n        WHERE category_code = 'BS_270' AND quarter != 0 AND year BETWEEN 2020 AND 2024\n\n        UNION ALL\n\n        SELECT stock_code, data\n        FROM securities_financial_report\n        WHERE category_code = 'BS_270' AND quarter != 0 AND year BETWEEN 2020 AND 2024\n    ) AS combined_assets\n    GROUP BY stock_code\n    HAVING MAX(data) > 100000000\n),\nroe_data AS (\n    SELECT stock_code, AVG(data) AS avg_roe\n    FROM financial_ratio\n    WHERE ratio_code = 'ROE' AND quarter != 0 AND year BETWEEN 2020 AND 2024\n    GROUP BY stock_code\n)\nSELECT ci.stock_code, ci.industry, roe_data.avg_roe\nFROM roe_data\nJOIN total_assets ON roe_data.stock_code = total_assets.stock_code\nJOIN company_info ci ON roe_data.stock_code = ci.stock_code\nORDER BY roe_data.avg_roe DESC\nLIMIT 5;\n"
            }
        ],
        "score": 1,
        "difficulty": 4,
        "response": "Table 1\n| stock_code   |\n|:-------------|\n| BID          |\n| BID          |\n| BID          |\n| BID          |\n| EIB          |\n| EIB          |\n| OCB          |\n| OCB          |\n| OCB          |\n| OCB          |\n| CTG          |\n| CTG          |\n| CTG          |\n| CTG          |\n| VCB          |\n| VCB          |\n| VCB          |\n| VCB          |\n| ACB          |\n| ACB          |\n| ACB          |\n| ACB          |\n| MBB          |\n| MBB          |\n| MBB          |\n| MBB          |\n| HDB          |\n| HDB          |\n| HDB          |\n| HDB          |\n| TPB          |\n| TPB          |\n| TPB          |\n| TPB          |\n| VPB          |\n| VPB          |\n| VPB          |\n| VPB          |\n| STB          |\n| STB          |\n| STB          |\n| STB          |\n| TCB          |\n| TCB          |\n| TCB          |\n| SHB          |\n| SHB          |\n| SHB          |\n| VIB          |\n| VIB          |\n| VIB          |\n| VIB          |\n| ABB          |\n| ABB          |\n| ABB          |\n| ABB          |\n| LPB          |\n| LPB          |\n| LPB          |\n| LPB          |\n| EIB          |\n| EIB          |\n| TCB          |\n| SHB          |\n| HPG          |\n| HPG          |\n| HPG          |\n| HPG          |\n| VHM          |\n| VHM          |\n| VHM          |\n| VHM          |\n| VIC          |\n| VIC          |\n| VIC          |\n| VIC          |\n| NVL          |\n| NVL          |\n| NVL          |\n| NVL          |\n| MSN          |\n| MSN          |\n| MSN          |\n| MSN          |\n\nTable 2\n| stock_code   |   average_roe_q2_2020_2024 |\n|:-------------|---------------------------:|\n| ACB          |                nan         |\n| VIB          |                  0.0740578 |\n| VCB          |                  0.0693446 |\n| HDB          |                  0.0587696 |\n| MBB          |                  0.0566224 |\n\nTable 3\n| stock_code   |   average_roe_q2_2020_2024 |\n|:-------------|---------------------------:|\n| ACB          |                nan         |\n| CAP          |                  0.153652  |\n| TMB          |                  0.148479  |\n| DGC          |                  0.1044    |\n| VNM          |                  0.0871241 |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "WITH eligible_companies AS (\n  SELECT \n    'bank' AS report_type,\n    bfr.stock_code,\n    bfr.year\n  FROM \n    bank_financial_report bfr\n  INNER JOIN \n    map_category_code_bank mccb ON bfr.category_code = mccb.category_code\n  WHERE \n    bfr.quarter = 0 \n    AND bfr.year BETWEEN 2020 AND 2024 \n    AND mccb.en_caption = 'Total assets'\n    AND bfr.data > 100000  -- 100,000 billion VND in Millions VND (adjusted to 100,000 for correct filtering)\n\n  UNION ALL\n\n  SELECT \n    'non_bank' AS report_type,\n    nbfr.stock_code,\n    nbfr.year\n  FROM \n    non_bank_financial_report nbfr\n  INNER JOIN \n    map_category_code_non_bank mccnb ON nbfr.category_code = mccnb.category_code\n  WHERE \n    nbfr.quarter = 0 \n    AND nbfr.year BETWEEN 2020 AND 2024 \n    AND mccnb.en_caption = 'TOTAL ASSETS'\n    AND nbfr.data > 100000  -- 100,000 billion VND in Millions VND (adjusted to 100,000 for correct filtering)\n\n  UNION ALL\n\n  SELECT \n    'securities' AS report_type,\n    sfr.stock_code,\n    sfr.year\n  FROM \n    securities_financial_report sfr\n  INNER JOIN \n    map_category_code_securities mccs ON sfr.category_code = mccs.category_code\n  WHERE \n    sfr.quarter = 0 \n    AND sfr.year BETWEEN 2020 AND 2024 \n    AND mccs.en_caption = 'TOTAL ASSETS'\n    AND sfr.data > 100000  -- 100,000 billion VND in Millions VND (adjusted to 100,000 for correct filtering)\n),\nroe_values AS (\n  SELECT \n    fr.stock_code,\n    fr.year,\n    fr.data AS roe\n  FROM \n    financial_ratio fr\n  INNER JOIN \n    map_category_code_ratio mccr ON fr.ratio_code = mccr.ratio_code\n  INNER JOIN \n    eligible_companies ec ON fr.stock_code = ec.stock_code AND fr.year = ec.year\n  WHERE \n    mccr.ratio_name = 'Return On Equity'\n    AND fr.quarter = 2  -- Q2\n    AND fr.year BETWEEN 2020 AND 2024\n)\nSELECT \n  stock_code,\n  AVG(roe) AS average_roe_q2_2020_2024\nFROM \n  roe_values\nGROUP BY \n  stock_code\nORDER BY \n  average_roe_q2_2020_2024 DESC\nLIMIT 5;\n"
            }
        ],
        "time": 103.75198745727539,
        "evaluate": 0,
        "input_token": 8029,
        "output_token": 3016
    },
    {
        "id": "c0ff8d4c-799a-4af1-97ff-5618152aa69d",
        "question": "For the period 2020-Q2 2024, list the top 10 companies with Net Income exceeding 1,000 billion VND, ranked by their Debt-to-Equity ratio, and provide the Debt-to-Equity ratio for each company.",
        "answer": "Table 1\n| stock_code   | industry   | is_bank   | is_securities   |   debt_to_equity_ratio |\n|:-------------|:-----------|:----------|:----------------|-----------------------:|\n| VCB          | Banking    | True      | False           |                29.2163 |\n| VCB          | Banking    | True      | False           |                30.067  |\n| ACB          | Banking    | True      | False           |               nan      |\n| STB          | Banking    | True      | False           |                16.557  |\n| SHB          | Banking    | True      | False           |                18.2134 |\n| LPB          | Banking    | True      | False           |                16.212  |\n| BID          | Banking    | True      | False           |                16.9862 |\n| BID          | Banking    | True      | False           |                17.6264 |\n| BID          | Banking    | True      | False           |                17.7161 |\n| BID          | Banking    | True      | False           |                17.7451 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "WITH net_income_exceeding AS (\n    SELECT\n        stock_code,\n        SUM(data) AS total_net_income\n    FROM (\n        SELECT stock_code, data\n        FROM bank_financial_report\n        WHERE category_code = 'IS_021' AND year BETWEEN 2020 AND 2024 AND quarter != 0\n\n        UNION ALL\n\n        SELECT stock_code, data\n        FROM non_bank_financial_report\n        WHERE category_code = 'IS_400' AND year BETWEEN 2020 AND 2024 AND quarter != 0\n\n        UNION ALL\n\n        SELECT stock_code, data\n        FROM securities_financial_report\n        WHERE category_code = 'IS_400' AND year BETWEEN 2020 AND 2024 AND quarter != 0\n    ) AS combined_reports\n    GROUP BY stock_code\n    HAVING SUM(data) > 1000000\n),\ntop_companies AS (\n    SELECT\n        fr.stock_code,\n        fr.data AS debt_to_equity_ratio\n    FROM financial_ratio fr\n    JOIN net_income_exceeding nie ON fr.stock_code = nie.stock_code\n    WHERE fr.ratio_code = 'DTER' AND fr.year BETWEEN 2020 AND 2024 AND fr.quarter != 0\n    ORDER BY fr.data DESC\n    LIMIT 10\n)\nSELECT\n    ci.stock_code,\n    ci.industry,\n    ci.is_bank,\n    ci.is_securities,\n    tc.debt_to_equity_ratio\nFROM company_info ci\nJOIN top_companies tc ON ci.stock_code = tc.stock_code;\n"
            }
        ],
        "score": 1,
        "difficulty": 4,
        "response": "Table 1\n| report_type   | stock_code   |   year |   quarter |   net_income |\n|:--------------|:-------------|-------:|----------:|-------------:|\n| bank          | BID          |   2020 |         0 |  5.09257e+06 |\n| bank          | BID          |   2021 |         0 |  6.17885e+06 |\n| bank          | BID          |   2022 |         0 |  4.21033e+06 |\n| bank          | BID          |   2023 |         0 |  2.0678e+06  |\n| bank          | CTG          |   2020 |         0 |  1.9097e+06  |\n| bank          | CTG          |   2021 |         0 |  3.39807e+06 |\n| bank          | CTG          |   2022 |         0 |  6.53737e+06 |\n| bank          | CTG          |   2023 |         0 |  5.80308e+06 |\n| bank          | VCB          |   2020 |         0 |  1.80025e+06 |\n| bank          | VCB          |   2021 |         0 |  2.39326e+06 |\n| bank          | VCB          |   2022 |         0 |  2.05396e+06 |\n| bank          | VCB          |   2023 |         0 |  2.27217e+06 |\n| bank          | MBB          |   2020 |         0 |  1.67955e+06 |\n| bank          | MBB          |   2021 |         0 |  3.25431e+06 |\n| bank          | MBB          |   2022 |         0 |  2.14166e+06 |\n| bank          | MBB          |   2023 |         0 |  2.42811e+06 |\n| bank          | VPB          |   2020 |         0 |  2.23616e+06 |\n| bank          | VPB          |   2021 |         0 |  2.80779e+06 |\n| bank          | VPB          |   2022 |         0 |  1.0584e+07  |\n| bank          | VPB          |   2023 |         0 |  4.52555e+06 |\n| bank          | STB          |   2020 |         0 |  1.12373e+06 |\n| bank          | STB          |   2022 |         0 |  2.74535e+06 |\n| bank          | TCB          |   2020 |         0 |  2.27921e+06 |\n| bank          | TCB          |   2021 |         0 |  1.80325e+06 |\n| bank          | TCB          |   2022 |         0 |  2.16738e+06 |\n| bank          | BID          |   2020 |         2 |  1.11826e+06 |\n| bank          | TCB          |   2023 |         0 |  2.43412e+06 |\n| non_bank      | MWG          |   2020 |         0 |  5.41253e+06 |\n| non_bank      | VNM          |   2020 |         0 |  1.35394e+07 |\n| non_bank      | VNM          |   2021 |         0 |  1.27276e+07 |\n| non_bank      | VNM          |   2022 |         0 |  1.04911e+07 |\n| non_bank      | VNM          |   2023 |         0 |  1.09036e+07 |\n| non_bank      | HPG          |   2020 |         0 |  1.52923e+07 |\n| non_bank      | HPG          |   2021 |         0 |  3.70084e+07 |\n| non_bank      | HPG          |   2022 |         0 |  9.79403e+06 |\n| non_bank      | HPG          |   2023 |         0 |  7.65076e+06 |\n| non_bank      | VHM          |   2020 |         0 |  3.73058e+07 |\n| non_bank      | VHM          |   2021 |         0 |  4.76649e+07 |\n| non_bank      | VHM          |   2022 |         0 |  3.79731e+07 |\n| non_bank      | VHM          |   2023 |         0 |  4.40454e+07 |\n| non_bank      | PNJ          |   2020 |         0 |  1.34913e+06 |\n| non_bank      | PNJ          |   2021 |         0 |  1.3069e+06  |\n| non_bank      | PNJ          |   2022 |         0 |  2.33747e+06 |\n| non_bank      | PNJ          |   2023 |         0 |  2.48413e+06 |\n| non_bank      | FPT          |   2020 |         0 |  5.19065e+06 |\n| non_bank      | FPT          |   2021 |         0 |  6.22849e+06 |\n| non_bank      | FPT          |   2022 |         0 |  7.58929e+06 |\n| non_bank      | FPT          |   2023 |         0 |  9.11174e+06 |\n| non_bank      | MSN          |   2020 |         0 |  1.19577e+06 |\n| non_bank      | MSN          |   2021 |         0 |  1.12732e+07 |\n| non_bank      | MSN          |   2022 |         0 |  5.22274e+06 |\n| non_bank      | MSN          |   2023 |         0 |  2.35043e+06 |\n| non_bank      | VRE          |   2020 |         0 |  2.90145e+06 |\n| non_bank      | VRE          |   2021 |         0 |  1.65791e+06 |\n| non_bank      | VRE          |   2022 |         0 |  3.4527e+06  |\n| non_bank      | VRE          |   2023 |         0 |  5.38188e+06 |\n| non_bank      | VIC          |   2020 |         0 |  1.46547e+07 |\n| non_bank      | VIC          |   2021 |         0 |  7.76091e+06 |\n| non_bank      | VIC          |   2022 |         0 |  8.00436e+06 |\n| non_bank      | PLX          |   2020 |         0 |  1.1914e+06  |\n| non_bank      | PLX          |   2021 |         0 |  3.51719e+06 |\n| non_bank      | PLX          |   2022 |         0 |  1.94222e+06 |\n| non_bank      | SAB          |   2020 |         0 |  6.07641e+06 |\n| non_bank      | SAB          |   2021 |         0 |  4.78023e+06 |\n| non_bank      | SAB          |   2022 |         0 |  6.82966e+06 |\n| non_bank      | SAB          |   2023 |         0 |  5.40263e+06 |\n| non_bank      | POW          |   2020 |         0 |  2.85524e+06 |\n| non_bank      | POW          |   2021 |         0 |  2.45918e+06 |\n| non_bank      | POW          |   2022 |         0 |  2.76516e+06 |\n| non_bank      | POW          |   2023 |         0 |  1.29018e+06 |\n| non_bank      | GVR          |   2020 |         0 |  4.80298e+06 |\n| non_bank      | GVR          |   2021 |         0 |  5.78333e+06 |\n| non_bank      | GVR          |   2022 |         0 |  4.3811e+06  |\n| non_bank      | GVR          |   2023 |         0 |  2.79553e+06 |\n| non_bank      | BCM          |   2021 |         0 |  2.21557e+06 |\n| non_bank      | BCM          |   2022 |         0 |  1.77327e+06 |\n| non_bank      | BCM          |   2023 |         0 |  2.80537e+06 |\n| non_bank      | KDH          |   2020 |         0 |  1.49751e+06 |\n| non_bank      | KDH          |   2021 |         0 |  1.35532e+06 |\n| non_bank      | KDH          |   2023 |         0 |  1.12173e+06 |\n| non_bank      | TCH          |   2020 |         0 |  1.27059e+06 |\n| non_bank      | TCH          |   2023 |         0 |  1.5182e+06  |\n| non_bank      | NVL          |   2020 |         0 |  5.04919e+06 |\n| non_bank      | NVL          |   2021 |         0 |  3.31158e+06 |\n| non_bank      | NVL          |   2022 |         0 |  2.61504e+06 |\n| non_bank      | NVL          |   2023 |         0 |  1.27259e+06 |\n| non_bank      | DBC          |   2020 |         0 |  1.54936e+06 |\n| non_bank      | PVT          |   2022 |         0 |  1.16936e+06 |\n| non_bank      | PVT          |   2023 |         0 |  1.34618e+06 |\n| non_bank      | DGC          |   2020 |         0 |  1.0236e+06  |\n| non_bank      | DGC          |   2021 |         0 |  2.64449e+06 |\n| non_bank      | DGC          |   2022 |         0 |  6.38165e+06 |\n| non_bank      | DGC          |   2023 |         0 |  3.48651e+06 |\n| non_bank      | DCM          |   2021 |         0 |  1.9545e+06  |\n| non_bank      | DCM          |   2022 |         0 |  4.59315e+06 |\n| non_bank      | DCM          |   2023 |         0 |  1.23233e+06 |\n| non_bank      | NKG          |   2021 |         0 |  2.55094e+06 |\n| non_bank      | VGI          |   2020 |         0 |  1.51243e+06 |\n| non_bank      | VGI          |   2022 |         0 |  2.96244e+06 |\n| non_bank      | VGI          |   2023 |         0 |  3.70401e+06 |\n\nTable 2\n| stock_code   |   debt_to_equity_ratio |\n|:-------------|-----------------------:|\n| BID          |                19.4068 |\n| BID          |                19.3533 |\n| BID          |                18.0427 |\n| BID          |                17.7184 |\n| STB          |                16.009  |\n| CTG          |                15.7188 |\n| CTG          |                15.3545 |\n| CTG          |                15.1483 |\n| CTG          |                14.7056 |\n| STB          |                14.3237 |\n\nTable 3\n| stock_code   |   debt_to_equity_ratio |\n|:-------------|-----------------------:|\n| BID          |                19.4068 |\n| BID          |                19.3533 |\n| BID          |                18.0427 |\n| BID          |                17.7184 |\n| STB          |                16.009  |\n| CTG          |                15.7188 |\n| CTG          |                15.3545 |\n| CTG          |                15.1483 |\n| CTG       ",
        "code_response": [
            {
                "language": "sql",
                "code": "WITH net_income_companies AS (\n  SELECT \n    'bank' AS report_type,\n    bfr.stock_code,\n    bfr.year,\n    bfr.quarter,\n    bfr.data AS net_income\n  FROM \n    bank_financial_report bfr\n  INNER JOIN \n    map_category_code_bank mccb ON bfr.category_code = mccb.category_code\n  WHERE \n    bfr.year BETWEEN 2020 AND 2024\n    AND (bfr.quarter = 0 OR (bfr.year = 2020 AND bfr.quarter = 2))\n    AND mccb.en_caption IN ('Net profit/(loss) from other activities', \n                            'Net Interest Income', \n                            'Net profit from operating activities')  -- Adjusted to include possible net income captions\n    AND bfr.data > 1000000\n\n  UNION ALL\n\n  SELECT \n    'non_bank' AS report_type,\n    nbfr.stock_code,\n    nbfr.year,\n    nbfr.quarter,\n    nbfr.data AS net_income\n  FROM \n    non_bank_financial_report nbfr\n  INNER JOIN \n    map_category_code_non_bank mccnb ON nbfr.category_code = mccnb.category_code\n  WHERE \n    nbfr.year BETWEEN 2020 AND 2024\n    AND (nbfr.quarter = 0 OR (nbfr.year = 2020 AND nbfr.quarter = 2))\n    AND mccnb.en_caption IN ('Net profit from operating activities', \n                             'Financial income', \n                             'Other income')  -- Adjusted to include possible net income captions\n    AND nbfr.data > 1000000\n\n  UNION ALL\n\n  SELECT \n    'securities' AS report_type,\n    sfr.stock_code,\n    sfr.year,\n    sfr.quarter,\n    sfr.data AS net_income\n  FROM \n    securities_financial_report sfr\n  INNER JOIN \n    map_category_code_securities mccs ON sfr.category_code = mccs.category_code\n  WHERE \n    sfr.year BETWEEN 2020 AND 2024\n    AND (sfr.quarter = 0 OR (sfr.year = 2020 AND sfr.quarter = 2))\n    AND mccs.en_caption IN ('Total comprehensive income', \n                            'Total financial revenue', \n                            'Other income')  -- Adjusted to include possible net income captions\n    AND sfr.data > 1000000\n),\n\nranked_companies AS (\n  SELECT \n    nic.stock_code,\n    fr.data AS debt_to_equity_ratio,\n    ROW_NUMBER() OVER (ORDER BY fr.data DESC) AS rank\n  FROM \n    net_income_companies nic\n  INNER JOIN \n    financial_ratio fr ON nic.stock_code = fr.stock_code\n  INNER JOIN \n    map_category_code_ratio mccr ON fr.ratio_code = mccr.ratio_code\n  WHERE \n    mccr.ratio_name = 'Debt To Equity Ratio'\n    AND nic.year = fr.year\n    AND nic.quarter = fr.quarter\n)\n\nSELECT \n  stock_code,\n  debt_to_equity_ratio\nFROM \n  ranked_companies\nWHERE \n  rank <= 10;\n"
            }
        ],
        "time": 123.701406955719,
        "evaluate": 0,
        "input_token": 7672,
        "output_token": 1058
    },
    {
        "id": "74b672c5-6a11-41a6-add8-8b866f4f1972",
        "question": "What were the total assets and total liabilities of Vinamilk and Masan Group at the end of 2023?",
        "answer": "Table 1\n| stock_code   | category_code   |        data |\n|:-------------|:----------------|------------:|\n| VNM          | BS_270          | 5.26734e+07 |\n| VNM          | BS_300          | 1.76476e+07 |\n| MSN          | BS_270          | 1.47383e+08 |\n| MSN          | BS_300          | 1.09146e+08 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    stock_code,\n    category_code,\n    data\nFROM \n    non_bank_financial_report\nWHERE \n    stock_code IN ('VNM', 'MSN') AND\n    year = 2023 AND\n    quarter = 0 AND\n    category_code IN ('BS_270', 'BS_300');\n"
            }
        ],
        "score": 1,
        "difficulty": 2,
        "response": "Table 1\n| stock_code   | industry           |   total_assets |   total_liabilities |\n|:-------------|:-------------------|---------------:|--------------------:|\n| MSN          | Food and Beverages |    4.37635e+07 |         1.0362e+08  |\n| VNM          | Food and Beverages |    3.59359e+07 |         1.67375e+07 |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT \n  ci.stock_code,\n  ci.industry,\n  r1.data AS total_assets,\n  r2.data AS total_liabilities\nFROM \n  company_info ci\n  LEFT JOIN non_bank_financial_report r1 ON ci.stock_code = r1.stock_code\n    AND r1.category_code = 'BS_100'  -- Replace with actual Total Assets category_code\n    AND r1.year = 2023 AND r1.quarter = 0\n  LEFT JOIN non_bank_financial_report r2 ON ci.stock_code = r2.stock_code\n    AND r2.category_code = 'BS_200'  -- Replace with actual Total Liabilities category_code\n    AND r2.year = 2023 AND r2.quarter = 0\nWHERE \n  ci.stock_code IN ('VNM', 'MSN')\nLIMIT 2;\n"
            }
        ],
        "time": 32.26469659805298,
        "evaluate": 0,
        "input_token": 6252,
        "output_token": 3170
    },
    {
        "id": "d791c613-7b95-4157-bde2-61de3fb6bec9",
        "question": "Rank the top 5 companies with the highest operating cash flow in Q2 2024, filtering for companies with total assets exceeding 100 billion VND.",
        "answer": "Table 1\n| stock_code   | industry           |   operating_cash_flow |\n|:-------------|:-------------------|----------------------:|\n| MWG          | Retail             |           7.46094e+06 |\n| VGI          | Telecommunications |           6.99246e+06 |\n| VHM          | Real Estate        |           6.47431e+06 |\n| VND          | Financial Services |           3.45256e+06 |\n| SSI          | Financial Services |           3.20662e+06 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "WITH TotalAssets AS (\n    SELECT stock_code, data AS total_assets\n    FROM bank_financial_report\n    WHERE category_code = 'BS_300' AND year = 2024 AND quarter = 2\n    UNION ALL\n    SELECT stock_code, data AS total_assets\n    FROM non_bank_financial_report\n    WHERE category_code = 'BS_270' AND year = 2024 AND quarter = 2\n    UNION ALL\n    SELECT stock_code, data AS total_assets\n    FROM securities_financial_report\n    WHERE category_code = 'BS_270' AND year = 2024 AND quarter = 2\n),\nOperatingCashFlow AS (\n    SELECT stock_code, data AS operating_cash_flow\n    FROM bank_financial_report\n    WHERE category_code = 'CF_009' AND year = 2024 AND quarter = 2\n    UNION ALL\n    SELECT stock_code, data AS operating_cash_flow\n    FROM non_bank_financial_report\n    WHERE category_code = 'CF_020' AND year = 2024 AND quarter = 2\n    UNION ALL\n    SELECT stock_code, data AS operating_cash_flow\n    FROM securities_financial_report\n    WHERE category_code = 'CF_060' AND year = 2024 AND quarter = 2\n)\nSELECT ci.stock_code, ci.industry, ocf.operating_cash_flow\nFROM OperatingCashFlow ocf\nJOIN TotalAssets ta ON ocf.stock_code = ta.stock_code\nJOIN company_info ci ON ocf.stock_code = ci.stock_code\nWHERE ta.total_assets > 100000\nORDER BY ocf.operating_cash_flow DESC\nLIMIT 5;\n"
            }
        ],
        "score": 1,
        "difficulty": 3,
        "response": "Table 1\n| company_type   | stock_code   |     total_assets |\n|:---------------|:-------------|-----------------:|\n| non_bank       | MWG          |      6.58698e+07 |\n| non_bank       | HPG          |      2.06609e+08 |\n| non_bank       | VHM          |      4.94461e+08 |\n| non_bank       | VRE          |      5.23284e+07 |\n| non_bank       | SAB          |      3.41536e+07 |\n| non_bank       | POW          |      8.09195e+07 |\n| non_bank       | BCM          |      5.50294e+07 |\n| non_bank       | VPI          |      1.17905e+07 |\n| non_bank       | HDC          |      5.10311e+06 |\n| non_bank       | CEO          |      9.01424e+06 |\n| non_bank       | HUT          |      2.72561e+07 |\n| non_bank       | PVT          |      1.75665e+07 |\n| non_bank       | CMG          |      7.30354e+06 |\n| non_bank       | VGI          |      5.71412e+07 |\n| non_bank       | L18          |      4.99112e+06 |\n| non_bank       | PLC          |      3.93712e+06 |\n| non_bank       | PVS          |      2.69181e+07 |\n| non_bank       | SLS          |      1.4375e+06  |\n| non_bank       | TIG          |      4.26296e+06 |\n| non_bank       | TMB          |      4.79079e+06 |\n| non_bank       | CAP          | 391508           |\n| non_bank       | PNJ          |      1.29639e+07 |\n| non_bank       | VIC          |      7.22259e+08 |\n| non_bank       | PLX          |      7.39669e+07 |\n| non_bank       | DBC          |      1.33263e+07 |\n| non_bank       | VTP          |      7.06503e+06 |\n| non_bank       | PVC          |      2.00333e+06 |\n| non_bank       | DTD          |      2.20978e+06 |\n| non_bank       | LHC          |      1.06364e+06 |\n| non_bank       | TNG          |      5.89481e+06 |\n| non_bank       | VCS          |      6.13076e+06 |\n| non_bank       | GVR          |      7.61166e+07 |\n| bank           | VPB          |      8.64392e+08 |\n| bank           | TCB          |      9.08307e+08 |\n| bank           | SHB          |      6.59767e+08 |\n| bank           | ABB          |      1.52146e+08 |\n| bank           | NVB          |      1.03312e+08 |\n| bank           | BID          |      2.52105e+09 |\n| securities     | MBS          |      1.75847e+07 |\n| securities     | VND          |      4.51535e+07 |\n| securities     | SSI          |      7.11076e+07 |\n| securities     | VIX          |      1.06076e+07 |\n| securities     | ORS          |      9.83216e+06 |\n\nTable 2\n| company_type   | stock_code   |     total_assets |\n|:---------------|:-------------|-----------------:|\n| non_bank       | HPG          |      2.06609e+08 |\n| non_bank       | VHM          |      4.94461e+08 |\n| non_bank       | PNJ          |      1.29639e+07 |\n| non_bank       | VIC          |      7.22259e+08 |\n| non_bank       | PLX          |      7.39669e+07 |\n| non_bank       | HDC          |      5.10311e+06 |\n| non_bank       | CEO          |      9.01424e+06 |\n| non_bank       | HUT          |      2.72561e+07 |\n| non_bank       | DBC          |      1.33263e+07 |\n| non_bank       | VTP          |      7.06503e+06 |\n| non_bank       | PVT          |      1.75665e+07 |\n| non_bank       | PVC          |      2.00333e+06 |\n| non_bank       | PLC          |      3.93712e+06 |\n| non_bank       | TNG          |      5.89481e+06 |\n| non_bank       | VCS          |      6.13076e+06 |\n| non_bank       | CAP          | 391508           |\n| non_bank       | MWG          |      6.58698e+07 |\n| non_bank       | VRE          |      5.23284e+07 |\n| non_bank       | SAB          |      3.41536e+07 |\n| non_bank       | POW          |      8.09195e+07 |\n| non_bank       | BCM          |      5.50294e+07 |\n| non_bank       | VPI          |      1.17905e+07 |\n| non_bank       | CMG          |      7.30354e+06 |\n| non_bank       | VGI          |      5.71412e+07 |\n| non_bank       | DTD          |      2.20978e+06 |\n| non_bank       | L18          |      4.99112e+06 |\n| non_bank       | LHC          |      1.06364e+06 |\n| non_bank       | PVS          |      2.69181e+07 |\n| non_bank       | SLS          |      1.4375e+06  |\n| non_bank       | TIG          |      4.26296e+06 |\n| non_bank       | TMB          |      4.79079e+06 |\n| non_bank       | GVR          |      7.61166e+07 |\n| bank           | VPB          |      8.64392e+08 |\n| bank           | TCB          |      9.08307e+08 |\n| bank           | SHB          |      6.59767e+08 |\n| bank           | ABB          |      1.52146e+08 |\n| bank           | NVB          |      1.03312e+08 |\n| bank           | BID          |      2.52105e+09 |\n| securities     | MBS          |      1.75847e+07 |\n| securities     | VND          |      4.51535e+07 |\n| securities     | SSI          |      7.11076e+07 |\n| securities     | VIX          |      1.06076e+07 |\n| securities     | ORS          |      9.83216e+06 |\n\nTable 3\n| stock_code   |     total_assets |\n|:-------------|-----------------:|\n| HPG          |      2.06609e+08 |\n| VHM          |      4.94461e+08 |\n| VRE          |      5.23284e+07 |\n| VIC          |      7.22259e+08 |\n| PLX          |      7.39669e+07 |\n| SAB          |      3.41536e+07 |\n| POW          |      8.09195e+07 |\n| HDC          |      5.10311e+06 |\n| CEO          |      9.01424e+06 |\n| HUT          |      2.72561e+07 |\n| DBC          |      1.33263e+07 |\n| DTD          |      2.20978e+06 |\n| L18          |      4.99112e+06 |\n| LHC          |      1.06364e+06 |\n| TNG          |      5.89481e+06 |\n| VCS          |      6.13076e+06 |\n| GVR          |      7.61166e+07 |\n| MWG          |      6.58698e+07 |\n| PNJ          |      1.29639e+07 |\n| BCM          |      5.50294e+07 |\n| VPI          |      1.17905e+07 |\n| VTP          |      7.06503e+06 |\n| PVT          |      1.75665e+07 |\n| CMG          |      7.30354e+06 |\n| VGI          |      5.71412e+07 |\n| PVC          |      2.00333e+06 |\n| PLC          |      3.93712e+06 |\n| PVS          |      2.69181e+07 |\n| SLS          |      1.4375e+06  |\n| TIG          |      4.26296e+06 |\n| TMB          |      4.79079e+06 |\n| CAP          | 391508           |\n| VPB          |      8.64392e+08 |\n| TCB          |      9.08307e+08 |\n| SHB          |      6.59767e+08 |\n| ABB          |      1.52146e+08 |\n| NVB          |      1.03312e+08 |\n| BID          |      2.52105e+09 |\n| MBS          |      1.75847e+07 |\n| VND          |      4.51535e+07 |\n| SSI          |      7.11076e+07 |\n| VIX          |      1.06076e+07 |\n| ORS          |      9.83216e+06 |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "WITH filtered_companies AS (\n  SELECT \n    nbf.stock_code,\n    nbf.data AS total_assets\n  FROM \n    non_bank_financial_report nbf\n  JOIN \n    map_category_code_non_bank mcn ON nbf.category_code = mcn.category_code\n  WHERE \n    nbf.quarter = 2 AND nbf.year = 2024 AND mcn.category_code = 'BS_270' AND nbf.data > 100000\n\n  UNION ALL\n\n  SELECT \n    bfr.stock_code,\n    bfr.data AS total_assets\n  FROM \n    bank_financial_report bfr\n  JOIN \n    map_category_code_bank mcb ON bfr.category_code = mcb.category_code\n  WHERE \n    bfr.quarter = 2 AND bfr.year = 2024 AND mcb.category_code = 'BS_300' AND bfr.data > 100000\n\n  UNION ALL\n\n  SELECT \n    sfr.stock_code,\n    sfr.data AS total_assets\n  FROM \n    securities_financial_report sfr\n  JOIN \n    map_category_code_securities mcs ON sfr.category_code = mcs.category_code\n  WHERE \n    sfr.quarter = 2 AND sfr.year = 2024 AND mcs.category_code = 'BS_270' AND sfr.data > 100000\n)\nSELECT * FROM filtered_companies\nLIMIT 100;\n"
            },
            {
                "language": "sql",
                "code": "WITH filtered_companies AS (\n  -- same CTE as in Step 1\n),\n\noperating_cash_flow AS (\n  SELECT \n    nbf.stock_code,\n    nbf.data AS operating_cash_flow\n  FROM \n    non_bank_financial_report nbf\n  JOIN \n    map_category_code_non_bank mcn ON nbf.category_code = mcn.category_code\n  JOIN \n    filtered_companies fc ON nbf.stock_code = fc.stock_code\n  WHERE \n    nbf.quarter = 2 AND nbf.year = 2024 AND mcn.category_code = 'CF_020'\n\n  UNION ALL\n\n  SELECT \n    bfr.stock_code,\n    bfr.data AS operating_cash_flow\n  FROM \n    bank_financial_report bfr\n  JOIN \n    map_category_code_bank mcb ON bfr.category_code = mcb.category_code\n  JOIN \n    filtered_companies fc ON bfr.stock_code = fc.stock_code\n  WHERE \n    bfr.quarter = 2 AND bfr.year = 2024 AND mcb.category_code = 'CF_009'\n\n  UNION ALL\n\n  SELECT \n    sfr.stock_code,\n    sfr.data AS operating_cash_flow\n  FROM \n    securities_financial_report sfr\n  JOIN \n    map_category_code_securities mcs ON sfr.category_code = mcs.category_code\n  JOIN \n    filtered_companies fc ON sfr.stock_code = fc.stock_code\n  WHERE \n    sfr.quarter = 2 AND sfr.year = 2024 AND mcs.category_code = 'CF_060'\n)\n\nSELECT \n  stock_code,\n  operating_cash_flow,\n  ROW_NUMBER() OVER (ORDER BY operating_cash_flow DESC) AS rank\nFROM \n  operating_cash_flow\nORDER BY rank\nLIMIT 5;\n"
            }
        ],
        "time": 162.76587510108948,
        "evaluate": 0,
        "input_token": 14182,
        "output_token": 3467
    },
    {
        "id": "e3299b8e-bde9-4386-aead-2aaf40d9c8fb",
        "question": "Rank the top 5 companies with the highest Return on Equity (ROE) among  Vietcombank, Techcombank, ACB, BIDV, and VietinBank for the period from 2020 to Q2 2024,  filtering for companies with total assets exceeding 100 billion VND in each year.",
        "answer": "Table 1\n| stock_code   |   year |   quarter |      roe |\n|:-------------|-------:|----------:|---------:|\n| ACB          |   2022 |         0 | 0.234232 |\n| ACB          |   2023 |         0 | 0.226122 |\n| VCB          |   2022 |         0 | 0.220567 |\n| ACB          |   2020 |         0 | 0.216734 |\n| ACB          |   2021 |         0 | 0.213865 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "WITH TotalAssets AS (\n    SELECT \n        stock_code, \n        year, \n        SUM(data) AS total_assets\n    FROM \n        bank_financial_report\n    WHERE \n        category_code = 'BS_300' -- Total assets for banks\n        AND year BETWEEN 2020 AND 2024\n        AND (quarter = 0 OR (year = 2024 AND quarter = 2))\n    GROUP BY \n        stock_code, year\n    HAVING \n        SUM(data) > 100000 -- 100 billion VND\n),\nROEData AS (\n    SELECT \n        fr.stock_code, \n        fr.year, \n        fr.quarter, \n        fr.data AS roe\n    FROM \n        financial_ratio fr\n    JOIN \n        map_category_code_ratio mccr ON fr.ratio_code = mccr.ratio_code\n    WHERE \n        mccr.ratio_name = 'Return On Equity'\n        AND fr.stock_code IN ('VCB', 'TCB', 'ACB', 'BID', 'CTG')\n        AND fr.year BETWEEN 2020 AND 2024\n        AND (fr.quarter = 0 OR (fr.year = 2024 AND fr.quarter = 2))\n)\nSELECT \n    roe.stock_code, \n    roe.year, \n    roe.quarter, \n    roe.roe\nFROM \n    ROEData roe\nJOIN \n    TotalAssets ta ON roe.stock_code = ta.stock_code AND roe.year = ta.year\nORDER BY \n    roe.roe DESC\nLIMIT 5;\n"
            }
        ],
        "score": 1,
        "difficulty": 3,
        "response": "Table 1\n| period_type   | stock_code   | year   | quarter   | total_assets   |\n|---------------|--------------|--------|-----------|----------------|\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "WITH \n  -- Identify stock codes\n  target_companies AS (\n    SELECT 'VCB' AS stock_code UNION\n    SELECT 'TCB' UNION\n    SELECT 'ACB' UNION\n    SELECT 'BID' UNION\n    SELECT 'CTG'\n  ),\n  \n  -- Gather annual total assets (2020-2023)\n  annual_total_assets AS (\n    SELECT \n      bfr.stock_code, \n      bfr.year, \n      CAST(0 AS INTEGER) AS quarter,  -- Cast to match integer type\n      bfr.data AS total_assets\n    FROM \n      bank_financial_report bfr\n    INNER JOIN \n      target_companies tc ON bfr.stock_code = tc.stock_code\n    INNER JOIN \n      map_category_code_bank mccb ON bfr.category_code = mccb.category_code\n    WHERE \n      bfr.quarter = 0 \n      AND bfr.year BETWEEN 2020 AND 2023 \n      AND mccb.en_caption = 'Total assets'\n  ),\n  \n  -- Gather quarterly total assets (Q1 2024 to Q2 2024)\n  quarterly_total_assets AS (\n    SELECT \n      bfr.stock_code, \n      bfr.year, \n      bfr.quarter, \n      bfr.data AS total_assets\n    FROM \n      bank_financial_report bfr\n    INNER JOIN \n      target_companies tc ON bfr.stock_code = tc.stock_code\n    INNER JOIN \n      map_category_code_bank mccb ON bfr.category_code = mccb.category_code\n    WHERE \n      bfr.quarter IN (1, 2) \n      AND bfr.year = 2024 \n      AND mccb.en_caption = 'Total assets'\n  )\n\n-- Combine results and filter companies with total assets exceeding 100 billion VND\nSELECT \n  'Annual' AS period_type, \n  ata.stock_code, \n  ata.year, \n  ata.quarter, \n  ata.total_assets\nFROM \n  annual_total_assets ata\nWHERE \n  ata.total_assets > 100000000000\n\nUNION ALL\n\nSELECT \n  'Quarterly' AS period_type, \n  qta.stock_code, \n  qta.year, \n  qta.quarter, \n  qta.total_assets\nFROM \n  quarterly_total_assets qta\nWHERE \n  qta.total_assets > 100000000000\n\nLIMIT 100;\n"
            },
            {
                "language": "sql",
                "code": "WITH \n  -- Results from Step 1 (assuming the previous query is stored in a temporary table named 'filtered_companies')\n  filtered_companies AS (\n    -- Insert previous query results here or use a temporary table\n    -- For demonstration purposes, using the previous query directly\n    WITH \n      --... (insert all previous CTEs here)\n    SELECT \n      period_type, \n      stock_code, \n      year, \n      quarter, \n      total_assets\n    FROM \n      (\n        -- Insert previous query here\n      ) AS subquery\n  ),\n  \n  -- Extract ROE for the identified stock codes and verified years/quarters\n  roe_data AS (\n    SELECT \n      fc.period_type, \n      fc.stock_code, \n      fc.year, \n      fc.quarter, \n      fr.data AS roe\n    FROM \n      filtered_companies fc\n    INNER JOIN \n      financial_ratio fr ON fc.stock_code = fr.stock_code AND fc.year = fr.year AND fc.quarter = fr.quarter\n    INNER JOIN \n      map_category_code_ratio mccr ON fr.ratio_code = mccr.ratio_code\n    WHERE \n      mccr.ratio_name = 'Return On Equity'\n  )\n\n-- Rank companies by ROE\nSELECT \n  period_type, \n  stock_code, \n  year, \n  quarter, \n  roe,\n  DENSE_RANK() OVER (PARTITION BY period_type ORDER BY roe DESC) AS roe_rank\nFROM \n  roe_data\n\nWHERE \n  roe_rank <= 5\n\nLIMIT 100;\n"
            },
            {
                "language": "sql",
                "code": "-- Final query\nWITH \n  --... (insert all previous CTEs here)\n  filtered_companies AS (\n    --... (insert previous query results here or use a temporary table)\n  ),\n  \n  roe_data AS (\n    --... (insert ROE data CTE here)\n  )\n\nSELECT \n  period_type, \n  stock_code, \n  year, \n  quarter, \n  roe,\n  DENSE_RANK() OVER (PARTITION BY period_type ORDER BY roe DESC) AS roe_rank\nFROM \n  roe_data\n\nWHERE \n  roe_rank <= 5\n\nLIMIT 100;\n"
            }
        ],
        "time": 192.82001304626465,
        "evaluate": 0,
        "input_token": 5133,
        "output_token": 1276
    },
    {
        "id": "3b87156b-84ba-4a7a-ac63-78e7629b7a76",
        "question": "What is the Return on Equity (ROE) and Debt-to-Equity Ratio for Vinamilk and Masan Group for the fiscal year 2023, and how do these compare to their respective figures in 2020?  Analyze the change in these ratios over time for each company, considering the impact of both profitability and financial leverage.",
        "answer": "Table 1\n| stock_code   |   year | ratio_code   |   ratio_value |\n|:-------------|-------:|:-------------|--------------:|\n| MSN          |   2020 | DTER         |     3.62386   |\n| MSN          |   2023 | DTER         |     2.85445   |\n| MSN          |   2020 | ROE          |     0.055733  |\n| MSN          |   2023 | ROE          |     0.0489033 |\n| VNM          |   2020 | DTER         |     0.439424  |\n| VNM          |   2023 | DTER         |     0.503847  |\n| VNM          |   2020 | ROE          |     0.333928  |\n| VNM          |   2023 | ROE          |     0.257506  |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    stock_code, \n    year, \n    ratio_code, \n    data AS ratio_value\nFROM \n    financial_ratio\nWHERE \n    stock_code IN ('VNM', 'MSN') AND\n    ratio_code IN ('ROE', 'DTER') AND\n    year IN (2023, 2020) AND\n    quarter = 0\nORDER BY \n    stock_code, \n    ratio_code, \n    year;\n"
            }
        ],
        "score": 1,
        "difficulty": 2,
        "response": "Error in getting the answer",
        "code_response": "Error in getting the code",
        "evaluate": 0,
        "input_token": 3289,
        "output_token": 1270
    },
    {
        "id": "32d92561-df33-4214-ab25-af40d4de6971",
        "question": "What were the Return on Equity (ROE) and Debt-to-Equity ratios for Vietcombank and Techcombank in 2022?",
        "answer": "Table 1\n| stock_code   | ratio_code   | ratio_name           |      data |\n|:-------------|:-------------|:---------------------|----------:|\n| TCB          | DTER         | Debt To Equity Ratio |  5.16295  |\n| VCB          | DTER         | Debt To Equity Ratio | 12.3717   |\n| TCB          | ROE          | Return On Equity     |  0.180176 |\n| VCB          | ROE          | Return On Equity     |  0.220567 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    fr.stock_code, \n    fr.ratio_code, \n    mcr.ratio_name, \n    fr.data \nFROM \n    financial_ratio fr\nJOIN \n    map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\nWHERE \n    fr.stock_code IN ('VCB', 'TCB') \n    AND fr.year = 2022 \n    AND fr.quarter = 0 \n    AND fr.ratio_code IN ('ROE', 'DTER');\n"
            }
        ],
        "score": 1,
        "difficulty": 2,
        "response": "Table 1\n| stock_code   | ratio_code   |      data | ratio_name           |\n|:-------------|:-------------|----------:|:---------------------|\n| TCB          | DTER         |  5.16295  | Debt To Equity Ratio |\n| VCB          | DTER         | 12.3717   | Debt To Equity Ratio |\n| TCB          | ROE          |  0.180176 | Return On Equity     |\n| VCB          | ROE          |  0.220567 | Return On Equity     |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT \n  fr.stock_code,\n  fr.ratio_code,\n  fr.data,\n  mccr.ratio_name\nFROM \n  financial_ratio fr\n  INNER JOIN map_category_code_ratio mccr ON fr.ratio_code = mccr.ratio_code\nWHERE \n  fr.stock_code IN ('VCB', 'TCB')  -- Identified stock codes for Vietcombank and Techcombank\n  AND fr.year = 2022\n  AND fr.quarter = 0  -- Annual report\n  AND fr.ratio_code IN ('ROE', 'DTER')  -- Desired ratios\nLIMIT 100;  -- Added limit as per the database schema guidelines\n"
            }
        ],
        "time": 35.89398765563965,
        "evaluate": 1,
        "input_token": 2276,
        "output_token": 524
    },
    {
        "id": "f6998c23-5ecd-44d3-a4ae-bf48c341f901",
        "question": "Compare the Current Ratio and Quick Ratio of Mobile World Investment, Vinamilk, and Masan Group for the first quarter of 2024.",
        "answer": "Table 1\n| stock_code   | ratio_name    |     data |\n|:-------------|:--------------|---------:|\n| MSN          | Current Ratio | 0.87025  |\n| MSN          | Quick Ratio   | 0.611971 |\n| MWG          | Current Ratio | 1.80429  |\n| MWG          | Quick Ratio   | 1.15211  |\n| VNM          | Current Ratio | 2.30115  |\n| VNM          | Quick Ratio   | 1.85779  |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    fr.stock_code,\n    mc.ratio_name,\n    fr.data\nFROM \n    financial_ratio fr\nJOIN \n    map_category_code_ratio mc ON fr.ratio_code = mc.ratio_code\nWHERE \n    fr.stock_code IN ('MWG', 'VNM', 'MSN') -- Stock codes for Mobile World Investment, Vinamilk, and Masan Group\n    AND fr.year = 2024\n    AND fr.quarter = 1 -- First quarter\n    AND mc.ratio_name IN ('Current Ratio', 'Quick Ratio');\n"
            }
        ],
        "score": 1,
        "difficulty": 2,
        "response": "Table 1\n| stock_code   |\n|:-------------|\n| MWG          |\n| VNM          |\n| MSN          |\n\nTable 2\n| stock_code   | ratio_name    |   ratio_value |\n|:-------------|:--------------|--------------:|\n| MSN          | Current Ratio |      0.87025  |\n| MSN          | Quick Ratio   |      0.611971 |\n| MWG          | Current Ratio |      1.80429  |\n| MWG          | Quick Ratio   |      1.15211  |\n| VNM          | Current Ratio |      2.30115  |\n| VNM          | Quick Ratio   |      1.85779  |\n\nTable 3\n| stock_code   | ratio_name    |   ratio_value |\n|:-------------|:--------------|--------------:|\n| MSN          | Current Ratio |      0.87025  |\n| MSN          | Quick Ratio   |      0.611971 |\n| MWG          | Current Ratio |      1.80429  |\n| MWG          | Quick Ratio   |      1.15211  |\n| VNM          | Current Ratio |      2.30115  |\n| VNM          | Quick Ratio   |      1.85779  |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT stock_code \nFROM company_info \nWHERE stock_code IN ('MWG', 'VNM', 'MSN');\n"
            },
            {
                "language": "sql",
                "code": "SELECT \n  fr.stock_code,\n  mcr.ratio_name AS ratio_name,\n  fr.data AS ratio_value\nFROM \n  financial_ratio fr\n  INNER JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\nWHERE \n  fr.stock_code IN ('MWG', 'VNM', 'MSN')\n  AND fr.year = 2024\n  AND fr.quarter = 1\n  AND mcr.ratio_code IN ('CurrentR', 'QR')\nLIMIT 100;  -- Add limit as per database schema requirement\n"
            },
            {
                "language": "sql",
                "code": "WITH identified_stock_codes AS (\n  SELECT stock_code \n  FROM company_info \n  WHERE stock_code IN ('MWG', 'VNM', 'MSN')\n)\nSELECT \n  fr.stock_code,\n  mcr.ratio_name AS ratio_name,\n  fr.data AS ratio_value\nFROM \n  financial_ratio fr\n  INNER JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\n  INNER JOIN identified_stock_codes isc ON fr.stock_code = isc.stock_code\nWHERE \n  fr.year = 2024\n  AND fr.quarter = 1\n  AND mcr.ratio_code IN ('CurrentR', 'QR')\nLIMIT 100;\n"
            }
        ],
        "time": 45.445735931396484,
        "evaluate": 0.5,
        "input_token": 2510,
        "output_token": 748
    },
    {
        "id": "68482aa2-d5ec-43e5-8f1a-17ba50d8107b",
        "question": "What was the average Return on Equity (ROE) for Vietcombank, Techcombank, and VPBank in Q2 2024, and how does this compare to their respective average ROE for the same quarter in 2020, considering their investments in subsidiaries?",
        "answer": "Table 1\n| stock_code   |   year |   average_roe |\n|:-------------|-------:|--------------:|\n| EIB          |   2020 |    0.00463626 |\n| MBB          |   2020 |    0.0521778  |\n| OCB          |   2020 |    0.039273   |\n| TCB          |   2020 |    0.0428449  |\n| TCB          |   2024 |    0.0457096  |\n| VCB          |   2020 |    0.0515214  |\n| VPB          |   2020 |    0.0621598  |\n| VPB          |   2024 |    0.026311   |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "WITH bank_and_subsidiaries AS (\n    SELECT DISTINCT f.stock_code, f.year, f.quarter, f.data\n    FROM financial_ratio f\n    JOIN map_category_code_ratio m ON f.ratio_code = m.ratio_code\n    LEFT JOIN sub_and_shareholder s ON f.stock_code = s.stock_code OR f.stock_code = s.invest_on\n    WHERE m.ratio_name = 'Return On Equity'\n      AND f.quarter = 2\n      AND f.year IN (2020, 2024)\n      AND (f.stock_code IN ('VCB', 'TCB', 'VPB') OR s.stock_code IN ('VCB', 'TCB', 'VPB'))\n)\nSELECT stock_code, year, AVG(data) AS average_roe\nFROM bank_and_subsidiaries\nGROUP BY stock_code, year\nORDER BY stock_code, year;\n"
            }
        ],
        "score": 1,
        "difficulty": 3,
        "response": "Table 1\n| stock_code   | subsidiary   |\n|:-------------|:-------------|\n| VCB          | PGI          |\n| VCB          | EIB          |\n| VCB          | MBB          |\n| VCB          | HVN          |\n| VCB          | PVD          |\n| VCB          | OCB          |\n| VPB          | SGP          |\n| VPB          | FDC          |\n| TCB          | VCG          |\n| TCB          | HVN          |\n| VCB          | EIB          |\n| VCB          | MBB          |\n| VCB          | OCB          |\n\nTable 2\n| stock_code   |   year |   avg_roe |\n|:-------------|-------:|----------:|\n| TCB          |   2020 | 0.0428449 |\n| TCB          |   2024 | 0.0457096 |\n| VCB          |   2020 | 0.0515214 |\n| VPB          |   2020 | 0.0621598 |\n| VPB          |   2024 | 0.026311  |\n\nTable 3\n| stock_code   | subsidiary   |   year |   avg_roe |\n|:-------------|:-------------|-------:|----------:|\n| TCB          | HVN          |   2020 | 0.0428449 |\n| TCB          | VCG          |   2020 | 0.0428449 |\n| TCB          | HVN          |   2024 | 0.0457096 |\n| TCB          | VCG          |   2024 | 0.0457096 |\n| VCB          | EIB          |   2020 | 0.0515214 |\n| VCB          | HVN          |   2020 | 0.0515214 |\n| VCB          | MBB          |   2020 | 0.0515214 |\n| VCB          | OCB          |   2020 | 0.0515214 |\n| VCB          | PGI          |   2020 | 0.0515214 |\n| VCB          | PVD          |   2020 | 0.0515214 |\n| VPB          | FDC          |   2020 | 0.0621598 |\n| VPB          | SGP          |   2020 | 0.0621598 |\n| VPB          | FDC          |   2024 | 0.026311  |\n| VPB          | SGP          |   2024 | 0.026311  |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "-- Step 1: Identify stock codes and retrieve subsidiary investment information\nWITH target_companies AS (\n  SELECT stock_code\n  FROM company_info\n  WHERE stock_code IN ('VCB', 'TCB', 'VPB')\n)\nSELECT \n  tc.stock_code,\n  ssh.invest_on AS subsidiary\nFROM target_companies tc\nLEFT JOIN sub_and_shareholder ssh ON tc.stock_code = ssh.stock_code\nLIMIT 100;  -- Add limit as per the note\n"
            },
            {
                "language": "sql",
                "code": "-- Step 2: Extract ROE, calculate average, and compare\nWITH target_companies AS (\n  SELECT stock_code\n  FROM company_info\n  WHERE stock_code IN ('VCB', 'TCB', 'VPB')\n),\nroe_data AS (\n  SELECT \n    fr.stock_code,\n    fr.year,\n    fr.quarter,\n    fr.data AS roe\n  FROM financial_ratio fr\n  JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\n  JOIN target_companies tc ON fr.stock_code = tc.stock_code\n  WHERE mcr.ratio_name = 'Return On Equity'\n    AND fr.quarter = 2  -- Q2\n    AND fr.year IN (2020, 2024)\n)\nSELECT \n  stock_code,\n  year,\n  AVG(roe) AS avg_roe\nFROM roe_data\nGROUP BY stock_code, year\nORDER BY stock_code, year\nLIMIT 100;  -- Add limit as per the note\n"
            },
            {
                "language": "sql",
                "code": "WITH target_companies AS (\n  SELECT stock_code\n  FROM company_info\n  WHERE stock_code IN ('VCB', 'TCB', 'VPB')\n),\nsubsidiary_info AS (\n  SELECT \n    tc.stock_code,\n    ssh.invest_on AS subsidiary\n  FROM target_companies tc\n  LEFT JOIN sub_and_shareholder ssh ON tc.stock_code = ssh.stock_code\n),\nroe_data AS (\n  SELECT \n    fr.stock_code,\n    fr.year,\n    fr.quarter,\n    fr.data AS roe\n  FROM financial_ratio fr\n  JOIN map_category_code_ratio mcr ON fr.ratio_code = mcr.ratio_code\n  JOIN target_companies tc ON fr.stock_code = tc.stock_code\n  WHERE mcr.ratio_name = 'Return On Equity'\n    AND fr.quarter = 2  -- Q2\n    AND fr.year IN (2020, 2024)\n)\nSELECT \n  si.stock_code,\n  si.subsidiary,\n  rd.year,\n  AVG(rd.roe) AS avg_roe\nFROM subsidiary_info si\nJOIN roe_data rd ON si.stock_code = rd.stock_code\nGROUP BY si.stock_code, si.subsidiary, rd.year\nORDER BY si.stock_code, rd.year\nLIMIT 100;  -- Add limit as per the note\n"
            }
        ],
        "time": 75.71257615089417,
        "evaluate": 0,
        "input_token": 4382,
        "output_token": 1479
    },
    {
        "id": "367dc7bd-7224-409a-a7c9-849e587f88e5",
        "question": "What is the trend of the current ratio for Vietcombank, Techcombank, and Sacombank from 2020 to Q2 2024?",
        "answer": "Table 1\n|   year |   quarter | stock_code   |   current_ratio |\n|-------:|----------:|:-------------|----------------:|\n|   2020 |         0 | STB          |        1.56301  |\n|   2020 |         0 | TCB          |        2.83619  |\n|   2020 |         0 | VCB          |        7.25011  |\n|   2021 |         0 | STB          |        1.02262  |\n|   2021 |         0 | TCB          |        4.35343  |\n|   2021 |         0 | VCB          |        6.29498  |\n|   2022 |         0 | STB          |        1.09035  |\n|   2022 |         0 | TCB          |        3.29776  |\n|   2022 |         0 | VCB          |        3.56816  |\n|   2023 |         0 | STB          |        0.700152 |\n|   2023 |         0 | TCB          |        2.66367  |\n|   2023 |         0 | VCB          |        4.7828   |\n|   2024 |         1 | STB          |        1.0368   |\n|   2024 |         1 | TCB          |        2.40445  |\n|   2024 |         1 | VCB          |        3.48899  |\n|   2024 |         2 | TCB          |        2.88946  |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "SELECT \n    year, \n    quarter, \n    stock_code, \n    data AS current_ratio\nFROM \n    financial_ratio\nWHERE \n    ratio_code = 'CurrentR'\n    AND stock_code IN ('VCB', 'TCB', 'STB')\n    AND (\n        (year = 2020 AND quarter = 0) OR\n        (year = 2021 AND quarter = 0) OR\n        (year = 2022 AND quarter = 0) OR\n        (year = 2023 AND quarter = 0) OR\n        (year = 2024 AND quarter IN (0, 1, 2))\n    )\nORDER BY \n    year, \n    quarter, \n    stock_code;\n"
            }
        ],
        "score": 1,
        "difficulty": 2,
        "response": "Table 1\n| stock_code   | company_name                                       |   year |   quarter |   current_ratio |\n|:-------------|:---------------------------------------------------|-------:|----------:|----------------:|\n| STB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n S\u00e0i G\u00f2n Th\u01b0\u01a1ng T\u00edn    |   2020 |         4 |         1.55489 |\n| STB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n S\u00e0i G\u00f2n Th\u01b0\u01a1ng T\u00edn    |   2021 |         4 |         1.01974 |\n| STB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n S\u00e0i G\u00f2n Th\u01b0\u01a1ng T\u00edn    |   2022 |         4 |         1.0881  |\n| TCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam    |   2020 |         4 |         2.83619 |\n| TCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam    |   2021 |         4 |         4.40216 |\n| TCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam    |   2022 |         4 |         3.29776 |\n| TCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam    |   2023 |         4 |         3.32547 |\n| TCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n K\u1ef9 th\u01b0\u01a1ng Vi\u1ec7t Nam    |   2024 |         2 |         2.88946 |\n| VCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ngo\u1ea1i th\u01b0\u01a1ng Vi\u1ec7t Nam |   2020 |         4 |         7.86737 |\n| VCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ngo\u1ea1i th\u01b0\u01a1ng Vi\u1ec7t Nam |   2021 |         4 |         6.58505 |\n| VCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ngo\u1ea1i th\u01b0\u01a1ng Vi\u1ec7t Nam |   2022 |         4 |         3.62631 |\n| VCB          | Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ngo\u1ea1i th\u01b0\u01a1ng Vi\u1ec7t Nam |   2023 |         4 |         5.24741 |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "SELECT \n  fr.stock_code,\n  ci.company_name,  -- assuming 'company_name' is available in 'company_info' table, if not, remove this column\n  fr.year,\n  fr.quarter,\n  fr.data AS current_ratio\nFROM \n  financial_ratio fr\n  INNER JOIN company_info ci ON fr.stock_code = ci.stock_code\nWHERE \n  fr.ratio_code = 'CurrentR'\n  AND fr.stock_code IN ('VCB', 'TCB', 'STB')\n  AND ((fr.year IN (2020, 2021, 2022, 2023) AND fr.quarter = 4) \n       OR (fr.year = 2024 AND fr.quarter = 2))\nORDER BY \n  fr.stock_code, fr.year, fr.quarter\nLIMIT 100;  -- adjust the limit as per your requirement\n"
            }
        ],
        "time": 46.548340797424316,
        "evaluate": 0,
        "input_token": 2038,
        "output_token": 552
    },
    {
        "id": "76f8d91f-264c-4654-aad8-17a86d41aafd",
        "question": "For the period 2020-Q2 2024, provide the year-over-year change in cash and cash equivalents, and short-term borrowings for Mobile World Investment, Vinamilk, and PetroVietnam Gas.  Calculate the cash ratio for each company for each year.",
        "answer": "Table 1\n| stock_code   |   year |   yoy_change_cash |   yoy_change_borrowings |   cash_ratio |\n|:-------------|-------:|------------------:|------------------------:|-------------:|\n| GAS          |   2020 |         nan       |                nan      |     5.14732  |\n| GAS          |   2021 |           1.20453 |                -52.3583 |    10.9344   |\n| GAS          |   2022 |          99.0317  |                -90.7175 |   234.451    |\n| GAS          |   2023 |         -46.263   |               3466.5    |     3.5325   |\n| MWG          |   2020 |         nan       |                nan      |     0.470257 |\n| MWG          |   2021 |         -43.6296  |                 57.742  |     0.16805  |\n| MWG          |   2022 |          22.1874  |                -56.636  |     0.473517 |\n| MWG          |   2023 |           6.02021 |                 78.9698 |     0.280508 |\n| VNM          |   2020 |         nan       |                nan      |     0.288559 |\n| VNM          |   2021 |          11.2403  |                 28.2356 |     0.250316 |\n| VNM          |   2022 |          -2.0697  |                -48.1246 |     0.472546 |\n| VNM          |   2023 |          26.613   |                 68.842  |     0.354358 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "WITH cash_data AS (\n    SELECT \n        stock_code,\n        year,\n        SUM(CASE WHEN category_code = 'BS_110' THEN data ELSE 0 END) AS cash_and_cash_equivalents,\n        SUM(CASE WHEN category_code = 'BS_320' THEN data ELSE 0 END) AS short_term_borrowings\n    FROM \n        non_bank_financial_report\n    WHERE \n        stock_code IN ('MWG', 'VNM', 'GAS') \n        AND year BETWEEN 2020 AND 2024\n        AND quarter = 0\n    GROUP BY \n        stock_code, year\n),\nyear_over_year_change AS (\n    SELECT \n        a.stock_code,\n        a.year,\n        (a.cash_and_cash_equivalents - b.cash_and_cash_equivalents) / NULLIF(b.cash_and_cash_equivalents, 0) * 100 AS yoy_change_cash,\n        (a.short_term_borrowings - b.short_term_borrowings) / NULLIF(b.short_term_borrowings, 0) * 100 AS yoy_change_borrowings\n    FROM \n        cash_data a\n    LEFT JOIN \n        cash_data b ON a.stock_code = b.stock_code AND a.year = b.year + 1\n),\ncash_ratio AS (\n    SELECT \n        stock_code,\n        year,\n        cash_and_cash_equivalents / NULLIF(short_term_borrowings, 0) AS cash_ratio\n    FROM \n        cash_data\n)\nSELECT \n    y.stock_code,\n    y.year,\n    y.yoy_change_cash,\n    y.yoy_change_borrowings,\n    c.cash_ratio\nFROM \n    year_over_year_change y\nJOIN \n    cash_ratio c ON y.stock_code = c.stock_code AND y.year = c.year\nORDER BY \n    y.stock_code, y.year;\n"
            }
        ],
        "score": 1,
        "difficulty": 4,
        "response": "Table 1\n| stock_code   | year   | quarter   | category_code   | data   |\n|--------------|--------|-----------|-----------------|--------|\n\nTable 2\n| stock_code   | year   | cash_equivalents   | short_term_borrowings   | cash_equivalents_yoy   | short_term_borrowings_yoy   | cash_ratio   |\n|--------------|--------|--------------------|-------------------------|------------------------|-----------------------------|--------------|\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "-- Subquery to identify stock codes\nWITH target_companies AS (\n  SELECT stock_code\n  FROM company_info\n  WHERE stock_code IN ('MWG', 'VNM', 'GAS')\n)\n\n-- Gather quarterly financial data\nSELECT \n  t.stock_code,\n  n.year,\n  n.quarter,\n  n.category_code,\n  n.data\nFROM \n  target_companies t\n  JOIN non_bank_financial_report n ON t.stock_code = n.stock_code\nWHERE \n  n.year BETWEEN 2020 AND 2024\n  AND n.quarter = 2  -- Q2\n  AND n.category_code IN (\n    -- Assuming category codes based on common financial reporting practices\n    -- Replace with actual category codes from `map_category_code_non_bank` table\n    'BS_1101',  -- Cash and Cash Equivalents\n    'BS_2101'   -- Short-term Borrowings\n  )\n"
            },
            {
                "language": "sql",
                "code": "-- Combine Step 1 with calculations for YoY change and cash ratio\nWITH target_companies AS (\n  SELECT stock_code\n  FROM company_info\n  WHERE stock_code IN ('MWG', 'VNM', 'GAS')\n),\nfinancial_data AS (\n  SELECT \n    t.stock_code,\n    n.year,\n    n.quarter,\n    n.category_code,\n    n.data\n  FROM \n    target_companies t\n    JOIN non_bank_financial_report n ON t.stock_code = n.stock_code\n  WHERE \n    n.year BETWEEN 2020 AND 2024\n    AND n.quarter = 2  -- Q2\n    AND n.category_code IN ('BS_1101', 'BS_2101')  -- Replace with actual category codes\n),\npivoted_data AS (\n  SELECT \n    stock_code,\n    year,\n    SUM(CASE WHEN category_code = 'BS_1101' THEN data ELSE 0 END) AS cash_equivalents,\n    SUM(CASE WHEN category_code = 'BS_2101' THEN data ELSE 0 END) AS short_term_borrowings\n  FROM \n    financial_data\n  GROUP BY \n    stock_code, year\n),\ncalculations AS (\n  SELECT \n    stock_code,\n    year,\n    cash_equivalents,\n    short_term_borrowings,\n    -- Year-over-Year (YoY) change calculations\n    (cash_equivalents - LAG(cash_equivalents) OVER (PARTITION BY stock_code ORDER BY year)) AS cash_equivalents_yoy,\n    (short_term_borrowings - LAG(short_term_borrowings) OVER (PARTITION BY stock_code ORDER BY year)) AS short_term_borrowings_yoy,\n    -- Cash Ratio calculation\n    (cash_equivalents / short_term_borrowings) AS cash_ratio\n  FROM \n    pivoted_data\n)\n-- Final query with desired output\nSELECT \n  stock_code,\n  year,\n  cash_equivalents,\n  short_term_borrowings,\n  cash_equivalents_yoy,\n  short_term_borrowings_yoy,\n  cash_ratio\nFROM \n  calculations\nORDER BY \n  stock_code, year\nLIMIT 100;  -- Add limit as per instructions\n"
            }
        ],
        "time": 66.94357538223267,
        "evaluate": 0,
        "input_token": 3930,
        "output_token": 2064
    },
    {
        "id": "78183cf7-204e-4442-b5b1-209c51e9ab3f",
        "question": "For the year 2023, what was the Debt-to-Equity ratio for VinGroup,  and how does this ratio change when considering the consolidated financial statements including its subsidiaries' debt and equity?",
        "answer": "Table 1\n|   standalone_dter |\n|------------------:|\n|           3.50444 |\n\nTable 2\n|   standalone_dter |   consolidated_dter |\n|------------------:|--------------------:|\n|           3.50444 |            0.499221 |\n\n",
        "code": [
            {
                "language": "sql",
                "code": "-- Step 1: Retrieve the Debt-to-Equity ratio for VinGroup for the year 2023\nSELECT fr.data AS standalone_dter\nFROM financial_ratio fr\nJOIN map_category_code_ratio mccr ON fr.ratio_code = mccr.ratio_code\nWHERE fr.stock_code = 'VIC'\n  AND fr.year = 2023\n  AND fr.quarter = 0\n  AND mccr.ratio_name = 'Debt To Equity Ratio';\n\n-- Step 2: Identify the subsidiaries of VinGroup\nWITH subsidiaries AS (\n    SELECT invest_on\n    FROM sub_and_shareholder\n    WHERE stock_code = 'VIC'\n)\n\n-- Step 3: Retrieve debt and equity data for VinGroup and its subsidiaries\n, debt_equity_data AS (\n    SELECT stock_code,\n           SUM(CASE WHEN category_code = 'BS_400' THEN data ELSE 0 END) AS total_liabilities,\n           SUM(CASE WHEN category_code IN ('BS_400', 'BS_410', 'BS_420') THEN data ELSE 0 END) AS total_equity\n    FROM non_bank_financial_report\n    WHERE (stock_code = 'VIC' OR stock_code IN (SELECT invest_on FROM subsidiaries))\n      AND year = 2023\n      AND quarter = 0\n    GROUP BY stock_code\n)\n\n-- Step 4: Calculate the consolidated Debt-to-Equity ratio\n, consolidated_dter AS (\n    SELECT SUM(total_liabilities) / NULLIF(SUM(total_equity), 0) AS consolidated_dter\n    FROM debt_equity_data\n)\n\n-- Step 5: Combine results\nSELECT standalone_dter, consolidated_dter\nFROM (\n    SELECT fr.data AS standalone_dter\n    FROM financial_ratio fr\n    JOIN map_category_code_ratio mccr ON fr.ratio_code = mccr.ratio_code\n    WHERE fr.stock_code = 'VIC'\n      AND fr.year = 2023\n      AND fr.quarter = 0\n      AND mccr.ratio_name = 'Debt To Equity Ratio'\n) AS standalone,\nconsolidated_dter;\n"
            }
        ],
        "score": 1,
        "difficulty": 4,
        "response": "Table 1\n|   vingroup_dter |\n|----------------:|\n|         3.50444 |\n\nTable 2\n|   total_debt |   total_equity |\n|-------------:|---------------:|\n|            0 |              0 |\n\nTable 3\n|   vingroup_dter | consolidated_dter   |\n|----------------:|:--------------------|\n|         1.43451 |                     |\n\n",
        "code_response": [
            {
                "language": "sql",
                "code": "WITH vingroup_stock_code AS (\n  SELECT stock_code \n  FROM company_info \n  WHERE industry = 'Real Estate' AND is_bank = FALSE AND is_securities = FALSE\n  LIMIT 1  -- Assuming only one record matches the criteria\n),\nvingroup_and_subs AS (\n  SELECT stock_code FROM vingroup_stock_code\n  UNION ALL\n  SELECT invest_on \n  FROM sub_and_shareholder \n  WHERE stock_code = (SELECT stock_code FROM vingroup_stock_code)\n),\nconsolidated_data AS (\n  SELECT \n    COALESCE(SUM(CASE WHEN category_code = 'BS_XXXX' THEN data ELSE 0 END), 0) AS total_debt,\n    COALESCE(SUM(CASE WHEN category_code = 'BS_YYYY' THEN data ELSE 0 END), 0) AS total_equity\n  FROM non_bank_financial_report\n  WHERE stock_code IN (SELECT stock_code FROM vingroup_and_subs)\n    AND year = 2023 \n    AND quarter = 0\n),\nvingroup_dter AS (\n  SELECT data AS vingroup_dter \n  FROM financial_ratio \n  JOIN map_category_code_ratio ON financial_ratio.ratio_code = map_category_code_ratio.ratio_code \n  WHERE financial_ratio.stock_code = (SELECT stock_code FROM vingroup_stock_code) \n    AND financial_ratio.year = 2023 \n    AND financial_ratio.quarter = 0 \n    AND map_category_code_ratio.ratio_name = 'Debt To Equity Ratio'\n  LIMIT 1  -- Assuming only one record matches the criteria\n)\nSELECT \n  vd.vingroup_dter,\n  CASE \n    WHEN cd.total_equity = 0 THEN NULL \n    ELSE (cd.total_debt / cd.total_equity) \n  END AS consolidated_dter\nFROM vingroup_dter vd\nCROSS JOIN consolidated_data cd\nLIMIT 1;\n"
            }
        ],
        "time": 167.66225218772888,
        "evaluate": 0,
        "input_token": 7106,
        "output_token": 1317
    }
]