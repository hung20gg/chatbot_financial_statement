-- Calculate ROS of VIC, VRE and VHM in first 2 quarter of 2024

-- Get Net income value
WITH net_income AS (
    SELECT nbfr.data AS net_income, nbfr.stock_code as stock_code, nbfr.quarter as quarter, nbfr.year as year
    FROM non_bank_financial_report nbfr
    WHERE nbfr.stock_code in ('VIC', 'VRE', 'VHM')
      AND nbfr.year = 2024
      AND nbfr.quarter in (1,2)
      AND nbfr.category_code = 'IS_060'
),

-- Get Revenue value
revenue AS (
    SELECT nbfr.data AS revenue, nbfr.stock_code as stock_code, nbfr.quarter as quarter, nbfr.year as year
    FROM non_bank_financial_report nbfr
    WHERE nbfr.stock_code in ('VIC', 'VRE', 'VHM')
      AND nbfr.year = 2024
      AND nbfr.quarter in (1,2)
      AND nbfr.category_code = 'IS_001'
)
-- Select detail information 
SELECT 
	net_income.stock_code,
	net_income.year,
	net_income.quarter,
	net_income.net_income,
    (net_income.net_income / revenue.revenue) AS ROS
    	
FROM net_income
JOIN equity 
ON net_income.stock_code = revenue.stock_code
AND net_income.quarter = revenue.quarter 
AND net_income.year = revenue.year;
-- Join on both quarter and year to avoid duplication