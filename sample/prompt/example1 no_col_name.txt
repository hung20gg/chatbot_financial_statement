-- Calculate ROS of VIC, VRE and VHM in first 2 quarter of 2024

-- Get Net income value
WITH net_income AS (
    SELECT data AS net_income, stock_code, quarter, year
    FROM non_bank_financial_report
    WHERE stock_code in ('VIC', 'VRE', 'VHM')
      AND year = 2024
      AND quarter in (1,2)
      AND category_code = 'IS_060'
),

-- Get Revenue value
revenue AS (
    SELECT data AS revenue, stock_code, quarter, year
    FROM non_bank_financial_report
    WHERE stock_code in ('VIC', 'VRE', 'VHM')
      AND year = 2024
      AND quarter in (1,2)
      AND category_code = 'IS_001'
)
-- Select detail information 
SELECT 
	net_income.stock_code,
	net_income.year,
	net_income.quarter,
	net_income.net_income,
    (net_income.net_income / revenue.revenue) AS ROS
    	
FROM net_income
JOIN equity 
ON net_income.stock_code = revenue.stock_code
AND net_income.quarter = revenue.quarter 
AND net_income.year = revenue.year;
-- Join on both quarter and year to avoid duplication