-- 1. what is the ... of BIDV in q2 2023 ?
select "BS_330","BS_110","BS_120"
from bank_financial_report_hori
where stock_code = 'BID'
and year = 2023
and quarter = 2;

-- 2. What is the Return on Equity (ROE) for Masan Group (MSN) in Q2 2023?
select "ROE"
from financial_ratios_hori 
where stock_code = 'MSN'
and year = 2023
and quarter = 2;

-- 12. Rank the top 5 companies with total assets greater than 100,000,000,000,000 VND as of Q2 2024 based on their Return on Equity (ROE).

WITH company_assets AS (
    -- For banks: get total assets from BS_300
    SELECT 
        bfrh.stock_code,
        bfrh.year,
        bfrh.quarter,
        bfrh."BS_300" AS total_assets
    FROM bank_financial_report_hori bfrh
    WHERE bfrh.quarter = 2
      AND bfrh.year = 2024
      AND bfrh."BS_300" > 100000000
    UNION ALL
    -- For non-banks: get total assets from BS_270
    SELECT 
        nbfrh.stock_code,
        nbfrh.year,
        nbfrh.quarter,
        nbfrh."BS_270" AS total_assets
    FROM non_bank_financial_report_hori nbfrh
    WHERE nbfrh.quarter = 2
      AND nbfrh.year = 2024
      AND nbfrh."BS_270" > 100000000
    UNION ALL
    -- For securities firms: get total assets from BS_270
    SELECT 
        sfrh.stock_code,
        sfrh.year,
        sfrh.quarter,
        sfrh."BS_270" AS total_assets
    FROM sec_financial_report_hori sfrh
    WHERE sfrh.quarter = 2
      AND sfrh.year = 2024
      AND sfrh."BS_270" > 100000000
),
company_roe AS (
    -- Get ROE from financial_ratios_hori table
    SELECT 
        frh.stock_code,
        frh.year,
        frh.quarter,
        frh."ROE" 
    FROM financial_ratios_hori frh
    WHERE frh.quarter = 2
      AND frh.year = 2024
)
-- Join the two results based on stock_code and quarter
SELECT 
    ca.stock_code,
    ca.total_assets,
    cr."ROE"
FROM company_assets ca
JOIN company_roe cr 
    ON ca.stock_code = cr.stock_code
    AND ca.year = cr.year
    AND ca.quarter = cr.quarter
ORDER BY cr."ROE" DESC
LIMIT 5;

